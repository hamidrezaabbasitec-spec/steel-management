<!DOCTYPE html>
<html lang="fa" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Steel Management Tech - سیستم یکپارچه مدیریت صنعتی</title>

    <!-- منابع -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700&display=swap');

        :root {
            --siemens-blue: #009999;
            --siemens-dark-blue: #006672;
            --siemens-light: #6fc9c9;
            --siemens-gray: #f5f5f5;
            --siemens-dark-gray: #1f2937;
            --industrial-dark: #0f172a;
            --gold: #ffd700;
            --steel-blue: #009999;
            --steel-light: #6fc9c9;
            --steeltech-dark: #111827;
            --steeltech-red: #009999;
            --steeltech-text: #c3dafe;
            --steeltech-light: #60a5fa;
            --card-bg: rgba(255, 255, 255, 0.04);
            --card-border: rgba(255, 255, 255, 0.08);
        }

        * {
            font-family: 'Vazirmatn', sans-serif;
            box-sizing: border-box;
        }

        body {
            background: #ffffff;
            color: #1a1a1a;
            line-height: 1.6;
        }

        a {
            transition: color 0.2s ease, opacity 0.2s ease;
        }

        /* رنگ‌ها */
        .siemens-bg {
            background-color: var(--siemens-blue);
        }

        .siemens-text,
        .text-siements-blue,
        .text-siemens-blue {
            color: var(--siemens-blue);
        }

        .text-siements-light,
        .text-siemens-light,
        .text-steel-light {
            color: var(--siemens-light);
        }

        .siemens-border {
            border-color: var(--siemens-blue);
        }

        .gold-text {
            color: var(--gold);
        }

        .industrial-gradient {
            background: linear-gradient(135deg, var(--siemens-blue) 0%, var(--industrial-dark) 100%);
        }

        /* استایل‌های Header - سبک Siemens */
        header {
            position: sticky;
            top: 0;
            z-index: 1000;
            background: #ffffff;
        }
        
        .nav-link {
            color: #1a1a1a;
            text-decoration: none;
        }
        
        .nav-link:hover {
            color: var(--siemens-blue);
        }

        /* کارت‌ها و سطوح - Siemens Style */
        .section-card,
        .siemens-card,
        .glass-card {
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 0;
            color: #1a1a1a;
            transition: all 0.3s ease;
        }

        .section-card:hover,
        .siemens-card:hover,
        .glass-card:hover,
        .report-card:hover,
        .user-card:hover,
        .factory-card:hover {
            border-color: var(--siemens-blue);
            box-shadow: 0 4px 12px rgba(0, 153, 153, 0.1);
        }

        .report-card {
            background: #ffffff;
            border: 1px solid #e5e7eb;
            color: #1a1a1a;
        }

        .user-card {
            background: #ffffff;
            border: 1px solid #e5e7eb;
            color: #1a1a1a;
        }

        .factory-card {
            background: #ffffff;
            border: 1px solid #e5e7eb;
            color: #1a1a1a;
            cursor: pointer;
        }

        /* دکمه‌ها */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            border-radius: 10px;
            padding: 10px 16px;
            transition: all 0.2s ease;
        }

        .btn-primary,
        .btn-steeltech {
            background: var(--siemens-blue);
            color: white;
        }

        .btn-primary:hover,
        .btn-steeltech:hover {
            background: var(--siemens-dark-blue);
        }

        .btn-ghost {
            background: rgba(255, 255, 255, 0.05);
            color: #e5e7eb;
            border: 1px solid var(--card-border);
        }

        .btn-ghost:hover {
            background: rgba(255, 255, 255, 0.12);
        }

        .btn-amber {
            background: #d97706;
            color: white;
        }

        /* نشان‌ها */
        .contractor-badge,
        .priority-badge,
        .invoice-status,
        .tender-status,
        .role-badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.78rem;
            font-weight: 700;
            border: 1px solid transparent;
        }

        .contractor-badge {
            background: rgba(227, 242, 253, 0.2);
            color: var(--siemens-light);
            border-color: rgba(0, 153, 153, 0.3);
        }

        .priority-badge { background: rgba(255, 255, 255, 0.06); }
        .priority-emergency { background: rgba(252, 129, 129, 0.15); color: #fc8181; border-color: rgba(252, 129, 129, 0.3); }
        .priority-high { background: rgba(236, 201, 75, 0.15); color: #ecc94b; border-color: rgba(236, 201, 75, 0.3); }
        .priority-normal { background: rgba(99, 179, 237, 0.15); color: #63b3ed; border-color: rgba(99, 179, 237, 0.3); }

        .tender-status { background: rgba(0, 153, 153, 0.12); color: var(--siemens-light); border-color: rgba(0, 153, 153, 0.35); }
        .tender-active { background: rgba(104, 211, 145, 0.15); color: #68d391; border-color: rgba(104, 211, 145, 0.3); }
        .tender-planned { background: rgba(99, 179, 237, 0.15); color: #63b3ed; border-color: rgba(99, 179, 237, 0.3); }
        .tender-closed { background: rgba(160, 174, 192, 0.15); color: #a0aec0; border-color: rgba(160, 174, 192, 0.3); }

        .invoice-paid { background: rgba(104, 211, 145, 0.2); color: #68d391; border-color: rgba(104, 211, 145, 0.25); }
        .invoice-pending { background: rgba(236, 201, 75, 0.2); color: #ecc94b; border-color: rgba(236, 201, 75, 0.25); }
        .invoice-overdue { background: rgba(252, 129, 129, 0.2); color: #fc8181; border-color: rgba(252, 129, 129, 0.25); }

        .role-admin { background: rgba(239, 68, 68, 0.2); color: #ef4444; border-color: rgba(239, 68, 68, 0.3); }
        .role-manager { background: rgba(59, 130, 246, 0.2); color: #3b82f6; border-color: rgba(59, 130, 246, 0.3); }
        .role-engineer { background: rgba(16, 185, 129, 0.2); color: #10b981; border-color: rgba(16, 185, 129, 0.3); }
        .role-operator { background: rgba(139, 92, 246, 0.2); color: #8b5cf6; border-color: rgba(139, 92, 246, 0.3); }

        /* وضعیت‌ها */
        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 999px;
            display: inline-block;
            margin-left: 8px;
        }

        .status-active { background: #10b981; }
        .status-warning { background: #f59e0b; }
        .status-maintenance { background: #dc2626; }

        /* هدینگ‌ها و بخش‌ها */
        .section-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 800;
            color: white;
        }

        /* نوار پیشرفت */
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 999px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--siemens-blue), var(--siemens-light));
            border-radius: inherit;
        }

        /* ناوبری و منو */
        /* Mega menu styles are defined below */

        /* کارت‌های تخصصی */
        .tender-card { border-left: 4px solid var(--siemens-blue); }
        .commerce-card { 
            border-top: 3px solid var(--siemens-blue);
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 0;
            color: #1a1a1a;
        }
        .contract-card { border-right: 4px solid var(--siemens-blue); transition: all 0.3s ease; }
        .contract-waiting { border-right-color: #f59e0b; }
        .contract-signed { border-right-color: #10b981; }
        .contract-expired { border-right-color: #ef4444; }
        
        /* استایل‌های Navigation - سبک Siemens */
        .nav-item {
            position: relative;
        }
        
        .nav-link {
            transition: all 0.2s ease;
            border-bottom: 3px solid transparent;
            color: #1a1a1a;
            text-decoration: none;
            display: flex;
            align-items: center;
        }
        
        .nav-link:hover {
            border-bottom-color: var(--siemens-blue);
            color: var(--siemens-blue) !important;
        }
        
        .mega-menu {
            animation: fadeInDown 0.3s ease-out;
            margin-top: 0;
            min-width: 320px;
        }
        
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .nav-item:hover .mega-menu { 
            display: block !important; 
        }
        
        .mega-menu a {
            transition: all 0.2s ease;
        }
        
        .mega-menu a:hover {
            background-color: #f9fafb;
        }

        /* افکت‌ها */
        .pulse-gold { animation: pulse-gold 2s infinite; }
        @keyframes pulse-gold { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }

        /* پس‌زمینه تزئینی */
        .floating-tech {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: -1;
            opacity: 0.05;
        }

        .floating-tech::before {
            content: "";
            position: absolute;
            width: 320px;
            height: 320px;
            border-radius: 50%;
            background: var(--siemens-blue);
            filter: blur(110px);
            top: 8%;
            right: 8%;
        }

        .floating-tech::after {
            content: "";
            position: absolute;
            width: 420px;
            height: 420px;
            border-radius: 50%;
            background: var(--gold);
            filter: blur(110px);
            bottom: 8%;
            left: 8%;
        }

        /* لوگو */
        .logo-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* لوگو صنعتی - سبک زیمنس */
        .logo-icon {
            width: 75px;
            height: 75px;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3), inset 0 2px 4px rgba(255, 255, 255, 0.1);
            border: 3px solid var(--siemens-blue);
        }

        .logo-icon::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(0, 153, 153, 0.1) 0%, transparent 50%);
            border-radius: 4px;
        }

        .logo-icon::after {
            content: '';
            position: absolute;
            inset: 2px;
            border: 1px solid rgba(0, 153, 153, 0.4);
            border-radius: 3px;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        .logo-icon i {
            color: var(--siemens-light);
            font-size: 32px;
            z-index: 1;
            text-shadow: 0 2px 8px rgba(0, 153, 153, 0.5);
            filter: drop-shadow(0 0 4px rgba(111, 201, 201, 0.6));
        }

        .logo-text {
            display: flex;
            flex-direction: column;
            line-height: 1.3;
            margin-right: 12px;
        }

        .logo-text .brand {
            font-size: 1.75rem;
            font-weight: 700;
            color: #000000;
            letter-spacing: -0.5px;
            font-family: 'Arial', sans-serif;
        }

        .logo-text .tagline {
            font-size: 0.75rem;
            color: #666666;
            font-weight: 400;
            margin-top: 2px;
        }

        @keyframes shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* شبکه‌ها */
        .equipment-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        /* پیجینیشن */
        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 2rem;
            gap: 0.5rem;
        }

        .pagination button {
            padding: 0.5rem 1rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            color: white;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .pagination button:hover,
        .pagination button.active {
            background: var(--siemens-blue);
            border-color: var(--siemens-blue);
        }

        /* آیکون‌ها - Siemens Style */
        .factory-icon {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, var(--siemens-blue), var(--siemens-light));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            box-shadow: 0 4px 12px rgba(0, 153, 153, 0.2);
        }
        
        .factory-card-enhanced {
            background: #ffffff;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 1.2rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            transform: scale(0.95);
        }
        
        .factory-card-enhanced:hover {
            transform: scale(0.98);
        }
        
        .factory-card-enhanced::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 4px;
            height: 100%;
            background: var(--siemens-blue);
            transition: width 0.3s ease;
        }
        
        .factory-card-enhanced:hover {
            border-color: var(--siemens-blue);
            box-shadow: 0 8px 24px rgba(0, 153, 153, 0.15);
            transform: translateY(-4px);
        }
        
        .factory-card-enhanced:hover::before {
            width: 100%;
            opacity: 0.05;
        }
        
        .factory-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .factory-stat-item {
            background: #f9fafb;
            padding: 0.75rem;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }
        
        .factory-stat-label {
            font-size: 0.75rem;
            color: #6b7280;
            margin-bottom: 0.25rem;
        }
        
        .factory-stat-value {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1a1a1a;
        }

        /* هشدار */
        .urgent-alert {
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 12px;
        }

        /* فیلتر فعال */
        .active {
            background: var(--siemens-blue) !important;
            color: white !important;
        }

        /* کلاس‌های Tailwind سفارشی‌شده */
        .bg-steel-blue { background-color: var(--steel-blue); color: white; }
        .hover\:bg-steel-blue\/80:hover { background-color: rgba(0, 153, 153, 0.8); }

        .bg-gradient-to-r.from-steeltech-dark.to-steeltech-red {
            background: linear-gradient(to right, var(--steeltech-dark), var(--steeltech-red));
        }

        .bg-gradient-to-r.from-steeltech-dark.to-steeltech-red .logo-icon {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.05));
        }

        .glass-effect {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(12px);
        }

        /* استایل‌های Collapsible Sections - Siemens Style */
        .collapsible-section {
            margin-bottom: 3rem;
            border-radius: 0;
            overflow: hidden;
            background: #ffffff;
            border: none;
            transition: all 0.3s ease;
            box-shadow: none;
        }
        
        /* استثنا: داشبورد - بدون header */
        #dashboard {
            margin-bottom: 2rem;
        }

        .collapsible-section:hover {
            border-color: rgba(0, 153, 153, 0.5);
            box-shadow: 0 8px 24px rgba(0, 153, 153, 0.2);
        }

        /* استایل Siemens برای سربرگ‌ها - دقیقاً شبیه سایت Siemens */
        .section-header {
            background: #ffffff;
            padding: 2rem 0;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s ease;
            border-bottom: 2px solid #e5e7eb;
            position: relative;
            border-top: none;
            border-left: none;
            border-right: none;
        }

        .section-header:hover {
            background: #fafafa;
            border-bottom-color: var(--siemens-blue);
        }

        .section-header.active {
            border-bottom-color: var(--siemens-blue);
        }

        .section-header h2 {
            margin: 0;
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 1.75rem;
            font-weight: 400;
            color: #1a1a1a;
            letter-spacing: -0.02em;
        }

        .section-header h2 i {
            color: var(--siemens-blue);
            font-size: 1.5rem;
            opacity: 0.9;
        }

        .section-toggle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            color: var(--siemens-blue);
            border: 1px solid #e5e7eb;
        }

        .section-header:hover .section-toggle {
            background: #f5f5f5;
            border-color: var(--siemens-blue);
            transform: scale(1.05);
        }

        .section-toggle i {
            transition: transform 0.3s ease;
        }

        .section-header.collapsed .section-toggle i {
            transform: rotate(-90deg);
        }

        .section-content {
            padding: 2rem 0;
            max-height: none;
            opacity: 1;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: visible;
            background: #ffffff;
            color: #1a1a1a;
            display: block !important;
        }

        .section-content.collapsed {
            display: block !important;
            opacity: 1;
        }
        
        .section-header.collapsed {
            border-bottom-color: #e5e7eb;
        }
        
        .section-header {
            cursor: pointer;
        }
        
        /* حذف collapsed از همه بخش‌ها - همیشه باز */
        .section-content.collapsed,
        .section-header.collapsed {
            display: block !important;
            opacity: 1 !important;
            max-height: none !important;
            padding: 2rem 0 !important;
        }

        /* رنگ‌بندی بخش‌ها */

        /* بقیه بخش‌ها: سفید با حاشیه آبی Siemens */
        .section-gradient-factories,
        .section-gradient-commerce,
        .section-gradient-marketplace,
        .section-gradient-contracts,
        .section-gradient-tenders,
        .section-gradient-reports,
        .section-gradient-users {
            background: #ffffff;
            border-bottom: 3px solid var(--siemens-blue);
        }
        
        /* استایل Siemens برای بخش‌ها */
        .siemens-section {
            background: #000000;
            border: 1px solid rgba(0, 153, 153, 0.3);
            border-radius: 12px;
        }
        
        .siemens-section-header {
            background: linear-gradient(135deg, rgba(0, 153, 153, 0.25) 0%, rgba(0, 102, 114, 0.15) 100%);
            border-bottom: 2px solid rgba(0, 153, 153, 0.4);
        }
        
        .siemens-section-header:hover {
            background: linear-gradient(135deg, rgba(0, 153, 153, 0.35) 0%, rgba(0, 102, 114, 0.25) 100%);
        }

        /* تبدیل رنگ‌های خاکستری به سفید/طوسی (Siemens Style) */
        .bg-gray-800,
        .bg-gray-700,
        .bg-gray-900 {
            background-color: #ffffff !important;
            color: #1a1a1a !important;
            border: 1px solid #e5e7eb !important;
        }

        .bg-gray-600 {
            background-color: #f5f5f5 !important;
            color: #1a1a1a !important;
        }

        .text-gray-300,
        .text-gray-400 {
            color: #6b7280 !important;
        }

        .border-gray-700,
        .border-gray-600 {
            border-color: #e5e7eb !important;
        }
        
        /* استثنا: داشبورد */
        #dashboard .bg-gray-800,
        #dashboard .bg-gray-700,
        #dashboard .bg-gray-900 {
            background-color: #000000 !important;
            color: #ffffff !important;
            border: 1px solid rgba(0, 153, 153, 0.3) !important;
        }
        
        #dashboard .text-gray-300,
        #dashboard .text-gray-400 {
            color: #e5e7eb !important;
        }
        
        /* استایل Siemens برای کارت‌ها */
        .siemens-card-style {
            background: #000000;
            border: 1px solid rgba(0, 153, 153, 0.3);
            color: #ffffff;
            transition: all 0.3s ease;
        }
        
        .siemens-card-style:hover {
            border-color: rgba(0, 153, 153, 0.6);
            box-shadow: 0 8px 24px rgba(0, 153, 153, 0.2);
            transform: translateY(-2px);
        }
        
        /* پس‌زمینه سفید برای کل صفحه - Siemens Style */
        .main-wrapper {
            background: #ffffff;
            min-height: 100vh;
        }
        
        /* استایل کارت‌های Siemens */
        .siemens-card {
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 0;
            transition: all 0.3s ease;
            padding: 2rem;
        }
        
        .siemens-card:hover {
            border-color: var(--siemens-blue);
            box-shadow: 0 4px 12px rgba(0, 153, 153, 0.1);
        }
        
        /* Grid استایل Siemens */
        .siemens-grid {
            display: grid;
            gap: 2rem;
            margin-top: 2rem;
        }
        /* استایل‌های اسلایدر سایت پلن */
        .site-plan-slider-container {
            position: relative;
            width: 100%;
        }

        .site-plan-slider-wrapper {
            position: relative;
            overflow: hidden;
            border-radius: 12px;
            background: #f3f4f6;
        }

        .site-plan-slider {
            display: flex;
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            width: 100%;
        }

        .site-plan-slide {
            min-width: 100%;
            flex-shrink: 0;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            position: relative;
        }

        .site-plan-slide.active {
            opacity: 1;
            z-index: 1;
        }

        .site-plan-nav-btn {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: none;
            font-size: 16px;
            border-radius: 8px;
        }

        .site-plan-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #d1d5db;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .site-plan-indicator.active {
            background: #9333ea;
            width: 24px;
            border-radius: 5px;
        }

        /* استایل‌های تحلیل خرابی */
        .failure-tab-btn {
            transition: all 0.3s ease;
        }

        .failure-tab-btn.active {
            background: #dc2626 !important;
            color: white !important;
        }

        .failure-tab-content {
            display: block;
        }

        .failure-tab-content.hidden {
            display: none;
        }

        /* استایل‌های تحلیل خرابی */
        .failure-tab-btn {
            transition: all 0.3s ease;
        }

        .failure-tab-btn.active {
            background: #dc2626 !important;
            color: white !important;
        }

        .failure-tab-content {
            display: block;
        }

        .failure-tab-content.hidden {
            display: none;
        }
        
        /* استایل‌های زبانه‌های قیمت‌گذاری - سبک Siemens */
        .price-tab-btn {
            transition: all 0.3s ease;
            position: relative;
            border: none;
            cursor: pointer;
        }
        
        .price-tab-btn.active {
            background: var(--siemens-blue) !important;
            color: white !important;
        }
        
        .price-tab-content {
            animation: fadeInTab 0.3s ease-in-out;
        }
        
        .price-tab-content.hidden {
            display: none;
        }
        
        @keyframes fadeInTab {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .equipment-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .equipment-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
            border-color: #dc2626;
        }

        /* استایل‌های پیشرفته بازار - شبیه دیجی‌کالا */
        .marketplace-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }

        .marketplace-stats-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .marketplace-stats-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
        }

        .price-badge {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .supplier-badge {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .rating-stars {
            color: #fbbf24;
            font-size: 0.875rem;
        }

        /* سیستم Glory Glass برای تجهیزات */
        .glory-glass {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 16px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .glory-glass:hover {
            background: rgba(255, 255, 255, 0.98);
            border-color: rgba(255, 255, 255, 0.5);
            box-shadow: 0 12px 48px 0 rgba(31, 38, 135, 0.25);
            transform: translateY(-4px);
        }

        .glory-glass-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.9) 100%);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 16px;
            padding: 1.5rem;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);
        }

        .glory-glass-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1;
        }

        .glory-glass-card:hover::before {
            left: 100%;
        }

        .glory-glass-card > * {
            position: relative;
            z-index: 2;
        }

        .glory-glass-card:hover {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(255, 255, 255, 0.95) 100%);
            border-color: rgba(255, 255, 255, 0.5);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.12);
            transform: translateY(-4px) scale(1.02);
        }

        .equipment-category-card {
            transition: all 0.3s ease;
        }

        .equipment-category-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .prediction-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.9) 100%);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-left: 4px solid;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .prediction-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }

        .prediction-card:hover::before {
            left: 100%;
        }

        .prediction-card:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .prediction-card.high-risk {
            border-left-color: #dc2626;
            background: linear-gradient(135deg, rgba(254, 226, 226, 0.95) 0%, rgba(255, 255, 255, 0.9) 100%);
        }

        .prediction-card.medium-risk {
            border-left-color: #f59e0b;
            background: linear-gradient(135deg, rgba(254, 243, 199, 0.95) 0%, rgba(255, 255, 255, 0.9) 100%);
        }

        .prediction-card.low-risk {
            border-left-color: #10b981;
            background: linear-gradient(135deg, rgba(209, 250, 229, 0.95) 0%, rgba(255, 255, 255, 0.9) 100%);
        }

        .risk-badge {
            padding: 0.375rem 0.75rem;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .risk-badge.high {
            background: #fee2e2;
            color: #991b1b;
        }

        .risk-badge.medium {
            background: #fef3c7;
            color: #92400e;
        }

        .risk-badge.low {
            background: #d1fae5;
            color: #065f46;
        }

        /* استایل‌های Marketplace - سبک Zoomit */
        .product-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.9) 100%);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
        }

        .product-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.5s;
        }

        .product-card:hover::before {
            left: 100%;
        }

        .product-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-color: var(--siemens-blue);
        }

        .filter-chip.active {
            background: #dbeafe !important;
            color: #1e40af !important;
        }

        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>
</head>

<body class="main-wrapper">
    <div class="floating-tech"></div>

    <!-- هدر اصلی - سبک Siemens -->
    <header class="bg-white border-b-2 border-gray-200 shadow-sm sticky top-0 z-50">
        <!-- نوار بالایی - سبک Siemens -->
        <div class="bg-gray-50 border-b border-gray-200 py-2">
            <div class="container mx-auto px-6" style="max-width: 100%;">
                <div class="flex justify-between items-center text-xs text-gray-600">
                    <div class="flex space-x-6 space-x-reverse">
                        <a href="#" class="hover:text-siements-blue transition">شرکت Steel Management Tech</a>
                        <a href="#" class="hover:text-siements-blue transition">سرمایه‌گذاری</a>
                        <a href="#" class="hover:text-siements-blue transition">اخبار صنعت</a>
                        <a href="#" class="hover:text-siements-blue transition">درباره ما</a>
                    </div>
                    <div class="flex space-x-4 space-x-reverse items-center">
                        <select class="bg-transparent text-xs border-none focus:outline-none cursor-pointer">
                            <option>فارسی</option>
                            <option>English</option>
                        </select>
                        <a href="#" class="hover:text-siements-blue transition">
                            <i class="fas fa-search ml-1"></i>جستجو
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- ناوبری اصلی - سبک Siemens -->
        <nav class="bg-white">
            <div class="container mx-auto px-6" style="max-width: 100%;">
                <div class="flex items-center justify-between py-4">
                <!-- لوگو -->
                <div class="logo-container">
                    <div class="logo-icon">
                        <i class="fas fa-industry text-white text-2xl"></i>
                    </div>
                    <div class="logo-text">
                            <div class="brand" style="color: #000000;">STEEL MANAGEMENT TECH</div>
                            <div class="tagline" style="color: #666666;">پلتفرم مدیریت هوشمند صنعت فولاد</div>
                    </div>
                </div>

                    <!-- منوی اصلی - سبک Siemens با dropdown -->
                    <div class="flex items-center space-x-1 space-x-reverse">
                        <div class="nav-item relative group">
                            <a href="#factories" class="nav-link py-3 px-4 text-gray-900 hover:text-siements-blue font-medium flex items-center transition">
                        <i class="fas fa-factory ml-2"></i>
                        کارخانه‌ها
                                <i class="fas fa-chevron-down text-xs mr-2 opacity-50"></i>
                            </a>
                            <div class="mega-menu absolute top-full right-0 bg-white shadow-xl border border-gray-200 rounded-lg p-6 w-96 hidden group-hover:block z-50">
                                <div class="grid grid-cols-2 gap-4">
                                    <a href="#factories" class="p-3 hover:bg-gray-50 rounded transition">
                                        <div class="font-semibold text-gray-900 mb-1">گندله‌سازی</div>
                                        <div class="text-xs text-gray-600">خط تولید ۱ و ۲</div>
                                    </a>
                                    <a href="#factories" class="p-3 hover:bg-gray-50 rounded transition">
                                        <div class="font-semibold text-gray-900 mb-1">کنسانتره</div>
                                        <div class="text-xs text-gray-600">مدار خردایش</div>
                                    </a>
                                    <a href="#factories" class="p-3 hover:bg-gray-50 rounded transition">
                                        <div class="font-semibold text-gray-900 mb-1">فولادسازی</div>
                                        <div class="text-xs text-gray-600">کوره‌های قوس الکتریکی</div>
                                    </a>
                                    <a href="#factories" class="p-3 hover:bg-gray-50 rounded transition">
                                        <div class="font-semibold text-gray-900 mb-1">همه کارخانه‌ها</div>
                                        <div class="text-xs text-gray-600">مشاهده کامل</div>
                                    </a>
                                </div>
                            </div>
                        </div>

                        <div class="nav-item relative group">
                            <a href="#marketplace" class="nav-link py-3 px-4 text-gray-900 hover:text-siements-blue font-medium flex items-center transition">
                                <i class="fas fa-shopping-cart ml-2"></i>
                                بازار تجهیزات
                                <i class="fas fa-chevron-down text-xs mr-2 opacity-50"></i>
                            </a>
                            <div class="mega-menu absolute top-full right-0 bg-white shadow-xl border border-gray-200 rounded-lg p-6 w-96 hidden group-hover:block z-50">
                                <div class="space-y-3">
                                    <a href="#marketplace" class="block p-3 hover:bg-gray-50 rounded transition">
                                        <div class="font-semibold text-gray-900 mb-1">تجهیزات مکانیکی</div>
                                        <div class="text-xs text-gray-600">Dosing, Pelletizing, Indurating</div>
                                    </a>
                                    <a href="#marketplace" class="block p-3 hover:bg-gray-50 rounded transition">
                                        <div class="font-semibold text-gray-900 mb-1">تجهیزات الکتریکی</div>
                                        <div class="text-xs text-gray-600">Motors, Drives, Transformers</div>
                                    </a>
                                    <a href="#marketplace" class="block p-3 hover:bg-gray-50 rounded transition">
                                        <div class="font-semibold text-gray-900 mb-1">ابزار دقیق</div>
                                        <div class="text-xs text-gray-600">Sensors, Transmitters, Flowmeters</div>
                                    </a>
                                    <a href="#marketplace" class="block p-3 hover:bg-gray-50 rounded transition">
                                        <div class="font-semibold text-gray-900 mb-1">اتوماسیون</div>
                                        <div class="text-xs text-gray-600">PLC, HMI, DCS Systems</div>
                                    </a>
                                </div>
                            </div>
                        </div>

                        <div class="nav-item relative group">
                            <a href="#commerce" class="nav-link py-3 px-4 text-gray-900 hover:text-siements-blue font-medium flex items-center transition">
                        <i class="fas fa-shopping-cart ml-2"></i>
                        بازرگانی
                                <i class="fas fa-chevron-down text-xs mr-2 opacity-50"></i>
                            </a>
                            <div class="mega-menu absolute top-full right-0 bg-white shadow-xl border border-gray-200 rounded-lg p-6 w-80 hidden group-hover:block z-50">
                                <div class="space-y-3">
                                    <a href="#commerce" class="block p-3 hover:bg-gray-50 rounded transition">
                                        <div class="font-semibold text-gray-900 mb-1">خریدهای در حال انجام</div>
                                        <div class="text-xs text-gray-600">۴۲ سفارش فعال</div>
                                    </a>
                                    <a href="#commerce" class="block p-3 hover:bg-gray-50 rounded transition">
                                        <div class="font-semibold text-gray-900 mb-1">صورت‌حساب‌ها</div>
                                        <div class="text-xs text-gray-600">مدیریت مالی</div>
                                    </a>
                                    <a href="#commerce" class="block p-3 hover:bg-gray-50 rounded transition">
                                        <div class="font-semibold text-gray-900 mb-1">آمار بازرگانی</div>
                                        <div class="text-xs text-gray-600">گزارش‌های تحلیلی</div>
                                    </a>
                                </div>
                            </div>
                        </div>

                        <div class="nav-item relative group">
                            <a href="#contracts" class="nav-link py-3 px-4 text-gray-900 hover:text-siements-blue font-medium flex items-center transition">
                        <i class="fas fa-file-contract ml-2"></i>
                        قراردادها
                                <i class="fas fa-chevron-down text-xs mr-2 opacity-50"></i>
                            </a>
                            <div class="mega-menu absolute top-full right-0 bg-white shadow-xl border border-gray-200 rounded-lg p-6 w-80 hidden group-hover:block z-50">
                                <div class="space-y-3">
                                    <a href="#contracts" class="block p-3 hover:bg-gray-50 rounded transition">
                                        <div class="font-semibold text-gray-900 mb-1">منتظر امضا</div>
                                        <div class="text-xs text-gray-600">۸ قرارداد</div>
                                    </a>
                                    <a href="#contracts" class="block p-3 hover:bg-gray-50 rounded transition">
                                        <div class="font-semibold text-gray-900 mb-1">امضا شده</div>
                                        <div class="text-xs text-gray-600">۲۷ قرارداد فعال</div>
                                    </a>
                                    <a href="#contracts" class="block p-3 hover:bg-gray-50 rounded transition">
                                        <div class="font-semibold text-gray-900 mb-1">امضای دیجیتال</div>
                                        <div class="text-xs text-gray-600">سیستم امن</div>
                                    </a>
                                </div>
                            </div>
                        </div>

                        <div class="nav-item relative group">
                            <a href="#tenders" class="nav-link py-3 px-4 text-gray-900 hover:text-siements-blue font-medium flex items-center transition">
                                <i class="fas fa-gavel ml-2"></i>
                                مناقصات
                                <i class="fas fa-chevron-down text-xs mr-2 opacity-50"></i>
                            </a>
                            <div class="mega-menu absolute top-full right-0 bg-white shadow-xl border border-gray-200 rounded-lg p-6 w-80 hidden group-hover:block z-50">
                                <div class="space-y-3">
                                    <a href="#tenders" class="block p-3 hover:bg-gray-50 rounded transition">
                                        <div class="font-semibold text-gray-900 mb-1">مناقصات فعال</div>
                                        <div class="text-xs text-gray-600">۱۰ مناقصه</div>
                                    </a>
                                    <a href="#tenders" class="block p-3 hover:bg-gray-50 rounded transition">
                                        <div class="font-semibold text-gray-900 mb-1">مناقصات برنامه‌ریزی شده</div>
                                        <div class="text-xs text-gray-600">۵ مناقصه</div>
                                    </a>
                                    <a href="#tenders" class="block p-3 hover:bg-gray-50 rounded transition">
                                        <div class="font-semibold text-gray-900 mb-1">مناقصات بسته شده</div>
                                        <div class="text-xs text-gray-600">تاریخچه</div>
                                    </a>
                                </div>
                            </div>
                        </div>

                        <div class="nav-item relative group">
                            <a href="#failure-analysis" class="nav-link py-3 px-4 text-gray-900 hover:text-siements-blue font-medium flex items-center transition">
                        <i class="fas fa-exclamation-triangle ml-2"></i>
                                تحلیل خرابی
                                <i class="fas fa-chevron-down text-xs mr-2 opacity-50"></i>
                            </a>
                            <div class="mega-menu absolute top-full right-0 bg-white shadow-xl border border-gray-200 rounded-lg p-6 w-80 hidden group-hover:block z-50">
                                <div class="space-y-3">
                                    <a href="#failure-analysis" class="block p-3 hover:bg-gray-50 rounded transition">
                                        <div class="font-semibold text-gray-900 mb-1">بانک اطلاعاتی تجهیزات</div>
                                        <div class="text-xs text-gray-600">دیتا شیت Final Book</div>
                                    </a>
                                    <a href="#failure-analysis" class="block p-3 hover:bg-gray-50 rounded transition">
                                        <div class="font-semibold text-gray-900 mb-1">تحلیل خرابی</div>
                                        <div class="text-xs text-gray-600">گزارش‌های تحلیلی</div>
                                    </a>
                                    <a href="#failure-analysis" class="block p-3 hover:bg-gray-50 rounded transition">
                                        <div class="font-semibold text-gray-900 mb-1">تعمیرات و نگهداری</div>
                                        <div class="text-xs text-gray-600">برنامه‌ریزی شده</div>
                                    </a>
                                </div>
                            </div>
                        </div>


                        <a href="#users" class="nav-link py-3 px-4 text-gray-900 hover:text-siements-blue font-medium flex items-center transition">
                        <i class="fas fa-users ml-2"></i>
                        کاربران
                    </a>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <!-- محتوای اصلی -->
    <main class="container mx-auto px-6 py-8" style="max-width: 95%;">
        <!-- داشبورد - Hero Screen -->
        <section id="dashboard" style="opacity: 0; animation: fadeIn 2s ease-in-out forwards; margin-bottom: 3rem;">
                <div class="industrial-gradient text-white rounded-xl p-8 mb-6">
                    <div class="max-w-3xl">
                        <h1 class="text-4xl font-bold mb-4">سیستم یکپارچه مدیریت صنعت فولاد</h1>
                    <p class="text-xl mb-8">پلتفرم جامع Steel Management Tech برای مدیریت کارخانه‌ها، تجهیزات، مناقصات و پیمانکاران</p>
                    </div>
                </div>
            </div>
        </section>

        <style>
            @keyframes fadeIn {
                from {
                    opacity: 0;
                    transform: translateY(-20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
        </style>

        <!-- کارخانه‌های تحت پوشش و تحلیل خرابی (ادغام شده) -->
        <section id="factories" class="collapsible-section">
            <div class="section-header collapsed section-gradient-factories" onclick="toggleSection('factories')">
                <h2>
                    <i class="fas fa-factory"></i>
                    کارخانه‌های تحت پوشش و تحلیل خرابی
                </h2>
                <div class="section-toggle">
                    <i class="fas fa-chevron-down"></i>
                </div>
            </div>
            <div class="section-content collapsed" id="factories-content">
                <!-- سایت پلن خطی کارخانه‌ها -->
                <div class="mb-8 bg-gradient-to-r from-cyan-50 to-blue-50 rounded-xl p-6 border border-cyan-200">
                    <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
                        <i class="fas fa-map-marked-alt text-cyan-600"></i>
                    </h3>
                    <div class="relative">
                        <!-- خط اتصال کارخانه‌ها -->
                        <div class="absolute top-1/2 left-0 right-0 h-1 bg-gradient-to-r from-cyan-400 via-blue-500 to-purple-500 transform -translate-y-1/2 z-0" style="margin: 0 5%;"></div>
                        
                        <!-- کارخانه‌ها به صورت خطی -->
                        <div class="relative flex items-center justify-between px-4 py-6" id="factory-timeline">
                            <!-- کارخانه‌ها به صورت داینامیک اضافه می‌شوند -->
                        </div>
                    </div>
                </div>
                
                <!-- صفحه کامل کارخانه انتخاب شده -->
                <div id="selected-factory-info" style="display: none;">
                    <!-- هدر کارخانه -->
                    <div class="bg-gradient-to-r from-cyan-600 to-blue-600 text-white rounded-xl p-6 mb-6 shadow-lg">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-4">
                                <div class="w-16 h-16 bg-white/20 rounded-lg flex items-center justify-center backdrop-blur-sm">
                                    <i class="fas fa-factory text-3xl text-white" id="selected-factory-header-icon"></i>
                                </div>
                                <div>
                                    <h1 class="text-3xl font-bold" id="selected-factory-header-name">کارخانه انتخاب شده</h1>
                                    <p class="text-white/80 mt-1" id="selected-factory-header-capacity">ظرفیت تولید</p>
                                </div>
                            </div>
                            <button onclick="closeFactoryDetails()" class="w-10 h-10 bg-white/20 hover:bg-white/30 rounded-lg flex items-center justify-center backdrop-blur-sm transition">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- تب‌های اصلی -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 mb-6">
                        <div class="border-b border-gray-200">
                            <div class="flex gap-2 p-2 overflow-x-auto">
                                <button onclick="showFactoryMainTab('equipment')" 
                                        class="factory-main-tab-btn active px-6 py-3 text-sm font-medium text-gray-700 border-b-2 border-cyan-600 whitespace-nowrap">
                                    <i class="fas fa-cogs ml-2"></i>
                                    بانک اطلاعاتی تجهیزات
                                </button>
                                <button onclick="showFactoryMainTab('analysis')" 
                                        class="factory-main-tab-btn px-6 py-3 text-sm font-medium text-gray-500 hover:text-gray-700 whitespace-nowrap hover:bg-gray-50 transition">
                                    <i class="fas fa-chart-line ml-2"></i>
                                    تحلیل خرابی و پیش‌بینی
                                </button>
                                <button onclick="showFactoryMainTab('ai-insights')" 
                                        class="factory-main-tab-btn px-6 py-3 text-sm font-medium text-gray-500 hover:text-gray-700 whitespace-nowrap hover:bg-gray-50 transition">
                                    <i class="fas fa-robot ml-2"></i>
                                    بینش‌های هوش مصنوعی
                                </button>
                                <button onclick="showFactoryMainTab('maintenance')" 
                                        class="factory-main-tab-btn px-6 py-3 text-sm font-medium text-gray-500 hover:text-gray-700 whitespace-nowrap hover:bg-gray-50 transition">
                                    <i class="fas fa-tools ml-2"></i>
                                    تعمیرات و نگهداری
                                </button>
                                <button onclick="showFactoryMainTab('inspection')" 
                                        class="factory-main-tab-btn px-6 py-3 text-sm font-medium text-gray-500 hover:text-gray-700 whitespace-nowrap hover:bg-gray-50 transition">
                                    <i class="fas fa-search ml-2"></i>
                                    بازرسی و کنترل کیفیت
                                </button>
                                <button onclick="showFactoryMainTab('technical-office')" 
                                        class="factory-main-tab-btn px-6 py-3 text-sm font-medium text-gray-500 hover:text-gray-700 whitespace-nowrap hover:bg-gray-50 transition">
                                    <i class="fas fa-clipboard-list ml-2"></i>
                                    دفتر فنی و مستندات
                                </button>
                                <button onclick="showFactoryMainTab('production')" 
                                        class="factory-main-tab-btn px-6 py-3 text-sm font-medium text-gray-500 hover:text-gray-700 whitespace-nowrap hover:bg-gray-50 transition">
                                    <i class="fas fa-industry ml-2"></i>
                                    تولید و بهره‌وری
                                </button>
                                <button onclick="showFactoryMainTab('reports')" 
                                        class="factory-main-tab-btn px-6 py-3 text-sm font-medium text-gray-500 hover:text-gray-700 whitespace-nowrap hover:bg-gray-50 transition">
                                    <i class="fas fa-file-alt ml-2"></i>
                                    گزارش‌ها و تحلیل‌ها
                                </button>
                                <button onclick="showFactoryMainTab('commerce')" 
                                        class="factory-main-tab-btn px-6 py-3 text-sm font-medium text-gray-500 hover:text-gray-700 whitespace-nowrap hover:bg-gray-50 transition">
                                    <i class="fas fa-shopping-cart ml-2"></i>
                                    بازرگانی و قراردادها
                                </button>
                                <button onclick="showFactoryMainTab('pcs7')" 
                                        class="factory-main-tab-btn px-6 py-3 text-sm font-medium text-gray-500 hover:text-gray-700 whitespace-nowrap hover:bg-gray-50 transition">
                                    <i class="fas fa-network-wired ml-2"></i>
                                    اتصال PCS7 و Real-time
                                </button>
                            </div>
                        </div>
                        
                        <div id="selected-factory-content" class="p-6">
                            <!-- محتوای تب‌های کارخانه -->
                        </div>
                    </div>
                </div>
                <div class="flex items-center justify-between mb-8">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 bg-cyan-50 flex items-center justify-center rounded-lg">
                            <i class="fas fa-map-marker-alt text-cyan-600 text-xl"></i>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold text-gray-900">مجتمع فولاد گل‌گهر سیرجان</h3>
                            <p class="text-gray-600">سیستم یکپارچه مدیریت کارخانه‌ها</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-2 px-4 py-2 bg-green-50 rounded-lg border border-green-200">
                        <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                        <span class="text-sm font-medium text-green-700">همه کارخانه‌ها فعال</span>
                    </div>
                </div>

                <!-- کارخانه‌ها زیر هم (vertical layout) - ابعاد مطابق screenshot 16 -->
                <div class="mb-6" id="factories-container">
                    <div class="grid grid-cols-1 gap-4" id="factories-grid">
                        <!-- کارخانه‌ها به صورت داینامیک بارگذاری می‌شوند -->
                    </div>
                </div>
                
                <!-- کارت‌های ساده کارخانه‌ها (طراحی Siemens - ابعاد مانند بازار تجهیزات) -->
                <script>
                // بارگذاری کارت‌های کارخانه به صورت ساده در یک ردیف
                document.addEventListener('DOMContentLoaded', function() {
                    const factoriesGrid = document.getElementById('factories-grid');
                    if (!factoriesGrid) return;
                    
                    const factories = [
                        { id: 'factory-1', name: 'گندله‌سازی', icon: 'fa-fire', color: 'cyan', production: '۵', efficiency: '۹۶.۷%', energy: '۲.۴ MW', lines: ['خط تولید ۱', 'خط تولید ۲'], description: 'کارخانه تولید گندله آهن با کوره ایندوریت', location: 'مجتمع فولاد گل‌گهر سیرجان', status: 'فعال' },
                        { id: 'factory-2', name: 'کنسانتره', icon: 'fa-filter', color: 'blue', production: '۳.۵', efficiency: '۹۴.۲%', energy: '۱.۸ MW', lines: ['مدار خردایش', 'فلوتاسیون'], description: 'کارخانه تولید کنسانتره آهن', location: 'مجتمع فولاد گل‌گهر سیرجان', status: 'فعال' },
                        { id: 'factory-3', name: 'فولادسازی', icon: 'fa-industry', color: 'yellow', production: '۲.۸', efficiency: '۸۷.۵%', energy: '۳.۱ MW', lines: ['کوره قوس الکتریکی', 'پاتیل تصفیه'], description: 'کارخانه تولید فولاد با کوره قوس الکتریکی', location: 'مجتمع فولاد گل‌گهر سیرجان', status: 'فعال' },
                        { id: 'factory-4', name: 'خردایش', icon: 'fa-hammer', color: 'orange', production: '۴.۵', efficiency: '۹۳.۵%', energy: '۲.۱ MW', lines: ['خط خردایش ۱', 'خط خردایش ۲'], description: 'کارخانه خردایش سنگ آهن با ظرفیت بالا', location: 'مجتمع فولاد گل‌گهر سیرجان', status: 'فعال' },
                        { id: 'factory-5', name: 'نورد', icon: 'fa-compress-arrows-alt', color: 'purple', production: '۲.۵', efficiency: '۹۲.۸%', energy: '۴.۲ MW', lines: ['خط نورد گرم', 'خط نورد سرد'], description: 'کارخانه نورد فولاد گرم و سرد', location: 'مجتمع فولاد گل‌گهر سیرجان', status: 'فعال' },
                        { id: 'factory-6', name: 'احیاء مستقیم', icon: 'fa-atom', color: 'pink', production: '۱.۸', efficiency: '۹۱.۵%', energy: '۲.۹ MW', lines: ['کوره احیاء'], description: 'کارخانه احیاء مستقیم آهن', location: 'مجتمع فولاد گل‌گهر سیرجان', status: 'فعال' }
                    ];
                    
                    const colorClasses = {
                        cyan: 'from-cyan-500 to-cyan-600',
                        blue: 'from-blue-500 to-blue-600',
                        orange: 'from-orange-500 to-orange-600',
                        yellow: 'from-yellow-500 to-yellow-600',
                        purple: 'from-purple-500 to-purple-600',
                        pink: 'from-pink-500 to-pink-600'
                    };
                    
                    // ابعاد مطابق screenshot 16 - کارخانه‌ها زیر هم (full width) با جزئیات بیشتر و تب‌ها
                    factoriesGrid.innerHTML = factories.map(factory => `
                        <div class="bg-white rounded-lg shadow-md border border-gray-200 overflow-hidden product-card w-full" 
                             style="min-height: 280px;">
                            <!-- سربرگ/نوار وظیفه در بیرون -->
                            <div class="bg-gradient-to-r ${colorClasses[factory.color]} text-white px-4 py-3 flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <i class="fas ${factory.icon} text-2xl"></i>
                                    <div>
                                        <h4 class="font-bold text-lg">${factory.name}</h4>
                                        <p class="text-xs text-white/80">${factory.location}</p>
                                    </div>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="px-3 py-1 bg-white/20 backdrop-blur-sm rounded-lg text-xs font-medium">
                                        <i class="fas fa-circle text-green-300 ml-1"></i>
                                        ${factory.status}
                                    </span>
                                </div>
                            </div>
                            
                            <!-- تب‌های کارخانه (نوار وظیفه) -->
                            <div class="border-b border-gray-200 bg-gray-50">
                                <div class="flex gap-1 p-2 overflow-x-auto">
                                    <button onclick="selectFactory('${factory.id}', '${factory.name}'); showFactoryTab('${factory.id}', 'site-plan')" 
                                            class="px-3 py-1.5 text-xs font-medium text-gray-700 bg-white rounded border border-gray-300 hover:bg-gray-100 whitespace-nowrap transition">
                                        <i class="fas fa-map ml-1"></i>
                                        سایت پلن
                                    </button>
                                    <button onclick="selectFactory('${factory.id}', '${factory.name}'); showFactoryTab('${factory.id}', 'equipment')" 
                                            class="px-3 py-1.5 text-xs font-medium text-gray-700 bg-white rounded border border-gray-300 hover:bg-gray-100 whitespace-nowrap transition">
                                        <i class="fas fa-cogs ml-1"></i>
                                        تجهیزات
                                    </button>
                                    <button onclick="selectFactory('${factory.id}', '${factory.name}'); showFactoryTab('${factory.id}', 'analysis')" 
                                            class="px-3 py-1.5 text-xs font-medium text-gray-700 bg-white rounded border border-gray-300 hover:bg-gray-100 whitespace-nowrap transition">
                                        <i class="fas fa-chart-line ml-1"></i>
                                        تحلیل خرابی
                                    </button>
                                    <button onclick="selectFactory('${factory.id}', '${factory.name}'); showFactoryTab('${factory.id}', 'maintenance')" 
                                            class="px-3 py-1.5 text-xs font-medium text-gray-700 bg-white rounded border border-gray-300 hover:bg-gray-100 whitespace-nowrap transition">
                                        <i class="fas fa-tools ml-1"></i>
                                        تعمیرات
                                    </button>
                                    <button onclick="selectFactory('${factory.id}', '${factory.name}'); showFactoryTab('${factory.id}', 'production')" 
                                            class="px-3 py-1.5 text-xs font-medium text-gray-700 bg-white rounded border border-gray-300 hover:bg-gray-100 whitespace-nowrap transition">
                                        <i class="fas fa-industry ml-1"></i>
                                        تولید
                                    </button>
                                    <button onclick="selectFactory('${factory.id}', '${factory.name}'); showFactoryTab('${factory.id}', 'commerce')" 
                                            class="px-3 py-1.5 text-xs font-medium text-gray-700 bg-white rounded border border-gray-300 hover:bg-gray-100 whitespace-nowrap transition">
                                        <i class="fas fa-shopping-cart ml-1"></i>
                                        بازرگانی
                                    </button>
                                    <button onclick="connectFactoryToPCS7('${factory.id}', '${factory.name}')" 
                                            class="px-3 py-1.5 text-xs font-medium text-white bg-gradient-to-r from-green-500 to-green-600 rounded border border-green-600 hover:from-green-600 hover:to-green-700 whitespace-nowrap transition" 
                                            id="pcs7-btn-${factory.id}">
                                        <i class="fas fa-plug ml-1"></i>
                                        <span id="pcs7-status-${factory.id}">اتصال PCS7</span>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- محتوای کارخانه -->
                            <div class="p-4">
                                <div class="flex flex-row gap-4">
                                    <!-- تصویر/آیکون در سمت راست -->
                                    <div class="relative w-24 h-24 bg-gradient-to-br ${colorClasses[factory.color]} rounded-lg flex items-center justify-center flex-shrink-0">
                                        <i class="fas ${factory.icon} text-white text-3xl opacity-80"></i>
                                    </div>
                                    
                                    <!-- اطلاعات کارخانه -->
                                    <div class="flex-1">
                                        <p class="text-sm text-gray-600 mb-3">${factory.description}</p>
                                        
                                        <!-- خطوط تولید -->
                                        <div class="mb-3">
                                            <div class="text-xs text-gray-500 mb-1">خطوط تولید:</div>
                                            <div class="flex flex-wrap gap-2">
                                                ${factory.lines.map(line => `
                                                    <span class="px-2 py-1 bg-blue-50 text-blue-700 rounded text-xs">${line}</span>
                                                `).join('')}
                                            </div>
                                        </div>
                                        
                                        <!-- دیتاهای مهم در یک ردیف -->
                                        <div class="grid grid-cols-4 gap-3 mb-3">
                                            <div class="text-center bg-gradient-to-r from-gray-50 to-gray-100 rounded-lg px-3 py-2 border border-gray-200">
                                                <div class="text-2xl font-bold text-gray-900 mb-0.5">${factory.production}</div>
                                                <div class="text-xs text-gray-600">میلیون تن/سال</div>
                                            </div>
                                            <div class="text-center bg-green-50 rounded-lg px-3 py-2 border border-green-200">
                                                <div class="text-sm font-bold text-green-600 mb-0.5">${factory.efficiency}</div>
                                                <div class="text-xs text-gray-600">راندمان</div>
                                            </div>
                                            <div class="text-center bg-blue-50 rounded-lg px-3 py-2 border border-blue-200">
                                                <div class="text-sm font-bold text-blue-600 mb-0.5">${factory.energy}</div>
                                                <div class="text-xs text-gray-600">انرژی</div>
                                            </div>
                                            <div class="text-center bg-purple-50 rounded-lg px-3 py-2 border border-purple-200">
                                                <div class="text-sm font-bold text-purple-600 mb-0.5">${factory.lines.length}</div>
                                                <div class="text-xs text-gray-600">خط تولید</div>
                                            </div>
                                        </div>
                                        
                                        <!-- دکمه مشاهده جزئیات -->
                                        <button onclick="selectFactory('${factory.id}', '${factory.name}')" 
                                                class="w-full py-2.5 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg text-sm font-semibold transition flex items-center justify-center gap-2">
                                            <i class="fas fa-eye"></i>
                                            مشاهده جزئیات کامل
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `).join('');
                });
                </script>
                
                <!-- کارخانه‌های تکراری حذف شدند -->
                
                </div>
            </div>
        </section>

        <!-- بازار جامع تجهیزات صنعتی - طراحی Zoomit + Siemens -->
        <!-- بازار جامع تجهیزات صنعتی - طراحی Zoomit + Siemens -->
        <section id="marketplace" class="collapsible-section">
            <div class="section-header collapsed section-gradient-marketplace" onclick="toggleSection('marketplace')">
                <h2>
                    <i class="fas fa-shopping-cart"></i>
                    بازار تجهیزات صنعتی
                </h2>
                <div class="section-toggle">
                    <i class="fas fa-chevron-down"></i>
                </div>
            </div>
            <div class="section-content collapsed" id="marketplace-content">
                <!-- هدر مارکت - سبک Zoomit (کوچک شده) -->
                <div class="bg-gradient-to-r from-blue-600 via-blue-700 to-cyan-600 rounded-lg p-4 mb-4 text-white shadow-md">
                    <div class="flex items-center justify-between mb-3">
                        <div>
                            <h3 class="text-xl font-bold mb-1">بازار جامع تجهیزات صنعتی</h3>
                            <p class="text-sm text-blue-100">پلتفرم خرید آنلاین برای کارخانه‌های زنجیره فولاد</p>
                        </div>
                        <div class="flex items-center gap-3">
                            <div class="text-center bg-white/10 backdrop-blur-sm rounded px-3 py-2">
                                <div class="text-lg font-bold">۵۸</div>
                                <div class="text-xs text-blue-100">تأمین‌کننده</div>
                    </div>
                            <div class="text-center bg-white/10 backdrop-blur-sm rounded px-3 py-2">
                                <div class="text-lg font-bold">۱,۲۴۵</div>
                                <div class="text-xs text-blue-100">محصول</div>
                            </div>
                        </div>
                            </div>
                    
                    <!-- جستجوی پیشرفته -->
                    <div class="bg-white/10 backdrop-blur-sm rounded-lg p-2">
                        <div class="flex gap-2">
                            <div class="flex-1 relative">
                                <input type="text" id="marketplace-search-main" 
                                       placeholder="جستجوی تجهیزات، برند، مدل..." 
                                       class="w-full px-3 py-1.5 pr-10 rounded-lg bg-white text-gray-900 text-sm focus:outline-none focus:ring-2 focus:ring-cyan-400"
                                       onkeyup="searchMarketplaceMain(this.value)">
                                <i class="fas fa-search absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 text-xs"></i>
                        </div>
                            <button onclick="performMarketplaceSearch()" class="px-4 py-1.5 bg-yellow-500 hover:bg-yellow-600 rounded-lg font-medium text-sm transition">
                                <i class="fas fa-search ml-1"></i>
                                جستجو
                            </button>
                            </div>
                    </div>
                </div>

                <!-- فیلترها و دسته‌بندی - سبک Zoomit (کوچک شده) -->
                <div class="bg-white rounded-lg p-3 mb-4 shadow-sm border border-gray-200">
                    <div class="flex flex-wrap gap-2 mb-2">
                        <select id="marketplace-category" class="px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" onchange="filterMarketplace()">
                            <option value="all">همه دسته‌ها</option>
                            <option value="mechanical">تجهیزات مکانیکی</option>
                            <option value="electrical">تجهیزات الکتریکی</option>
                            <option value="instrumentation">ابزار دقیق</option>
                            <option value="automation">اتوماسیون</option>
                            <option value="safety">ایمنی</option>
                            <option value="piping">پایپینگ</option>
                        </select>
                        <select id="marketplace-brand" class="px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" onchange="filterMarketplace()">
                            <option value="all">همه برندها</option>
                            <option value="siemens">Siemens</option>
                            <option value="abb">ABB</option>
                            <option value="outotec">Outotec</option>
                            <option value="flsmidth">FLSmidth</option>
                            <option value="howden">Howden</option>
                            <option value="schenck">Schenck Process</option>
                            <option value="endress">Endress+Hauser</option>
                        </select>
                        <select id="marketplace-price-range" class="px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" onchange="filterMarketplace()">
                            <option value="all">همه قیمت‌ها</option>
                            <option value="0-100">تا ۱۰۰ میلیون</option>
                            <option value="100-500">۱۰۰ تا ۵۰۰ میلیون</option>
                            <option value="500-2000">۵۰۰ میلیون تا ۲ میلیارد</option>
                            <option value="2000+">بالای ۲ میلیارد</option>
                        </select>
                        <select id="marketplace-sort" class="px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" onchange="sortMarketplace()">
                            <option value="default">مرتب‌سازی</option>
                            <option value="price-asc">قیمت: کم به زیاد</option>
                            <option value="price-desc">قیمت: زیاد به کم</option>
                            <option value="rating">بیشترین امتیاز</option>
                            <option value="suppliers">بیشترین تأمین‌کننده</option>
                        </select>
                    </div>
                </div>

                <!-- نمایش محصولات با زبانه‌های قیمت‌گذاری - سبک Siemens -->
                <div id="marketplace-products-container" class="space-y-6">
                    <!-- محصولات به صورت داینامیک بارگذاری می‌شوند -->
                            </div>
                    </div>

        <!-- مدال تأمین‌کنندگان -->
        <div id="suppliersModal" class="fixed inset-0 bg-black bg-opacity-75 hidden z-50 flex items-center justify-center p-4">
            <div class="bg-gray-800 rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden">
                <div class="bg-gradient-to-r from-steeltech-dark to-steeltech-red p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-xl font-bold" id="modalEquipmentName">نام تجهیز</h3>
                            <p class="text-gray-300 text-sm">لیست تأمین‌کنندگان و قیمت‌ها</p>
                        </div>
                        <button onclick="closeSuppliers()" class="text-white hover:text-gray-300 text-2xl">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                <div class="p-6 overflow-y-auto max-h-[60vh]">
                    <table class="w-full">
                        <thead>
                            <tr class="text-gray-400 text-sm border-b border-gray-700">
                                <th class="text-right pb-3">تأمین‌کننده</th>
                                <th class="text-right pb-3">برند</th>
                                <th class="text-right pb-3">قیمت (تومان)</th>
                                <th class="text-right pb-3">زمان تحویل</th>
                                <th class="text-right pb-3">گارانتی</th>
                                <th class="text-right pb-3">امتیاز</th>
                                <th class="text-center pb-3">عملیات</th>
                            </tr>
                        </thead>
                        <tbody id="suppliersTableBody">
                            <!-- تأمین‌کنندگان اینجا اضافه می‌شوند -->
                        </tbody>
                    </table>
                </div>
                <div class="p-4 bg-gray-900 border-t border-gray-700 flex justify-between items-center">
                    <span class="text-sm text-gray-400">قیمت‌ها شامل مالیات و حمل نیست</span>
                    <button onclick="closeSuppliers()" class="px-6 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition">بستن</button>
                </div>
            </div>
        </div>


            <!-- سیستم قراردادها -->
            <section id="contracts" class="collapsible-section">
                <div class="section-header collapsed section-gradient-contracts" onclick="toggleSection('contracts')">
                    <h2>
                        <i class="fas fa-file-contract"></i>
                        سیستم مدیریت قراردادها
                    </h2>
                    <div class="section-toggle">
                        <i class="fas fa-chevron-down"></i>
                    </div>
                </div>
                <div class="section-content collapsed" id="contracts-content">
                    <div class="bg-white mb-8" style="border-bottom: 1px solid #e5e7eb; padding-bottom: 2rem;">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="text-2xl font-normal text-gray-900 mb-3" style="letter-spacing: -0.02em;">مدیریت قراردادها، پیگیری مهلت‌ها و امضای دیجیتال</h3>
                                <p class="text-gray-600 text-lg">سیستم جامع مدیریت قراردادها با قابلیت امضای الکترونیک</p>
                            </div>
                        <button class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg font-medium transition"
                            onclick="showNewContract()">
                            <i class="fas fa-plus ml-2"></i>
                            قرارداد جدید
                        </button>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- قراردادهای منتظر امضا -->
                    <div class="contract-card contract-waiting bg-gray-800 rounded-xl p-6">
                        <h3 class="text-lg font-bold mb-4">
                            <i class="fas fa-clock ml-2 text-yellow-400"></i>
                            منتظر امضا
                        </h3>
                        <div class="space-y-4 max-h-96 overflow-y-auto">
                            <div class="p-4 bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-600 transition"
                                onclick="showContractDetails(1)">
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="font-bold">تعمیرات کوره گندله‌سازی</h4>
                                    <span class="priority-badge priority-emergency">اولویت بالا</span>
                                </div>
                                <div class="text-sm text-gray-300 mb-2">کد: CNT-2024-015</div>
                                <div class="text-xs text-gray-400 mb-2">دیتا شیت: GZP Final Book/5 Mechanical Equipment/03 Indurating Machine/04 Indurating Machine</div>
                                <div class="text-xs text-blue-300 mb-1">بازار خرید: ۱۲ تأمین‌کننده | قیمت بازار: ۱۱۰-۱۴۰ میلیارد</div>
                                <div class="flex justify-between items-center">
                                    <span class="text-yellow-400 text-sm">۱۲۵ میلیارد تومان</span>
                                    <span class="text-xs text-gray-400">مهلت: ۱۴۰۲/۱۱/۲۰</span>
                                </div>
                            </div>
                            
                            <div class="p-4 bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-600 transition"
                                onclick="showContractDetails(2)">
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="font-bold">تعمیرات Loss in Weight Feeder</h4>
                                    <span class="priority-badge priority-high">اولویت بالا</span>
                                </div>
                                <div class="text-sm text-gray-300 mb-2">کد: CNT-2024-016</div>
                                <div class="text-xs text-gray-400 mb-2">دیتا شیت: GZP Final Book/5 Mechanical Equipment/01 Dosing and Mixing/02 Loss in Weight Feeder</div>
                                <div class="text-xs text-blue-300 mb-1">بازار خرید: ۸ تأمین‌کننده | قیمت بازار: ۴۰-۵۰ میلیارد</div>
                                <div class="flex justify-between items-center">
                                    <span class="text-yellow-400 text-sm">۴۵ میلیارد تومان</span>
                                    <span class="text-xs text-gray-400">مهلت: ۱۴۰۲/۱۱/۲۲</span>
                                </div>
                            </div>
                            
                            <div class="p-4 bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-600 transition"
                                onclick="showContractDetails(3)">
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="font-bold">تعمیرات Pelletizing Discs</h4>
                                    <span class="priority-badge priority-high">اولویت بالا</span>
                                </div>
                                <div class="text-sm text-gray-300 mb-2">کد: CNT-2024-017</div>
                                <div class="text-xs text-gray-400 mb-2">دیتا شیت: GZP Final Book/5 Mechanical Equipment/02 Green Peletizing/03 Pelletizing Discs</div>
                                <div class="text-xs text-blue-300 mb-1">بازار خرید: ۱۵ تأمین‌کننده | قیمت بازار: ۸۵-۱۰۵ میلیارد</div>
                                <div class="flex justify-between items-center">
                                    <span class="text-yellow-400 text-sm">۹۵ میلیارد تومان</span>
                                    <span class="text-xs text-gray-400">مهلت: ۱۴۰۲/۱۱/۲۵</span>
                                </div>
                            </div>
                            
                            <div class="p-4 bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-600 transition"
                                onclick="showContractDetails(4)">
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="font-bold">تعمیرات Updraft Drying Fan</h4>
                                    <span class="priority-badge priority-normal">اولویت عادی</span>
                                </div>
                                <div class="text-sm text-gray-300 mb-2">کد: CNT-2024-018</div>
                                <div class="text-xs text-gray-400 mb-2">دیتا شیت: GZP Final Book/5 Mechanical Equipment/05 Process Fans and Ducts/02 Updrought Drying Fan</div>
                                <div class="text-xs text-blue-300 mb-1">بازار خرید: ۱۰ تأمین‌کننده | قیمت بازار: ۲۰۰-۲۴۰ میلیارد</div>
                                <div class="flex justify-between items-center">
                                    <span class="text-yellow-400 text-sm">۲۲۰ میلیارد تومان</span>
                                    <span class="text-xs text-gray-400">مهلت: ۱۴۰۲/۱۱/۲۸</span>
                                </div>
                            </div>
                            
                            <div class="p-4 bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-600 transition"
                                onclick="showContractDetails(5)">
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="font-bold">تعمیرات ESP Windbox Exhaust Gas</h4>
                                    <span class="priority-badge priority-high">اولویت بالا</span>
                                </div>
                                <div class="text-sm text-gray-300 mb-2">کد: CNT-2024-019</div>
                                <div class="text-xs text-gray-400 mb-2">دیتا شیت: GZP Final Book/5 Mechanical Equipment/09 Process Gas Dedusting/01 ESP Windbox Exhaust Gas 1</div>
                                <div class="text-xs text-blue-300 mb-1">بازار خرید: ۶ تأمین‌کننده | قیمت بازار: ۶۰۰-۷۰۰ میلیارد</div>
                                <div class="flex justify-between items-center">
                                    <span class="text-yellow-400 text-sm">۶۵۰ میلیارد تومان</span>
                                    <span class="text-xs text-gray-400">مهلت: ۱۴۰۲/۱۲/۰۵</span>
                                </div>
                            </div>
                            
                            <div class="p-4 bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-600 transition"
                                onclick="showContractDetails(6)">
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="font-bold">تعمیرات Thickener with Rake</h4>
                                    <span class="priority-badge priority-normal">اولویت عادی</span>
                                </div>
                                <div class="text-sm text-gray-300 mb-2">کد: CNT-2024-020</div>
                                <div class="text-xs text-gray-400 mb-2">دیتا شیت: GZP Final Book/5 Mechanical Equipment/11 Process Water System/01 Thickener with Rake Mechanism</div>
                                <div class="flex justify-between items-center">
                                    <span class="text-yellow-400 text-sm">۱۲۰ میلیارد تومان</span>
                                    <span class="text-xs text-gray-400">مهلت: ۱۴۰۲/۱۲/۱۰</span>
                                </div>
                            </div>
                            
                            <div class="p-4 bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-600 transition"
                                onclick="showContractDetails(7)">
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="font-bold">تعمیرات Membrane Filter Press</h4>
                                    <span class="priority-badge priority-normal">اولویت عادی</span>
                                </div>
                                <div class="text-sm text-gray-300 mb-2">کد: CNT-2024-021</div>
                                <div class="text-xs text-gray-400 mb-2">دیتا شیت: GZP Final Book/5 Mechanical Equipment/12 Filtration/01 Membrane Filter Press, including</div>
                                <div class="flex justify-between items-center">
                                    <span class="text-yellow-400 text-sm">۱۸۰ میلیارد تومان</span>
                                    <span class="text-xs text-gray-400">مهلت: ۱۴۰۲/۱۲/۱۵</span>
                                </div>
                            </div>
                            
                            <div class="p-4 bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-600 transition"
                                onclick="showContractDetails(8)">
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="font-bold">تعمیرات PLC SIMATIC S7-1500</h4>
                                    <span class="priority-badge priority-emergency">اولویت اضطراری</span>
                                </div>
                                <div class="text-sm text-gray-300 mb-2">کد: CNT-2024-022</div>
                                <div class="text-xs text-gray-400 mb-2">دیتا شیت: GZP Final Book/6 Electrical Equipment/02 Supply Documentation</div>
                                <div class="flex justify-between items-center">
                                    <span class="text-yellow-400 text-sm">۲۵۰ میلیون تومان</span>
                                    <span class="text-xs text-gray-400">مهلت: ۱۴۰۲/۱۱/۱۸</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- قراردادهای امضا شده -->
                    <div class="contract-card contract-signed bg-gray-800 rounded-xl p-6">
                        <h3 class="text-lg font-bold mb-4">
                            <i class="fas fa-check-circle ml-2 text-green-400"></i>
                            امضا شده
                        </h3>
                        <div class="space-y-4 max-h-96 overflow-y-auto">
                            <div class="p-4 bg-gray-50 rounded-lg" style="border: 1px solid #e5e7eb;">
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="font-bold">نگهداری سالانه تجهیزات</h4>
                                    <span class="text-xs text-green-400">فعال</span>
                                </div>
                                <div class="text-sm text-gray-300 mb-2">کد: CNT-2024-014</div>
                                <div class="text-xs text-gray-500 mb-2">دیتا شیت: GZP Final Book/5 Mechanical Equipment</div>
                                <div class="flex justify-between items-center">
                                    <span class="text-yellow-400 text-sm">۸۵ میلیارد تومان</span>
                                    <span class="text-xs text-gray-400">شروع: ۱۴۰۲/۱۰/۰۱</span>
                                </div>
                            </div>
                            
                            <div class="p-4 bg-gray-50 rounded-lg" style="border: 1px solid #e5e7eb;">
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="font-bold">قرارداد تعمیرات Indurating Hood</h4>
                                    <span class="text-xs text-green-400">فعال</span>
                                </div>
                                <div class="text-sm text-gray-300 mb-2">کد: CNT-2024-023</div>
                                <div class="text-xs text-gray-500 mb-2">دیتا شیت: GZP Final Book/5 Mechanical Equipment/04 Indurating Hood/00 Indurating Hood</div>
                                <div class="flex justify-between items-center">
                                    <span class="text-yellow-400 text-sm">۱۵,۰۰۰ میلیارد تومان</span>
                                    <span class="text-xs text-gray-400">شروع: ۱۴۰۲/۰۹/۱۵</span>
                                </div>
                            </div>
                            
                            <div class="p-4 bg-gray-50 rounded-lg" style="border: 1px solid #e5e7eb;">
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="font-bold">قرارداد تعمیرات Belt Weighers</h4>
                                    <span class="text-xs text-green-400">فعال</span>
                                </div>
                                <div class="text-sm text-gray-300 mb-2">کد: CNT-2024-024</div>
                                <div class="text-xs text-gray-500 mb-2">دیتا شیت: GZP Final Book/5 Mechanical Equipment/01 Dosing and Mixing/04 Belt Weighers + Dosing Belt Weighers</div>
                                <div class="flex justify-between items-center">
                                    <span class="text-yellow-400 text-sm">۳۲۰ میلیون تومان</span>
                                    <span class="text-xs text-gray-400">شروع: ۱۴۰۲/۱۰/۱۰</span>
                                </div>
                            </div>
                            
                            <div class="p-4 bg-gray-50 rounded-lg" style="border: 1px solid #e5e7eb;">
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="font-bold">قرارداد تعمیرات Mixers Drum Type</h4>
                                    <span class="text-xs text-green-400">فعال</span>
                                </div>
                                <div class="text-sm text-gray-300 mb-2">کد: CNT-2024-025</div>
                                <div class="text-xs text-gray-500 mb-2">دیتا شیت: GZP Final Book/5 Mechanical Equipment/01 Dosing and Mixing/06 Mixers Drum Type</div>
                                <div class="flex justify-between items-center">
                                    <span class="text-yellow-400 text-sm">۳۸۰ میلیون تومان</span>
                                    <span class="text-xs text-gray-400">شروع: ۱۴۰۲/۱۰/۱۲</span>
                                </div>
                            </div>
                            
                            <div class="p-4 bg-gray-50 rounded-lg" style="border: 1px solid #e5e7eb;">
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="font-bold">قرارداد تعمیرات Reciprocating Head</h4>
                                    <span class="text-xs text-green-400">فعال</span>
                                </div>
                                <div class="text-sm text-gray-300 mb-2">کد: CNT-2024-026</div>
                                <div class="text-xs text-gray-500 mb-2">دیتا شیت: GZP Final Book/5 Mechanical Equipment/03 Indurating Machine/01 Reciproacting head with oil hydraulic drive</div>
                                <div class="flex justify-between items-center">
                                    <span class="text-yellow-400 text-sm">۱,۲۰۰ میلیارد تومان</span>
                                    <span class="text-xs text-gray-400">شروع: ۱۴۰۲/۰۹/۲۰</span>
                                </div>
                            </div>
                            
                            <div class="p-4 bg-gray-50 rounded-lg" style="border: 1px solid #e5e7eb;">
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="font-bold">قرارداد تعمیرات Cooling Air Fans</h4>
                                    <span class="text-xs text-green-400">فعال</span>
                                </div>
                                <div class="text-sm text-gray-300 mb-2">کد: CNT-2024-027</div>
                                <div class="text-xs text-gray-500 mb-2">دیتا شیت: GZP Final Book/5 Mechanical Equipment/05 Process Fans and Ducts/01 Cooling Air Fans</div>
                                <div class="flex justify-between items-center">
                                    <span class="text-yellow-400 text-sm">۹۵۰ میلیون تومان</span>
                                    <span class="text-xs text-gray-400">شروع: ۱۴۰۲/۱۰/۰۵</span>
                                </div>
                            </div>
                            
                            <div class="p-4 bg-gray-50 rounded-lg" style="border: 1px solid #e5e7eb;">
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="font-bold">قرارداد تعمیرات Product Screen Sizer</h4>
                                    <span class="text-xs text-green-400">فعال</span>
                                </div>
                                <div class="text-sm text-gray-300 mb-2">کد: CNT-2024-028</div>
                                <div class="text-xs text-gray-500 mb-2">دیتا شیت: GZP Final Book/5 Mechanical Equipment/06 Pellet Screening and Transport/01 Product Screens - Sizer</div>
                                <div class="flex justify-between items-center">
                                    <span class="text-yellow-400 text-sm">۵۲۰ میلیون تومان</span>
                                    <span class="text-xs text-gray-400">شروع: ۱۴۰۲/۱۰/۱۸</span>
                                </div>
                            </div>
                            
                            <div class="p-4 bg-gray-50 rounded-lg" style="border: 1px solid #e5e7eb;">
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="font-bold">قرارداد تعمیرات Distribution Transformer</h4>
                                    <span class="text-xs text-green-400">فعال</span>
                                </div>
                                <div class="text-sm text-gray-300 mb-2">کد: CNT-2024-029</div>
                                <div class="text-xs text-gray-500 mb-2">دیتا شیت: GZP Final Book/6 Electrical Equipment/02 Supply Documentation</div>
                                <div class="flex justify-between items-center">
                                    <span class="text-yellow-400 text-sm">۱,۲۰۰ میلیون تومان</span>
                                    <span class="text-xs text-gray-400">شروع: ۱۴۰۲/۰۹/۲۵</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- آمار قراردادها -->
                    <div class="bg-gray-800 rounded-xl p-6">
                        <h3 class="text-lg font-bold mb-4">
                            <i class="fas fa-chart-bar ml-2 text-purple-400"></i>
                            آمار قراردادها
                        </h3>
                        <div class="space-y-4">
                            <div class="p-4 bg-gray-50 rounded-lg" style="border: 1px solid #e5e7eb;">
                                <div class="flex justify-between mb-2">
                                    <span>کل قراردادها:</span>
                                    <span class="font-bold text-white">۳۵</span>
                                </div>
                                <div class="text-xs text-gray-500 mt-1">منتظر امضا: ۸ | امضا شده: ۲۷</div>
                            </div>

                            <div class="p-4 bg-gray-50 rounded-lg" style="border: 1px solid #e5e7eb;">
                                <div class="flex justify-between mb-2">
                                    <span>ارزش کل:</span>
                                    <span class="font-bold text-yellow-400">۲,۸۵۰ میلیارد تومان</span>
                                </div>
                                <div class="text-xs text-gray-500 mt-1">پرداخت شده: ۱,۲۲۰ میلیارد</div>
                            </div>

                            <div class="p-4 bg-gray-50 rounded-lg" style="border: 1px solid #e5e7eb;">
                                <div class="flex justify-between mb-2">
                                    <span>میانگین مدت:</span>
                                    <span class="font-bold text-blue-400">۲۴ ماه</span>
                                </div>
                                <div class="text-xs text-gray-500 mt-1">کوتاه‌ترین: ۶ ماه | طولانی‌ترین: ۶۰ ماه</div>
                            </div>
                            
                            <div class="p-4 bg-gray-50 rounded-lg" style="border: 1px solid #e5e7eb;">
                                <div class="flex justify-between mb-2">
                                    <span>قراردادهای بر اساس Final Book:</span>
                                    <span class="font-bold text-green-400">۲۸ قرارداد</span>
                                </div>
                                <div class="text-xs text-gray-500 mt-1">مکانیکی: ۱۸ | الکتریکی: ۷ | ابزار دقیق: ۳</div>
                            </div>

                            <button class="w-full py-3 bg-purple-600 hover:bg-purple-700 rounded-lg transition">
                                <i class="fas fa-file-export ml-2"></i>
                                خروجی گزارش
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- بخش مناقصات و مزایده‌ها -->
        <section id="tenders" class="collapsible-section">
            <div class="section-header collapsed section-gradient-tenders" onclick="toggleSection('tenders')">
                <h2>
                    <i class="fas fa-gavel"></i>
                    سیستم مدیریت مناقصات
                </h2>
                <div class="section-toggle">
                    <i class="fas fa-chevron-down"></i>
                </div>
            </div>
            <div class="section-content collapsed" id="tenders-content">
                <div class="bg-white mb-8" style="border-bottom: 1px solid #e5e7eb; padding-bottom: 2rem;">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-2xl font-normal text-gray-900 mb-3" style="letter-spacing: -0.02em;">مدیریت فرآیند مناقصات، مزایده‌ها و انتخاب پیمانکاران</h3>
                            <p class="text-gray-600 text-lg">سیستم جامع مدیریت مناقصات و مزایده‌های صنعتی</p>
                        </div>
                        <button class="px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg font-medium transition"
                            onclick="showNewTender()">
                            <i class="fas fa-plus ml-2"></i>
                            مناقصه جدید
                        </button>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6" id="tenders-grid">
                    <!-- مناقصه 1 -->
                    <div class="bg-white rounded-xl p-6 border border-gray-200 hover:border-green-500 transition duration-300 shadow-md tender-card">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="text-xl font-bold text-gray-900">تعمیرات کوره گندله‌سازی</h3>
                                <p class="text-cyan-600 font-semibold text-sm">کد: TND-2024-001</p>
                            </div>
                            <span class="tender-status tender-active">فعال</span>
                        </div>
                        <p class="text-gray-600 mb-4">تعمیرات اساسی کوره ایندوریت کارخانه گندله‌سازی - خط تولید ۲</p>
                        <div class="flex justify-between items-center text-sm text-gray-500 mb-4">
                            <span>مهلت: ۱۴۰۲/۱۱/۱۵</span>
                            <span class="font-bold text-gray-900">بودجه: ۱۲۵ میلیارد تومان</span>
                        </div>
                        <div class="mb-4">
                            <div class="text-xs text-gray-500 mb-2">لیست تجهیزات:</div>
                            <div class="flex flex-wrap gap-2 mb-2">
                                <span class="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs">Indurating Machine</span>
                                <span class="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs">Indurating Hood</span>
                                <span class="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs">Process Fans</span>
                        </div>
                            <button onclick="toggleTenderEquipment('tender1')" class="text-xs text-cyan-600 hover:text-cyan-700">
                                <i class="fas fa-chevron-down ml-1"></i>مشاهده تمام تجهیزات
                            </button>
                            <div id="tender1-equipment" class="hidden mt-2 space-y-1 text-xs text-gray-600">
                                <div>• کوره ایندوریت - خط 2</div>
                                <div>• هود بازیابی حرارت</div>
                                <div>• فن‌های خنک‌کننده</div>
                                <div>• سیستم عایق‌کاری نسوز</div>
                            </div>
                        </div>
                        <button class="w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-semibold transition duration-200"
                            onclick="showTenderDetails('tender1')">
                            ارسال پیشنهاد
                        </button>
                    </div>

                    <!-- مناقصه 2 -->
                    <div class="bg-white rounded-xl p-6 border border-gray-200 hover:border-green-500 transition duration-300 shadow-md tender-card">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="text-xl font-bold text-gray-900">نوسازی سیستم کنترل مرکزی</h3>
                                <p class="text-cyan-600 font-semibold text-sm">کد: TND-2024-002</p>
                            </div>
                            <span class="tender-status tender-active">فعال</span>
                        </div>
                        <p class="text-gray-600 mb-4">ارتقاء سیستم کنترل و اتوماسیون کارخانه فولادسازی - بخش کوره‌ها</p>
                        <div class="flex justify-between items-center text-sm text-gray-500 mb-4">
                            <span>مهلت: ۱۴۰۲/۱۲/۰۱</span>
                            <span class="font-bold text-gray-900">بودجه: ۸۵ میلیارد تومان</span>
                        </div>
                        <div class="mb-4">
                            <div class="text-xs text-gray-500 mb-2">لیست تجهیزات:</div>
                            <div class="flex flex-wrap gap-2 mb-2">
                                <span class="px-2 py-1 bg-purple-100 text-purple-700 rounded text-xs">PLC Systems</span>
                                <span class="px-2 py-1 bg-purple-100 text-purple-700 rounded text-xs">HMI Panels</span>
                                <span class="px-2 py-1 bg-purple-100 text-purple-700 rounded text-xs">Instrumentation</span>
                        </div>
                            <button onclick="toggleTenderEquipment('tender2')" class="text-xs text-cyan-600 hover:text-cyan-700">
                                <i class="fas fa-chevron-down ml-1"></i>مشاهده تمام تجهیزات
                            </button>
                            <div id="tender2-equipment" class="hidden mt-2 space-y-1 text-xs text-gray-600">
                                <div>• PLC SIMATIC S7-1500</div>
                                <div>• HMI پنل صنعتی</div>
                                <div>• ترانسمیتر فشار و دما</div>
                                <div>• سیستم SCADA</div>
                            </div>
                        </div>
                        <button class="w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-semibold transition duration-200"
                            onclick="showTenderDetails('tender2')">
                            ارسال پیشنهاد
                        </button>
                    </div>

                    <!-- مناقصه 3 -->
                    <div class="bg-white rounded-xl p-6 border border-gray-200 hover:border-green-500 transition duration-300 shadow-md tender-card">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="text-xl font-bold text-gray-900">تعمیرات سیستم Dosing & Mixing</h3>
                                <p class="text-cyan-600 font-semibold text-sm">کد: TND-2024-003</p>
                            </div>
                            <span class="tender-status tender-active">فعال</span>
                        </div>
                        <p class="text-gray-600 mb-4">تعمیرات و نگهداری سیستم‌های دوزینگ و مخلوط‌سازی</p>
                        <div class="flex justify-between items-center text-sm text-gray-500 mb-4">
                            <span>مهلت: ۱۴۰۲/۱۱/۲۰</span>
                            <span class="font-bold text-gray-900">بودجه: ۴۵ میلیارد تومان</span>
                        </div>
                        <div class="mb-4">
                            <div class="text-xs text-gray-500 mb-2">لیست تجهیزات:</div>
                            <div class="flex flex-wrap gap-2 mb-2">
                                <span class="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs">Loss in Weight Feeder</span>
                                <span class="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs">Mixers</span>
                            </div>
                            <button onclick="toggleTenderEquipment('tender3')" class="text-xs text-cyan-600 hover:text-cyan-700">
                                <i class="fas fa-chevron-down ml-1"></i>مشاهده تمام تجهیزات
                            </button>
                            <div id="tender3-equipment" class="hidden mt-2 space-y-1 text-xs text-gray-600">
                                <div>• Loss in Weight Feeder - 4 دستگاه</div>
                                <div>• Mixers Drum Type - 2 دستگاه</div>
                                <div>• Air Blaster Systems</div>
                            </div>
                        </div>
                        <button class="w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-semibold transition duration-200"
                            onclick="showTenderDetails('tender3')">
                            ارسال پیشنهاد
                        </button>
                    </div>

                    <!-- مناقصه 4 -->
                    <div class="bg-white rounded-xl p-6 border border-gray-200 hover:border-green-500 transition duration-300 shadow-md tender-card">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="text-xl font-bold text-gray-900">تعمیرات Green Pelletizing</h3>
                                <p class="text-cyan-600 font-semibold text-sm">کد: TND-2024-004</p>
                            </div>
                            <span class="tender-status tender-active">فعال</span>
                        </div>
                        <p class="text-gray-600 mb-4">تعمیرات و نگهداری دیسک‌های گندله‌سازی</p>
                        <div class="flex justify-between items-center text-sm text-gray-500 mb-4">
                            <span>مهلت: ۱۴۰۲/۱۱/۲۵</span>
                            <span class="font-bold text-gray-900">بودجه: ۶۵ میلیارد تومان</span>
                        </div>
                        <div class="mb-4">
                            <div class="text-xs text-gray-500 mb-2">لیست تجهیزات:</div>
                            <div class="flex flex-wrap gap-2 mb-2">
                                <span class="px-2 py-1 bg-green-100 text-green-700 rounded text-xs">Pelletizing Discs</span>
                                <span class="px-2 py-1 bg-green-100 text-green-700 rounded text-xs">Roller Screen</span>
                            </div>
                            <button onclick="toggleTenderEquipment('tender4')" class="text-xs text-cyan-600 hover:text-cyan-700">
                                <i class="fas fa-chevron-down ml-1"></i>مشاهده تمام تجهیزات
                            </button>
                            <div id="tender4-equipment" class="hidden mt-2 space-y-1 text-xs text-gray-600">
                                <div>• Pelletizing Discs - 8 متر</div>
                                <div>• Single Deck Roller Screen</div>
                                <div>• سیستم روغن‌کاری مرکزی</div>
                            </div>
                        </div>
                        <button class="w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-semibold transition duration-200"
                            onclick="showTenderDetails('tender4')">
                            ارسال پیشنهاد
                        </button>
                    </div>

                    <!-- مناقصه 5 -->
                    <div class="bg-white rounded-xl p-6 border border-gray-200 hover:border-green-500 transition duration-300 shadow-md tender-card">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="text-xl font-bold text-gray-900">تعمیرات Process Fans</h3>
                                <p class="text-cyan-600 font-semibold text-sm">کد: TND-2024-005</p>
                            </div>
                            <span class="tender-status tender-active">فعال</span>
                        </div>
                        <p class="text-gray-600 mb-4">تعمیرات و نگهداری فن‌های فرآیندی</p>
                        <div class="flex justify-between items-center text-sm text-gray-500 mb-4">
                            <span>مهلت: ۱۴۰۲/۱۲/۰۵</span>
                            <span class="font-bold text-gray-900">بودجه: ۳۵ میلیارد تومان</span>
                        </div>
                        <div class="mb-4">
                            <div class="text-xs text-gray-500 mb-2">لیست تجهیزات:</div>
                            <div class="flex flex-wrap gap-2 mb-2">
                                <span class="px-2 py-1 bg-purple-100 text-purple-700 rounded text-xs">Cooling Air Fans</span>
                                <span class="px-2 py-1 bg-purple-100 text-purple-700 rounded text-xs">Drying Fans</span>
                            </div>
                            <button onclick="toggleTenderEquipment('tender5')" class="text-xs text-cyan-600 hover:text-cyan-700">
                                <i class="fas fa-chevron-down ml-1"></i>مشاهده تمام تجهیزات
                            </button>
                            <div id="tender5-equipment" class="hidden mt-2 space-y-1 text-xs text-gray-600">
                                <div>• Cooling Air Fans - 6 دستگاه</div>
                                <div>• Updrought Drying Fan - 4 دستگاه</div>
                                <div>• سیستم کنترل سرعت</div>
                            </div>
                        </div>
                        <button class="w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-semibold transition duration-200"
                            onclick="showTenderDetails('tender5')">
                            ارسال پیشنهاد
                        </button>
                    </div>

                    <!-- مناقصه 6 -->
                    <div class="bg-white rounded-xl p-6 border border-gray-200 hover:border-green-500 transition duration-300 shadow-md tender-card">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="text-xl font-bold text-gray-900">تعمیرات سیستم الکتریکی</h3>
                                <p class="text-cyan-600 font-semibold text-sm">کد: TND-2024-006</p>
                            </div>
                            <span class="tender-status tender-active">فعال</span>
                        </div>
                        <p class="text-gray-600 mb-4">تعمیرات و نگهداری تجهیزات الکتریکی</p>
                        <div class="flex justify-between items-center text-sm text-gray-500 mb-4">
                            <span>مهلت: ۱۴۰۲/۱۲/۱۰</span>
                            <span class="font-bold text-gray-900">بودجه: ۵۵ میلیارد تومان</span>
                        </div>
                        <div class="mb-4">
                            <div class="text-xs text-gray-500 mb-2">لیست تجهیزات:</div>
                            <div class="flex flex-wrap gap-2 mb-2">
                                <span class="px-2 py-1 bg-yellow-100 text-yellow-700 rounded text-xs">Motors</span>
                                <span class="px-2 py-1 bg-yellow-100 text-yellow-700 rounded text-xs">Drives</span>
                            </div>
                            <button onclick="toggleTenderEquipment('tender6')" class="text-xs text-cyan-600 hover:text-cyan-700">
                                <i class="fas fa-chevron-down ml-1"></i>مشاهده تمام تجهیزات
                            </button>
                            <div id="tender6-equipment" class="hidden mt-2 space-y-1 text-xs text-gray-600">
                                <div>• الکتروموتور SIMOTICS - 15 دستگاه</div>
                                <div>• درایو SINAMICS G120 - 12 دستگاه</div>
                                <div>• ترانسفورماتور قدرت</div>
                            </div>
                        </div>
                        <button class="w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-semibold transition duration-200"
                            onclick="showTenderDetails('tender6')">
                            ارسال پیشنهاد
                        </button>
                    </div>

                    <!-- مناقصه 7 -->
                    <div class="bg-white rounded-xl p-6 border border-gray-200 hover:border-green-500 transition duration-300 shadow-md tender-card">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="text-xl font-bold text-gray-900">تعمیرات سیستم Dedusting</h3>
                                <p class="text-cyan-600 font-semibold text-sm">کد: TND-2024-007</p>
                            </div>
                            <span class="tender-status tender-active">فعال</span>
                        </div>
                        <p class="text-gray-600 mb-4">تعمیرات سیستم‌های غبارگیری</p>
                        <div class="flex justify-between items-center text-sm text-gray-500 mb-4">
                            <span>مهلت: ۱۴۰۲/۱۲/۱۵</span>
                            <span class="font-bold text-gray-900">بودجه: ۷۵ میلیارد تومان</span>
                        </div>
                        <div class="mb-4">
                            <div class="text-xs text-gray-500 mb-2">لیست تجهیزات:</div>
                            <div class="flex flex-wrap gap-2 mb-2">
                                <span class="px-2 py-1 bg-orange-100 text-orange-700 rounded text-xs">ESP Systems</span>
                                <span class="px-2 py-1 bg-orange-100 text-orange-700 rounded text-xs">Bag Filters</span>
                            </div>
                            <button onclick="toggleTenderEquipment('tender7')" class="text-xs text-cyan-600 hover:text-cyan-700">
                                <i class="fas fa-chevron-down ml-1"></i>مشاهده تمام تجهیزات
                            </button>
                            <div id="tender7-equipment" class="hidden mt-2 space-y-1 text-xs text-gray-600">
                                <div>• ESP Windbox Exhaust Gas</div>
                                <div>• سیستم فیلتراسیون کیسه‌ای</div>
                                <div>• فن‌های مکش</div>
                            </div>
                        </div>
                        <button class="w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-semibold transition duration-200"
                            onclick="showTenderDetails('tender7')">
                            ارسال پیشنهاد
                        </button>
                    </div>

                    <!-- مناقصه 8 -->
                    <div class="bg-white rounded-xl p-6 border border-gray-200 hover:border-green-500 transition duration-300 shadow-md tender-card">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="text-xl font-bold text-gray-900">تعمیرات سیستم آب</h3>
                                <p class="text-cyan-600 font-semibold text-sm">کد: TND-2024-008</p>
                            </div>
                            <span class="tender-status tender-active">فعال</span>
                        </div>
                        <p class="text-gray-600 mb-4">تعمیرات سیستم آب فرآیندی</p>
                        <div class="flex justify-between items-center text-sm text-gray-500 mb-4">
                            <span>مهلت: ۱۴۰۲/۱۲/۲۰</span>
                            <span class="font-bold text-gray-900">بودجه: ۴۰ میلیارد تومان</span>
                        </div>
                        <div class="mb-4">
                            <div class="text-xs text-gray-500 mb-2">لیست تجهیزات:</div>
                            <div class="flex flex-wrap gap-2 mb-2">
                                <span class="px-2 py-1 bg-cyan-100 text-cyan-700 rounded text-xs">Thickener</span>
                                <span class="px-2 py-1 bg-cyan-100 text-cyan-700 rounded text-xs">Pumps</span>
                            </div>
                            <button onclick="toggleTenderEquipment('tender8')" class="text-xs text-cyan-600 hover:text-cyan-700">
                                <i class="fas fa-chevron-down ml-1"></i>مشاهده تمام تجهیزات
                            </button>
                            <div id="tender8-equipment" class="hidden mt-2 space-y-1 text-xs text-gray-600">
                                <div>• Thickener with Rake</div>
                                <div>• پمپ‌های سانتریفیوژ</div>
                                <div>• سیستم فیلتراسیون</div>
                            </div>
                        </div>
                        <button class="w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-semibold transition duration-200"
                            onclick="showTenderDetails('tender8')">
                            ارسال پیشنهاد
                        </button>
                    </div>

                    <!-- مناقصه 9 -->
                    <div class="bg-white rounded-xl p-6 border border-gray-200 hover:border-green-500 transition duration-300 shadow-md tender-card">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="text-xl font-bold text-gray-900">تعمیرات Screening & Transport</h3>
                                <p class="text-cyan-600 font-semibold text-sm">کد: TND-2024-009</p>
                            </div>
                            <span class="tender-status tender-active">فعال</span>
                        </div>
                        <p class="text-gray-600 mb-4">تعمیرات سیستم‌های الک و حمل و نقل</p>
                        <div class="flex justify-between items-center text-sm text-gray-500 mb-4">
                            <span>مهلت: ۱۴۰۲/۱۲/۲۵</span>
                            <span class="font-bold text-gray-900">بودجه: ۳۰ میلیارد تومان</span>
                        </div>
                        <div class="mb-4">
                            <div class="text-xs text-gray-500 mb-2">لیست تجهیزات:</div>
                            <div class="flex flex-wrap gap-2 mb-2">
                                <span class="px-2 py-1 bg-teal-100 text-teal-700 rounded text-xs">Product Screens</span>
                                <span class="px-2 py-1 bg-teal-100 text-teal-700 rounded text-xs">Conveyors</span>
                            </div>
                            <button onclick="toggleTenderEquipment('tender9')" class="text-xs text-cyan-600 hover:text-cyan-700">
                                <i class="fas fa-chevron-down ml-1"></i>مشاهده تمام تجهیزات
                            </button>
                            <div id="tender9-equipment" class="hidden mt-2 space-y-1 text-xs text-gray-600">
                                <div>• Product Screens - Sizer</div>
                                <div>• نوار نقاله‌های انتقال</div>
                                <div>• سیستم‌های غربالگری</div>
                            </div>
                        </div>
                        <button class="w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-semibold transition duration-200"
                            onclick="showTenderDetails('tender9')">
                            ارسال پیشنهاد
                        </button>
                    </div>

                    <!-- مناقصه 10 -->
                    <div class="bg-white rounded-xl p-6 border border-gray-200 hover:border-green-500 transition duration-300 shadow-md tender-card">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="text-xl font-bold text-gray-900">اورهال کامل کارخانه گندله‌سازی</h3>
                                <p class="text-cyan-600 font-semibold text-sm">کد: TND-2024-010</p>
                            </div>
                            <span class="tender-status tender-active">فعال</span>
                        </div>
                        <p class="text-gray-600 mb-4">اورهال کامل و تعمیرات اساسی تمام بخش‌های کارخانه</p>
                        <div class="flex justify-between items-center text-sm text-gray-500 mb-4">
                            <span>مهلت: ۱۴۰۳/۰۱/۱۰</span>
                            <span class="font-bold text-gray-900">بودجه: ۳۵۰ میلیارد تومان</span>
                        </div>
                        <div class="mb-4">
                            <div class="text-xs text-gray-500 mb-2">لیست تجهیزات:</div>
                            <div class="flex flex-wrap gap-2 mb-2">
                                <span class="px-2 py-1 bg-red-100 text-red-700 rounded text-xs">همه بخش‌ها</span>
                            </div>
                            <button onclick="toggleTenderEquipment('tender10')" class="text-xs text-cyan-600 hover:text-cyan-700">
                                <i class="fas fa-chevron-down ml-1"></i>مشاهده تمام تجهیزات
                            </button>
                            <div id="tender10-equipment" class="hidden mt-2 space-y-1 text-xs text-gray-600">
                                <div>• Dosing & Mixing - تمام تجهیزات</div>
                                <div>• Green Pelletizing - تمام تجهیزات</div>
                                <div>• Indurating Machine - تمام تجهیزات</div>
                                <div>• Process Fans - تمام تجهیزات</div>
                                <div>• سیستم‌های الکتریکی و ابزار دقیق</div>
                            </div>
                        </div>
                        <button class="w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-semibold transition duration-200"
                            onclick="showTenderDetails('tender10')">
                            ارسال پیشنهاد
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- مدیریت قراردادهای دیجیتال و امضای الکترونیک -->
        <section id="digital-contracts" class="collapsible-section">
            <div class="section-header collapsed section-gradient-factories" onclick="toggleSection('digital-contracts')">
                <h2>
                    <i class="fas fa-file-signature"></i>
                    مدیریت قراردادهای دیجیتال و امضای الکترونیک
                    </h2>
                    <div class="section-toggle">
                        <i class="fas fa-chevron-down"></i>
                    </div>
                </div>
            <div class="section-content collapsed" id="digital-contracts-content">
                <div class="bg-white mb-8" style="border-bottom: 1px solid #e5e7eb; padding-bottom: 2rem;">
                        <div class="flex items-center justify-between">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-bold">
                                <i class="fas fa-clock ml-2 text-yellow-400"></i>
                                منتظر امضا
                            </h3>
                            <span class="px-3 py-1 bg-yellow-500 bg-opacity-20 text-yellow-400 rounded-lg text-sm">۸
                                قرارداد</span>
                        </div>
                        <div class="space-y-4 max-h-96 overflow-y-auto">
                            <div class="contract-card contract-waiting bg-gray-700 rounded-lg p-4 hover:bg-gray-600 transition cursor-pointer"
                                onclick="showContractDetails(1)">
                                <div class="flex justify-between items-start mb-2">
                                    <div>
                                        <h4 class="font-bold">تعمیرات کوره گندله‌سازی</h4>
                                        <p class="text-sm text-gray-400">کد: CNT-2024-015</p>
                                    </div>
                                    <span class="px-2 py-1 bg-orange-500 bg-opacity-20 text-orange-400 rounded text-xs">اولویت
                                        بالا</span>
                                </div>
                                <div class="text-xs text-gray-400 mb-2">دیتا شیت: GZP Final Book/5 Mechanical Equipment/03 Indurating Machine/04 Indurating Machine</div>
                                <div class="text-sm text-gray-300 mb-2">
                                    مهلت امضا: ۱۴۰۲/۱۱/۲۰
                                </div>
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-yellow-400 text-sm">۱۲۵ میلیارد تومان</span>
                                    <button class="px-3 py-1 btn-steeltech rounded text-xs transition"
                                        onclick="event.stopPropagation(); showDigitalSignature()">
                                        امضا کن
                                    </button>
                                </div>
                                <button class="w-full mt-2 px-3 py-1 bg-blue-600 hover:bg-blue-700 rounded text-xs transition text-white"
                                    onclick="event.stopPropagation(); openAIChat('قرارداد تعمیرات کوره گندله‌سازی - کد: CNT-2024-015 - مبلغ: ۱۲۵ میلیارد تومان')">
                                    <i class="fas fa-comments ml-1"></i>
                                    سوال دارید؟
                                </button>
                            </div>

                            <div class="contract-card contract-waiting bg-gray-700 rounded-lg p-4 hover:bg-gray-600 transition cursor-pointer"
                                onclick="showContractDetails(2)">
                                <div class="flex justify-between items-start mb-2">
                                    <div>
                                        <h4 class="font-bold">نوسازی سیستم کنترل</h4>
                                        <p class="text-sm text-gray-400">کد: CNT-2024-016</p>
                                    </div>
                                    <span
                                        class="px-2 py-1 bg-yellow-500 bg-opacity-20 text-yellow-400 rounded text-xs">اولویت
                                        متوسط</span>
                                </div>
                                <div class="text-xs text-gray-400 mb-2">دیتا شیت: GZP Final Book/6 Electrical Equipment/02 Supply Documentation</div>
                                <div class="text-sm text-gray-300 mb-2">
                                    مهلت امضا: ۱۴۰۲/۱۱/۲۵
                                </div>
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-yellow-400 text-sm">۸۵ میلیارد تومان</span>
                                    <button class="px-3 py-1 btn-steeltech rounded text-xs transition"
                                        onclick="event.stopPropagation(); showDigitalSignature()">
                                        امضا کن
                                    </button>
                                </div>
                                <button class="w-full mt-2 px-3 py-1 bg-blue-600 hover:bg-blue-700 rounded text-xs transition text-white"
                                    onclick="event.stopPropagation(); openAIChat('قرارداد نوسازی سیستم کنترل - کد: CNT-2024-016 - مبلغ: ۸۵ میلیارد تومان')">
                                    <i class="fas fa-comments ml-1"></i>
                                    سوال دارید؟
                                </button>
                            </div>
                            
                            <div class="contract-card contract-waiting bg-gray-700 rounded-lg p-4 hover:bg-gray-600 transition cursor-pointer"
                                onclick="showContractDetails(9)">
                                <div class="flex justify-between items-start mb-2">
                                    <div>
                                        <h4 class="font-bold">تعمیرات Dual Fuel Burner</h4>
                                        <p class="text-sm text-gray-400">کد: CNT-2024-030</p>
                                    </div>
                                    <span class="px-2 py-1 bg-orange-500 bg-opacity-20 text-orange-400 rounded text-xs">اولویت
                                        بالا</span>
                                </div>
                                <div class="text-xs text-gray-400 mb-2">دیتا شیت: GZP Final Book/5 Mechanical Equipment/04 Indurating Hood/03 Dual Fuel Burner</div>
                                <div class="text-sm text-gray-300 mb-2">
                                    مهلت امضا: ۱۴۰۲/۱۲/۰۱
                                </div>
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-yellow-400 text-sm">۳,۲۰۰ میلیارد تومان</span>
                                    <button class="px-3 py-1 btn-steeltech rounded text-xs transition"
                                        onclick="event.stopPropagation(); showDigitalSignature()">
                                        امضا کن
                                    </button>
                                </div>
                                <button class="w-full mt-2 px-3 py-1 bg-blue-600 hover:bg-blue-700 rounded text-xs transition text-white"
                                    onclick="event.stopPropagation(); openAIChat('قرارداد تعمیرات Dual Fuel Burner - کد: CNT-2024-030 - مبلغ: ۳,۲۰۰ میلیارد تومان')">
                                    <i class="fas fa-comments ml-1"></i>
                                    سوال دارید؟
                                </button>
                            </div>
                            
                            <div class="contract-card contract-waiting bg-gray-700 rounded-lg p-4 hover:bg-gray-600 transition cursor-pointer"
                                onclick="showContractDetails(10)">
                                <div class="flex justify-between items-start mb-2">
                                    <div>
                                        <h4 class="font-bold">تعمیرات Heat Exchanger</h4>
                                        <p class="text-sm text-gray-400">کد: CNT-2024-031</p>
                                    </div>
                                    <span class="px-2 py-1 bg-yellow-500 bg-opacity-20 text-yellow-400 rounded text-xs">اولویت
                                        متوسط</span>
                                </div>
                                <div class="text-xs text-gray-400 mb-2">دیتا شیت: GZP Final Book/5 Mechanical Equipment/13 Cooling Water System/01 Heat Exchanger</div>
                                <div class="text-sm text-gray-300 mb-2">
                                    مهلت امضا: ۱۴۰۲/۱۲/۰۵
                                </div>
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-yellow-400 text-sm">۸۵۰ میلیون تومان</span>
                                    <button class="px-3 py-1 btn-steeltech rounded text-xs transition"
                                        onclick="event.stopPropagation(); showDigitalSignature()">
                                        امضا کن
                                    </button>
                                </div>
                                <button class="w-full mt-2 px-3 py-1 bg-blue-600 hover:bg-blue-700 rounded text-xs transition text-white"
                                    onclick="event.stopPropagation(); openAIChat('قرارداد تعمیرات Heat Exchanger - کد: CNT-2024-031 - مبلغ: ۸۵۰ میلیون تومان')">
                                    <i class="fas fa-comments ml-1"></i>
                                    سوال دارید؟
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- صورت‌وضعیت‌های آماده تحویل -->
                    <div class="bg-gray-800 rounded-xl p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-bold">
                                <i class="fas fa-file-invoice-dollar ml-2 text-green-400"></i>
                                صورت‌وضعیت‌های آماده تحویل
                            </h3>
                            <span class="px-3 py-1 bg-green-500 bg-opacity-20 text-green-400 rounded-lg text-sm">۸
                                مورد</span>
                        </div>
                        <div class="space-y-4">
                            <div class="bg-gray-700 rounded-lg p-4 hover:bg-gray-600 transition cursor-pointer">
                                <div class="flex justify-between items-center mb-2">
                                    <div>
                                        <h4 class="font-bold">فاز ۱ تعمیرات گندله‌سازی</h4>
                                        <p class="text-sm text-gray-400">شماره: INV-2024-045</p>
                                    </div>
                                    <span
                                        class="px-2 py-1 bg-green-500 bg-opacity-20 text-green-400 rounded text-xs">آماده
                                        تحویل</span>
                                </div>
                                <div class="text-sm text-gray-300 mb-2">
                                    مبلغ: ۳۴ میلیارد تومان
                                </div>
                                <div class="flex justify-between text-xs text-gray-400">
                                    <span>تاریخ: ۱۴۰۲/۱۰/۱۵</span>
                                    <button class="text-steeltech-text hover:text-steeltech-light"
                                        onclick="downloadInvoice()">
                                        <i class="fas fa-download ml-1"></i>
                                        دریافت PDF
                                    </button>
                                </div>
                            </div>

                            <div class="bg-gray-700 rounded-lg p-4 hover:bg-gray-600 transition cursor-pointer">
                                <div class="flex justify-between items-center mb-2">
                                    <div>
                                        <h4 class="font-bold">فاز ۲ نوسازی فولادسازی</h4>
                                        <p class="text-sm text-gray-400">شماره: INV-2024-046</p>
                                    </div>
                                    <span
                                        class="px-2 py-1 bg-yellow-500 bg-opacity-20 text-yellow-400 rounded text-xs">در
                                        انتظار تأیید</span>
                                </div>
                                <div class="text-sm text-gray-300 mb-2">
                                    مبلغ: ۲۸ میلیارد تومان
                                </div>
                                <div class="flex justify-between text-xs text-gray-400">
                                    <span>تاریخ: ۱۴۰۲/۱۰/۲۰</span>
                                    <button class="text-steeltech-text hover:text-steeltech-light">
                                        <i class="fas fa-eye ml-1"></i>
                                        مشاهده
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- امضای دیجیتال -->
                    <div class="bg-gray-800 rounded-xl p-6">
                        <h3 class="text-lg font-bold mb-4">
                            <i class="fas fa-signature ml-2 text-purple-400"></i>
                            امضای دیجیتال
                        </h3>
                        <div class="text-center p-4">
                            <div
                                class="w-32 h-32 mx-auto mb-4 bg-gradient-to-br from-steeltech-red to-steeltech-dark rounded-full flex items-center justify-center">
                                <i class="fas fa-signature text-4xl text-white"></i>
                            </div>
                            <h4 class="font-bold mb-2">امضای دیجیتال امن</h4>
                            <p class="text-sm text-gray-400 mb-4">امضای الکترونیک با اعتبار قانونی</p>

                            <div class="space-y-3">
                                <div class="p-3 bg-gray-700 rounded-lg">
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm">آخرین امضا:</span>
                                        <span class="text-sm text-green-400">۱۴۰۲/۱۰/۱۸</span>
                                    </div>
                                </div>

                                <button class="w-full py-3 btn-steeltech rounded-lg transition"
                                    onclick="showDigitalSignature()">
                                    <i class="fas fa-pen ml-2"></i>
                                    امضای جدید
                                </button>

                                <button class="w-full py-3 bg-gray-700 hover:bg-gray-600 rounded-lg transition">
                                    <i class="fas fa-history ml-2"></i>
                                    تاریخچه امضاها
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- مدیریت قراردادهای دیجیتال و امضای الکترونیک -->
        <section id="digital-contracts" class="collapsible-section">
            <div class="section-header collapsed section-gradient-factories" onclick="toggleSection('digital-contracts')">
                <h2>
                    <i class="fas fa-file-signature"></i>
                    مدیریت قراردادهای دیجیتال و امضای الکترونیک
                </h2>
                <div class="section-toggle">
                    <i class="fas fa-chevron-down"></i>
                </div>
            </div>
            <div class="section-content collapsed" id="digital-contracts-content">
                <div class="bg-white mb-8" style="border-bottom: 1px solid #e5e7eb; padding-bottom: 2rem;">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-2xl font-normal text-gray-900 mb-3" style="letter-spacing: -0.02em;">بانک اطلاعاتی تجهیزات و تحلیل خرابی پیش‌بینی‌شده</h3>
                            <p class="text-gray-600 text-lg">سیستم جامع مدیریت و پیش‌بینی خرابی تجهیزات کارخانه گندله‌سازی</p>
                        </div>
                        <button class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg font-medium transition text-white"
                            onclick="refreshFailureAnalysis()">
                            <i class="fas fa-sync-alt ml-2"></i>
                            به‌روزرسانی تحلیل
                        </button>
                    </div>
                </div>

                <!-- تب‌های اصلی -->
                <div class="mb-6 border-b border-gray-200">
                    <div class="flex flex-wrap gap-2">
                        <button onclick="showFailureTab('equipment-database')" 
                                class="failure-tab-btn active px-6 py-3 bg-red-600 text-white rounded-t-lg font-medium transition">
                            <i class="fas fa-database ml-2"></i>
                            بانک اطلاعاتی تجهیزات
                        </button>
                        <button onclick="showFailureTab('failure-analysis')" 
                                class="failure-tab-btn px-6 py-3 bg-gray-200 text-gray-700 rounded-t-lg font-medium hover:bg-gray-300 transition">
                            <i class="fas fa-chart-line ml-2"></i>
                            تحلیل خرابی
                        </button>
                        <button onclick="showFailureTab('prediction')" 
                                class="failure-tab-btn px-6 py-3 bg-gray-200 text-gray-700 rounded-t-lg font-medium hover:bg-gray-300 transition">
                            <i class="fas fa-crystal-ball ml-2"></i>
                            پیش‌بینی خرابی (۱۰ مورد نمونه)
                        </button>
                        <button onclick="showFailureTab('maintenance')" 
                                class="failure-tab-btn px-6 py-3 bg-gray-200 text-gray-700 rounded-t-lg font-medium hover:bg-gray-300 transition">
                            <i class="fas fa-tools ml-2"></i>
                            تعمیرات و نگهداری
                        </button>
                    </div>
                </div>

                <!-- محتوای بانک اطلاعاتی تجهیزات -->
                <div id="equipment-database-tab" class="failure-tab-content">
                    <!-- سیستم جستجوی هوشمند با AI -->
                    <div class="bg-gradient-to-r from-cyan-50 to-blue-50 rounded-xl p-6 mb-6 border border-cyan-200">
                        <div class="flex items-center gap-4 mb-4">
                            <div class="w-12 h-12 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-lg flex items-center justify-center">
                                <i class="fas fa-brain text-white text-xl"></i>
                            </div>
                            <div class="flex-1">
                                <h3 class="text-xl font-bold text-gray-900 mb-1">جستجوی هوشمند با هوش مصنوعی</h3>
                                <p class="text-sm text-gray-600">از AI برای پیدا کردن تجهیزات، بررسی نیازمندی‌های بازرسی و دریافت توصیه‌های نگهداری استفاده کنید</p>
                            </div>
                        </div>
                        <div class="flex gap-3">
                            <div class="flex-1 relative">
                                <input type="text" id="ai-equipment-search" placeholder="مثال: تجهیزات نیازمند بازرسی هفتگی، فن‌های فرآیندی، سیستم‌های غبارگیری..." 
                                       class="w-full px-4 py-3 pr-12 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-transparent text-gray-900"
                                       onkeyup="handleAISearch(event)">
                                <button onclick="performAISearch()" class="absolute left-3 top-1/2 transform -translate-y-1/2 text-cyan-600 hover:text-cyan-700">
                                    <i class="fas fa-search text-lg"></i>
                                </button>
                            </div>
                            <button onclick="performAISearch()" class="px-6 py-3 bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-700 hover:to-blue-700 text-white rounded-lg font-semibold transition shadow-lg">
                                <i class="fas fa-magic ml-2"></i>
                                جستجوی AI
                            </button>
                        </div>
                        <div id="ai-search-results" class="mt-4 hidden"></div>
                    </div>

                    <div class="mb-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-xl font-semibold text-gray-900">بانک اطلاعاتی تجهیزات کارخانه گندله‌سازی</h3>
                            <div class="flex gap-2">
                                <input type="text" id="equipment-search" placeholder="جستجوی تجهیز..." 
                                       class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500"
                                       onkeyup="searchEquipment(this.value)">
                                <select id="equipment-filter" onchange="filterEquipmentByCategory(this.value)"
                                        class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500">
                                    <option value="all">همه دسته‌بندی‌ها</option>
                                    <option value="dosing-mixing">Dosing & Mixing</option>
                                    <option value="pelletizing">Green Pelletizing</option>
                                    <option value="indurating">Indurating Machine</option>
                                    <option value="indurating-hood">Indurating Hood</option>
                                    <option value="process-fans">Process Fans</option>
                                    <option value="screening">الک و غربال</option>
                                    <option value="dedusting">سیستم‌های غبارگیری</option>
                                    <option value="water">سیستم آب</option>
                                    <option value="electrical">تجهیزات الکتریکی</option>
                                    <option value="instrumentation">ابزار دقیق</option>
                                </select>
                            </div>
                        </div>

                        <!-- نمایش ساختار سلسله‌مراتبی -->
                        <div class="mb-6">
                            <h4 class="text-lg font-bold text-gray-900 mb-4">ساختار سلسله‌مراتبی تجهیزات بر اساس Final Book</h4>
                            <div id="equipment-hierarchy" class="space-y-3">
                                <!-- به صورت داینامیک پر می‌شود -->
                            </div>
                        </div>

                        <!-- دسته‌بندی تجهیزات بر اساس Final Book -->
                        <div class="bg-white rounded-xl p-4 mb-6 shadow-sm border border-gray-200">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-bold text-gray-800">دسته‌بندی تجهیزات کارخانه (بر اساس Final Book)</h3>
                            </div>
                            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
                                <button onclick="filterEquipmentByCategory('all')" class="equipment-category-btn active px-4 py-3 bg-gradient-to-r from-cyan-600 to-blue-600 text-white rounded-lg font-semibold transition-all shadow-md hover:shadow-lg" data-category="all">
                                    <i class="fas fa-th ml-2"></i>همه تجهیزات
                                </button>
                                <button onclick="filterEquipmentByCategory('dosing-mixing')" class="equipment-category-btn px-4 py-3 bg-white text-gray-700 rounded-lg font-medium transition-all border-2 border-gray-200 hover:border-blue-500 hover:text-blue-600 hover:shadow-md" data-category="dosing-mixing">
                                    <i class="fas fa-flask ml-2"></i>01 Dosing & Mixing
                                </button>
                                <button onclick="filterEquipmentByCategory('green-pelletizing')" class="equipment-category-btn px-4 py-3 bg-white text-gray-700 rounded-lg font-medium transition-all border-2 border-gray-200 hover:border-green-500 hover:text-green-600 hover:shadow-md" data-category="green-pelletizing">
                                    <i class="fas fa-circle-notch ml-2"></i>02 Green Pelletizing
                                </button>
                                <button onclick="filterEquipmentByCategory('indurating-machine')" class="equipment-category-btn px-4 py-3 bg-white text-gray-700 rounded-lg font-medium transition-all border-2 border-gray-200 hover:border-red-500 hover:text-red-600 hover:shadow-md" data-category="indurating-machine">
                                    <i class="fas fa-fire ml-2"></i>03 Indurating Machine
                                </button>
                                <button onclick="filterEquipmentByCategory('indurating-hood')" class="equipment-category-btn px-4 py-3 bg-white text-gray-700 rounded-lg font-medium transition-all border-2 border-gray-200 hover:border-orange-500 hover:text-orange-600 hover:shadow-md" data-category="indurating-hood">
                                    <i class="fas fa-tools ml-2"></i>04 Indurating Hood
                                </button>
                                <button onclick="filterEquipmentByCategory('process-fans')" class="equipment-category-btn px-4 py-3 bg-white text-gray-700 rounded-lg font-medium transition-all border-2 border-gray-200 hover:border-purple-500 hover:text-purple-600 hover:shadow-md" data-category="process-fans">
                                    <i class="fas fa-wind ml-2"></i>05 Process Fans
                                </button>
                                <button onclick="filterEquipmentByCategory('screening-transport')" class="equipment-category-btn px-4 py-3 bg-white text-gray-700 rounded-lg font-medium transition-all border-2 border-gray-200 hover:border-indigo-500 hover:text-indigo-600 hover:shadow-md" data-category="screening-transport">
                                    <i class="fas fa-th ml-2"></i>06 Screening & Transport
                                </button>
                                <button onclick="filterEquipmentByCategory('process-dedusting')" class="equipment-category-btn px-4 py-3 bg-white text-gray-700 rounded-lg font-medium transition-all border-2 border-gray-200 hover:border-teal-500 hover:text-teal-600 hover:shadow-md" data-category="process-dedusting">
                                    <i class="fas fa-filter ml-2"></i>09 Process Gas Dedusting
                                </button>
                                <button onclick="filterEquipmentByCategory('plant-dedusting')" class="equipment-category-btn px-4 py-3 bg-white text-gray-700 rounded-lg font-medium transition-all border-2 border-gray-200 hover:border-gray-500 hover:text-gray-600 hover:shadow-md" data-category="plant-dedusting">
                                    <i class="fas fa-wind ml-2"></i>10 Plant Dedusting
                                </button>
                                <button onclick="filterEquipmentByCategory('water-system')" class="equipment-category-btn px-4 py-3 bg-white text-gray-700 rounded-lg font-medium transition-all border-2 border-gray-200 hover:border-cyan-500 hover:text-cyan-600 hover:shadow-md" data-category="water-system">
                                    <i class="fas fa-water ml-2"></i>11 Process Water System
                                </button>
                                <button onclick="filterEquipmentByCategory('filtration')" class="equipment-category-btn px-4 py-3 bg-white text-gray-700 rounded-lg font-medium transition-all border-2 border-gray-200 hover:border-blue-500 hover:text-blue-600 hover:shadow-md" data-category="filtration">
                                    <i class="fas fa-filter ml-2"></i>12 Filtration
                                </button>
                                <button onclick="filterEquipmentByCategory('cooling-water')" class="equipment-category-btn px-4 py-3 bg-white text-gray-700 rounded-lg font-medium transition-all border-2 border-gray-200 hover:border-blue-500 hover:text-blue-600 hover:shadow-md" data-category="cooling-water">
                                    <i class="fas fa-snowflake ml-2"></i>13 Cooling Water System
                                </button>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="equipment-grid">
                            <!-- تجهیزات به صورت داینامیک اضافه می‌شوند با سیستم Glory Glass -->
                        </div>
                    </div>
                </div>

                <!-- محتوای تب تحلیل خرابی -->
                <div id="failure-analysis-tab" class="failure-tab-content hidden">
                    <div class="mb-6">
                        <h3 class="text-xl font-semibold text-gray-900 mb-4">تحلیل خرابی‌های شناسایی شده</h3>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6" id="failure-analysis-grid">
                            <!-- تحلیل‌های خرابی به صورت داینامیک اضافه می‌شوند -->
                        </div>
                    </div>
                </div>

                <!-- محتوای تب پیش‌بینی خرابی -->
                <div id="prediction-tab" class="failure-tab-content hidden">
                    <div class="mb-6">
                        <div class="bg-gradient-to-r from-red-50 to-orange-50 rounded-xl p-6 mb-6 border border-red-200">
                            <div class="flex items-center gap-3 mb-3">
                                <i class="fas fa-robot text-red-600 text-2xl"></i>
                                <h3 class="text-xl font-semibold text-gray-900">پیش‌بینی خرابی با هوش مصنوعی</h3>
                            </div>
                            <p class="text-gray-700">سیستم پیش‌بینی خرابی بر اساس تحلیل داده‌های سنسورها، تاریخچه تعمیرات و دیتا شیت تجهیزات</p>
                        </div>

                        <!-- فیلترهای پیش‌بینی -->
                        <div class="mb-6 flex gap-3 flex-wrap">
                            <select id="prediction-risk-filter" onchange="filterPredictions()" class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500">
                                <option value="all">همه سطوح ریسک</option>
                                <option value="high">ریسک بالا</option>
                                <option value="medium">ریسک متوسط</option>
                                <option value="low">ریسک پایین</option>
                            </select>
                            <select id="prediction-time-filter" onchange="filterPredictions()" class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500">
                                <option value="7">۷ روز آینده</option>
                                <option value="14">۱۴ روز آینده</option>
                                <option value="30">۳۰ روز آینده</option>
                                <option value="90">۹۰ روز آینده</option>
                            </select>
                            <button onclick="showPredictionDetails()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition">
                                <i class="fas fa-info-circle ml-2"></i>
                                جزئیات تحلیل
                            </button>
                        </div>

                        <div class="grid grid-cols-1 gap-6" id="prediction-grid">
                            <!-- پیش‌بینی‌ها به صورت داینامیک اضافه می‌شوند -->
                        </div>
                    </div>
                </div>

                <!-- محتوای تب تعمیرات و نگهداری -->
                <div id="maintenance-tab" class="failure-tab-content hidden">
                    <div class="mb-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-xl font-semibold text-gray-900">سیستم تعمیرات و نگهداری تجهیزات</h3>
                            <button class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg font-medium transition text-white">
                                <i class="fas fa-plus ml-2"></i>
                                درخواست تعمیرات جدید
                            </button>
                        </div>

                        <!-- دسته‌بندی تجهیزات در بخش تعمیرات -->
                        <div class="bg-white rounded-xl p-4 mb-6 shadow-sm border border-gray-200">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-bold text-gray-800">دسته‌بندی تجهیزات نیازمند تعمیرات</h3>
                                <div class="flex items-center gap-2 text-sm text-gray-600 cursor-pointer hover:text-cyan-600">
                                    <i class="fas fa-filter"></i>
                                    <span>فیلتر پیشرفته</span>
                                </div>
                            </div>
                            <div class="flex flex-wrap gap-2">
                                <button onclick="filterMaintenanceEquipment('all')" class="equipment-category-btn active px-5 py-2.5 bg-gradient-to-r from-cyan-600 to-blue-600 text-white rounded-lg font-semibold transition-all shadow-md hover:shadow-lg transform hover:scale-105" data-category="all">
                                    <i class="fas fa-th ml-2"></i>همه تجهیزات
                                </button>
                                <button onclick="filterMaintenanceEquipment('dosing-mixing')" class="equipment-category-btn px-5 py-2.5 bg-white text-gray-700 rounded-lg font-medium transition-all border-2 border-gray-200 hover:border-blue-500 hover:text-blue-600 hover:shadow-md" data-category="dosing-mixing">
                                    <i class="fas fa-flask ml-2"></i>Dosing & Mixing
                                </button>
                                <button onclick="filterMaintenanceEquipment('pelletizing')" class="equipment-category-btn px-5 py-2.5 bg-white text-gray-700 rounded-lg font-medium transition-all border-2 border-gray-200 hover:border-green-500 hover:text-green-600 hover:shadow-md" data-category="pelletizing">
                                    <i class="fas fa-circle-notch ml-2"></i>Green Pelletizing
                                </button>
                                <button onclick="filterMaintenanceEquipment('indurating')" class="equipment-category-btn px-5 py-2.5 bg-white text-gray-700 rounded-lg font-medium transition-all border-2 border-gray-200 hover:border-red-500 hover:text-red-600 hover:shadow-md" data-category="indurating">
                                    <i class="fas fa-fire ml-2"></i>Indurating Machine
                                </button>
                                <button onclick="filterMaintenanceEquipment('indurating-hood')" class="equipment-category-btn px-5 py-2.5 bg-white text-gray-700 rounded-lg font-medium transition-all border-2 border-gray-200 hover:border-orange-500 hover:text-orange-600 hover:shadow-md" data-category="indurating-hood">
                                    <i class="fas fa-tools ml-2"></i>Indurating Hood
                                </button>
                                <button onclick="filterMaintenanceEquipment('process-fans')" class="equipment-category-btn px-5 py-2.5 bg-white text-gray-700 rounded-lg font-medium transition-all border-2 border-gray-200 hover:border-purple-500 hover:text-purple-600 hover:shadow-md" data-category="process-fans">
                                    <i class="fas fa-wind ml-2"></i>Process Fans
                                </button>
                            </div>
                        </div>

                        <!-- لیست تجهیزات نیازمند تعمیرات -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="maintenance-equipment-grid">
                            <!-- تجهیزات نیازمند تعمیرات با Glory Glass -->
                        </div>
                    </div>
                </div>

            </div>
        </section>

    </main>

    <!-- فوتر -->
    <footer class="bg-white text-gray-900 py-12" style="border-top: 1px solid #e5e7eb;">
        <div class="container mx-auto px-6" style="max-width: 95%;">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                <div>
                    <div class="logo-container mb-4">
                        <div class="logo-icon" style="width: 40px; height: 40px;">
                            <i class="fas fa-industry text-white text-lg"></i>
                        </div>
                        <div class="logo-text">
                            <div class="brand" style="font-size: 1.2rem;">SMT</div>
                            <div class="tagline" style="font-size: 0.6rem;">Steel Management Tech</div>
                        </div>
                    </div>
                    <p class="text-gray-400 text-sm">
                        پلتفرم مدیریت هوشمند صنعت فولاد گل‌گهر سیرجان
                    </p>
                </div>

                <div>
                    <h4 class="font-bold mb-4">سیستم‌های اصلی</h4>
                    <ul class="space-y-2 text-sm text-gray-400">
                        <li><a href="#tenders" class="hover:text-gold transition">سیستم مناقصات</a></li>
                        <li><a href="#commerce" class="hover:text-gold transition">سیستم بازرگانی</a></li>
                        <li><a href="#contracts" class="hover:text-gold transition">سیستم قراردادها</a></li>
                        <li><a href="#reports" class="hover:text-gold transition">سیستم گزارشات</a></li>
                    </ul>
                </div>

                <div>
                    <h4 class="font-bold mb-4">کارخانه‌ها</h4>
                    <ul class="space-y-2 text-sm text-gray-400">
                        <li><a href="#" class="hover:text-gold transition">گندله‌سازی</a></li>
                        <li><a href="#" class="hover:text-gold transition">کنسانتره</a></li>
                        <li><a href="#" class="hover:text-gold transition">فولادسازی</a></li>
                        <li><a href="#" class="hover:text-gold transition">احیاء مستقیم</a></li>
                    </ul>
                </div>

                <div>
                    <h4 class="font-bold mb-4">تماس با ما</h4>
                    <ul class="space-y-2 text-sm text-gray-400">
                        <li class="flex items-center gap-2">
                            <i class="fas fa-map-marker-alt text-gold"></i>
                            <span>سیرجان، مجتمع فولاد گل‌گهر</span>
                        </li>
                        <li class="flex items-center gap-2">
                            <i class="fas fa-phone text-gold"></i>
                            <span>۰۲۱-۱۲۳۴۵۶۷۸</span>
                        </li>
                        <li class="flex items-center gap-2">
                            <i class="fas fa-envelope text-gold"></i>
                            <span>info@steelmanagment.tech</span>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="border-t border-gray-200 mt-8 pt-6 text-center text-gray-600 text-sm" style="border-top: 1px solid #e5e7eb;">
                <p>© ۲۰۲۴ Steel Management Tech - تمامی حقوق محفوظ است</p>
                <p class="mt-2">همکاری با Siemens Industrial Automation - نسخه ۲.۰</p>
            </div>
        </div>
    </footer>

    <!-- دکمه دستیار AI -->
    <!-- AI Chat قدیمی حذف شده - از sidebar جدید استفاده می‌شود -->

    <!-- اسکریپت‌ها -->
    <script>
        // تنظیمات API
        const API_URL = 'http://localhost:3000';
        let aiConversationId = null;
        // توابع نمایش مودال‌ها
        function showNewTender() {
            alert('فرم ایجاد مناقصه جدید باز شد.');
        }

        function showNewOrder() {
            alert('فرم ایجاد سفارش جدید باز شد.');
        }

        function showNewContract() {
            alert('فرم ایجاد قرارداد جدید باز شد.');
        }

        function showContractDetails(id) {
            alert(`جزئیات قرارداد شماره ${id} در حال بارگذاری...`);
        }

        function generateCustomReport() {
            alert('گزارش سفارشی شما در حال ایجاد است. پس از تکمیل، قابل دانلود خواهد بود.');
        }

        function showNewUser() {
            alert('فرم ایجاد کاربر جدید باز شد.');
        }

        // فیلتر تجهیزات بازار
        function filterEquipment(category) {
            const items = document.querySelectorAll('.equipment-item');
            const tabs = document.querySelectorAll('.equipment-tab');
            
            tabs.forEach(tab => {
                tab.classList.remove('active', 'bg-steeltech-red', 'text-white');
                tab.classList.add('bg-gray-700', 'text-gray-300');
            });
            
            const activeTab = document.querySelector(`.equipment-tab[data-category="${category}"]`);
            if (activeTab) {
                activeTab.classList.remove('bg-gray-700', 'text-gray-300');
                activeTab.classList.add('active', 'bg-steeltech-red', 'text-white');
            }
            
            items.forEach(item => {
                if (category === 'all' || item.dataset.category === category) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // داده‌های تأمین‌کنندگان
        const suppliersData = {
            'الکتروموتور SIMOTICS': [
                { name: 'شرکت تهران الکتریک', brand: 'Siemens اصل', price: '۱۸۵,۰۰۰,۰۰۰', delivery: '۲ هفته', warranty: '۲۴ ماه', rating: 4.8 },
                { name: 'پارس صنعت نوین', brand: 'Siemens اصل', price: '۱۹۲,۰۰۰,۰۰۰', delivery: '۱ هفته', warranty: '۱۸ ماه', rating: 4.6 },
                { name: 'صنایع برق ایران', brand: 'Siemens اصل', price: '۱۸۰,۰۰۰,۰۰۰', delivery: '۳ هفته', warranty: '۲۴ ماه', rating: 4.5 },
                { name: 'گروه صنعتی البرز', brand: 'Siemens OEM', price: '۱۶۵,۰۰۰,۰۰۰', delivery: '۱۰ روز', warranty: '۱۲ ماه', rating: 4.3 },
                { name: 'آریا موتور', brand: 'Siemens اصل', price: '۲۰۵,۰۰۰,۰۰۰', delivery: '۵ روز', warranty: '۳۶ ماه', rating: 4.9 },
            ],
            'درایو SINAMICS G120': [
                { name: 'اتوماسیون گستر', brand: 'Siemens اصل', price: '۳۵۰,۰۰۰,۰۰۰', delivery: '۲ هفته', warranty: '۲۴ ماه', rating: 4.7 },
                { name: 'کنترل افزار تهران', brand: 'Siemens اصل', price: '۳۶۵,۰۰۰,۰۰۰', delivery: '۱ هفته', warranty: '۲۴ ماه', rating: 4.8 },
                { name: 'صنایع اتوماسیون پارس', brand: 'Siemens اصل', price: '۳۸۰,۰۰۰,۰۰۰', delivery: '۳ روز', warranty: '۳۶ ماه', rating: 4.9 },
                { name: 'الکترو صنعت شرق', brand: 'Siemens OEM', price: '۳۲۰,۰۰۰,۰۰۰', delivery: '۲ هفته', warranty: '۱۸ ماه', rating: 4.4 },
            ],
            'ترانسفورماتور قدرت': [
                { name: 'ایران ترانسفو', brand: 'ABB', price: '۱,۲۵۰,۰۰۰,۰۰۰', delivery: '۶ هفته', warranty: '۳۶ ماه', rating: 4.9 },
                { name: 'ترانسفورماتور توس', brand: 'ABB', price: '۱,۴۵۰,۰۰۰,۰۰۰', delivery: '۴ هفته', warranty: '۴۸ ماه', rating: 4.8 },
                { name: 'پارس سوییچ', brand: 'Schneider', price: '۱,۳۸۰,۰۰۰,۰۰۰', delivery: '۵ هفته', warranty: '۳۶ ماه', rating: 4.6 },
            ],
            'پمپ سانتریفیوژ': [
                { name: 'پمپیران', brand: 'KSB', price: '۲۸۵,۰۰۰,۰۰۰', delivery: '۲ هفته', warranty: '۲۴ ماه', rating: 4.7 },
                { name: 'سازه گستر سیالات', brand: 'Grundfos', price: '۳۱۰,۰۰۰,۰۰۰', delivery: '۱۰ روز', warranty: '۲۴ ماه', rating: 4.8 },
                { name: 'هیدروپمپ تهران', brand: 'KSB', price: '۲۹۵,۰۰۰,۰۰۰', delivery: '۲ هفته', warranty: '۱۸ ماه', rating: 4.5 },
                { name: 'پمپ سازان اصفهان', brand: 'ایرانی', price: '۱۸۵,۰۰۰,۰۰۰', delivery: '۱ هفته', warranty: '۱۲ ماه', rating: 4.2 },
            ],
            'کمپرسور هوا': [
                { name: 'اطلس کوپکو ایران', brand: 'Atlas Copco', price: '۶۸۰,۰۰۰,۰۰۰', delivery: '۳ هفته', warranty: '۳۶ ماه', rating: 4.9 },
                { name: 'کمپرسور کار', brand: 'Atlas Copco', price: '۷۲۰,۰۰۰,۰۰۰', delivery: '۲ هفته', warranty: '۲۴ ماه', rating: 4.7 },
                { name: 'صنعت کمپرسور', brand: 'Kaeser', price: '۶۵۰,۰۰۰,۰۰۰', delivery: '۴ هفته', warranty: '۲۴ ماه', rating: 4.6 },
            ],
            'گیربکس صنعتی': [
                { name: 'فلندر ایران', brand: 'Flender', price: '۴۶۰,۰۰۰,۰۰۰', delivery: '۴ هفته', warranty: '۳۶ ماه', rating: 4.8 },
                { name: 'صنایع گیربکس پارس', brand: 'SEW', price: '۵۲۰,۰۰۰,۰۰۰', delivery: '۳ هفته', warranty: '۲۴ ماه', rating: 4.7 },
                { name: 'مکانیک صنعت', brand: 'Bonfiglioli', price: '۴۸۰,۰۰۰,۰۰۰', delivery: '۲ هفته', warranty: '۲۴ ماه', rating: 4.5 },
            ],
            'ترانسمیتر فشار': [
                { name: 'ابزار دقیق ایران', brand: 'Endress+Hauser', price: '۴۸,۰۰۰,۰۰۰', delivery: '۱ هفته', warranty: '۲۴ ماه', rating: 4.8 },
                { name: 'پارس ابزار', brand: 'E+H', price: '۵۲,۰۰۰,۰۰۰', delivery: '۵ روز', warranty: '۲۴ ماه', rating: 4.7 },
                { name: 'کنترل ابزار تهران', brand: 'Siemens', price: '۵۵,۰۰۰,۰۰۰', delivery: '۱ هفته', warranty: '۱۸ ماه', rating: 4.6 },
                { name: 'صنایع ابزاردقیق', brand: 'Rosemount', price: '۶۲,۰۰۰,۰۰۰', delivery: '۲ هفته', warranty: '۳۶ ماه', rating: 4.9 },
            ],
            'فلومتر الکترومغناطیسی': [
                { name: 'ابزار دقیق ایران', brand: 'E+H Promag', price: '۸۸,۰۰۰,۰۰۰', delivery: '۲ هفته', warranty: '۲۴ ماه', rating: 4.8 },
                { name: 'کنترل ابزار تهران', brand: 'Siemens', price: '۹۵,۰۰۰,۰۰۰', delivery: '۱۰ روز', warranty: '۲۴ ماه', rating: 4.7 },
                { name: 'پارس ابزار', brand: 'Yokogawa', price: '۱۱۰,۰۰۰,۰۰۰', delivery: '۳ هفته', warranty: '۳۶ ماه', rating: 4.9 },
            ],
            'PLC SIMATIC S7-1500': [
                { name: 'اتوماسیون گستر', brand: 'Siemens اصل', price: '۲۲۵,۰۰۰,۰۰۰', delivery: '۱ هفته', warranty: '۲۴ ماه', rating: 4.9 },
                { name: 'کنترل افزار تهران', brand: 'Siemens اصل', price: '۲۳۸,۰۰۰,۰۰۰', delivery: '۵ روز', warranty: '۲۴ ماه', rating: 4.8 },
                { name: 'صنایع اتوماسیون پارس', brand: 'Siemens اصل', price: '۲۴۵,۰۰۰,۰۰۰', delivery: '۳ روز', warranty: '۳۶ ماه', rating: 4.9 },
            ],
            'HMI پنل صنعتی': [
                { name: 'اتوماسیون گستر', brand: 'Siemens TP1500', price: '۱۵۵,۰۰۰,۰۰۰', delivery: '۱ هفته', warranty: '۲۴ ماه', rating: 4.8 },
                { name: 'کنترل افزار تهران', brand: 'Siemens', price: '۱۶۸,۰۰۰,۰۰۰', delivery: '۵ روز', warranty: '۲۴ ماه', rating: 4.7 },
                { name: 'پارس HMI', brand: 'Weintek', price: '۸۵,۰۰۰,۰۰۰', delivery: '۳ روز', warranty: '۱۸ ماه', rating: 4.4 },
            ]
        };

        // تبدیل زمان تحویل به روز برای مرتب‌سازی
        function parseDeliveryTime(delivery) {
            const deliveryLower = delivery.toLowerCase();
            if (deliveryLower.includes('روز') || deliveryLower.includes('day')) {
                const match = delivery.match(/(\d+)\s*(روز|day)/i);
                return match ? parseInt(match[1]) : 999;
            } else if (deliveryLower.includes('هفته') || deliveryLower.includes('week')) {
                const match = delivery.match(/(\d+)\s*(هفته|week)/i);
                return match ? parseInt(match[1]) * 7 : 999;
            }
            return 999;
        }

        // دریافت تأمین‌کنندگان محصول مرتب شده بر اساس زمان تحویل
        function getProductSuppliersSorted(productName) {
            let suppliers = suppliersData[productName] || [];
            
            // اگر تأمین‌کننده برای این محصول نداریم، یک لیست نمونه ایجاد می‌کنیم
            if (suppliers.length === 0) {
                suppliers = [
                    { name: 'تأمین‌کننده 1', brand: 'Siemens', price: '۲۰۰,۰۰۰,۰۰۰', delivery: '۵ روز', warranty: '۲۴ ماه', rating: 4.8 },
                    { name: 'تأمین‌کننده 2', brand: 'ABB', price: '۲۱۰,۰۰۰,۰۰۰', delivery: '۱۰ روز', warranty: '۲۴ ماه', rating: 4.7 },
                    { name: 'تأمین‌کننده 3', brand: 'Schneider', price: '۱۹۵,۰۰۰,۰۰۰', delivery: '۱۴ روز', warranty: '۱۸ ماه', rating: 4.6 },
                    { name: 'تأمین‌کننده 4', brand: 'Outotec', price: '۲۲۰,۰۰۰,۰۰۰', delivery: '۲۱ روز', warranty: '۳۶ ماه', rating: 4.9 },
                    { name: 'تأمین‌کننده 5', brand: 'FLSmidth', price: '۲۱۵,۰۰۰,۰۰۰', delivery: '۲۸ روز', warranty: '۲۴ ماه', rating: 4.5 }
                ];
            }
            
            // مرتب‌سازی بر اساس زمان تحویل و محدود کردن به 10 ردیف
            return suppliers
                .map(s => ({ ...s, deliveryDays: parseDeliveryTime(s.delivery) }))
                .sort((a, b) => a.deliveryDays - b.deliveryDays)
                .slice(0, 10)
                .map(({ deliveryDays, ...rest }) => rest); // حذف deliveryDays از نتیجه نهایی
        }

        // نمایش مودال تأمین‌کنندگان (حداکثر 10 ردیف بر اساس زمان تحویل)
        function showSuppliers(equipmentName, category) {
            const modal = document.getElementById('suppliersModal');
            const title = document.getElementById('modalEquipmentName');
            const tbody = document.getElementById('suppliersTableBody');
            
            title.textContent = equipmentName;
            
            let suppliers = suppliersData[equipmentName] || [];
            
            // مرتب‌سازی بر اساس زمان تحویل (کمترین به بیشترین)
            suppliers = suppliers
                .map(s => ({ ...s, deliveryDays: parseDeliveryTime(s.delivery) }))
                .sort((a, b) => a.deliveryDays - b.deliveryDays)
                .slice(0, 10); // حداکثر 10 ردیف
            
            tbody.innerHTML = suppliers.map((s, index) => `
                <tr class="border-b border-gray-700 hover:bg-gray-700 transition">
                    <td class="py-4">
                        <div class="font-bold">${s.name}</div>
                        <div class="text-xs text-gray-400">تأمین‌کننده معتبر</div>
                    </td>
                    <td class="py-4">${s.brand}</td>
                    <td class="py-4 text-steeltech-red font-bold">${s.price}</td>
                    <td class="py-4">${s.delivery}</td>
                    <td class="py-4">${s.warranty}</td>
                    <td class="py-4">
                        <div class="flex items-center gap-1">
                            <i class="fas fa-star text-yellow-400"></i>
                            <span>${s.rating}</span>
                        </div>
                    </td>
                    <td class="py-4 text-center">
                        <button class="px-3 py-1 bg-steeltech-red hover:bg-steeltech-dark text-white rounded text-sm transition" onclick="requestQuote('${s.name}', '${equipmentName}')">
                            درخواست قیمت
                        </button>
                    </td>
                </tr>
            `).join('');
            
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        // بستن مودال تأمین‌کنندگان
        function closeSuppliers() {
            const modal = document.getElementById('suppliersModal');
            modal.classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        // درخواست قیمت
        function requestQuote(supplierName, equipmentName) {
            alert(`درخواست قیمت از ${supplierName} برای ${equipmentName} ارسال شد.`);
        }

        // بستن مودال با کلیک خارج از آن
        document.getElementById('suppliersModal')?.addEventListener('click', function(e) {
            if (e.target === this) {
                closeSuppliers();
            }
        });

        // تابع toggle برای بخش‌های collapsible
        function toggleSection(sectionId) {
            const section = document.getElementById(sectionId);
            if (!section) return;
            
            const header = section.querySelector('.section-header');
            const content = section.querySelector('.section-content');
            
            if (!header || !content) return;
            
            // همیشه باز کن - بدون collapsible
                header.classList.remove('collapsed');
                content.classList.remove('collapsed');
            
            // اگر بخش marketplace باز شد، محصولات را بارگذاری کن
            if (sectionId === 'marketplace') {
                setTimeout(() => {
                    loadMarketplaceProductsNew();
                }, 100);
            }
            
            // اسکرول به بخش
            section.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // تابع برای باز و بسته کردن زیر مجموعه‌های گندله‌سازی
        function toggleSubSection(subSectionId) {
            const content = document.getElementById(subSectionId + '-content');
            const icon = document.getElementById(subSectionId + '-icon');
            
            if (!content || !icon) return;
            
            const isHidden = content.classList.contains('hidden');
            
            if (isHidden) {
                // باز کردن
                content.classList.remove('hidden');
                icon.classList.add('rotate-180');
                
                // اگر سایت پلن‌ها باز شد، اسلایدر را راه‌اندازی کن
                if (subSectionId === 'pellet-site-plans') {
                    initializeSitePlanSlider();
                    loadPelletEquipmentList();
                }
            } else {
                // بستن
                content.classList.add('hidden');
                icon.classList.remove('rotate-180');
            }
        }

        // متغیرهای اسلایدر سایت پلن
        let currentSitePlanSlide = 0;
        const totalSitePlanSlides = 6;

        // راه‌اندازی اسلایدر سایت پلن
        function initializeSitePlanSlider() {
            // ایجاد اندیکاتورها
            const indicatorsContainer = document.getElementById('sitePlanIndicators');
            if (indicatorsContainer && indicatorsContainer.children.length === 0) {
                for (let i = 0; i < totalSitePlanSlides; i++) {
                    const indicator = document.createElement('div');
                    indicator.className = 'site-plan-indicator' + (i === 0 ? ' active' : '');
                    indicator.onclick = () => goToSitePlanSlide(i);
                    indicatorsContainer.appendChild(indicator);
                }
            }
            updateSitePlanSlider();
        }

        // به‌روزرسانی اسلایدر
        function updateSitePlanSlider() {
            const slider = document.getElementById('sitePlanSlider');
            if (!slider) return;

            const slides = slider.querySelectorAll('.site-plan-slide');
            slides.forEach((slide, index) => {
                slide.classList.remove('active');
                if (index === currentSitePlanSlide) {
                    slide.classList.add('active');
                }
            });

            // به‌روزرسانی اندیکاتورها
            const indicators = document.querySelectorAll('#sitePlanIndicators .site-plan-indicator');
            indicators.forEach((indicator, index) => {
                indicator.classList.remove('active');
                if (index === currentSitePlanSlide) {
                    indicator.classList.add('active');
                }
            });
        }

        // اسلاید بعدی
        function nextSitePlanSlide() {
            currentSitePlanSlide = (currentSitePlanSlide + 1) % totalSitePlanSlides;
            updateSitePlanSlider();
        }

        // اسلاید قبلی
        function previousSitePlanSlide() {
            currentSitePlanSlide = (currentSitePlanSlide - 1 + totalSitePlanSlides) % totalSitePlanSlides;
            updateSitePlanSlider();
        }

        // رفتن به اسلاید خاص
        function goToSitePlanSlide(index) {
            currentSitePlanSlide = index;
            updateSitePlanSlider();
        }

        // بارگذاری لیست تجهیزات گندله
        function loadPelletEquipmentList() {
            const equipmentListContainer = document.getElementById('pellet-equipment-list');
            if (!equipmentListContainer || !equipmentDatabase) return;

            // فیلتر کردن تجهیزات گندله (فقط تجهیزات کارخانه گندله‌سازی)
            const pelletEquipment = equipmentDatabase.filter(eq => 
                eq.section && (
                    eq.section.includes('گندله') || 
                    eq.section.includes('دوزینگ') || 
                    eq.section.includes('مخلوط') ||
                    eq.section.includes('ایندوریت') ||
                    eq.section.includes('فن') ||
                    eq.section.includes('غبارگیری')
                )
            );

            if (pelletEquipment.length === 0) {
                equipmentListContainer.innerHTML = '<p class="text-gray-500 text-center py-4">هیچ تجهیزاتی یافت نشد</p>';
                return;
            }

            // گروه‌بندی بر اساس بخش
            const groupedEquipment = {};
            pelletEquipment.forEach(eq => {
                if (!groupedEquipment[eq.section]) {
                    groupedEquipment[eq.section] = [];
                }
                groupedEquipment[eq.section].push(eq);
            });

            let html = '<div class="space-y-4">';
            Object.keys(groupedEquipment).forEach(section => {
                html += `
                    <div class="border-b border-gray-200 pb-3 mb-3">
                        <h5 class="font-semibold text-gray-800 mb-2 flex items-center gap-2">
                            <i class="fas fa-folder text-purple-500"></i>
                            ${section}
                        </h5>
                        <div class="space-y-2">
                `;
                groupedEquipment[section].forEach(eq => {
                    const statusColor = eq.status === 'فعال' ? 'green' : 
                                       eq.status === 'نیاز به بازرسی' ? 'yellow' : 'red';
                    html += `
                        <div class="flex items-center justify-between p-2 bg-gray-50 rounded hover:bg-gray-100 transition">
                            <div class="flex-1">
                                <div class="font-medium text-sm text-gray-900">${eq.name}</div>
                                <div class="text-xs text-gray-600">${eq.location} | ${eq.manufacturer} ${eq.model}</div>
                            </div>
                            <span class="px-2 py-1 rounded text-xs font-medium bg-${statusColor}-100 text-${statusColor}-700">
                                ${eq.status}
                            </span>
                        </div>
                    `;
                });
                html += '</div></div>';
            });
            html += '</div>';

            equipmentListContainer.innerHTML = html;
        }

        // نمایش مودال ثبت درخواست تعمیرات
        function showRepairRequestModal() {
            // ایجاد مودال
            const modal = document.createElement('div');
            modal.id = 'repair-request-modal';
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
            modal.style.display = 'flex';
            
            modal.innerHTML = `
                <div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                    <div class="sticky top-0 bg-gradient-to-r from-red-600 to-orange-600 text-white p-6 rounded-t-xl flex items-center justify-between">
                        <h3 class="text-2xl font-bold flex items-center gap-2">
                            <i class="fas fa-tools"></i>
                            ثبت درخواست تعمیرات
                        </h3>
                        <button onclick="closeRepairRequestModal()" class="text-white hover:text-gray-200 text-2xl">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div class="p-6">
                        <!-- انتخاب تجهیز -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-cog ml-2"></i>
                                انتخاب تجهیز
                            </label>
                            <select id="repair-equipment-select" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500">
                                <option value="">-- انتخاب تجهیز --</option>
                            </select>
                        </div>

                        <!-- اطلاعات تجهیز انتخاب شده -->
                        <div id="selected-equipment-info" class="hidden mb-6 p-4 bg-blue-50 rounded-lg border border-blue-200">
                            <h4 class="font-semibold text-gray-900 mb-2">اطلاعات تجهیز</h4>
                            <div id="equipment-details" class="text-sm text-gray-700"></div>
                        </div>

                        <!-- نوع مشکل -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-exclamation-triangle ml-2"></i>
                                نوع مشکل
                            </label>
                            <select id="repair-problem-type" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500">
                                <option value="">-- انتخاب نوع مشکل --</option>
                                <option value="mechanical">مکانیکی</option>
                                <option value="electrical">الکتریکی</option>
                                <option value="instrumentation">ابزار دقیق</option>
                                <option value="hydraulic">هیدرولیک</option>
                                <option value="pneumatic">پنوماتیک</option>
                                <option value="other">سایر</option>
                            </select>
                        </div>

                        <!-- اولویت -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-flag ml-2"></i>
                                اولویت
                            </label>
                            <select id="repair-priority" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500">
                                <option value="normal">عادی</option>
                                <option value="high">بالا</option>
                                <option value="urgent">اضطراری</option>
                            </select>
                        </div>

                        <!-- شرح مشکل -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-file-alt ml-2"></i>
                                شرح مشکل
                            </label>
                            <textarea id="repair-description" rows="4" 
                                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500"
                                placeholder="شرح کامل مشکل به وجود آمده را وارد کنید..."></textarea>
                        </div>

                        <!-- لیست تجهیزات کارخانه -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-list ml-2"></i>
                                تجهیزات کارخانه
                            </label>
                            <div class="border-2 border-gray-300 rounded-lg p-4 max-h-64 overflow-y-auto">
                                <div id="factory-equipment-list" class="space-y-2">
                                    <!-- لیست تجهیزات به صورت داینامیک بارگذاری می‌شود -->
                                </div>
                            </div>
                        </div>

                        <!-- دکمه‌های اقدام -->
                        <div class="flex gap-4">
                            <button onclick="submitRepairRequest()" 
                                class="flex-1 py-3 bg-gradient-to-r from-red-600 to-orange-600 hover:from-red-700 hover:to-orange-700 text-white rounded-lg font-semibold transition">
                                <i class="fas fa-paper-plane ml-2"></i>
                                ثبت درخواست
                            </button>
                            <button onclick="closeRepairRequestModal()" 
                                class="px-6 py-3 bg-gray-300 hover:bg-gray-400 text-gray-800 rounded-lg font-semibold transition">
                                انصراف
                            </button>
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            // بارگذاری لیست تجهیزات در select
            loadEquipmentForRepairRequest();

            // بارگذاری لیست کامل تجهیزات
            loadFactoryEquipmentList();

            // رویداد تغییر تجهیز
            document.getElementById('repair-equipment-select').addEventListener('change', function() {
                const equipmentId = this.value;
                if (equipmentId) {
                    showSelectedEquipmentInfo(equipmentId);
                } else {
                    document.getElementById('selected-equipment-info').classList.add('hidden');
                }
            });
        }

        // بستن مودال
        function closeRepairRequestModal() {
            const modal = document.getElementById('repair-request-modal');
            if (modal) {
                modal.remove();
            }
        }

        // بارگذاری تجهیزات برای select
        function loadEquipmentForRepairRequest() {
            const select = document.getElementById('repair-equipment-select');
            if (!select || !equipmentDatabase) return;

            // فیلتر تجهیزات گندله
            const pelletEquipment = equipmentDatabase.filter(eq => 
                eq.section && (
                    eq.section.includes('گندله') || 
                    eq.section.includes('دوزینگ') || 
                    eq.section.includes('مخلوط') ||
                    eq.section.includes('ایندوریت') ||
                    eq.section.includes('فن') ||
                    eq.section.includes('غبارگیری')
                )
            );

            pelletEquipment.forEach(eq => {
                const option = document.createElement('option');
                option.value = eq.id;
                option.textContent = `${eq.name} - ${eq.location}`;
                select.appendChild(option);
            });
        }

        // نمایش اطلاعات تجهیز انتخاب شده
        function showSelectedEquipmentInfo(equipmentId) {
            const equipment = equipmentDatabase.find(eq => eq.id === equipmentId);
            if (!equipment) return;

            const infoDiv = document.getElementById('selected-equipment-info');
            const detailsDiv = document.getElementById('equipment-details');

            let specsHtml = '<div class="grid grid-cols-2 gap-2">';
            specsHtml += `<div><strong>سازنده:</strong> ${equipment.manufacturer}</div>`;
            specsHtml += `<div><strong>مدل:</strong> ${equipment.model}</div>`;
            specsHtml += `<div><strong>شماره سریال:</strong> ${equipment.serialNumber}</div>`;
            specsHtml += `<div><strong>موقعیت:</strong> ${equipment.location}</div>`;
            specsHtml += `<div><strong>نصب:</strong> ${equipment.installationDate}</div>`;
            specsHtml += `<div><strong>وضعیت:</strong> ${equipment.status}</div>`;
            
            if (equipment.specifications) {
                Object.keys(equipment.specifications).forEach(key => {
                    specsHtml += `<div><strong>${key}:</strong> ${equipment.specifications[key]}</div>`;
                });
            }
            
            specsHtml += '</div>';

            detailsDiv.innerHTML = specsHtml;
            infoDiv.classList.remove('hidden');
        }

        // بارگذاری لیست کامل تجهیزات کارخانه
        function loadFactoryEquipmentList() {
            const listContainer = document.getElementById('factory-equipment-list');
            if (!listContainer || !equipmentDatabase) return;

            // گروه‌بندی بر اساس بخش
            const groupedEquipment = {};
            equipmentDatabase.forEach(eq => {
                if (!groupedEquipment[eq.section]) {
                    groupedEquipment[eq.section] = [];
                }
                groupedEquipment[eq.section].push(eq);
            });

            let html = '';
            Object.keys(groupedEquipment).forEach(section => {
                html += `
                    <div class="mb-4">
                        <h6 class="font-semibold text-gray-800 mb-2 text-sm">${section}</h6>
                        <div class="space-y-1">
                `;
                groupedEquipment[section].forEach(eq => {
                    const statusColor = eq.status === 'فعال' ? 'green' : 
                                       eq.status === 'نیاز به بازرسی' ? 'yellow' : 'red';
                    html += `
                        <div class="flex items-center justify-between p-2 bg-gray-50 rounded text-xs">
                            <span class="text-gray-700">${eq.name}</span>
                            <span class="px-2 py-0.5 rounded bg-${statusColor}-100 text-${statusColor}-700">${eq.status}</span>
                        </div>
                    `;
                });
                html += '</div></div>';
            });

            listContainer.innerHTML = html;
        }

        // ثبت درخواست تعمیرات
        function submitRepairRequest() {
            const equipmentId = document.getElementById('repair-equipment-select').value;
            const problemType = document.getElementById('repair-problem-type').value;
            const priority = document.getElementById('repair-priority').value;
            const description = document.getElementById('repair-description').value;

            if (!equipmentId || !problemType || !description) {
                alert('لطفاً تمام فیلدهای الزامی را پر کنید.');
                return;
            }

            const equipment = equipmentDatabase.find(eq => eq.id === equipmentId);
            
            // در اینجا می‌توانید درخواست را به سرور ارسال کنید
            alert(`درخواست تعمیرات برای ${equipment.name} با موفقیت ثبت شد.\nاولویت: ${priority}\nنوع مشکل: ${problemType}`);
            
            closeRepairRequestModal();
        }

        // مدیریت کلیک‌های ناوبری
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const targetId = this.getAttribute('href').substring(1);
                const targetSection = document.getElementById(targetId);
                if (targetSection) {
                    // اگر بخش collapsible است، آن را باز کن
                    const collapsibleSection = targetSection.closest('.collapsible-section');
                    if (collapsibleSection) {
                        const header = collapsibleSection.querySelector('.section-header');
                        const content = collapsibleSection.querySelector('.section-content');
                        if (header && content) {
                            header.classList.remove('collapsed');
                            content.classList.remove('collapsed');
                        }
                    }
                    targetSection.scrollIntoView({ behavior: 'smooth' });
                }
            });
        });

        // بروزرسانی Real-time داده‌ها
        function updateRealTimeData() {
            // بروزرسانی راندمان کارخانه‌ها
            const efficiencyElements = document.querySelectorAll('.text-green-400, .text-yellow-400');
            efficiencyElements.forEach(element => {
                if (element.textContent.includes('٪')) {
                    const current = parseFloat(element.textContent);
                    const change = (Math.random() - 0.5) * 0.3;
                    const newValue = Math.max(85, Math.min(99, current + change));
                    element.textContent = newValue.toFixed(1) + '٪';
                    element.className = newValue > 90 ? 'text-green-400' : 'text-yellow-400';
                }
            });

            // بروزرسانی وضعیت کارخانه‌ها
            const statusIndicators = document.querySelectorAll('.w-3.h-3');
            statusIndicators.forEach(indicator => {
                if (Math.random() > 0.95) {
                    indicator.classList.toggle('bg-green-400');
                    indicator.classList.toggle('bg-yellow-400');
                }
            });
        }

        // شروع بروزرسانی Real-time
        setInterval(updateRealTimeData, 5000);

        // مدیریت hover روی کارت‌ها
        document.querySelectorAll('.siemens-card, .factory-card, .report-card, .user-card').forEach(card => {
            card.addEventListener('mouseenter', function () {
                this.style.transform = 'translateY(-5px)';
            });

            card.addEventListener('mouseleave', function () {
                this.style.transform = 'translateY(0)';
            });
        });

        // ========== توابع AI Chat ==========
        function toggleAIChat() {
            const container = document.getElementById('ai-chat-container');
            if (container) {
                container.style.display = container.style.display === 'none' ? 'flex' : 'none';
            }
        }

        async function sendAIMessage() {
            const input = document.getElementById('chat-input');
            const contextSelect = document.getElementById('chat-context');
            const messagesContainer = document.getElementById('ai-chat-messages');

            if (!input || !messagesContainer) return;

            const message = input.value.trim();
            const context = contextSelect?.value || 'general';

            if (!message) return;

            // نمایش پیام کاربر
            addAIMessage('user', message, messagesContainer);
            input.value = '';

            // نمایش loading
            const loadingId = addAIMessage('assistant', 'در حال پردازش...', messagesContainer, true);

            try {
                const response = await fetch(`${API_URL}/api/ai/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        context,
                        message,
                        conversationId: aiConversationId
                    })
                });

                const data = await response.json();
                aiConversationId = data.conversationId;

                // حذف loading و نمایش پاسخ
                const loadingEl = document.getElementById(loadingId);
                if (loadingEl) {
                    loadingEl.remove();
                }
                addAIMessage('assistant', data.response, messagesContainer);
            } catch (error) {
                const loadingEl = document.getElementById(loadingId);
                if (loadingEl) {
                    loadingEl.remove();
                }
                addAIMessage('assistant', 'خطا در ارتباط با سرور. لطفاً مطمئن شوید سرور در حال اجرا است (npm start).', messagesContainer);
            }
        }

        function addAIMessage(role, content, container, isLoading = false) {
            const messageId = `msg_${Date.now()}_${Math.random()}`;
            const messageEl = document.createElement('div');
            messageEl.id = messageId;
            messageEl.style.cssText = `
                margin-bottom: 12px;
                padding: 12px;
                border-radius: 8px;
                background: ${role === 'user' ? 'rgba(0, 153, 153, 0.2)' : 'rgba(255, 255, 255, 0.05)'};
                color: #ffffff;
                text-align: ${role === 'user' ? 'left' : 'right'};
            `;
            messageEl.innerHTML = `
                <div style="font-weight: bold; margin-bottom: 4px; color: #009999;">
                    ${role === 'user' ? 'شما' : 'دستیار AI'}
                </div>
                <div>${content}</div>
            `;
            container.appendChild(messageEl);
            container.scrollTop = container.scrollHeight;
            return messageId;
        }

        // ========== توابع تحلیل AI ==========
        async function analyzeContractWithAI(contractId, contractTitle) {
            try {
                const loadingMsg = showLoading('در حال تحلیل قرارداد با AI...');
                
                const response = await fetch(`${API_URL}/api/contracts/${contractId}/analyze`, {
                    method: 'POST'
                });

                if (!response.ok) {
                    throw new Error('خطا در ارتباط با سرور');
                }

                const analysis = await response.json();
                hideLoading(loadingMsg);

                // نمایش نتایج در مودال
                showAIAnalysisModal('تحلیل قرارداد', contractTitle, analysis);
            } catch (error) {
                hideLoading();
                alert('خطا در تحلیل قرارداد. لطفاً مطمئن شوید سرور در حال اجرا است.\n\nبرای راه‌اندازی:\n1. npm install\n2. npm run build\n3. npm start');
            }
        }

        async function analyzeReportWithAI(reportId, reportTitle) {
            try {
                const loadingMsg = showLoading('در حال تحلیل گزارش با AI...');
                
                const response = await fetch(`${API_URL}/api/reports/${reportId}/analyze`, {
                    method: 'POST'
                });

                if (!response.ok) {
                    throw new Error('خطا در ارتباط با سرور');
                }

                const insights = await response.json();
                hideLoading(loadingMsg);

                // نمایش نتایج
                showAIInsightsModal('تحلیل گزارش', reportTitle, insights);
            } catch (error) {
                hideLoading();
                alert('خطا در تحلیل گزارش. لطفاً مطمئن شوید سرور در حال اجرا است.');
            }
        }

        function showAIAnalysisModal(title, subtitle, analysis) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            modal.innerHTML = `
                <div style="
                    background: #000000;
                    border: 1px solid rgba(0, 153, 153, 0.3);
                    border-radius: 16px;
                    padding: 24px;
                    max-width: 600px;
                    width: 90%;
                    max-height: 80vh;
                    overflow-y: auto;
                ">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2 style="color: #ffffff; margin: 0;">${title}</h2>
                        <button onclick="this.closest('div[style*=\"position: fixed\"]').remove()" style="
                            background: none;
                            border: none;
                            color: #ffffff;
                            font-size: 24px;
                            cursor: pointer;
                        ">×</button>
                    </div>
                    <p style="color: #009999; margin-bottom: 20px;">${subtitle}</p>
                    <div style="margin-bottom: 16px;">
                        <strong style="color: #ffffff;">سطح ریسک:</strong>
                        <span style="color: ${analysis.riskLevel === 'high' ? '#ef4444' : analysis.riskLevel === 'medium' ? '#f59e0b' : '#10b981'}; margin-right: 8px;">
                            ${analysis.riskLevel === 'high' ? 'بالا' : analysis.riskLevel === 'medium' ? 'متوسط' : 'پایین'}
                        </span>
                    </div>
                    <div style="margin-bottom: 16px;">
                        <strong style="color: #ffffff;">سطح اطمینان:</strong>
                        <span style="color: #009999; margin-right: 8px;">${analysis.confidence}%</span>
                    </div>
                    <div style="margin-bottom: 16px;">
                        <strong style="color: #ffffff;">خلاصه تحلیل:</strong>
                        <p style="color: #ffffff; margin-top: 8px;">${analysis.summary}</p>
                    </div>
                    <div>
                        <strong style="color: #ffffff;">توصیه‌ها:</strong>
                        <ul style="color: #ffffff; margin-top: 8px; padding-right: 20px;">
                            ${analysis.recommendations.map(rec => `<li style="margin-bottom: 8px;">${rec}</li>`).join('')}
                        </ul>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function showAIInsightsModal(title, subtitle, insights) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            modal.innerHTML = `
                <div style="
                    background: #000000;
                    border: 1px solid rgba(0, 153, 153, 0.3);
                    border-radius: 16px;
                    padding: 24px;
                    max-width: 600px;
                    width: 90%;
                    max-height: 80vh;
                    overflow-y: auto;
                ">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2 style="color: #ffffff; margin: 0;">${title}</h2>
                        <button onclick="this.closest('div[style*=\"position: fixed\"]').remove()" style="
                            background: none;
                            border: none;
                            color: #ffffff;
                            font-size: 24px;
                            cursor: pointer;
                        ">×</button>
                    </div>
                    <p style="color: #009999; margin-bottom: 20px;">${subtitle}</p>
                    <div>
                        ${insights.map(insight => `
                            <div style="
                                background: ${insight.type === 'warning' ? 'rgba(239, 68, 68, 0.1)' : insight.type === 'suggestion' ? 'rgba(0, 153, 153, 0.1)' : 'rgba(168, 85, 247, 0.1)'};
                                border: 1px solid ${insight.type === 'warning' ? 'rgba(239, 68, 68, 0.3)' : insight.type === 'suggestion' ? 'rgba(0, 153, 153, 0.3)' : 'rgba(168, 85, 247, 0.3)'};
                                border-radius: 8px;
                                padding: 12px;
                                margin-bottom: 12px;
                            ">
                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                    <i class="fas fa-${insight.type === 'warning' ? 'exclamation-triangle' : insight.type === 'suggestion' ? 'lightbulb' : 'chart-line'}" 
                                       style="color: ${insight.type === 'warning' ? '#ef4444' : insight.type === 'suggestion' ? '#009999' : '#a855f7'};"></i>
                                    <strong style="color: #ffffff;">${insight.type === 'warning' ? 'هشدار' : insight.type === 'suggestion' ? 'پیشنهاد' : 'پیش‌بینی'}</strong>
                                    <span style="color: #009999; font-size: 12px;">اولویت: ${insight.priority}/10</span>
                                </div>
                                <p style="color: #ffffff; margin: 0;">${insight.message}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function showLoading(message) {
            const loading = document.createElement('div');
            loading.id = 'loading-overlay';
            loading.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.7);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            loading.innerHTML = `
                <div style="
                    background: #000000;
                    border: 1px solid rgba(0, 153, 153, 0.3);
                    border-radius: 16px;
                    padding: 24px;
                    text-align: center;
                ">
                    <i class="fas fa-spinner fa-spin" style="color: #009999; font-size: 32px; margin-bottom: 16px;"></i>
                    <p style="color: #ffffff; margin: 0;">${message}</p>
                </div>
            `;
            document.body.appendChild(loading);
            return loading;
        }

        function hideLoading(element) {
            if (element) {
                element.remove();
            } else {
                const loading = document.getElementById('loading-overlay');
                if (loading) loading.remove();
            }
        }

        // ========== توابع OPC UA و PCS7 ==========
        // ذخیره وضعیت اتصال کارخانه‌ها
        const factoryPCS7Status = {};
        
        async function connectFactoryToPCS7(factoryId, factoryName) {
            const endpoint = prompt(`لطفاً آدرس OPC UA سرور PCS7 را وارد کنید:\n\nمثال: opc.tcp://pcs7-server:4840\n\nکارخانه: ${factoryName}`);
            if (!endpoint) return;

            try {
                const loadingMsg = showLoading(`در حال اتصال به PCS7 برای ${factoryName}...`);
                
                const response = await fetch(`${API_URL}/api/factories/${factoryId}/connect-opcua`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ endpoint })
                });

                if (!response.ok) {
                    throw new Error('خطا در اتصال');
                }

                const connection = await response.json();
                hideLoading(loadingMsg);

                if (connection.status === 'connected') {
                    factoryPCS7Status[factoryId] = { connected: true, endpoint };
                    updatePCS7ButtonStatus(factoryId, true);
                    alert(`اتصال به PCS7 برقرار شد!\n\nکارخانه: ${factoryName}\nEndpoint: ${endpoint}`);
                    // راه‌اندازی WebSocket برای Real-time data
                    setupOPCUAWebSocket(factoryId, factoryName);
                } else {
                    factoryPCS7Status[factoryId] = { connected: false };
                    updatePCS7ButtonStatus(factoryId, false);
                    alert('خطا در اتصال به PCS7. لطفاً آدرس را بررسی کنید.');
                }
            } catch (error) {
                hideLoading();
                factoryPCS7Status[factoryId] = { connected: false };
                updatePCS7ButtonStatus(factoryId, false);
                alert('خطا در اتصال. لطفاً مطمئن شوید سرور در حال اجرا است.');
            }
        }
        
        function updatePCS7ButtonStatus(factoryId, connected) {
            const btn = document.getElementById(`pcs7-btn-${factoryId}`);
            const status = document.getElementById(`pcs7-status-${factoryId}`);
            if (btn && status) {
                if (connected) {
                    btn.className = 'px-3 py-1.5 text-xs font-medium text-white bg-gradient-to-r from-green-600 to-green-700 rounded border border-green-700 hover:from-green-700 hover:to-green-800 whitespace-nowrap transition';
                    status.innerHTML = '<i class="fas fa-check-circle ml-1"></i> متصل';
                } else {
                    btn.className = 'px-3 py-1.5 text-xs font-medium text-white bg-gradient-to-r from-green-500 to-green-600 rounded border border-green-600 hover:from-green-600 hover:to-green-700 whitespace-nowrap transition';
                    status.innerHTML = '<i class="fas fa-plug ml-1"></i> اتصال PCS7';
                }
            }
        }
        
        // تابع قدیمی برای سازگاری
        async function connectFactoryToOPCUA(factoryId, factoryName) {
            return connectFactoryToPCS7(factoryId, factoryName);
        }
        
        // تحلیل خرابی با استفاده از داده‌های PCS7
        async function analyzeFailureWithPCS7(factoryId, factoryName) {
            if (!factoryPCS7Status[factoryId] || !factoryPCS7Status[factoryId].connected) {
                alert('لطفاً ابتدا به PCS7 متصل شوید.');
                return;
            }
            
            try {
                const loadingMsg = showLoading(`در حال تحلیل خرابی برای ${factoryName}...`);
                
                // Node IDs نمونه برای هر کارخانه (باید با Node IDs واقعی PCS7 جایگزین شوند)
                const nodeIds = [
                    'ns=2;s=Temperature',
                    'ns=2;s=Pressure',
                    'ns=2;s=Vibration',
                    'ns=2;s=Efficiency',
                    'ns=2;s=PowerConsumption'
                ];
                
                const response = await fetch(`${API_URL}/api/factories/${factoryId}/analyze-failure`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ nodeIds })
                });

                if (!response.ok) {
                    throw new Error('خطا در تحلیل');
                }

                const analysis = await response.json();
                hideLoading(loadingMsg);
                
                // نمایش نتایج تحلیل
                showFailureAnalysisResults(factoryId, factoryName, analysis);
            } catch (error) {
                hideLoading();
                alert('خطا در تحلیل خرابی: ' + error.message);
            }
        }
        
        function showFailureAnalysisResults(factoryId, factoryName, analysis) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.7);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 20px;
            `;
            
            modal.innerHTML = `
                <div style="
                    background: #0a0e27;
                    border: 2px solid #009999;
                    border-radius: 16px;
                    max-width: 800px;
                    width: 100%;
                    max-height: 90vh;
                    overflow-y: auto;
                    padding: 24px;
                    color: #00ff88;
                ">
                    <div class="flex items-center justify-between mb-6">
                        <h2 style="color: #009999; font-size: 24px; font-weight: bold;">
                            <i class="fas fa-chart-line ml-2"></i>
                            نتایج تحلیل خرابی - ${factoryName}
                        </h2>
                        <button onclick="this.closest('div[style*=\"position: fixed\"]').remove()" 
                                style="color: #009999; background: none; border: none; font-size: 24px; cursor: pointer;">
                            ×
                        </button>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h3 style="color: #009999; margin-bottom: 12px;">داده‌های Real-time:</h3>
                        <div style="background: #151a2e; padding: 16px; border-radius: 8px; border-right: 3px solid #009999;">
                            <pre style="color: #6fc9c9; font-size: 12px; white-space: pre-wrap;">${JSON.stringify(analysis.realtimeData, null, 2)}</pre>
                        </div>
                    </div>
                    
                    <div>
                        <h3 style="color: #009999; margin-bottom: 12px;">تحلیل هوش مصنوعی:</h3>
                        <div style="background: #151a2e; padding: 16px; border-radius: 8px; border-right: 3px solid #00ff88;">
                            <p style="color: #00ff88; line-height: 1.8; white-space: pre-wrap;">${analysis.analysis}</p>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function setupOPCUAWebSocket(factoryId, factoryName) {
            try {
                const ws = new WebSocket(`ws://localhost:3000`);
                
                ws.onopen = () => {
                    ws.send(JSON.stringify({
                        type: 'subscribe-factory',
                        factoryId,
                        nodeIds: ['ns=2;s=Temperature', 'ns=2;s=Pressure', 'ns=2;s=Efficiency']
                    }));
                    console.log(`WebSocket متصل شد برای ${factoryName}`);
                };
                
                ws.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    if (data.type === 'factory-data') {
                        // به‌روزرسانی UI با داده‌های Real-time
                        updateFactoryRealTimeData(factoryId, data.data);
                    }
                };

                ws.onerror = (error) => {
                    console.error('خطا در WebSocket:', error);
                };
            } catch (error) {
                console.error('خطا در راه‌اندازی WebSocket:', error);
            }
        }

        function updateFactoryRealTimeData(factoryId, data) {
            console.log(`داده‌های Real-time کارخانه ${factoryId}:`, data);
            // اینجا می‌توانید UI را به‌روزرسانی کنید
        }
        
        // نمایش جزئیات کارخانه
        function showFactoryDetails(factoryId) {
            const factoryData = {
                'factory-1': {
                    name: 'گندله‌سازی',
                    capacity: '۵ میلیون تن/سال',
                    lines: 'خط تولید ۱ و ۲',
                    efficiency: '۹۶.۷٪',
                    energy: '۲.۴ MW',
                    daily: '۱۳,۷۰۰ تن',
                    quality: '۹۸.۲٪',
                    temp: '۱,۲۵۰°C',
                    pressure: '۲.۸ bar',
                    status: 'فعال',
                    description: 'کارخانه گندله‌سازی با ظرفیت ۵ میلیون تن در سال، یکی از پیشرفته‌ترین واحدهای تولیدی مجتمع فولاد گل‌گهر است.'
                },
                'factory-2': {
                    name: 'کنسانتره',
                    capacity: '۳.۵ میلیون تن/سال',
                    lines: 'مدار خردایش',
                    efficiency: '۹۴.۲٪',
                    energy: '۱.۸ MW',
                    daily: '۹,۶۰۰ تن',
                    quality: '۹۶.۸٪',
                    temp: 'N/A',
                    pressure: 'N/A',
                    status: 'فعال',
                    description: 'واحد کنسانتره با مدار خردایش پیشرفته و ظرفیت ۳.۵ میلیون تن در سال.'
                },
                'factory-3': {
                    name: 'فولادسازی',
                    capacity: '۲.۵ میلیون تن/سال',
                    lines: 'کوره قوس الکتریکی',
                    efficiency: '۸۷.۵٪',
                    energy: '۳.۱ MW',
                    daily: '۶,۸۰۰ تن',
                    quality: '۹۴.۵٪',
                    temp: '۱,۶۵۰°C',
                    pressure: 'N/A',
                    status: 'نیاز به بازرسی',
                    description: 'واحد فولادسازی با کوره قوس الکتریکی و ظرفیت ۲.۵ میلیون تن در سال.'
                }
            };
            
            const factory = factoryData[factoryId];
            if (!factory) return;
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            modal.innerHTML = `
                <div style="
                    background: #ffffff;
                    border-radius: 16px;
                    padding: 2rem;
                    max-width: 600px;
                    width: 90%;
                    max-height: 80vh;
                    overflow-y: auto;
                    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                ">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; border-bottom: 2px solid #e5e7eb; padding-bottom: 1rem;">
                        <h2 style="color: #1a1a1a; margin: 0; font-size: 1.75rem; font-weight: 600;">جزئیات کارخانه ${factory.name}</h2>
                        <button onclick="this.closest('div[style*=\"position: fixed\"]').remove()" style="
                            background: none;
                            border: none;
                            color: #6b7280;
                            font-size: 24px;
                            cursor: pointer;
                            padding: 0;
                            width: 32px;
                            height: 32px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            border-radius: 50%;
                            transition: all 0.2s;
                        " onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='none'">×</button>
                    </div>
                    <p style="color: #6b7280; margin-bottom: 1.5rem; line-height: 1.6;">${factory.description}</p>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-bottom: 1.5rem;">
                        <div style="background: #f9fafb; padding: 1rem; border-radius: 8px; border: 1px solid #e5e7eb;">
                            <div style="font-size: 0.75rem; color: #6b7280; margin-bottom: 0.5rem;">ظرفیت سالانه</div>
                            <div style="font-size: 1.25rem; font-weight: 600; color: #1a1a1a;">${factory.capacity}</div>
                        </div>
                        <div style="background: #f9fafb; padding: 1rem; border-radius: 8px; border: 1px solid #e5e7eb;">
                            <div style="font-size: 0.75rem; color: #6b7280; margin-bottom: 0.5rem;">خطوط تولید</div>
                            <div style="font-size: 1.25rem; font-weight: 600; color: #1a1a1a;">${factory.lines}</div>
                        </div>
                        <div style="background: #f9fafb; padding: 1rem; border-radius: 8px; border: 1px solid #e5e7eb;">
                            <div style="font-size: 0.75rem; color: #6b7280; margin-bottom: 0.5rem;">راندمان</div>
                            <div style="font-size: 1.25rem; font-weight: 600; color: #009999;">${factory.efficiency}</div>
                        </div>
                        <div style="background: #f9fafb; padding: 1rem; border-radius: 8px; border: 1px solid #e5e7eb;">
                            <div style="font-size: 0.75rem; color: #6b7280; margin-bottom: 0.5rem;">مصرف انرژی</div>
                            <div style="font-size: 1.25rem; font-weight: 600; color: #1a1a1a;">${factory.energy}</div>
                        </div>
                        <div style="background: #f9fafb; padding: 1rem; border-radius: 8px; border: 1px solid #e5e7eb;">
                            <div style="font-size: 0.75rem; color: #6b7280; margin-bottom: 0.5rem;">تولید روزانه</div>
                            <div style="font-size: 1.25rem; font-weight: 600; color: #10b981;">${factory.daily}</div>
                        </div>
                        <div style="background: #f9fafb; padding: 1rem; border-radius: 8px; border: 1px solid #e5e7eb;">
                            <div style="font-size: 0.75rem; color: #6b7280; margin-bottom: 0.5rem;">کیفیت محصول</div>
                            <div style="font-size: 1.25rem; font-weight: 600; color: #8b5cf6;">${factory.quality}</div>
                        </div>
                    </div>
                    <div style="display: flex; gap: 0.5rem; margin-top: 1.5rem;">
                        <button onclick="window.open('factory.html', '_blank'); this.closest('div[style*=\"position: fixed\"]').remove();" style="
                            flex: 1;
                            padding: 0.75rem;
                            background: #009999;
                            color: white;
                            border: none;
                            border-radius: 8px;
                            font-weight: 600;
                            cursor: pointer;
                            transition: all 0.2s;
                        " onmouseover="this.style.background='#008080'" onmouseout="this.style.background='#009999'">
                            مشاهده گزارش کامل
                        </button>
                        <button onclick="this.closest('div[style*=\"position: fixed\"]').remove()" style="
                            padding: 0.75rem 1.5rem;
                            background: #f3f4f6;
                            color: #1a1a1a;
                            border: none;
                            border-radius: 8px;
                            font-weight: 600;
                            cursor: pointer;
                            transition: all 0.2s;
                        " onmouseover="this.style.background='#e5e7eb'" onmouseout="this.style.background='#f3f4f6'">
                            بستن
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // نمایش مودال سایت پلن با تحلیل خرابی
        function showSitePlanModal(imagePath, title, planNumber) {
            // داده‌های تحلیل خرابی برای هر سایت پلن
            const damageAnalysisData = {
                1: {
                    title: 'سایت پلن اصلی مجتمع',
                    issues: [
                        { area: 'بخش گندله‌سازی', severity: 'متوسط', description: 'نیاز به بازرسی دوره‌ای خطوط لوله', status: 'warning' },
                        { area: 'بخش کنسانتره', severity: 'کم', description: 'همه تجهیزات در وضعیت مطلوب', status: 'success' },
                        { area: 'بخش فولادسازی', severity: 'بالا', description: 'نیاز به تعمیرات اساسی کوره', status: 'danger' }
                    ],
                    recommendations: [
                        'بازرسی فنی دوره‌ای همه بخش‌ها',
                        'به‌روزرسانی نقشه‌های زیرساخت',
                        'نصب سنسورهای مانیتورینگ در نقاط حساس'
                    ],
                    lastInspection: '۱۴۰۳/۰۹/۱۵',
                    nextInspection: '۱۴۰۳/۱۲/۱۵'
                },
                2: {
                    title: 'سایت پلن بخش گندله‌سازی',
                    issues: [
                        { area: 'کوره ایندوریت خط ۲', severity: 'بالا', description: 'شکستگی در آجرهای نسوز', status: 'danger' },
                        { area: 'سیستم خنک‌کننده', severity: 'متوسط', description: 'کاهش راندمان خنک‌سازی', status: 'warning' },
                        { area: 'سیستم انتقال مواد', severity: 'کم', description: 'عملکرد عادی', status: 'success' }
                    ],
                    recommendations: [
                        'تعویض آجرهای نسوز کوره',
                        'بازرسی سیستم خنک‌کننده',
                        'کالیبراسیون سنسورهای دما'
                    ],
                    lastInspection: '۱۴۰۳/۰۸/۲۰',
                    nextInspection: '۱۴۰۳/۱۱/۲۰'
                },
                3: {
                    title: 'سایت پلن بخش کنسانتره',
                    issues: [
                        { area: 'مدار خردایش', severity: 'کم', description: 'عملکرد بهینه', status: 'success' },
                        { area: 'سیستم جداسازی', severity: 'کم', description: 'عملکرد عادی', status: 'success' },
                        { area: 'سیستم فیلتراسیون', severity: 'متوسط', description: 'نیاز به تعویض فیلترها', status: 'warning' }
                    ],
                    recommendations: [
                        'تعویض فیلترهای سیستم فیلتراسیون',
                        'بازرسی دوره‌ای مدار خردایش',
                        'بهینه‌سازی مصرف انرژی'
                    ],
                    lastInspection: '۱۴۰۳/۰۹/۱۰',
                    nextInspection: '۱۴۰۳/۱۲/۱۰'
                },
                4: {
                    title: 'سایت پلن بخش فولادسازی',
                    issues: [
                        { area: 'کوره قوس الکتریکی', severity: 'بالا', description: 'نیاز به تعمیرات اساسی', status: 'danger' },
                        { area: 'سیستم تصفیه گاز', severity: 'متوسط', description: 'کاهش راندمان تصفیه', status: 'warning' },
                        { area: 'سیستم ریخته‌گری', severity: 'کم', description: 'عملکرد مطلوب', status: 'success' }
                    ],
                    recommendations: [
                        'تعمیرات اساسی کوره قوس الکتریکی',
                        'بازسازی سیستم تصفیه گاز',
                        'نصب سیستم مانیتورینگ پیشرفته'
                    ],
                    lastInspection: '۱۴۰۳/۰۷/۱۵',
                    nextInspection: '۱۴۰۳/۱۰/۱۵'
                },
                5: {
                    title: 'سایت پلن بخش زیرساخت',
                    issues: [
                        { area: 'سیستم برق', severity: 'کم', description: 'عملکرد عادی', status: 'success' },
                        { area: 'سیستم آب', severity: 'متوسط', description: 'نیاز به بهینه‌سازی', status: 'warning' },
                        { area: 'سیستم گاز', severity: 'کم', description: 'عملکرد مطلوب', status: 'success' }
                    ],
                    recommendations: [
                        'بهینه‌سازی سیستم آب',
                        'بازرسی دوره‌ای سیستم برق',
                        'نصب سیستم مانیتورینگ هوشمند'
                    ],
                    lastInspection: '۱۴۰۳/۰۹/۰۵',
                    nextInspection: '۱۴۰۳/۱۲/۰۵'
                },
                6: {
                    title: 'سایت پلن بخش انبار و لجستیک',
                    issues: [
                        { area: 'انبار مواد اولیه', severity: 'کم', description: 'ظرفیت کافی', status: 'success' },
                        { area: 'سیستم حمل و نقل', severity: 'متوسط', description: 'نیاز به بهینه‌سازی', status: 'warning' },
                        { area: 'انبار محصولات', severity: 'کم', description: 'عملکرد عادی', status: 'success' }
                    ],
                    recommendations: [
                        'بهینه‌سازی سیستم حمل و نقل',
                        'افزایش ظرفیت انبار در صورت نیاز',
                        'پیاده‌سازی سیستم مدیریت انبار هوشمند'
                    ],
                    lastInspection: '۱۴۰۳/۰۸/۲۵',
                    nextInspection: '۱۴۰۳/۱۱/۲۵'
                }
            };

            const analysis = damageAnalysisData[planNumber] || damageAnalysisData[1];
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.7);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                padding: 20px;
            `;
            
            modal.innerHTML = `
                <div style="
                    background: #ffffff;
                    border-radius: 16px;
                    padding: 0;
                    max-width: 1200px;
                    width: 100%;
                    max-height: 90vh;
                    overflow-y: auto;
                    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                ">
                    <!-- هدر مودال -->
                    <div style="
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        padding: 1.5rem 2rem;
                        border-bottom: 2px solid #e5e7eb;
                        background: linear-gradient(135deg, #3b82f6, #1e40af);
                        color: white;
                        border-radius: 16px 16px 0 0;
                    ">
                        <div>
                            <h2 style="margin: 0; font-size: 1.75rem; font-weight: 600; color: white;">${analysis.title}</h2>
                            <p style="margin: 0.5rem 0 0 0; color: rgba(255,255,255,0.9); font-size: 0.9rem;">تحلیل خرابی و بررسی وضعیت</p>
                        </div>
                        <button onclick="this.closest('div[style*=\"position: fixed\"]').remove()" style="
                            background: rgba(255,255,255,0.2);
                            border: none;
                            color: white;
                            font-size: 24px;
                            cursor: pointer;
                            padding: 0;
                            width: 40px;
                            height: 40px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            border-radius: 50%;
                            transition: all 0.2s;
                        " onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">×</button>
                    </div>

                    <div style="padding: 2rem;">
                        <!-- تصویر سایت پلن -->
                        <div style="margin-bottom: 2rem;">
                            <h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem; color: #1a1a1a;">
                                <i class="fas fa-map-marked-alt ml-2" style="color: #3b82f6;"></i>
                                نقشه سایت پلن
                            </h3>
                            <div style="
                                border: 2px solid #e5e7eb;
                                border-radius: 12px;
                                overflow: hidden;
                                background: #f9fafb;
                            ">
                                <img src="images/${imagePath}" alt="${title}" 
                                     style="width: 100%; height: auto; display: block; max-height: 500px; object-fit: contain;">
                            </div>
                        </div>

                        <!-- تحلیل خرابی -->
                        <div style="margin-bottom: 2rem;">
                            <h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem; color: #1a1a1a;">
                                <i class="fas fa-exclamation-triangle ml-2" style="color: #ef4444;"></i>
                                تحلیل خرابی و مشکلات شناسایی شده
                            </h3>
                            <div style="display: grid; gap: 1rem;">
                                ${analysis.issues.map(issue => {
                                    const statusColors = {
                                        danger: { bg: '#fee2e2', text: '#dc2626', border: '#fecaca' },
                                        warning: { bg: '#fef3c7', text: '#d97706', border: '#fde68a' },
                                        success: { bg: '#d1fae5', text: '#059669', border: '#a7f3d0' }
                                    };
                                    const colors = statusColors[issue.status] || statusColors.warning;
                                    return `
                                        <div style="
                                            background: ${colors.bg};
                                            border: 2px solid ${colors.border};
                                            border-radius: 12px;
                                            padding: 1.25rem;
                                        ">
                                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                                                <div>
                                                    <h4 style="margin: 0; font-size: 1.1rem; font-weight: 600; color: #1a1a1a;">${issue.area}</h4>
                                                    <p style="margin: 0.5rem 0 0 0; color: #6b7280; font-size: 0.9rem;">${issue.description}</p>
                                                </div>
                                                <span style="
                                                    padding: 0.375rem 0.75rem;
                                                    background: ${colors.bg};
                                                    color: ${colors.text};
                                                    border: 1px solid ${colors.border};
                                                    border-radius: 6px;
                                                    font-size: 0.875rem;
                                                    font-weight: 600;
                                                ">${issue.severity}</span>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>

                        <!-- توصیه‌ها -->
                        <div style="margin-bottom: 2rem;">
                            <h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem; color: #1a1a1a;">
                                <i class="fas fa-lightbulb ml-2" style="color: #f59e0b;"></i>
                                توصیه‌های بهبود
                            </h3>
                            <div style="background: #f0f9ff; border: 2px solid #bae6fd; border-radius: 12px; padding: 1.25rem;">
                                <ul style="margin: 0; padding-right: 1.5rem; color: #1e40af;">
                                    ${analysis.recommendations.map(rec => `
                                        <li style="margin-bottom: 0.75rem; line-height: 1.6;">${rec}</li>
                                    `).join('')}
                                </ul>
                            </div>
                        </div>

                        <!-- اطلاعات بازرسی -->
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-bottom: 2rem;">
                            <div style="background: #f9fafb; border: 2px solid #e5e7eb; border-radius: 12px; padding: 1.25rem;">
                                <div style="font-size: 0.875rem; color: #6b7280; margin-bottom: 0.5rem;">
                                    <i class="fas fa-calendar-check ml-1" style="color: #3b82f6;"></i>
                                    آخرین بازرسی
                                </div>
                                <div style="font-size: 1.25rem; font-weight: 600; color: #1a1a1a;">${analysis.lastInspection}</div>
                            </div>
                            <div style="background: #f9fafb; border: 2px solid #e5e7eb; border-radius: 12px; padding: 1.25rem;">
                                <div style="font-size: 0.875rem; color: #6b7280; margin-bottom: 0.5rem;">
                                    <i class="fas fa-calendar-alt ml-1" style="color: #10b981;"></i>
                                    بازرسی بعدی
                                </div>
                                <div style="font-size: 1.25rem; font-weight: 600; color: #1a1a1a;">${analysis.nextInspection}</div>
                            </div>
                        </div>

                        <!-- دکمه‌های عملیاتی -->
                        <div style="display: flex; gap: 0.75rem; margin-top: 2rem;">
                            <button onclick="alert('گزارش تحلیل خرابی در حال آماده‌سازی است...')" style="
                                flex: 1;
                                padding: 0.875rem;
                                background: #3b82f6;
                                color: white;
                                border: none;
                                border-radius: 8px;
                                font-weight: 600;
                                cursor: pointer;
                                transition: all 0.2s;
                                font-size: 0.95rem;
                            " onmouseover="this.style.background='#2563eb'" onmouseout="this.style.background='#3b82f6'">
                                <i class="fas fa-file-pdf ml-1"></i>
                                دانلود گزارش PDF
                            </button>
                            <button onclick="alert('ارسال به تیم تعمیرات...')" style="
                                flex: 1;
                                padding: 0.875rem;
                                background: #10b981;
                                color: white;
                                border: none;
                                border-radius: 8px;
                                font-weight: 600;
                                cursor: pointer;
                                transition: all 0.2s;
                                font-size: 0.95rem;
                            " onmouseover="this.style.background='#059669'" onmouseout="this.style.background='#10b981'">
                                <i class="fas fa-tools ml-1"></i>
                                ارسال به تعمیرات
                            </button>
                            <button onclick="this.closest('div[style*=\"position: fixed\"]').remove()" style="
                                padding: 0.875rem 1.5rem;
                                background: #f3f4f6;
                                color: #1a1a1a;
                                border: none;
                                border-radius: 8px;
                                font-weight: 600;
                                cursor: pointer;
                                transition: all 0.2s;
                                font-size: 0.95rem;
                            " onmouseover="this.style.background='#e5e7eb'" onmouseout="this.style.background='#f3f4f6'">
                                بستن
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            modal.onclick = function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            };
            
            document.body.appendChild(modal);
        }

        // ========== سیستم تحلیل خرابی و پیش‌بینی ==========
        
        // بانک اطلاعاتی تجهیزات کارخانه گندله‌سازی (بر اساس Final Book)
        const equipmentDatabase = [
            // بخش دوزینگ و مخلوط‌سازی
            {
                id: 'EQ-001',
                name: 'Loss in Weight Feeder - LIW-01',
                category: 'dosing',
                section: 'دوزینگ و مخلوط‌سازی',
                location: 'خط تولید ۱',
                manufacturer: 'Schenck Process',
                model: 'LIW-01',
                serialNumber: '120008_ZZZ01_ZZ01_MDC05_00003',
                installationDate: '۱۳۹۸/۰۳/۱۵',
                lastMaintenance: '۱۴۰۳/۰۸/۲۰',
                nextMaintenance: '۱۴۰۳/۱۱/۲۰',
                status: 'فعال',
                specifications: {
                    capacity: '۵۰ تن/ساعت',
                    accuracy: '±۰.۵٪',
                    power: '۵.۵ kW'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/01 Dosing and Mixing/02 Loss in Weight Feeder'
            },
            {
                id: 'EQ-002',
                name: 'Belt Weigher - BW-01',
                category: 'dosing',
                section: 'دوزینگ و مخلوط‌سازی',
                location: 'خط تولید ۱',
                manufacturer: 'Schenck Process',
                model: 'BW-01',
                serialNumber: '120008_ZZZ01_ZZ01_MDC05_00017',
                installationDate: '۱۳۹۸/۰۳/۲۰',
                lastMaintenance: '۱۴۰۳/۰۹/۱۰',
                nextMaintenance: '۱۴۰۳/۱۲/۱۰',
                status: 'فعال',
                specifications: {
                    capacity: '۱۰۰ تن/ساعت',
                    accuracy: '±۰.۲٪',
                    beltWidth: '۱۲۰۰ mm'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/01 Dosing and Mixing/04 Belt Weighers + Dosing Belt Weighers'
            },
            {
                id: 'EQ-003',
                name: 'Mixer Drum Type - MIX-01',
                category: 'dosing',
                section: 'دوزینگ و مخلوط‌سازی',
                location: 'خط تولید ۱',
                manufacturer: 'Outotec',
                model: 'MIX-01',
                serialNumber: '120008_ZZZ01_ZZ01_MDC05_00006',
                installationDate: '۱۳۹۸/۰۴/۰۵',
                lastMaintenance: '۱۴۰۳/۰۷/۱۵',
                nextMaintenance: '۱۴۰۳/۱۰/۱۵',
                status: 'نیاز به بازرسی',
                specifications: {
                    capacity: '۱۵۰ تن/ساعت',
                    drumDiameter: '۳.۵ متر',
                    power: '۷۵ kW'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/01 Dosing and Mixing/06 Mixers Drum Type'
            },
            
            // بخش گندله‌سازی
            {
                id: 'EQ-004',
                name: 'Pelletizing Disc - PD-01',
                category: 'pelletizing',
                section: 'گندله‌سازی',
                location: 'خط تولید ۱',
                manufacturer: 'Outotec',
                model: 'PD-01',
                serialNumber: '120008_ZZZ01_ZZ01_MDC05_00002',
                installationDate: '۱۳۹۸/۰۵/۱۰',
                lastMaintenance: '۱۴۰۳/۰۶/۲۰',
                nextMaintenance: '۱۴۰۳/۰۹/۲۰',
                status: 'فعال',
                specifications: {
                    discDiameter: '۷.۵ متر',
                    capacity: '۵۰۰ تن/ساعت',
                    power: '۱۶۰ kW',
                    inclination: '۴۵ درجه'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/02 Green Peletizing/03 Pelletizing Discs'
            },
            {
                id: 'EQ-005',
                name: 'Single Deck Roller Screen - RS-01',
                category: 'screening',
                section: 'گندله‌سازی',
                location: 'خط تولید ۱',
                manufacturer: 'Outotec',
                model: 'RS-01',
                serialNumber: '120008_ZZZ01_ZZ01_MDC05_00005',
                installationDate: '۱۳۹۸/۰۵/۱۵',
                lastMaintenance: '۱۴۰۳/۰۸/۰۵',
                nextMaintenance: '۱۴۰۳/۱۱/۰۵',
                status: 'فعال',
                specifications: {
                    screenArea: '۱۲ متر مربع',
                    capacity: '۵۰۰ تن/ساعت',
                    power: '۳۷ kW'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/02 Green Peletizing/05 Single Deck Roller Screen and Carriage'
            },
            
            // بخش کوره ایندوریت
            {
                id: 'EQ-006',
                name: 'Indurating Machine - IM-01',
                category: 'indurating',
                section: 'کوره ایندوریت',
                location: 'خط تولید ۱',
                manufacturer: 'Outotec',
                model: 'IM-01',
                serialNumber: '120008_ZZZ01_ZZ01_MDC05_00004',
                installationDate: '۱۳۹۸/۰۶/۰۱',
                lastMaintenance: '۱۴۰۳/۰۵/۱۰',
                nextMaintenance: '۱۴۰۳/۰۸/۱۰',
                status: 'نیاز به تعمیرات',
                specifications: {
                    length: '۱۵۰ متر',
                    width: '۴.۵ متر',
                    capacity: '۵ میلیون تن/سال',
                    maxTemperature: '۱۳۵۰°C',
                    power: '۲۵۰۰ kW'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/03 Indurating Machine/04 Indurating Machine'
            },
            {
                id: 'EQ-007',
                name: 'Reciprocating Head - RH-01',
                category: 'indurating',
                section: 'کوره ایندوریت',
                location: 'خط تولید ۱',
                manufacturer: 'Outotec',
                model: 'RH-01',
                serialNumber: '120008_ZZZ01_ZZ01_MDC05_00001',
                installationDate: '۱۳۹۸/۰۶/۰۵',
                lastMaintenance: '۱۴۰۳/۰۷/۲۰',
                nextMaintenance: '۱۴۰۳/۱۰/۲۰',
                status: 'فعال',
                specifications: {
                    type: 'Oil Hydraulic Drive',
                    strokeLength: '۴.۵ متر',
                    power: '۱۸۵ kW'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/03 Indurating Machine/01 Reciproacting head with oil hydraulic drive'
            },
            
            // بخش فن‌های فرآیندی
            {
                id: 'EQ-008',
                name: 'Updraft Drying Fan - UDF-01',
                category: 'fans',
                section: 'فن‌های فرآیندی',
                location: 'خط تولید ۱',
                manufacturer: 'Howden',
                model: 'UDF-01',
                serialNumber: '120008_ZZZ01_ZZ01_MDC05_00002',
                installationDate: '۱۳۹۸/۰۷/۱۰',
                lastMaintenance: '۱۴۰۳/۰۹/۰۱',
                nextMaintenance: '۱۴۰۳/۱۲/۰۱',
                status: 'فعال',
                specifications: {
                    flowRate: '۵۰۰,۰۰۰ m³/h',
                    pressure: '۸ kPa',
                    power: '۱۵۰۰ kW',
                    temperature: '۳۵۰°C'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/05 Process Fans and Ducts/02 Updrought Drying Fan'
            },
            {
                id: 'EQ-009',
                name: 'Hood Exhaust Gas Fan - HEGF-01',
                category: 'fans',
                section: 'فن‌های فرآیندی',
                location: 'خط تولید ۱',
                manufacturer: 'Howden',
                model: 'HEGF-01',
                serialNumber: '120008_ZZZ01_ZZ01_MDC05_00006',
                installationDate: '۱۳۹۸/۰۷/۱۵',
                lastMaintenance: '۱۴۰۳/۰۸/۱۵',
                nextMaintenance: '۱۴۰۳/۱۱/۱۵',
                status: 'فعال',
                specifications: {
                    flowRate: '۴۰۰,۰۰۰ m³/h',
                    pressure: '۶ kPa',
                    power: '۱۲۰۰ kW',
                    temperature: '۳۰۰°C'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/05 Process Fans and Ducts/06 Hood Exhaust Gas Fan'
            },
            
            // بخش غبارگیری
            {
                id: 'EQ-010',
                name: 'ESP Windbox Exhaust Gas 1 - ESP-01',
                category: 'dedusting',
                section: 'سیستم‌های غبارگیری',
                location: 'خط تولید ۱',
                manufacturer: 'FLSmidth',
                model: 'ESP-01',
                serialNumber: '120008_ZZZ01_ZZ01_MDC05_00009',
                installationDate: '۱۳۹۸/۰۸/۰۱',
                lastMaintenance: '۱۴۰۳/۰۶/۱۰',
                nextMaintenance: '۱۴۰۳/۰۹/۱۰',
                status: 'نیاز به بازرسی',
                specifications: {
                    efficiency: '۹۹.۹٪',
                    flowRate: '۳۰۰,۰۰۰ m³/h',
                    power: '۸۰۰ kW'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/09 Process Gas Dedusting/01 ESP Windbox Exhaust Gas 1'
            },
            
            // بخش سیستم آب
            {
                id: 'EQ-011',
                name: 'Thickener with Rake Mechanism - TH-01',
                category: 'water',
                section: 'سیستم آب فرآیندی',
                location: 'خط تولید ۱',
                manufacturer: 'Outotec',
                model: 'TH-01',
                serialNumber: '120008_ZZZ01_ZZ01_MDC05_00011',
                installationDate: '۱۳۹۸/۰۸/۱۰',
                lastMaintenance: '۱۴۰۳/۰۷/۰۵',
                nextMaintenance: '۱۴۰۳/۱۰/۰۵',
                status: 'فعال',
                specifications: {
                    diameter: '۴۵ متر',
                    capacity: '۲۰۰۰ m³/h',
                    power: '۳۷ kW'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/11 Process Water System/01 Thickener with Rake Mechanism'
            },
            {
                id: 'EQ-012',
                name: 'Membrane Filter Press - MFP-01',
                category: 'water',
                section: 'سیستم آب فرآیندی',
                location: 'خط تولید ۱',
                manufacturer: 'Outotec',
                model: 'MFP-01',
                serialNumber: '120008_ZZZ01_ZZ01_MDC05_00012',
                installationDate: '۱۳۹۸/۰۸/۱۵',
                lastMaintenance: '۱۴۰۳/۰۸/۲۵',
                nextMaintenance: '۱۴۰۳/۱۱/۲۵',
                status: 'فعال',
                specifications: {
                    filterArea: '۸۰۰ m²',
                    capacity: '۱۵۰ m³/h',
                    pressure: '۱۶ bar'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/12 Filtration/01 Membrane Filter Press, including'
            },
            
            // بخش الک و غربال
            {
                id: 'EQ-013',
                name: 'Product Screen Sizer - PS-01',
                category: 'screening',
                section: 'الک و غربال محصول',
                location: 'خط تولید ۱',
                manufacturer: 'Outotec',
                model: 'PS-01',
                serialNumber: '120008_ZZZ01_ZZ01_MDC05_00006',
                installationDate: '۱۳۹۸/۰۹/۰۱',
                lastMaintenance: '۱۴۰۳/۰۹/۱۵',
                nextMaintenance: '۱۴۰۳/۱۲/۱۵',
                status: 'فعال',
                specifications: {
                    screenArea: '۲۰ متر مربع',
                    capacity: '۵۰۰ تن/ساعت',
                    power: '۵۵ kW'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/06 Pellet Screening and Transport/01 Product Screens - Sizer'
            }
        ];

        // داده‌های پیش‌بینی خرابی (۱۰ مورد نمونه)
        const failurePredictions = [
            {
                equipmentId: 'EQ-006',
                equipmentName: 'Indurating Machine - IM-01',
                section: 'کوره ایندوریت',
                riskLevel: 'high',
                predictedFailureDate: '۱۴۰۳/۱۰/۱۵',
                daysRemaining: 45,
                failureType: 'خرابی آجرهای نسوز',
                probability: 85,
                symptoms: [
                    'افزایش دمای بدنه کوره',
                    'کاهش راندمان حرارتی',
                    'افزایش مصرف انرژی',
                    'ترک‌های قابل مشاهده در آجرها'
                ],
                impact: 'توقف کامل خط تولید - هزینه تعمیرات: ۱۵ میلیارد تومان',
                recommendations: [
                    'بازرسی فوری آجرهای نسوز',
                    'برنامه‌ریزی تعویض آجرها در اسرع وقت',
                    'کاهش دمای کوره تا ۵۰ درجه',
                    'افزایش فرکانس بازرسی‌ها'
                ],
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/03 Indurating Machine/04 Indurating Machine'
            },
            {
                equipmentId: 'EQ-008',
                equipmentName: 'Updraft Drying Fan - UDF-01',
                section: 'فن‌های فرآیندی',
                riskLevel: 'medium',
                predictedFailureDate: '۱۴۰۳/۱۱/۲۰',
                daysRemaining: 81,
                failureType: 'خرابی یاتاقان‌ها',
                probability: 65,
                symptoms: [
                    'افزایش لرزش',
                    'افزایش دمای یاتاقان‌ها',
                    'صدای غیرعادی',
                    'کاهش راندمان'
                ],
                impact: 'توقف موقت - هزینه تعمیرات: ۲.۵ میلیارد تومان',
                recommendations: [
                    'تعویض روغن یاتاقان‌ها',
                    'بازرسی دوره‌ای لرزش',
                    'نصب سنسورهای مانیتورینگ',
                    'برنامه‌ریزی تعویض یاتاقان‌ها'
                ],
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/05 Process Fans and Ducts/02 Updrought Drying Fan'
            },
            {
                equipmentId: 'EQ-003',
                equipmentName: 'Mixer Drum Type - MIX-01',
                section: 'دوزینگ و مخلوط‌سازی',
                riskLevel: 'medium',
                predictedFailureDate: '۱۴۰۳/۱۰/۲۵',
                daysRemaining: 55,
                failureType: 'خرابی گیربکس',
                probability: 70,
                symptoms: [
                    'صدای غیرعادی از گیربکس',
                    'افزایش لرزش',
                    'نشت روغن',
                    'کاهش سرعت چرخش'
                ],
                impact: 'توقف موقت - هزینه تعمیرات: ۱.۸ میلیارد تومان',
                recommendations: [
                    'بررسی سطح و کیفیت روغن',
                    'بازرسی دنده‌های گیربکس',
                    'برنامه‌ریزی تعمیرات',
                    'نصب سیستم مانیتورینگ'
                ],
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/01 Dosing and Mixing/06 Mixers Drum Type'
            },
            {
                equipmentId: 'EQ-010',
                equipmentName: 'ESP Windbox Exhaust Gas 1 - ESP-01',
                section: 'سیستم‌های غبارگیری',
                riskLevel: 'high',
                predictedFailureDate: '۱۴۰۳/۱۰/۰۵',
                daysRemaining: 35,
                failureType: 'خرابی الکترودها',
                probability: 80,
                symptoms: [
                    'کاهش راندمان غبارگیری',
                    'افزایش فشار',
                    'جرقه‌زنی غیرعادی',
                    'افزایش مصرف برق'
                ],
                impact: 'کاهش کیفیت محصول - هزینه تعمیرات: ۳.۵ میلیارد تومان',
                recommendations: [
                    'بازرسی فوری الکترودها',
                    'تمیزکاری سیستم',
                    'برنامه‌ریزی تعویض الکترودها',
                    'افزایش فرکانس بازرسی‌ها'
                ],
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/09 Process Gas Dedusting/01 ESP Windbox Exhaust Gas 1'
            },
            {
                equipmentId: 'EQ-001',
                equipmentName: 'Loss in Weight Feeder - LIW-01',
                section: 'دوزینگ و مخلوط‌سازی',
                riskLevel: 'low',
                predictedFailureDate: '۱۴۰۳/۱۲/۱۰',
                daysRemaining: 101,
                failureType: 'خرابی سنسور وزن',
                probability: 40,
                symptoms: [
                    'خطا در اندازه‌گیری',
                    'نوسان در دوزینگ',
                    'هشدارهای سیستم'
                ],
                impact: 'کاهش دقت تولید - هزینه تعمیرات: ۸۰۰ میلیون تومان',
                recommendations: [
                    'کالیبراسیون سنسور',
                    'بازرسی دوره‌ای',
                    'برنامه‌ریزی تعویض سنسور'
                ],
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/01 Dosing and Mixing/02 Loss in Weight Feeder'
            },
            {
                equipmentId: 'EQ-004',
                equipmentName: 'Pelletizing Disc - PD-01',
                section: 'گندله‌سازی',
                riskLevel: 'medium',
                predictedFailureDate: '۱۴۰۳/۱۱/۱۵',
                daysRemaining: 76,
                failureType: 'خرابی سیستم روغن‌کاری',
                probability: 60,
                symptoms: [
                    'کاهش فشار روغن',
                    'افزایش دمای یاتاقان‌ها',
                    'نشت روغن',
                    'افزایش لرزش'
                ],
                impact: 'توقف موقت - هزینه تعمیرات: ۱.۲ میلیارد تومان',
                recommendations: [
                    'بررسی سیستم روغن‌کاری',
                    'تعویض فیلترها',
                    'بررسی نشتی‌ها',
                    'برنامه‌ریزی تعمیرات'
                ],
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/02 Green Peletizing/03 Pelletizing Discs'
            },
            {
                equipmentId: 'EQ-009',
                equipmentName: 'Hood Exhaust Gas Fan - HEGF-01',
                section: 'فن‌های فرآیندی',
                riskLevel: 'low',
                predictedFailureDate: '۱۴۰۳/۱۲/۲۰',
                daysRemaining: 111,
                failureType: 'خرابی پره‌های فن',
                probability: 35,
                symptoms: [
                    'کاهش جریان هوا',
                    'افزایش لرزش',
                    'صدای غیرعادی',
                    'کاهش راندمان'
                ],
                impact: 'کاهش راندمان - هزینه تعمیرات: ۱.۵ میلیارد تومان',
                recommendations: [
                    'بازرسی پره‌ها',
                    'تعادل‌سازی روتور',
                    'برنامه‌ریزی تعمیرات'
                ],
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/05 Process Fans and Ducts/06 Hood Exhaust Gas Fan'
            },
            {
                equipmentId: 'EQ-011',
                equipmentName: 'Thickener with Rake Mechanism - TH-01',
                section: 'سیستم آب فرآیندی',
                riskLevel: 'medium',
                predictedFailureDate: '۱۴۰۳/۱۰/۳۰',
                daysRemaining: 60,
                failureType: 'خرابی مکانیزم ریک',
                probability: 55,
                symptoms: [
                    'افزایش بار موتور',
                    'صدای غیرعادی',
                    'کاهش سرعت چرخش',
                    'افزایش مصرف برق'
                ],
                impact: 'کاهش راندمان - هزینه تعمیرات: ۲ میلیارد تومان',
                recommendations: [
                    'بازرسی مکانیزم ریک',
                    'بررسی یاتاقان‌ها',
                    'برنامه‌ریزی تعمیرات',
                    'نصب سیستم مانیتورینگ'
                ],
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/11 Process Water System/01 Thickener with Rake Mechanism'
            },
            {
                equipmentId: 'EQ-007',
                equipmentName: 'Reciprocating Head - RH-01',
                section: 'کوره ایندوریت',
                riskLevel: 'low',
                predictedFailureDate: '۱۴۰۴/۰۱/۱۰',
                daysRemaining: 131,
                failureType: 'خرابی سیستم هیدرولیک',
                probability: 30,
                symptoms: [
                    'نشت روغن هیدرولیک',
                    'کاهش فشار',
                    'افزایش دمای روغن',
                    'کاهش سرعت حرکت'
                ],
                impact: 'کاهش راندمان - هزینه تعمیرات: ۲.۲ میلیارد تومان',
                recommendations: [
                    'بررسی سیستم هیدرولیک',
                    'تعویض فیلترها',
                    'بررسی نشتی‌ها',
                    'برنامه‌ریزی تعمیرات'
                ],
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/03 Indurating Machine/01 Reciproacting head with oil hydraulic drive'
            },
            {
                equipmentId: 'EQ-012',
                equipmentName: 'Membrane Filter Press - MFP-01',
                section: 'سیستم آب فرآیندی',
                riskLevel: 'low',
                predictedFailureDate: '۱۴۰۳/۱۲/۰۵',
                daysRemaining: 96,
                failureType: 'خرابی ممبران',
                probability: 45,
                symptoms: [
                    'کاهش راندمان فیلتراسیون',
                    'افزایش فشار',
                    'نشت آب',
                    'کاهش کیفیت آب خروجی'
                ],
                impact: 'کاهش کیفیت - هزینه تعمیرات: ۱.۸ میلیارد تومان',
                recommendations: [
                    'بازرسی ممبران‌ها',
                    'برنامه‌ریزی تعویض',
                    'افزایش فرکانس بازرسی‌ها'
                ],
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/12 Filtration/01 Membrane Filter Press, including'
            }
        ];

        // تابع نمایش تب‌ها
        function showFailureTab(tabName) {
            // مخفی کردن همه تب‌ها
            document.querySelectorAll('.failure-tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // غیرفعال کردن همه دکمه‌ها
            document.querySelectorAll('.failure-tab-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-red-600', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            
            // نمایش تب انتخاب شده
            const selectedTab = document.getElementById(tabName + '-tab');
            if (selectedTab) {
                selectedTab.classList.remove('hidden');
            }
            
            // فعال کردن دکمه مربوطه
            const clickedBtn = event && event.target ? event.target.closest('.failure-tab-btn') : null;
            if (clickedBtn) {
                clickedBtn.classList.remove('bg-gray-200', 'text-gray-700');
                clickedBtn.classList.add('active', 'bg-red-600', 'text-white');
            } else {
                // اگر event وجود نداشت، دکمه را بر اساس tabName پیدا کن
                document.querySelectorAll('.failure-tab-btn').forEach(btn => {
                    if (btn.textContent.includes(tabName === 'equipment-database' ? 'بانک اطلاعاتی' : 
                                                   tabName === 'failure-analysis' ? 'تحلیل خرابی' :
                                                   tabName === 'prediction' ? 'پیش‌بینی' : 'تعمیرات')) {
                        btn.classList.remove('bg-gray-200', 'text-gray-700');
                        btn.classList.add('active', 'bg-red-600', 'text-white');
                    }
                });
            }
            
            // بارگذاری داده‌ها
            if (tabName === 'equipment-database') {
                setTimeout(() => {
                loadEquipmentDatabase();
                    loadEquipmentHierarchy();
                }, 100);
            } else if (tabName === 'failure-analysis') {
                setTimeout(() => {
                loadFailureAnalysis();
                }, 100);
            } else if (tabName === 'prediction') {
                setTimeout(() => {
                loadFailurePredictions();
                }, 100);
            } else if (tabName === 'maintenance') {
                setTimeout(() => {
                loadMaintenanceEquipment();
                }, 100);
            }
        }

        // بارگذاری بانک اطلاعاتی تجهیزات با سیستم Glory Glass
        function loadEquipmentDatabase() {
            const grid = document.getElementById('equipment-grid');
            if (!grid) return;
            
            grid.innerHTML = equipmentDatabase.map(eq => `
                <div class="glory-glass-card" onclick="showEquipmentDetails('${eq.id}')">
                    <div class="flex items-start justify-between mb-3">
                        <div class="flex-1">
                            <h4 class="font-bold text-lg text-gray-900 mb-1">${eq.name}</h4>
                            <p class="text-sm text-gray-600">${eq.section}</p>
                        </div>
                        <span class="px-2 py-1 rounded text-xs font-medium ${
                            eq.status === 'فعال' ? 'bg-green-100 text-green-700' : 
                            eq.status === 'نیاز به بازرسی' ? 'bg-yellow-100 text-yellow-700' : 
                            'bg-red-100 text-red-700'
                        }">${eq.status}</span>
                    </div>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span class="text-gray-600">کد تجهیز:</span>
                            <span class="font-semibold">${eq.id}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">سازنده:</span>
                            <span class="font-semibold">${eq.manufacturer}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">مکان:</span>
                            <span class="font-semibold">${eq.location}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">بازرسی بعدی:</span>
                            <span class="font-semibold text-red-600">${eq.nextMaintenance}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // بارگذاری تحلیل خرابی
        function loadFailureAnalysis() {
            const grid = document.getElementById('failure-analysis-grid');
            if (!grid) return;
            
            // تجهیزاتی که نیاز به بازرسی دارند
            const criticalEquipment = equipmentDatabase.filter(eq => 
                eq.status === 'نیاز به بازرسی' || eq.status === 'نیاز به تعمیرات'
            );
            
            grid.innerHTML = criticalEquipment.map(eq => `
                <div class="prediction-card glory-glass-card ${eq.status === 'نیاز به تعمیرات' ? 'high-risk' : 'medium-risk'}">
                    <div class="flex items-start justify-between mb-3">
                        <div>
                            <h4 class="font-bold text-lg text-gray-900 mb-1">${eq.name}</h4>
                            <p class="text-sm text-gray-600">${eq.section} - ${eq.location}</p>
                        </div>
                        <span class="risk-badge ${eq.status === 'نیاز به تعمیرات' ? 'high' : 'medium'}">
                            ${eq.status}
                        </span>
                    </div>
                    <div class="space-y-2 text-sm mb-4">
                        <div class="flex justify-between">
                            <span class="text-gray-600">کد تجهیز:</span>
                            <span class="font-semibold">${eq.id}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">آخرین بازرسی:</span>
                            <span class="font-semibold">${eq.lastMaintenance}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">بازرسی بعدی:</span>
                            <span class="font-semibold text-red-600">${eq.nextMaintenance}</span>
                        </div>
                    </div>
                    <button onclick="showEquipmentDetails('${eq.id}')" 
                            class="w-full py-2 bg-red-600 hover:bg-red-700 rounded-lg text-white font-medium transition">
                        <i class="fas fa-info-circle ml-1"></i>
                        مشاهده جزئیات
                    </button>
                </div>
            `).join('');
        }

        // فیلتر تجهیزات تعمیرات
        function filterMaintenanceEquipment(category) {
            // به‌روزرسانی دکمه‌های فعال
            document.querySelectorAll('.equipment-category-btn').forEach(btn => {
                if (btn.dataset.category === category) {
                    btn.classList.remove('bg-white', 'text-gray-700', 'border-gray-200');
                    btn.classList.add('active', 'bg-gradient-to-r', 'from-cyan-600', 'to-blue-600', 'text-white', 'shadow-md');
                } else {
                    btn.classList.remove('active', 'bg-gradient-to-r', 'from-cyan-600', 'to-blue-600', 'text-white', 'shadow-md');
                    btn.classList.add('bg-white', 'text-gray-700', 'border-gray-200');
                }
            });
            
            loadMaintenanceEquipment(category);
        }

        // بارگذاری پیش‌بینی خرابی
        function loadFailurePredictions() {
            const grid = document.getElementById('prediction-grid');
            if (!grid) {
                console.error('prediction-grid element not found!');
                return;
            }
            
            if (!failurePredictions || failurePredictions.length === 0) {
                grid.innerHTML = '<div class="text-center py-8 text-gray-500 bg-white rounded-lg p-6">هیچ پیش‌بینی خرابی موجود نیست</div>';
                return;
            }
            
            console.log('Loading', failurePredictions.length, 'predictions');
            
            grid.innerHTML = failurePredictions.map(pred => {
                const riskText = pred.riskLevel === 'high' ? 'ریسک بالا' : pred.riskLevel === 'medium' ? 'ریسک متوسط' : 'ریسک پایین';
                const riskClass = pred.riskLevel === 'high' ? 'high-risk' : pred.riskLevel === 'medium' ? 'medium-risk' : 'low-risk';
                
                return `
                <div class="prediction-card glory-glass-card ${riskClass} border-l-4 ${pred.riskLevel === 'high' ? 'border-red-500' : pred.riskLevel === 'medium' ? 'border-orange-500' : 'border-green-500'}">
                    <div class="flex items-start justify-between mb-4 pb-4 border-b border-gray-200">
                        <div class="flex-1">
                            <h4 class="font-bold text-2xl text-gray-900 mb-2">${pred.equipmentName}</h4>
                            <p class="text-base text-gray-600">${pred.section}</p>
                        </div>
                        <span class="risk-badge ${pred.riskLevel} px-4 py-2 rounded-lg font-bold text-sm">
                            ${riskText}
                        </span>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div class="bg-gradient-to-br ${pred.riskLevel === 'high' ? 'from-red-50 to-red-100' : pred.riskLevel === 'medium' ? 'from-orange-50 to-orange-100' : 'from-green-50 to-green-100'} rounded-lg p-4 border ${pred.riskLevel === 'high' ? 'border-red-200' : pred.riskLevel === 'medium' ? 'border-orange-200' : 'border-green-200'}>
                            <div class="text-sm text-gray-700 mb-2 font-semibold">احتمال خرابی</div>
                            <div class="text-3xl font-bold ${pred.riskLevel === 'high' ? 'text-red-600' : pred.riskLevel === 'medium' ? 'text-orange-600' : 'text-green-600'}">${pred.probability}%</div>
                        </div>
                        <div class="bg-gradient-to-br from-orange-50 to-orange-100 rounded-lg p-4 border border-orange-200">
                            <div class="text-sm text-gray-700 mb-2 font-semibold">روزهای باقیمانده</div>
                            <div class="text-3xl font-bold text-orange-600">${pred.daysRemaining}</div>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <div class="text-base font-bold text-gray-900 mb-2">نوع خرابی پیش‌بینی شده:</div>
                        <div class="text-lg text-gray-800 font-semibold bg-gray-50 rounded-lg p-3">${pred.failureType}</div>
                    </div>
                    
                    <div class="mb-4">
                        <div class="text-base font-bold text-gray-900 mb-2">تاریخ پیش‌بینی شده:</div>
                        <div class="text-xl text-red-600 font-bold bg-red-50 rounded-lg p-3 text-center">${pred.predictedFailureDate}</div>
                    </div>
                    
                    <div class="mb-4">
                        <div class="text-base font-bold text-gray-900 mb-3">علائم هشدار:</div>
                        <ul class="list-disc list-inside text-sm text-gray-700 space-y-2 bg-yellow-50 rounded-lg p-4 border border-yellow-200">
                            ${pred.symptoms.map(s => `<li class="py-1">${s}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div class="mb-4 p-4 bg-red-50 rounded-lg border-2 border-red-300">
                        <div class="text-base font-bold text-red-900 mb-2">تأثیر خرابی:</div>
                        <div class="text-base text-red-700 font-semibold">${pred.impact}</div>
                    </div>
                    
                    <div class="mb-6">
                        <div class="text-base font-bold text-gray-900 mb-3">توصیه‌ها:</div>
                        <ul class="list-disc list-inside text-sm text-gray-700 space-y-2 bg-blue-50 rounded-lg p-4 border border-blue-200">
                            ${pred.recommendations.map(r => `<li class="py-1">${r}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div class="flex gap-3 pt-4 border-t border-gray-200">
                        <button onclick="showEquipmentDetails('${pred.equipmentId}')" 
                                class="flex-1 py-3 bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 rounded-lg text-white font-bold transition shadow-lg">
                            <i class="fas fa-info-circle ml-2"></i>
                            جزئیات تجهیز
                        </button>
                        <button onclick="scheduleMaintenanceForEquipment('${pred.equipmentId}')" 
                                class="px-6 py-3 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 rounded-lg text-white font-bold transition shadow-lg">
                            <i class="fas fa-calendar-alt ml-2"></i>
                            برنامه‌ریزی تعمیر
                        </button>
                    </div>
                </div>
            `;
            }).join('');
        }

        // جستجوی تجهیزات
        function searchEquipment(query) {
            const cards = document.querySelectorAll('.glory-glass-card');
            cards.forEach(card => {
                const text = card.textContent.toLowerCase();
                if (text.includes(query.toLowerCase())) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // فیلتر بر اساس دسته‌بندی
        function filterEquipmentByCategory(category) {
            if (category === 'all') {
                loadEquipmentDatabase();
                return;
            }
            
            const filtered = equipmentDatabase.filter(eq => eq.category === category);
            const grid = document.getElementById('equipment-grid');
            if (!grid) return;
            
            grid.innerHTML = filtered.map(eq => `
                <div class="glory-glass-card" onclick="showEquipmentDetails('${eq.id}')">
                    <div class="flex items-start justify-between mb-3">
                        <div class="flex-1">
                            <h4 class="font-bold text-lg text-gray-900 mb-1">${eq.name}</h4>
                            <p class="text-sm text-gray-600">${eq.section}</p>
                        </div>
                        <span class="px-2 py-1 rounded text-xs font-medium ${
                            eq.status === 'فعال' ? 'bg-green-100 text-green-700' : 
                            eq.status === 'نیاز به بازرسی' ? 'bg-yellow-100 text-yellow-700' : 
                            'bg-red-100 text-red-700'
                        }">${eq.status}</span>
                    </div>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span class="text-gray-600">کد تجهیز:</span>
                            <span class="font-semibold">${eq.id}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">سازنده:</span>
                            <span class="font-semibold">${eq.manufacturer}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">مکان:</span>
                            <span class="font-semibold">${eq.location}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // نمایش جزئیات تجهیز
        function showEquipmentDetails(equipmentId) {
            const equipment = equipmentDatabase.find(eq => eq.id === equipmentId);
            if (!equipment) return;
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.7);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                padding: 20px;
            `;
            
            modal.innerHTML = `
                <div style="
                    background: #ffffff;
                    border-radius: 16px;
                    padding: 2rem;
                    max-width: 800px;
                    width: 100%;
                    max-height: 90vh;
                    overflow-y: auto;
                    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                ">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; border-bottom: 2px solid #e5e7eb; padding-bottom: 1rem;">
                        <h2 style="color: #1a1a1a; margin: 0; font-size: 1.75rem; font-weight: 600;">${equipment.name}</h2>
                        <button onclick="this.closest('div[style*=\"position: fixed\"]').remove()" style="
                            background: none;
                            border: none;
                            color: #6b7280;
                            font-size: 24px;
                            cursor: pointer;
                            padding: 0;
                            width: 32px;
                            height: 32px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            border-radius: 50%;
                            transition: all 0.2s;
                        " onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='none'">×</button>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-bottom: 1.5rem;">
                        <div style="background: #f9fafb; padding: 1rem; border-radius: 8px; border: 1px solid #e5e7eb;">
                            <div style="font-size: 0.75rem; color: #6b7280; margin-bottom: 0.5rem;">کد تجهیز</div>
                            <div style="font-size: 1.25rem; font-weight: 600; color: #1a1a1a;">${equipment.id}</div>
                        </div>
                        <div style="background: #f9fafb; padding: 1rem; border-radius: 8px; border: 1px solid #e5e7eb;">
                            <div style="font-size: 0.75rem; color: #6b7280; margin-bottom: 0.5rem;">بخش</div>
                            <div style="font-size: 1.25rem; font-weight: 600; color: #1a1a1a;">${equipment.section}</div>
                        </div>
                        <div style="background: #f9fafb; padding: 1rem; border-radius: 8px; border: 1px solid #e5e7eb;">
                            <div style="font-size: 0.75rem; color: #6b7280; margin-bottom: 0.5rem;">سازنده</div>
                            <div style="font-size: 1.25rem; font-weight: 600; color: #1a1a1a;">${equipment.manufacturer}</div>
                        </div>
                        <div style="background: #f9fafb; padding: 1rem; border-radius: 8px; border: 1px solid #e5e7eb;">
                            <div style="font-size: 0.75rem; color: #6b7280; margin-bottom: 0.5rem;">مدل</div>
                            <div style="font-size: 1.25rem; font-weight: 600; color: #1a1a1a;">${equipment.model}</div>
                        </div>
                        <div style="background: #f9fafb; padding: 1rem; border-radius: 8px; border: 1px solid #e5e7eb;">
                            <div style="font-size: 0.75rem; color: #6b7280; margin-bottom: 0.5rem;">تاریخ نصب</div>
                            <div style="font-size: 1.25rem; font-weight: 600; color: #1a1a1a;">${equipment.installationDate}</div>
                        </div>
                        <div style="background: #f9fafb; padding: 1rem; border-radius: 8px; border: 1px solid #e5e7eb;">
                            <div style="font-size: 0.75rem; color: #6b7280; margin-bottom: 0.5rem;">وضعیت</div>
                            <div style="font-size: 1.25rem; font-weight: 600; color: ${
                                equipment.status === 'فعال' ? '#10b981' : 
                                equipment.status === 'نیاز به بازرسی' ? '#f59e0b' : 
                                '#dc2626'
                            };">${equipment.status}</div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <h3 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 1rem; color: #1a1a1a;">مشخصات فنی</h3>
                        <div style="background: #f9fafb; padding: 1rem; border-radius: 8px; border: 1px solid #e5e7eb;">
                            ${Object.entries(equipment.specifications).map(([key, value]) => `
                                <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #e5e7eb;">
                                    <span style="color: #6b7280;">${key}:</span>
                                    <span style="font-weight: 600; color: #1a1a1a;">${value}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <h3 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 1rem; color: #1a1a1a;">تاریخچه تعمیرات</h3>
                        <div style="background: #f9fafb; padding: 1rem; border-radius: 8px; border: 1px solid #e5e7eb;">
                            <div style="display: flex; justify-content: space-between; padding: 0.5rem 0;">
                                <span style="color: #6b7280;">آخرین تعمیرات:</span>
                                <span style="font-weight: 600; color: #1a1a1a;">${equipment.lastMaintenance}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 0.5rem 0;">
                                <span style="color: #6b7280;">تعمیرات بعدی:</span>
                                <span style="font-weight: 600; color: #dc2626;">${equipment.nextMaintenance}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 0.5rem; margin-top: 1.5rem;">
                        <button onclick="alert('دیتا شیت تجهیز: ${equipment.dataSheet}')" style="
                            flex: 1;
                            padding: 0.75rem;
                            background: #dc2626;
                            color: white;
                            border: none;
                            border-radius: 8px;
                            font-weight: 600;
                            cursor: pointer;
                            transition: all 0.2s;
                        " onmouseover="this.style.background='#b91c1c'" onmouseout="this.style.background='#dc2626'">
                            مشاهده دیتا شیت
                        </button>
                        <button onclick="this.closest('div[style*=\"position: fixed\"]').remove()" style="
                            padding: 0.75rem 1.5rem;
                            background: #f3f4f6;
                            color: #1a1a1a;
                            border: none;
                            border-radius: 8px;
                            font-weight: 600;
                            cursor: pointer;
                            transition: all 0.2s;
                        " onmouseover="this.style.background='#e5e7eb'" onmouseout="this.style.background='#f3f4f6'">
                            بستن
                        </button>
                    </div>
                </div>
            `;
            
            modal.onclick = function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            };
            
            document.body.appendChild(modal);
        }

        // به‌روزرسانی تحلیل خرابی
        function refreshFailureAnalysis() {
            loadEquipmentDatabase();
            setTimeout(() => {
                loadFailurePredictions();
            }, 500);
        }
        
        // ========== سیستم پیش‌بینی خرابی بر اساس سنسورها، تاریخچه تعمیرات و دیتا شیت ==========
        
        // داده‌های سنسورها (شبیه‌سازی)
        const sensorData = {
            'Loss in Weight Feeder-01': {
                temperature: 85,
                vibration: 7.2,
                current: 45.3,
                pressure: 2.1,
                lastUpdate: '2024-01-15 14:30:00'
            },
            'Pelletizing Disc-01': {
                temperature: 120,
                vibration: 12.5,
                current: 125.8,
                pressure: 0.8,
                lastUpdate: '2024-01-15 14:28:00'
            },
            'Indurating Machine-01': {
                temperature: 950,
                vibration: 3.2,
                current: 450.5,
                pressure: 1.2,
                lastUpdate: '2024-01-15 14:25:00'
            },
            'Updraft Drying Fan-01': {
                temperature: 65,
                vibration: 8.9,
                current: 320.2,
                pressure: 0.5,
                lastUpdate: '2024-01-15 14:32:00'
            },
            'ESP Windbox Exhaust Gas-01': {
                temperature: 180,
                vibration: 2.1,
                current: 280.5,
                pressure: 0.3,
                lastUpdate: '2024-01-15 14:20:00'
            }
        };
        
        // تاریخچه تعمیرات
        const maintenanceHistory = {
            'Loss in Weight Feeder-01': [
                { date: '2023-06-15', type: 'تعمیرات اساسی', cost: 45000000, duration: 5 },
                { date: '2023-12-10', type: 'بازرسی دوره‌ای', cost: 5000000, duration: 1 }
            ],
            'Pelletizing Disc-01': [
                { date: '2023-05-20', type: 'تعویض دیسک', cost: 1200000000, duration: 15 },
                { date: '2023-11-05', type: 'تعمیرات جزئی', cost: 25000000, duration: 3 }
            ],
            'Indurating Machine-01': [
                { date: '2023-04-10', type: 'اورهال کامل', cost: 15000000000, duration: 45 },
                { date: '2023-10-01', type: 'بازرسی فنی', cost: 15000000, duration: 2 }
            ],
            'Updraft Drying Fan-01': [
                { date: '2023-07-25', type: 'تعمیرات پره‌ها', cost: 85000000, duration: 7 },
                { date: '2023-12-20', type: 'تعویض یاتاقان', cost: 35000000, duration: 4 }
            ],
            'ESP Windbox Exhaust Gas-01': [
                { date: '2023-03-15', type: 'تعمیرات سیستم ESP', cost: 6500000000, duration: 30 },
                { date: '2023-09-10', type: 'بازرسی و تمیزکاری', cost: 45000000, duration: 5 }
            ]
        };
        
        // تابع محاسبه احتمال خرابی
        function calculateFailureProbability(equipmentName, sensorData, maintenanceHistory, datasheet) {
            let riskScore = 0;
            const factors = [];
            
            if (sensorData) {
                if (sensorData.temperature > 100) {
                    riskScore += 20;
                    factors.push(`دمای بالا: ${sensorData.temperature}°C`);
                } else if (sensorData.temperature > 80) {
                    riskScore += 10;
                    factors.push(`دمای نسبتاً بالا: ${sensorData.temperature}°C`);
                }
                
                if (sensorData.vibration > 10) {
                    riskScore += 25;
                    factors.push(`ارتعاش غیرعادی: ${sensorData.vibration} mm/s`);
                } else if (sensorData.vibration > 7) {
                    riskScore += 15;
                    factors.push(`ارتعاش بالا: ${sensorData.vibration} mm/s`);
                }
                
                if (sensorData.current > 400) {
                    riskScore += 15;
                    factors.push(`جریان بالا: ${sensorData.current} A`);
                }
            }
            
            if (maintenanceHistory && maintenanceHistory.length > 0) {
                const lastMaintenance = new Date(maintenanceHistory[0].date);
                const daysSinceMaintenance = Math.floor((new Date() - lastMaintenance) / (1000 * 60 * 60 * 24));
                
                if (daysSinceMaintenance > 180) {
                    riskScore += 20;
                    factors.push(`آخرین تعمیرات: ${daysSinceMaintenance} روز پیش`);
                } else if (daysSinceMaintenance > 120) {
                    riskScore += 10;
                    factors.push(`آخرین تعمیرات: ${daysSinceMaintenance} روز پیش`);
                }
                
                if (maintenanceHistory.length > 3) {
                    riskScore += 15;
                    factors.push(`تعداد تعمیرات زیاد: ${maintenanceHistory.length} مورد`);
                }
            }
            
            if (datasheet && datasheet.mtbf) {
                const expectedDays = datasheet.mtbf;
                const daysSinceInstallation = datasheet.daysSinceInstallation || 365;
                
                if (daysSinceInstallation > expectedDays * 0.8) {
                    riskScore += 25;
                    factors.push(`نزدیک به پایان عمر مفید: ${Math.round((daysSinceInstallation / expectedDays) * 100)}%`);
                }
            }
            
            let riskLevel = 'low';
            if (riskScore >= 60) riskLevel = 'high';
            else if (riskScore >= 35) riskLevel = 'medium';
            
            return {
                probability: Math.min(riskScore, 95),
                riskLevel: riskLevel,
                factors: factors,
                predictedDays: riskLevel === 'high' ? Math.floor(Math.random() * 7) + 1 : 
                               riskLevel === 'medium' ? Math.floor(Math.random() * 14) + 7 : 
                               Math.floor(Math.random() * 30) + 15
            };
        }
        
        // بارگذاری پیش‌بینی‌های خرابی
        function loadFailurePredictions() {
            const container = document.getElementById('failure-predictions-container');
            if (!container) return;
            
            const predictions = [];
            
            equipmentDatabase.forEach(equipment => {
                const sensor = sensorData[equipment.name];
                const history = maintenanceHistory[equipment.name];
                const datasheet = {
                    mtbf: equipment.mtbf || 1095,
                    daysSinceInstallation: equipment.daysSinceInstallation || 730
                };
                
                const prediction = calculateFailureProbability(equipment.name, sensor, history, datasheet);
                
                if (prediction.probability > 20) {
                    predictions.push({
                        equipment: equipment,
                        prediction: prediction,
                        sensor: sensor,
                        history: history
                    });
                }
            });
            
            predictions.sort((a, b) => b.prediction.probability - a.prediction.probability);
            
            container.innerHTML = predictions.map(pred => {
                const riskClass = `prediction-card ${pred.prediction.riskLevel}-risk`;
                const riskColor = pred.prediction.riskLevel === 'high' ? 'text-red-600' : 
                                 pred.prediction.riskLevel === 'medium' ? 'text-yellow-600' : 'text-green-600';
                const riskBadge = pred.prediction.riskLevel === 'high' ? 'bg-red-100 text-red-700' : 
                                pred.prediction.riskLevel === 'medium' ? 'bg-yellow-100 text-yellow-700' : 'bg-green-100 text-green-700';
                
                return `
                    <div class="${riskClass}">
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex-1">
                                <h4 class="font-bold text-lg text-gray-900 mb-1">${pred.equipment.name}</h4>
                                <p class="text-sm text-gray-600 mb-2">${pred.equipment.section}</p>
                                <div class="flex items-center gap-2 mb-2">
                                    <span class="px-3 py-1 ${riskBadge} rounded-full text-xs font-bold">
                                        ${pred.prediction.riskLevel === 'high' ? 'ریسک بالا' : 
                                          pred.prediction.riskLevel === 'medium' ? 'ریسک متوسط' : 'ریسک پایین'}
                                    </span>
                                    <span class="text-sm font-bold ${riskColor}">
                                        ${pred.prediction.probability}% احتمال خرابی
                                    </span>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-2xl font-bold ${riskColor}">${pred.prediction.predictedDays}</div>
                                <div class="text-xs text-gray-500">روز تا خرابی</div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <div class="text-xs font-semibold text-gray-700 mb-2">عوامل ریسک:</div>
                            <ul class="space-y-1">
                                ${pred.prediction.factors.map(factor => `
                                    <li class="text-xs text-gray-600 flex items-center">
                                        <i class="fas fa-exclamation-circle text-red-500 ml-1 text-xs"></i>
                                        ${factor}
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                        
                        ${pred.sensor ? `
                            <div class="mb-3 p-2 bg-gray-50 rounded">
                                <div class="text-xs font-semibold text-gray-700 mb-1">داده‌های سنسور:</div>
                                <div class="grid grid-cols-2 gap-1 text-xs text-gray-600">
                                    <div>دما: ${pred.sensor.temperature}°C</div>
                                    <div>ارتعاش: ${pred.sensor.vibration} mm/s</div>
                                    <div>جریان: ${pred.sensor.current} A</div>
                                    <div>فشار: ${pred.sensor.pressure} bar</div>
                                </div>
                            </div>
                        ` : ''}
                        
                        ${pred.history && pred.history.length > 0 ? `
                            <div class="mb-3 p-2 bg-gray-50 rounded">
                                <div class="text-xs font-semibold text-gray-700 mb-1">تاریخچه تعمیرات:</div>
                                <div class="text-xs text-gray-600">
                                    آخرین تعمیرات: ${new Date(pred.history[0].date).toLocaleDateString('fa-IR')}
                                    <br>تعداد: ${pred.history.length} مورد
                                </div>
                            </div>
                        ` : ''}
                        
                        <div class="mb-2 p-2 bg-blue-50 rounded">
                            <div class="text-xs font-semibold text-gray-700 mb-1">دیتا شیت Final Book:</div>
                            <div class="text-xs text-gray-600">${pred.equipment.dataSheet || 'در دسترس نیست'}</div>
                        </div>
                        
                        <div class="flex gap-2 mt-3">
                            <button onclick="scheduleMaintenanceForEquipment('${pred.equipment.id}')" 
                                    class="flex-1 px-3 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg text-xs font-medium transition">
                                <i class="fas fa-calendar-plus ml-1"></i>
                                برنامه‌ریزی تعمیر
                            </button>
                            <button onclick="showPredictionDetailsForEquipment('${pred.equipment.id}')" 
                                    class="px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-xs font-medium transition">
                                <i class="fas fa-info-circle"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // متغیر برای ذخیره پیش‌بینی‌های فیلتر شده
        let filteredPredictions = [];
        
        function filterPredictions() {
            const riskFilter = document.getElementById('prediction-risk-filter')?.value || 'all';
            const timeFilter = parseInt(document.getElementById('prediction-time-filter')?.value || '7');
            
            // فیلتر کردن از آرایه failurePredictions
            filteredPredictions = failurePredictions.filter(pred => {
                const showByRisk = riskFilter === 'all' || pred.riskLevel === riskFilter;
                const showByTime = pred.daysRemaining <= timeFilter;
                return showByRisk && showByTime;
            });
            
            // استفاده از تابع loadFailurePredictions با داده‌های فیلتر شده
            const grid = document.getElementById('prediction-grid');
            if (!grid) return;
            
            // ذخیره موقت آرایه اصلی
            const originalPredictions = [...failurePredictions];
            
            // جایگزین موقت با داده‌های فیلتر شده
            failurePredictions.length = 0;
            failurePredictions.push(...filteredPredictions);
            
            // بارگذاری مجدد
            loadFailurePredictions();
            
            // بازگرداندن آرایه اصلی
            failurePredictions.length = 0;
            failurePredictions.push(...originalPredictions);
        }
        
        function refreshPredictions() {
            loadFailurePredictions();
        }
        
        function scheduleMaintenanceForEquipment(equipmentId) {
            const equipment = equipmentDatabase.find(eq => eq.id === equipmentId);
            if (equipment) {
                alert(`برنامه‌ریزی تعمیرات برای ${equipment.name}\n\nاین درخواست به سیستم تعمیرات ارسال شد.`);
            }
        }
        
        function showPredictionDetails() {
            const totalPredictions = failurePredictions.length;
            const highRisk = failurePredictions.filter(p => p.riskLevel === 'high').length;
            const mediumRisk = failurePredictions.filter(p => p.riskLevel === 'medium').length;
            const lowRisk = failurePredictions.filter(p => p.riskLevel === 'low').length;
            
            alert(`جزئیات تحلیل پیش‌بینی خرابی:\n\n` +
                  `تعداد کل پیش‌بینی‌ها: ${totalPredictions}\n` +
                  `ریسک بالا: ${highRisk} مورد\n` +
                  `ریسک متوسط: ${mediumRisk} مورد\n` +
                  `ریسک پایین: ${lowRisk} مورد\n\n` +
                  `سیستم پیش‌بینی خرابی بر اساس تحلیل داده‌های سنسورها، تاریخچه تعمیرات و دیتا شیت تجهیزات کار می‌کند.`);
        }
        
        function showPredictionDetailsForEquipment(equipmentId) {
            const equipment = equipmentDatabase.find(eq => eq.id === equipmentId);
            if (equipment) {
                const sensor = sensorData[equipment.name];
                const history = maintenanceHistory[equipment.name];
                
                let details = `جزئیات پیش‌بینی خرابی: ${equipment.name}\n\n`;
                details += `بخش: ${equipment.section}\n`;
                details += `وضعیت: ${equipment.status}\n\n`;
                
                if (sensor) {
                    details += `داده‌های سنسور:\n`;
                    details += `- دما: ${sensor.temperature}°C\n`;
                    details += `- ارتعاش: ${sensor.vibration} mm/s\n`;
                    details += `- جریان: ${sensor.current} A\n`;
                    details += `- فشار: ${sensor.pressure} bar\n`;
                    details += `- آخرین به‌روزرسانی: ${sensor.lastUpdate}\n\n`;
                }
                
                if (history && history.length > 0) {
                    details += `تاریخچه تعمیرات:\n`;
                    history.forEach((maint, idx) => {
                        details += `${idx + 1}. ${maint.type} - ${maint.date} (${maint.duration} روز، ${maint.cost.toLocaleString()} تومان)\n`;
                    });
                    details += `\n`;
                }
                
                details += `دیتا شیت: ${equipment.dataSheet || 'در دسترس نیست'}\n`;
                
                alert(details);
            }
        }
        
        function showPredictionDetails() {
            alert('سیستم پیش‌بینی خرابی بر اساس:\n\n' +
                  '1. تحلیل داده‌های سنسورها (دما، ارتعاش، جریان، فشار)\n' +
                  '2. تاریخچه تعمیرات و نگهداری\n' +
                  '3. اطلاعات دیتا شیت Final Book (MTBF، عمر مفید)\n\n' +
                  'این سیستم به صورت مداوم داده‌ها را تحلیل می‌کند و احتمال خرابی را محاسبه می‌کند.');
        }

        // ========== سیستم Marketplace - سبک Zoomit ==========
        
        // بانک اطلاعاتی تجهیزات بازار (بر اساس Final Book)
        const marketplaceProducts = [
            // تجهیزات مکانیکی
            {
                id: 'MP-001',
                name: 'Loss in Weight Feeder',
                brand: 'Schenck Process',
                model: 'LIW-01',
                category: 'mechanical',
                price: { min: 280, max: 350 },
                unit: 'میلیون تومان',
                suppliers: 22,
                rating: 4.8,
                image: 'fas fa-weight',
                description: 'فیدر وزن‌سنج با دقت بالا برای دوزینگ مواد',
                specifications: {
                    'ظرفیت': '۵۰ تن/ساعت',
                    'دقت': '±۰.۵٪',
                    'قدرت': '۵.۵ kW'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/01 Dosing and Mixing/02 Loss in Weight Feeder',
                delivery: '۲-۳ هفته',
                warranty: '۲۴ ماه'
            },
            {
                id: 'MP-002',
                name: 'Belt Weigher',
                brand: 'Schenck Process',
                model: 'BW-01',
                category: 'mechanical',
                price: { min: 320, max: 400 },
                unit: 'میلیون تومان',
                suppliers: 25,
                rating: 4.7,
                image: 'fas fa-conveyor-belt',
                description: 'ترازوی نوار نقاله برای اندازه‌گیری جریان مواد',
                specifications: {
                    'ظرفیت': '۱۰۰ تن/ساعت',
                    'دقت': '±۰.۲٪',
                    'عرض نوار': '۱۲۰۰ mm'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/01 Dosing and Mixing/04 Belt Weighers + Dosing Belt Weighers',
                delivery: '۳-۴ هفته',
                warranty: '۲۴ ماه'
            },
            {
                id: 'MP-003',
                name: 'Pelletizing Disc',
                brand: 'Outotec',
                model: 'PD-01',
                category: 'mechanical',
                price: { min: 2500, max: 3200 },
                unit: 'میلیون تومان',
                suppliers: 18,
                rating: 4.9,
                image: 'fas fa-circle',
                description: 'دیسک گندله‌سازی با قطر ۷.۵ متر',
                specifications: {
                    'قطر دیسک': '۷.۵ متر',
                    'ظرفیت': '۵۰۰ تن/ساعت',
                    'قدرت': '۱۶۰ kW',
                    'زاویه': '۴۵ درجه'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/02 Green Peletizing/03 Pelletizing Discs',
                delivery: '۱۶-۲۰ هفته',
                warranty: '۳۶ ماه'
            },
            {
                id: 'MP-004',
                name: 'Indurating Machine',
                brand: 'Outotec',
                model: 'IM-01',
                category: 'mechanical',
                price: { min: 15000, max: 20000 },
                unit: 'میلیون تومان',
                suppliers: 15,
                rating: 4.8,
                image: 'fas fa-fire',
                description: 'کوره ایندوریت با ظرفیت ۵ میلیون تن/سال',
                specifications: {
                    'طول': '۱۵۰ متر',
                    'عرض': '۴.۵ متر',
                    'ظرفیت': '۵ میلیون تن/سال',
                    'حداکثر دما': '۱۳۵۰°C',
                    'قدرت': '۲۵۰۰ kW'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/03 Indurating Machine/04 Indurating Machine',
                delivery: '۴۰-۵۲ هفته',
                warranty: '۶۰ ماه'
            },
            {
                id: 'MP-005',
                name: 'Updraft Drying Fan',
                brand: 'Howden',
                model: 'UDF-01',
                category: 'mechanical',
                price: { min: 1800, max: 2400 },
                unit: 'میلیون تومان',
                suppliers: 20,
                rating: 4.7,
                image: 'fas fa-fan',
                description: 'فن خشک‌کنی با جریان ۵۰۰,۰۰۰ m³/h',
                specifications: {
                    'جریان': '۵۰۰,۰۰۰ m³/h',
                    'فشار': '۸ kPa',
                    'قدرت': '۱۵۰۰ kW',
                    'دما': '۳۵۰°C'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/05 Process Fans and Ducts/02 Updrought Drying Fan',
                delivery: '۲۰-۲۴ هفته',
                warranty: '۳۶ ماه'
            },
            {
                id: 'MP-006',
                name: 'ESP Windbox Exhaust Gas',
                brand: 'FLSmidth',
                model: 'ESP-01',
                category: 'mechanical',
                price: { min: 3500, max: 4500 },
                unit: 'میلیون تومان',
                suppliers: 26,
                rating: 4.6,
                image: 'fas fa-wind',
                description: 'سیستم غبارگیری الکترواستاتیک',
                specifications: {
                    'راندمان': '۹۹.۹٪',
                    'جریان': '۳۰۰,۰۰۰ m³/h',
                    'قدرت': '۸۰۰ kW'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/09 Process Gas Dedusting/01 ESP Windbox Exhaust Gas 1',
                delivery: '۲۴-۳۰ هفته',
                warranty: '۳۶ ماه'
            },
            {
                id: 'MP-007',
                name: 'Thickener with Rake',
                brand: 'Outotec',
                model: 'TH-01',
                category: 'mechanical',
                price: { min: 1200, max: 1600 },
                unit: 'میلیون تومان',
                suppliers: 18,
                rating: 4.5,
                image: 'fas fa-water',
                description: 'تغلیظ‌کننده با مکانیزم ریک',
                specifications: {
                    'قطر': '۴۵ متر',
                    'ظرفیت': '۲۰۰۰ m³/h',
                    'قدرت': '۳۷ kW'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/11 Process Water System/01 Thickener with Rake Mechanism',
                delivery: '۱۸-۲۲ هفته',
                warranty: '۲۴ ماه'
            },
            {
                id: 'MP-008',
                name: 'Membrane Filter Press',
                brand: 'Outotec',
                model: 'MFP-01',
                category: 'mechanical',
                price: { min: 1800, max: 2200 },
                unit: 'میلیون تومان',
                suppliers: 17,
                rating: 4.7,
                image: 'fas fa-filter',
                description: 'فیلتر پرس ممبرانی برای تصفیه آب',
                specifications: {
                    'سطح فیلتر': '۸۰۰ m²',
                    'ظرفیت': '۱۵۰ m³/h',
                    'فشار': '۱۶ bar'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/12 Filtration/01 Membrane Filter Press, including',
                delivery: '۲۰-۲۶ هفته',
                warranty: '۳۶ ماه'
            },
            
            // تجهیزات الکتریکی
            {
                id: 'MP-009',
                name: 'Distribution Transformer',
                brand: 'ABB',
                model: 'DT-1000',
                category: 'electrical',
                price: { min: 1200, max: 1800 },
                unit: 'میلیون تومان',
                suppliers: 22,
                rating: 4.8,
                image: 'fas fa-plug',
                description: 'ترانسفورماتور توزیع ۱۰۰۰ kVA',
                specifications: {
                    'ظرفیت': '۱۰۰۰ kVA',
                    'ولتاژ اولیه': '۲۰ kV',
                    'ولتاژ ثانویه': '۴۰۰ V'
                },
                dataSheet: 'GZP Final Book/6 Electrical Equipment/02 Supply Documentation/01 Distribution Transformers',
                delivery: '۱۶-۲۰ هفته',
                warranty: '۳۶ ماه'
            },
            {
                id: 'MP-010',
                name: 'MV Switchgear',
                brand: 'Siemens',
                model: 'MV-SG-01',
                category: 'electrical',
                price: { min: 800, max: 1200 },
                unit: 'میلیون تومان',
                suppliers: 25,
                rating: 4.9,
                image: 'fas fa-bolt',
                description: 'تابلوی توزیع فشار متوسط',
                specifications: {
                    'ولتاژ': '۲۰ kV',
                    'جریان': '۶۳۰ A',
                    'نوع': 'Metal Clad'
                },
                dataSheet: 'GZP Final Book/6 Electrical Equipment/02 Supply Documentation/02 MV Switchgear',
                delivery: '۱۲-۱۶ هفته',
                warranty: '۲۴ ماه'
            },
            {
                id: 'MP-011',
                name: 'MCC - LV Switchgear',
                brand: 'Siemens',
                model: 'MCC-01',
                category: 'electrical',
                price: { min: 600, max: 900 },
                unit: 'میلیون تومان',
                suppliers: 28,
                rating: 4.7,
                image: 'fas fa-server',
                description: 'تابلوی کنترل موتور فشار پایین',
                specifications: {
                    'ولتاژ': '۴۰۰ V',
                    'جریان': '۱۶۰۰ A',
                    'تعداد خروجی': '۲۰'
                },
                dataSheet: 'GZP Final Book/6 Electrical Equipment/02 Supply Documentation/03 MCC - LV Switchgear',
                delivery: '۱۰-۱۴ هفته',
                warranty: '۲۴ ماه'
            },
            {
                id: 'MP-012',
                name: 'LV Motor',
                brand: 'Siemens',
                model: 'SIMOTICS 1LE0',
                category: 'electrical',
                price: { min: 180, max: 250 },
                unit: 'میلیون تومان',
                suppliers: 30,
                rating: 4.8,
                image: 'fas fa-cog',
                description: 'الکتروموتور فشار پایین Siemens',
                specifications: {
                    'قدرت': '۱۵-۷۵ kW',
                    'ولتاژ': '۴۰۰ V',
                    'فرکانس': '۵۰ Hz'
                },
                dataSheet: 'GZP Final Book/6 Electrical Equipment/02 Supply Documentation/05 LV Motors',
                delivery: '۴-۶ هفته',
                warranty: '۲۴ ماه'
            },
            {
                id: 'MP-013',
                name: 'Emergency Diesel Generator',
                brand: 'Cummins',
                model: 'EDG-500',
                category: 'electrical',
                price: { min: 2500, max: 3200 },
                unit: 'میلیون تومان',
                suppliers: 18,
                rating: 4.6,
                image: 'fas fa-power-off',
                description: 'ژنراتور دیزلی اضطراری ۵۰۰ kVA',
                specifications: {
                    'ظرفیت': '۵۰۰ kVA',
                    'سوخت': 'دیزل',
                    'ولتاژ': '۴۰۰ V'
                },
                dataSheet: 'GZP Final Book/6 Electrical Equipment/02 Supply Documentation/06 Emergency Diesel Generator',
                delivery: '۲۰-۲۶ هفته',
                warranty: '۳۶ ماه'
            },
            {
                id: 'MP-014',
                name: 'UPS Distribution Panel',
                brand: 'APC',
                model: 'UPS-DP-01',
                category: 'electrical',
                price: { min: 400, max: 600 },
                unit: 'میلیون تومان',
                suppliers: 20,
                rating: 4.5,
                image: 'fas fa-battery-full',
                description: 'تابلوی توزیع UPS',
                specifications: {
                    'ظرفیت': '۱۰۰ kVA',
                    'ولتاژ': '۴۰۰ V',
                    'زمان پشتیبانی': '۳۰ دقیقه'
                },
                dataSheet: 'GZP Final Book/6 Electrical Equipment/02 Supply Documentation/07 UPS Distribution Panel',
                delivery: '۸-۱۲ هفته',
                warranty: '۲۴ ماه'
            },
            
            // ابزار دقیق
            {
                id: 'MP-015',
                name: 'Pressure Transmitter',
                brand: 'Endress+Hauser',
                model: 'Cerabar S',
                category: 'instrumentation',
                price: { min: 45, max: 65 },
                unit: 'میلیون تومان',
                suppliers: 35,
                rating: 4.8,
                image: 'fas fa-tachometer-alt',
                description: 'ترانسمیتر فشار با دقت بالا',
                specifications: {
                    'رنج': '۰-۱۰ bar',
                    'دقت': '±۰.۰۷۵٪',
                    'خروجی': '4-20 mA'
                },
                dataSheet: 'GZP Final Book/7 Instrumentation/02 Supply Documetation',
                delivery: '۲-۳ هفته',
                warranty: '۲۴ ماه'
            },
            {
                id: 'MP-016',
                name: 'Temperature Transmitter',
                brand: 'Endress+Hauser',
                model: 'iTEMP TMT162',
                category: 'instrumentation',
                price: { min: 35, max: 50 },
                unit: 'میلیون تومان',
                suppliers: 32,
                rating: 4.7,
                image: 'fas fa-thermometer-half',
                description: 'ترانسمیتر دما با سنسور RTD',
                specifications: {
                    'رنج': '-۵۰ تا ۲۰۰°C',
                    'دقت': '±۰.۱°C',
                    'خروجی': '4-20 mA'
                },
                dataSheet: 'GZP Final Book/7 Instrumentation/02 Supply Documetation',
                delivery: '۲-۳ هفته',
                warranty: '۲۴ ماه'
            },
            {
                id: 'MP-017',
                name: 'Electromagnetic Flowmeter',
                brand: 'Endress+Hauser',
                model: 'Promag 50',
                category: 'instrumentation',
                price: { min: 85, max: 120 },
                unit: 'میلیون تومان',
                suppliers: 28,
                rating: 4.9,
                image: 'fas fa-water',
                description: 'فلومتر الکترومغناطیسی برای مایعات',
                specifications: {
                    'قطر': 'DN50-DN600',
                    'دقت': '±۰.۲٪',
                    'خروجی': '4-20 mA + HART'
                },
                dataSheet: 'GZP Final Book/7 Instrumentation/02 Supply Documetation',
                delivery: '۳-۴ هفته',
                warranty: '۲۴ ماه'
            },
            {
                id: 'MP-018',
                name: 'Level Transmitter',
                brand: 'Vega',
                model: 'VEGAPULS 64',
                category: 'instrumentation',
                price: { min: 55, max: 75 },
                unit: 'میلیون تومان',
                suppliers: 25,
                rating: 4.6,
                image: 'fas fa-ruler-vertical',
                description: 'ترانسمیتر سطح راداری',
                specifications: {
                    'رنج': '۰-۳۰ متر',
                    'دقت': '±۳ mm',
                    'فرکانس': '۸۰ GHz'
                },
                dataSheet: 'GZP Final Book/7 Instrumentation/02 Supply Documetation',
                delivery: '۳-۴ هفته',
                warranty: '۲۴ ماه'
            },
            
            // اتوماسیون
            {
                id: 'MP-019',
                name: 'PLC SIMATIC S7-1500',
                brand: 'Siemens',
                model: 'CPU 1516-3 PN/DP',
                category: 'automation',
                price: { min: 220, max: 280 },
                unit: 'میلیون تومان',
                suppliers: 24,
                rating: 4.9,
                image: 'fas fa-microchip',
                description: 'کنترلر منطقی قابل برنامه‌ریزی',
                specifications: {
                    'حافظه': '۱ MB',
                    'ورودی/خروجی': '۱۰۲۴/۱۰۲۴',
                    'پروتکل': 'PROFINET'
                },
                dataSheet: 'GZP Final Book/6 Electrical Equipment/02 Supply Documentation/04 Power Drive System for Process Gas Fan',
                delivery: '۶-۸ هفته',
                warranty: '۳۶ ماه'
            },
            {
                id: 'MP-020',
                name: 'HMI Industrial Panel',
                brand: 'Siemens',
                model: 'TP1500 Comfort',
                category: 'automation',
                price: { min: 150, max: 190 },
                unit: 'میلیون تومان',
                suppliers: 22,
                rating: 4.7,
                image: 'fas fa-tv',
                description: 'پنل اپراتوری ۱۵ اینچ',
                specifications: {
                    'اندازه صفحه': '۱۵ اینچ',
                    'رزولوشن': '۱۹۲۰x1080',
                    'پروتکل': 'PROFINET'
                },
                dataSheet: 'GZP Final Book/6 Electrical Equipment/02 Supply Documentation/04 Power Drive System for Process Gas Fan',
                delivery: '۴-۶ هفته',
                warranty: '۲۴ ماه'
            },
            {
                id: 'MP-021',
                name: 'Variable Frequency Drive',
                brand: 'Siemens',
                model: 'SINAMICS G120',
                category: 'automation',
                price: { min: 350, max: 420 },
                unit: 'میلیون تومان',
                suppliers: 26,
                rating: 4.8,
                image: 'fas fa-sliders-h',
                description: 'درایو فرکانس متغیر برای موتورها',
                specifications: {
                    'قدرت': '۰.۳۷-۲۵۰ kW',
                    'ولتاژ': '۳۸۰-۴۸۰ V',
                    'کنترل': 'Vector Control'
                },
                dataSheet: 'GZP Final Book/6 Electrical Equipment/02 Supply Documentation/04 Power Drive System for Process Gas Fan',
                delivery: '۸-۱۰ هفته',
                warranty: '۳۶ ماه'
            },
            
            // ایمنی
            {
                id: 'MP-024',
                name: 'Safety Instrumented System',
                brand: 'Siemens',
                model: 'SIS-01',
                category: 'safety',
                price: { min: 1500, max: 2000 },
                unit: 'میلیون تومان',
                suppliers: 18,
                rating: 4.9,
                image: 'fas fa-shield-alt',
                description: 'سیستم ایمنی ابزاری SIL3',
                specifications: {
                    'سطح ایمنی': 'SIL3',
                    'MTBF': '>۱۰ سال',
                    'پروتکل': 'PROFIsafe'
                },
                dataSheet: 'GZP Final Book/2 Safety/01 Functional Safety',
                delivery: '۱۶-۲۰ هفته',
                warranty: '۶۰ ماه'
            },
            
            // تجهیزات مکانیکی از Final Book - Dosing & Mixing
            {
                id: 'MP-025',
                name: 'Loss in Weight Feeder',
                brand: 'Schenck Process',
                model: 'LIW-01',
                category: 'mechanical',
                price: { min: 380, max: 520 },
                unit: 'میلیون تومان',
                suppliers: 18,
                rating: 4.7,
                image: 'fas fa-flask',
                description: 'فیدر دوزینگ با سیستم توزین Loss in Weight',
                specifications: {
                    'ظرفیت': '۵۰ تن/ساعت',
                    'دقت': '±۰.۵٪',
                    'قدرت': '۵.۵ kW'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/01 Dosing and Mixing/02 Loss in Weight Feeder',
                delivery: '۱۰-۱۴ هفته',
                warranty: '۲۴ ماه'
            },
            {
                id: 'MP-026',
                name: 'Belt Weigher',
                brand: 'Schenck Process',
                model: 'BW-01',
                category: 'mechanical',
                price: { min: 280, max: 380 },
                unit: 'میلیون تومان',
                suppliers: 22,
                rating: 4.6,
                image: 'fas fa-weight',
                description: 'توزین نوار نقاله',
                specifications: {
                    'ظرفیت': '۱۰۰ تن/ساعت',
                    'دقت': '±۰.۲٪',
                    'عرض نوار': '۱۲۰۰ mm'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/01 Dosing and Mixing/04 Belt Weighers + Dosing Belt Weighers',
                delivery: '۸-۱۲ هفته',
                warranty: '۲۴ ماه'
            },
            {
                id: 'MP-027',
                name: 'Mixer Drum Type',
                brand: 'Outotec',
                model: 'MIX-01',
                category: 'mechanical',
                price: { min: 320, max: 450 },
                unit: 'میلیون تومان',
                suppliers: 26,
                rating: 4.8,
                image: 'fas fa-cog',
                description: 'میکسر درام برای مخلوط‌سازی',
                specifications: {
                    'ظرفیت': '۱۵۰ تن/ساعت',
                    'قطر درام': '۳.۵ متر',
                    'قدرت': '۷۵ kW'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/01 Dosing and Mixing/06 Mixers Drum Type',
                delivery: '۱۲-۱۶ هفته',
                warranty: '۳۶ ماه'
            },
            {
                id: 'MP-028',
                name: 'Air Blaster Systems',
                brand: 'Martin Engineering',
                model: 'AB-01',
                category: 'mechanical',
                price: { min: 45, max: 75 },
                unit: 'میلیون تومان',
                suppliers: 25,
                rating: 4.5,
                image: 'fas fa-wind',
                description: 'سیستم انفجار هوای فشرده برای تمیزکاری',
                specifications: {
                    'فشار': '۸ bar',
                    'حجم مخزن': '۵۰ لیتر',
                    'نوع': 'پنوماتیک'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/01 Dosing and Mixing/01 Air Blaster Systems',
                delivery: '۴-۶ هفته',
                warranty: '۱۲ ماه'
            },
            
            // Green Pelletizing
            {
                id: 'MP-029',
                name: 'Pelletizing Discs',
                brand: 'Outotec',
                model: 'PD-01',
                category: 'mechanical',
                price: { min: 950, max: 1300 },
                unit: 'میلیون تومان',
                suppliers: 22,
                rating: 4.9,
                image: 'fas fa-circle-notch',
                description: 'دیسک گندله‌سازی',
                specifications: {
                    'قطر دیسک': '۷.۵ متر',
                    'ظرفیت': '۵۰۰ تن/ساعت',
                    'قدرت': '۱۶۰ kW',
                    'زاویه': '۴۵ درجه'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/02 Green Peletizing/03 Pelletizing Discs',
                delivery: '۱۶-۲۰ هفته',
                warranty: '۳۶ ماه'
            },
            {
                id: 'MP-030',
                name: 'Single Deck Roller Screen',
                brand: 'Outotec',
                model: 'RS-01',
                category: 'mechanical',
                price: { min: 480, max: 680 },
                unit: 'میلیون تومان',
                suppliers: 24,
                rating: 4.7,
                image: 'fas fa-th',
                description: 'غربال تک‌طبقه رولری',
                specifications: {
                    'سطح غربال': '۱۲ متر مربع',
                    'ظرفیت': '۵۰۰ تن/ساعت',
                    'قدرت': '۳۷ kW'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/02 Green Peletizing/05 Single Deck Roller Screen and Carriage',
                delivery: '۱۴-۱۸ هفته',
                warranty: '۳۶ ماه'
            },
            
            // Indurating Machine
            {
                id: 'MP-031',
                name: 'Indurating Machine',
                brand: 'Outotec',
                model: 'IM-01',
                category: 'mechanical',
                price: { min: 28000, max: 38000 },
                unit: 'میلیون تومان',
                suppliers: 15,
                rating: 4.9,
                image: 'fas fa-fire',
                description: 'کوره ایندوریت برای پخت گندله',
                specifications: {
                    'طول': '۱۵۰ متر',
                    'عرض': '۴.۵ متر',
                    'ظرفیت': '۵ میلیون تن/سال',
                    'حداکثر دما': '۱۳۵۰°C',
                    'قدرت': '۲۵۰۰ kW'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/03 Indurating Machine/04 Indurating Machine',
                delivery: '۴۸-۵۶ هفته',
                warranty: '۶۰ ماه'
            },
            {
                id: 'MP-032',
                name: 'Reciprocating Head',
                brand: 'Outotec',
                model: 'RH-01',
                category: 'mechanical',
                price: { min: 1200, max: 1800 },
                unit: 'میلیون تومان',
                suppliers: 20,
                rating: 4.8,
                image: 'fas fa-exchange-alt',
                description: 'سر رفت و برگشتی با درایو هیدرولیک',
                specifications: {
                    'نوع': 'Oil Hydraulic Drive',
                    'طول کورس': '۴.۵ متر',
                    'قدرت': '۱۸۵ kW'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/03 Indurating Machine/01 Reciproacting head with oil hydraulic drive',
                delivery: '۲۰-۲۶ هفته',
                warranty: '۳۶ ماه'
            },
            
            // Process Fans
            {
                id: 'MP-033',
                name: 'Updraft Drying Fan',
                brand: 'Howden',
                model: 'UDF-01',
                category: 'mechanical',
                price: { min: 1900, max: 2600 },
                unit: 'میلیون تومان',
                suppliers: 18,
                rating: 4.8,
                image: 'fas fa-wind',
                description: 'فن خشک‌کنی جریان رو به بالا',
                specifications: {
                    'دبی جریان': '۵۰۰,۰۰۰ m³/h',
                    'فشار': '۸ kPa',
                    'قدرت': '۱۵۰۰ kW',
                    'دما': '۳۵۰°C'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/05 Process Fans and Ducts/02 Updrought Drying Fan',
                delivery: '۱۸-۲۴ هفته',
                warranty: '۳۶ ماه'
            },
            {
                id: 'MP-034',
                name: 'Hood Exhaust Gas Fan',
                brand: 'Howden',
                model: 'HEGF-01',
                category: 'mechanical',
                price: { min: 1600, max: 2200 },
                unit: 'میلیون تومان',
                suppliers: 18,
                rating: 4.7,
                image: 'fas fa-wind',
                description: 'فن خروج گاز هود',
                specifications: {
                    'دبی جریان': '۴۰۰,۰۰۰ m³/h',
                    'فشار': '۶ kPa',
                    'قدرت': '۱۲۰۰ kW',
                    'دما': '۳۰۰°C'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/05 Process Fans and Ducts/06 Hood Exhaust Gas Fan',
                delivery: '۱۶-۲۲ هفته',
                warranty: '۳۶ ماه'
            },
            {
                id: 'MP-035',
                name: 'Cooling Air Fans',
                brand: 'Howden',
                model: 'CAF-01',
                category: 'mechanical',
                price: { min: 850, max: 1200 },
                unit: 'میلیون تومان',
                suppliers: 22,
                rating: 4.6,
                image: 'fas fa-wind',
                description: 'فن‌های خنک‌کننده هوا',
                specifications: {
                    'دبی جریان': '۲۰۰,۰۰۰ m³/h',
                    'فشار': '۴ kPa',
                    'قدرت': '۶۵۰ kW'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/05 Process Fans and Ducts/01 Cooling Air Fans',
                delivery: '۱۲-۱۶ هفته',
                warranty: '۳۶ ماه'
            },
            
            // Dedusting Systems
            {
                id: 'MP-036',
                name: 'ESP Windbox Exhaust Gas',
                brand: 'FLSmidth',
                model: 'ESP-01',
                category: 'mechanical',
                price: { min: 5500, max: 7800 },
                unit: 'میلیون تومان',
                suppliers: 18,
                rating: 4.9,
                image: 'fas fa-filter',
                description: 'سیستم الکترواستاتیک غبارگیری',
                specifications: {
                    'راندمان': '۹۹.۹٪',
                    'دبی جریان': '۳۰۰,۰۰۰ m³/h',
                    'قدرت': '۸۰۰ kW'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/09 Process Gas Dedusting/01 ESP Windbox Exhaust Gas 1',
                delivery: '۳۲-۴۰ هفته',
                warranty: '۶۰ ماه'
            },
            
            // Water Systems
            {
                id: 'MP-037',
                name: 'Thickener with Rake Mechanism',
                brand: 'Outotec',
                model: 'TH-01',
                category: 'mechanical',
                price: { min: 1350, max: 1900 },
                unit: 'میلیون تومان',
                suppliers: 24,
                rating: 4.7,
                image: 'fas fa-water',
                description: 'تخلیص‌کن با مکانیزم ریک',
                specifications: {
                    'قطر': '۴۵ متر',
                    'ظرفیت': '۲۰۰۰ m³/h',
                    'قدرت': '۳۷ kW'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/11 Process Water System/01 Thickener with Rake Mechanism',
                delivery: '۲۰-۲۶ هفته',
                warranty: '۳۶ ماه'
            },
            {
                id: 'MP-038',
                name: 'Membrane Filter Press',
                brand: 'Outotec',
                model: 'MFP-01',
                category: 'mechanical',
                price: { min: 3000, max: 4000 },
                unit: 'میلیون تومان',
                suppliers: 22,
                rating: 4.8,
                image: 'fas fa-filter',
                description: 'فیلتر پرس ممبرانی',
                specifications: {
                    'سطح فیلتر': '۸۰۰ m²',
                    'ظرفیت': '۱۵۰ m³/h',
                    'فشار': '۱۶ bar'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/12 Filtration/01 Membrane Filter Press, including',
                delivery: '۲۴-۳۰ هفته',
                warranty: '۳۶ ماه'
            },
            
            // Screening & Transport
            {
                id: 'MP-039',
                name: 'Product Screen Sizer',
                brand: 'Outotec',
                model: 'PS-01',
                category: 'mechanical',
                price: { min: 520, max: 720 },
                unit: 'میلیون تومان',
                suppliers: 17,
                rating: 4.6,
                image: 'fas fa-th',
                description: 'غربال اندازه‌بندی محصول',
                specifications: {
                    'سطح غربال': '۲۰ متر مربع',
                    'ظرفیت': '۵۰۰ تن/ساعت',
                    'قدرت': '۵۵ kW'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/06 Pellet Screening and Transport/01 Product Screens - Sizer',
                delivery: '۱۴-۱۸ هفته',
                warranty: '۳۶ ماه'
            },
            
            // تجهیزات بیشتر از Final Book - Dosing & Mixing
            {
                id: 'MP-040',
                name: 'Level Measuring System',
                brand: 'Vega',
                model: 'LMS-01',
                category: 'mechanical',
                price: { min: 180, max: 280 },
                unit: 'میلیون تومان',
                suppliers: 22,
                rating: 4.7,
                image: 'fas fa-ruler-vertical',
                description: 'سیستم اندازه‌گیری سطح',
                specifications: {
                    'نوع': 'راداری',
                    'رنج': '۰-۳۰ متر',
                    'دقت': '±۳ mm'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/01 Dosing and Mixing/03 Level Measuring System',
                delivery: '۶-۱۰ هفته',
                warranty: '۲۴ ماه'
            },
            {
                id: 'MP-041',
                name: 'Wet Scrubber System',
                brand: 'FLSmidth',
                model: 'WSS-01',
                category: 'mechanical',
                price: { min: 1200, max: 1800 },
                unit: 'میلیون تومان',
                suppliers: 16,
                rating: 4.6,
                image: 'fas fa-spray-can',
                description: 'سیستم اسکرابر مرطوب',
                specifications: {
                    'دبی جریان': '۱۵۰,۰۰۰ m³/h',
                    'راندمان': '۹۵٪',
                    'قدرت': '۲۲۰ kW'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/01 Dosing and Mixing/05 Wet Scrubber System (Scrubber + Fan)',
                delivery: '۲۰-۲۶ هفته',
                warranty: '۳۶ ماه'
            },
            
            // Indurating Hood
            {
                id: 'MP-042',
                name: 'Indurating Hood',
                brand: 'Outotec',
                model: 'IH-01',
                category: 'mechanical',
                price: { min: 15000, max: 22000 },
                unit: 'میلیون تومان',
                suppliers: 8,
                rating: 4.9,
                image: 'fas fa-fire',
                description: 'هود کوره ایندوریت',
                specifications: {
                    'طول': '۱۵۰ متر',
                    'عرض': '۴.۵ متر',
                    'حداکثر دما': '۱۳۵۰°C',
                    'نوع': 'Recuperative'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/04 Indurating Hood/00 Indurating Hood',
                delivery: '۴۰-۵۲ هفته',
                warranty: '۶۰ ماه'
            },
            {
                id: 'MP-043',
                name: 'Dual Fuel Burner',
                brand: 'Weishaupt',
                model: 'DFB-01',
                category: 'mechanical',
                price: { min: 650, max: 900 },
                unit: 'میلیون تومان',
                suppliers: 14,
                rating: 4.7,
                image: 'fas fa-fire',
                description: 'برنر دوگانه‌سوز (گاز/گازوئیل)',
                specifications: {
                    'ظرفیت': '۵۰ MW',
                    'سوخت': 'گاز طبیعی / گازوئیل',
                    'راندمان': '۹۵٪'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/04 Indurating Hood/03 Dual Fuel Burner',
                delivery: '۱۶-۲۲ هفته',
                warranty: '۳۶ ماه'
            },
            {
                id: 'MP-044',
                name: 'GPRS & Flow Control Stations',
                brand: 'Emerson',
                model: 'GPRS-01',
                category: 'mechanical',
                price: { min: 650, max: 900 },
                unit: 'میلیون تومان',
                suppliers: 14,
                rating: 4.6,
                image: 'fas fa-sliders-h',
                description: 'ایستگاه‌های کنترل جریان GPRS',
                specifications: {
                    'نوع': 'Diesel & NG & BMS',
                    'کنترل': 'اتوماتیک',
                    'دقت': '±۱٪'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/04 Indurating Hood/02 GPRS & Flow Control Stations for Diesel & NG & BMS',
                delivery: '۱۲-۱۸ هفته',
                warranty: '۲۴ ماه'
            },
            
            // Process Fans - بیشتر
            {
                id: 'MP-045',
                name: 'Windbox Recuperation Fan',
                brand: 'Howden',
                model: 'WRF-01',
                category: 'mechanical',
                price: { min: 1400, max: 1900 },
                unit: 'میلیون تومان',
                suppliers: 18,
                rating: 4.7,
                image: 'fas fa-wind',
                description: 'فن بازیابی ویندباکس',
                specifications: {
                    'دبی جریان': '۳۵۰,۰۰۰ m³/h',
                    'فشار': '۵.۵ kPa',
                    'قدرت': '۱۰۰۰ kW'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/05 Process Fans and Ducts/03 Windbox Recuperation Fan',
                delivery: '۱۶-۲۲ هفته',
                warranty: '۳۶ ماه'
            },
            {
                id: 'MP-046',
                name: 'Windbox Exhaust Gas Fan 1',
                brand: 'Howden',
                model: 'WEGF1-01',
                category: 'mechanical',
                price: { min: 1800, max: 2400 },
                unit: 'میلیون تومان',
                suppliers: 18,
                rating: 4.8,
                image: 'fas fa-wind',
                description: 'فن خروج گاز ویندباکس ۱',
                specifications: {
                    'دبی جریان': '۴۵۰,۰۰۰ m³/h',
                    'فشار': '۷ kPa',
                    'قدرت': '۱۳۵۰ kW',
                    'دما': '۳۵۰°C'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/05 Process Fans and Ducts/04 Windbox Exhaust Gas Fan 1',
                delivery: '۱۸-۲۴ هفته',
                warranty: '۳۶ ماه'
            },
            {
                id: 'MP-047',
                name: 'Windbox Exhaust Gas Fan 2',
                brand: 'Howden',
                model: 'WEGF2-01',
                category: 'mechanical',
                price: { min: 1800, max: 2400 },
                unit: 'میلیون تومان',
                suppliers: 18,
                rating: 4.8,
                image: 'fas fa-wind',
                description: 'فن خروج گاز ویندباکس ۲',
                specifications: {
                    'دبی جریان': '۴۵۰,۰۰۰ m³/h',
                    'فشار': '۷ kPa',
                    'قدرت': '۱۳۵۰ kW',
                    'دما': '۳۵۰°C'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/05 Process Fans and Ducts/05 Windbox Exhaust Gas Fan 2',
                delivery: '۱۸-۲۴ هفته',
                warranty: '۳۶ ماه'
            },
            
            // Dedusting - بیشتر
            {
                id: 'MP-048',
                name: 'ESP Windbox Exhaust Gas 2',
                brand: 'FLSmidth',
                model: 'ESP2-01',
                category: 'mechanical',
                price: { min: 5500, max: 7800 },
                unit: 'میلیون تومان',
                suppliers: 18,
                rating: 4.9,
                image: 'fas fa-filter',
                description: 'سیستم الکترواستاتیک غبارگیری ویندباکس ۲',
                specifications: {
                    'راندمان': '۹۹.۹٪',
                    'دبی جریان': '۳۰۰,۰۰۰ m³/h',
                    'قدرت': '۸۰۰ kW'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/09 Process Gas Dedusting/02 ESP Windbox Exhaust Gas 2',
                delivery: '۳۲-۴۰ هفته',
                warranty: '۳۶ ماه'
            },
            {
                id: 'MP-049',
                name: 'ESP Hood Exhaust',
                brand: 'FLSmidth',
                model: 'ESP-H-01',
                category: 'mechanical',
                price: { min: 4800, max: 6800 },
                unit: 'میلیون تومان',
                suppliers: 18,
                rating: 4.8,
                image: 'fas fa-filter',
                description: 'سیستم الکترواستاتیک غبارگیری هود',
                specifications: {
                    'راندمان': '۹۹.۸٪',
                    'دبی جریان': '۲۵۰,۰۰۰ m³/h',
                    'قدرت': '۷۰۰ kW'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/09 Process Gas Dedusting/03 ESP Hood Exhaust',
                delivery: '۳۰-۳۸ هفته',
                warranty: '۳۶ ماه'
            },
            {
                id: 'MP-050',
                name: 'ESP Plant Dedusting',
                brand: 'FLSmidth',
                model: 'ESP-P-01',
                category: 'mechanical',
                price: { min: 4200, max: 5800 },
                unit: 'میلیون تومان',
                suppliers: 20,
                rating: 4.7,
                image: 'fas fa-filter',
                description: 'سیستم الکترواستاتیک غبارگیری کارخانه',
                specifications: {
                    'راندمان': '۹۹.۵٪',
                    'دبی جریان': '۲۰۰,۰۰۰ m³/h',
                    'قدرت': '۶۰۰ kW'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/10 Plant Dedusting/01 ESP Dedusting',
                delivery: '۲۸-۳۶ هفته',
                warranty: '۳۶ ماه'
            },
            {
                id: 'MP-051',
                name: 'Plant Dedusting Fan',
                brand: 'Howden',
                model: 'PDF-01',
                category: 'mechanical',
                price: { min: 950, max: 1300 },
                unit: 'میلیون تومان',
                suppliers: 22,
                rating: 4.6,
                image: 'fas fa-wind',
                description: 'فن غبارگیری کارخانه',
                specifications: {
                    'دبی جریان': '۱۸۰,۰۰۰ m³/h',
                    'فشار': '۴.۵ kPa',
                    'قدرت': '۵۵۰ kW'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/10 Plant Dedusting/02 Plant Dedusting Fan',
                delivery: '۱۴-۲۰ هفته',
                warranty: '۳۶ ماه'
            },
            
            // Cooling Water System
            {
                id: 'MP-052',
                name: 'Heat Exchanger',
                brand: 'Alfa Laval',
                model: 'HE-01',
                category: 'mechanical',
                price: { min: 850, max: 1200 },
                unit: 'میلیون تومان',
                suppliers: 24,
                rating: 4.7,
                image: 'fas fa-thermometer-half',
                description: 'مبدل حرارتی',
                specifications: {
                    'سطح انتقال حرارت': '۵۰۰ m²',
                    'نوع': 'Shell & Tube',
                    'ظرفیت': '۱۰ MW'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/13 Cooling Water System/01 Heat Exchanger',
                delivery: '۱۶-۲۲ هفته',
                warranty: '۳۶ ماه'
            },
            {
                id: 'MP-053',
                name: 'Corrosion Inhibitor Dosing Station',
                brand: 'Nalco',
                model: 'CID-01',
                category: 'mechanical',
                price: { min: 180, max: 280 },
                unit: 'میلیون تومان',
                suppliers: 18,
                rating: 4.5,
                image: 'fas fa-flask',
                description: 'ایستگاه دوزینگ بازدارنده خوردگی',
                specifications: {
                    'ظرفیت': '۱۰۰ لیتر/ساعت',
                    'دقت': '±۲٪',
                    'نوع': 'اتوماتیک'
                },
                dataSheet: 'GZP Final Book/5 Mechanical Equipment/13 Cooling Water System/02 Corrosion Inhibitor Dosing Station',
                delivery: '۸-۱۲ هفته',
                warranty: '۲۴ ماه'
            },
            
            // تجهیزات الکتریکی بیشتر
            {
                id: 'MP-054',
                name: 'MV Motor',
                brand: 'Siemens',
                model: 'SIMOTICS 1LA8',
                category: 'electrical',
                price: { min: 450, max: 650 },
                unit: 'میلیون تومان',
                suppliers: 28,
                rating: 4.8,
                image: 'fas fa-cog',
                description: 'الکتروموتور فشار متوسط',
                specifications: {
                    'قدرت': '۱۰۰-۱۰۰۰ kW',
                    'ولتاژ': '۶.۶ kV',
                    'فرکانس': '۵۰ Hz'
                },
                dataSheet: 'GZP Final Book/6 Electrical Equipment/02 Supply Documentation',
                delivery: '۱۲-۱۸ هفته',
                warranty: '۳۶ ماه'
            },
            {
                id: 'MP-055',
                name: 'Power Drive System',
                brand: 'Siemens',
                model: 'SINAMICS G150',
                category: 'electrical',
                price: { min: 2800, max: 3800 },
                unit: 'میلیون تومان',
                suppliers: 20,
                rating: 4.9,
                image: 'fas fa-sliders-h',
                description: 'سیستم درایو قدرت برای فن فرآیند',
                specifications: {
                    'قدرت': '۵۰۰-۳۰۰۰ kW',
                    'ولتاژ': '۶.۶ kV',
                    'کنترل': 'Vector Control'
                },
                dataSheet: 'GZP Final Book/6 Electrical Equipment/02 Supply Documentation/04 Power Drive System for Process Gas Fan',
                delivery: '۲۰-۲۸ هفته',
                warranty: '۳۶ ماه'
            },
            
            // ابزار دقیق بیشتر
            {
                id: 'MP-056',
                name: 'Flow Transmitter',
                brand: 'Endress+Hauser',
                model: 'Promag 50',
                category: 'instrumentation',
                price: { min: 85, max: 120 },
                unit: 'میلیون تومان',
                suppliers: 28,
                rating: 4.9,
                image: 'fas fa-water',
                description: 'ترانسمیتر جریان الکترومغناطیسی',
                specifications: {
                    'قطر': 'DN50-DN600',
                    'دقت': '±۰.۲٪',
                    'خروجی': '4-20 mA + HART'
                },
                dataSheet: 'GZP Final Book/7 Instrumentation/02 Supply Documetation',
                delivery: '۳-۴ هفته',
                warranty: '۲۴ ماه'
            },
            {
                id: 'MP-057',
                name: 'Control Valve',
                brand: 'Fisher',
                model: 'CV-01',
                category: 'instrumentation',
                price: { min: 120, max: 180 },
                unit: 'میلیون تومان',
                suppliers: 26,
                rating: 4.7,
                image: 'fas fa-valve',
                description: 'شیر کنترل',
                specifications: {
                    'قطر': 'DN50-DN300',
                    'فشار': 'تا ۴۰ bar',
                    'نوع': 'Globe / Ball'
                },
                dataSheet: 'GZP Final Book/7 Instrumentation/02 Supply Documetation',
                delivery: '۶-۱۰ هفته',
                warranty: '۲۴ ماه'
            },
            {
                id: 'MP-058',
                name: 'DCS System',
                brand: 'Siemens',
                model: 'SIMATIC PCS 7',
                category: 'automation',
                price: { min: 15000, max: 25000 },
                unit: 'میلیون تومان',
                suppliers: 12,
                rating: 4.9,
                image: 'fas fa-server',
                description: 'سیستم کنترل توزیع شده',
                specifications: {
                    'نوع': 'DCS',
                    'I/O Points': 'تا ۱۰۰,۰۰۰',
                    'پروتکل': 'PROFINET / PROFIBUS'
                },
                dataSheet: 'GZP Final Book/6 Electrical Equipment/02 Supply Documentation',
                delivery: '۳۶-۴۸ هفته',
                warranty: '۶۰ ماه'
            }
        ];

        // ساختار سلسله‌مراتبی تجهیزات بر اساس Final Book
        const equipmentHierarchy = {
            'mechanical': {
                name: 'تجهیزات مکانیکی',
                icon: 'fas fa-cogs',
                subcategories: {
                    'dosing-mixing': {
                        name: 'Dosing & Mixing',
                        icon: 'fas fa-flask',
                        equipment: [
                            {
                                category: 'air-blaster',
                                name: 'Air Blaster Systems',
                                dataSheet: 'GZP Final Book/5 Mechanical Equipment/01 Dosing and Mixing/01 Air Blaster Systems',
                                inspectionFrequency: 'ماهانه',
                                suppliers: 25,
                                avgPrice: { min: 45, max: 75 }
                            },
                            {
                                category: 'loss-weight-feeder',
                                name: 'Loss in Weight Feeder',
                                dataSheet: 'GZP Final Book/5 Mechanical Equipment/01 Dosing and Mixing/02 Loss in Weight Feeder',
                                inspectionFrequency: 'هفتگی',
                                suppliers: 18,
                                avgPrice: { min: 380, max: 520 }
                            },
                            {
                                category: 'level-measuring',
                                name: 'Level Measuring System',
                                dataSheet: 'GZP Final Book/5 Mechanical Equipment/01 Dosing and Mixing/03 Level Measuring System',
                                inspectionFrequency: 'ماهانه',
                                suppliers: 22,
                                avgPrice: { min: 180, max: 280 }
                            },
                            {
                                category: 'belt-weigher',
                                name: 'Belt Weighers + Dosing Belt Weighers',
                                dataSheet: 'GZP Final Book/5 Mechanical Equipment/01 Dosing and Mixing/04 Belt Weighers + Dosing Belt Weighers',
                                inspectionFrequency: 'هفتگی',
                                suppliers: 22,
                                avgPrice: { min: 320, max: 400 }
                            },
                            {
                                category: 'wet-scrubber',
                                name: 'Wet Scrubber System',
                                dataSheet: 'GZP Final Book/5 Mechanical Equipment/01 Dosing and Mixing/05 Wet Scrubber System (Scrubber + Fan)',
                                inspectionFrequency: 'ماهانه',
                                suppliers: 15,
                                avgPrice: { min: 850, max: 1200 }
                            },
                            {
                                category: 'mixer-drum',
                                name: 'Mixers Drum Type',
                                dataSheet: 'GZP Final Book/5 Mechanical Equipment/01 Dosing and Mixing/06 Mixers Drum Type',
                                inspectionFrequency: 'هفتگی',
                                suppliers: 16,
                                avgPrice: { min: 320, max: 450 }
                            }
                        ]
                    },
                    'green-pelletizing': {
                        name: 'Green Pelletizing',
                        icon: 'fas fa-circle-notch',
                        equipment: [
                            {
                                category: 'pelletizing-discs',
                                name: 'Pelletizing Discs',
                                dataSheet: 'GZP Final Book/5 Mechanical Equipment/02 Green Peletizing/03 Pelletizing Discs',
                                inspectionFrequency: 'روزانه',
                                suppliers: 12,
                                avgPrice: { min: 950, max: 1300 }
                            },
                            {
                                category: 'lubrication-pelletizing',
                                name: 'Centralized Lubrication Systems - Pelletizing Discs',
                                dataSheet: 'GZP Final Book/5 Mechanical Equipment/02 Green Peletizing/04 Centralized Lubrcation Systems - Pelletizing Discs',
                                inspectionFrequency: 'هفتگی',
                                suppliers: 18,
                                avgPrice: { min: 280, max: 380 }
                            },
                            {
                                category: 'roller-screen',
                                name: 'Single Deck Roller Screen and Carriage',
                                dataSheet: 'GZP Final Book/5 Mechanical Equipment/02 Green Peletizing/05 Single Deck Roller Screen and Carriage',
                                inspectionFrequency: 'روزانه',
                                suppliers: 14,
                                avgPrice: { min: 480, max: 680 }
                            }
                        ]
                    },
                    'indurating-machine': {
                        name: 'Indurating Machine',
                        icon: 'fas fa-fire',
                        equipment: [
                            {
                                category: 'reciprocating-head',
                                name: 'Reciprocating head with oil hydraulic drive',
                                dataSheet: 'GZP Final Book/5 Mechanical Equipment/03 Indurating Machine/01 Reciproacting head with oil hydraulic drive',
                                inspectionFrequency: 'روزانه',
                                suppliers: 10,
                                avgPrice: { min: 1200, max: 1800 }
                            },
                            {
                                category: 'wide-belt-conveyor',
                                name: 'Wide Belt Conveyor',
                                dataSheet: 'GZP Final Book/5 Mechanical Equipment/03 Indurating Machine/02 Wide Belt Conveyor',
                                inspectionFrequency: 'روزانه',
                                suppliers: 20,
                                avgPrice: { min: 450, max: 650 }
                            },
                            {
                                category: 'belt-conveyor-ddrs',
                                name: 'DDRS & US-OS Belt Conveyor',
                                dataSheet: 'GZP Final Book/5 Mechanical Equipment/03 Indurating Machine/03 DDRS & US-OS Belt Conveyor, horizontal & Oversize Belt Conveyor',
                                inspectionFrequency: 'روزانه',
                                suppliers: 18,
                                avgPrice: { min: 520, max: 720 }
                            },
                            {
                                category: 'indurating-machine-main',
                                name: 'Indurating Machine',
                                dataSheet: 'GZP Final Book/5 Mechanical Equipment/03 Indurating Machine/04 Indurating Machine',
                                inspectionFrequency: 'روزانه',
                                suppliers: 5,
                                avgPrice: { min: 28000, max: 38000 }
                            },
                            {
                                category: 'lubrication-indurating',
                                name: 'Centralized Lubrication Systems - Indurating Machine',
                                dataSheet: 'GZP Final Book/5 Mechanical Equipment/03 Indurating Machine/05 Centralized Lubrication Systems - Indurating Machine',
                                inspectionFrequency: 'هفتگی',
                                suppliers: 16,
                                avgPrice: { min: 380, max: 520 }
                            }
                        ]
                    },
                    'indurating-hood': {
                        name: 'Indurating Hood',
                        icon: 'fas fa-tools',
                        equipment: [
                            {
                                category: 'indurating-hood-main',
                                name: 'Indurating Hood',
                                dataSheet: 'GZP Final Book/5 Mechanical Equipment/04 Indurating Hood/00 Indurating Hood',
                                inspectionFrequency: 'روزانه',
                                suppliers: 8,
                                avgPrice: { min: 15000, max: 22000 }
                            },
                            {
                                category: 'recovery-material',
                                name: 'Recovery Material',
                                dataSheet: 'GZP Final Book/5 Mechanical Equipment/04 Indurating Hood/01 Recovery Material',
                                inspectionFrequency: 'ماهانه',
                                suppliers: 12,
                                avgPrice: { min: 850, max: 1200 }
                            },
                            {
                                category: 'gprs-flow-control',
                                name: 'GPRS & Flow Control Stations',
                                dataSheet: 'GZP Final Book/5 Mechanical Equipment/04 Indurating Hood/02 GPRS & Flow Control Stations for Diesel & NG & BMS',
                                inspectionFrequency: 'هفتگی',
                                suppliers: 14,
                                avgPrice: { min: 650, max: 900 }
                            },
                            {
                                category: 'dual-fuel-burner',
                                name: 'Dual Fuel Burner',
                                dataSheet: 'GZP Final Book/5 Mechanical Equipment/04 Indurating Hood/03 Dual Fuel Burner',
                                inspectionFrequency: 'روزانه',
                                suppliers: 10,
                                avgPrice: { min: 3200, max: 4500 }
                            }
                        ]
                    },
                    'process-fans': {
                        name: 'Process Fans and Ducts',
                        icon: 'fas fa-wind',
                        equipment: [
                            {
                                category: 'cooling-air-fans',
                                name: 'Cooling Air Fans',
                                dataSheet: 'GZP Final Book/5 Mechanical Equipment/05 Process Fans and Ducts/01 Cooling Air Fans',
                                inspectionFrequency: 'هفتگی',
                                suppliers: 22,
                                avgPrice: { min: 850, max: 1200 }
                            },
                            {
                                category: 'updraft-drying-fan',
                                name: 'Updraft Drying Fan',
                                dataSheet: 'GZP Final Book/5 Mechanical Equipment/05 Process Fans and Ducts/02 Updrought Drying Fan',
                                inspectionFrequency: 'هفتگی',
                                suppliers: 18,
                                avgPrice: { min: 1900, max: 2600 }
                            },
                            {
                                category: 'windbox-recuperation-fan',
                                name: 'Windbox Recuperation Fan',
                                dataSheet: 'GZP Final Book/5 Mechanical Equipment/05 Process Fans and Ducts/03 Windbox Recuperation Fan',
                                inspectionFrequency: 'هفتگی',
                                suppliers: 18,
                                avgPrice: { min: 1800, max: 2400 }
                            },
                            {
                                category: 'windbox-exhaust-gas-fan-1',
                                name: 'Windbox Exhaust Gas Fan 1',
                                dataSheet: 'GZP Final Book/5 Mechanical Equipment/05 Process Fans and Ducts/04 Windbox Exhaust Gas Fan 1',
                                inspectionFrequency: 'هفتگی',
                                suppliers: 18,
                                avgPrice: { min: 1600, max: 2200 }
                            },
                            {
                                category: 'windbox-exhaust-gas-fan-2',
                                name: 'Windbox Exhaust Gas Fan 2',
                                dataSheet: 'GZP Final Book/5 Mechanical Equipment/05 Process Fans and Ducts/05 Windbox Exhaust Gas Fan 2',
                                inspectionFrequency: 'هفتگی',
                                suppliers: 18,
                                avgPrice: { min: 1600, max: 2200 }
                            },
                            {
                                category: 'hood-exhaust-gas-fan',
                                name: 'Hood Exhaust Gas Fan',
                                dataSheet: 'GZP Final Book/5 Mechanical Equipment/05 Process Fans and Ducts/06 Hood Exhaust Gas Fan',
                                inspectionFrequency: 'هفتگی',
                                suppliers: 18,
                                avgPrice: { min: 1600, max: 2200 }
                            }
                        ]
                    },
                    'screening-transport': {
                        name: 'Pellet Screening and Transport',
                        icon: 'fas fa-th',
                        equipment: [
                            {
                                category: 'product-screen-sizer',
                                name: 'Product Screens - Sizer',
                                dataSheet: 'GZP Final Book/5 Mechanical Equipment/06 Pellet Screening and Transport/01 Product Screens - Sizer',
                                inspectionFrequency: 'روزانه',
                                suppliers: 17,
                                avgPrice: { min: 520, max: 720 }
                            }
                        ]
                    },
                    'dedusting': {
                        name: 'Process Gas Dedusting',
                        icon: 'fas fa-filter',
                        equipment: [
                            {
                                category: 'esp-windbox-exhaust-1',
                                name: 'ESP Windbox Exhaust Gas 1',
                                dataSheet: 'GZP Final Book/5 Mechanical Equipment/09 Process Gas Dedusting/01 ESP Windbox Exhaust Gas 1',
                                inspectionFrequency: 'هفتگی',
                                suppliers: 8,
                                avgPrice: { min: 5500, max: 7800 }
                            },
                            {
                                category: 'esp-windbox-exhaust-2',
                                name: 'ESP Windbox Exhaust Gas 2',
                                dataSheet: 'GZP Final Book/5 Mechanical Equipment/09 Process Gas Dedusting/02 ESP Windbox Exhaust Gas 2',
                                inspectionFrequency: 'هفتگی',
                                suppliers: 8,
                                avgPrice: { min: 5500, max: 7800 }
                            },
                            {
                                category: 'esp-hood-exhaust',
                                name: 'ESP Hood Exhaust',
                                dataSheet: 'GZP Final Book/5 Mechanical Equipment/09 Process Gas Dedusting/03 ESP Hood Exhaust',
                                inspectionFrequency: 'هفتگی',
                                suppliers: 8,
                                avgPrice: { min: 5200, max: 7500 }
                            }
                        ]
                    },
                    'water-systems': {
                        name: 'Process Water System',
                        icon: 'fas fa-water',
                        equipment: [
                            {
                                category: 'thickener-rake',
                                name: 'Thickener with Rake Mechanism',
                                dataSheet: 'GZP Final Book/5 Mechanical Equipment/11 Process Water System/01 Thickener with Rake Mechanism',
                                inspectionFrequency: 'هفتگی',
                                suppliers: 14,
                                avgPrice: { min: 1350, max: 1900 }
                            }
                        ]
                    },
                    'filtration': {
                        name: 'Filtration',
                        icon: 'fas fa-filter',
                        equipment: [
                            {
                                category: 'membrane-filter-press',
                                name: 'Membrane Filter Press',
                                dataSheet: 'GZP Final Book/5 Mechanical Equipment/12 Filtration/01 Membrane Filter Press, including',
                                inspectionFrequency: 'هفتگی',
                                suppliers: 12,
                                avgPrice: { min: 3000, max: 4000 }
                            }
                        ]
                    }
                }
            },
            'electrical': {
                name: 'تجهیزات الکتریکی',
                icon: 'fas fa-bolt',
                subcategories: {
                    'transformers': {
                        name: 'Distribution Transformers',
                        icon: 'fas fa-plug',
                        equipment: [
                            {
                                category: 'distribution-transformer',
                                name: 'Distribution Transformer',
                                dataSheet: 'GZP Final Book/6 Electrical Equipment/02 Supply Documentation/01 Distribution Transformers',
                                inspectionFrequency: 'ماهانه',
                                suppliers: 22,
                                avgPrice: { min: 1200, max: 1800 }
                            }
                        ]
                    },
                    'switchgear': {
                        name: 'Switchgear',
                        icon: 'fas fa-server',
                        equipment: [
                            {
                                category: 'mv-switchgear',
                                name: 'MV Switchgear',
                                dataSheet: 'GZP Final Book/6 Electrical Equipment/02 Supply Documentation/02 MV Switchgear',
                                inspectionFrequency: 'ماهانه',
                                suppliers: 25,
                                avgPrice: { min: 800, max: 1200 }
                            },
                            {
                                category: 'mcc-lv-switchgear',
                                name: 'MCC - LV Switchgear',
                                dataSheet: 'GZP Final Book/6 Electrical Equipment/02 Supply Documentation/03 MCC - LV Switchgear',
                                inspectionFrequency: 'هفتگی',
                                suppliers: 28,
                                avgPrice: { min: 600, max: 900 }
                            }
                        ]
                    },
                    'drives-motors': {
                        name: 'Drives & Motors',
                        icon: 'fas fa-cog',
                        equipment: [
                            {
                                category: 'power-drive-system',
                                name: 'Power Drive System for Process Gas Fan',
                                dataSheet: 'GZP Final Book/6 Electrical Equipment/02 Supply Documentation/04 Power Drive System for Process Gas Fan',
                                inspectionFrequency: 'هفتگی',
                                suppliers: 18,
                                avgPrice: { min: 450, max: 650 }
                            },
                            {
                                category: 'lv-motors',
                                name: 'LV Motors',
                                dataSheet: 'GZP Final Book/6 Electrical Equipment/02 Supply Documentation/05 LV Motors',
                                inspectionFrequency: 'هفتگی',
                                suppliers: 30,
                                avgPrice: { min: 180, max: 250 }
                            }
                        ]
                    },
                    'emergency-power': {
                        name: 'Emergency Power',
                        icon: 'fas fa-power-off',
                        equipment: [
                            {
                                category: 'emergency-diesel-generator',
                                name: 'Emergency Diesel Generator',
                                dataSheet: 'GZP Final Book/6 Electrical Equipment/02 Supply Documentation/06 Emergency Diesel Generator',
                                inspectionFrequency: 'ماهانه',
                                suppliers: 18,
                                avgPrice: { min: 2500, max: 3200 }
                            },
                            {
                                category: 'ups-distribution',
                                name: 'UPS Distribution Panel',
                                dataSheet: 'GZP Final Book/6 Electrical Equipment/02 Supply Documentation/07 UPS Distribution Panel',
                                inspectionFrequency: 'ماهانه',
                                suppliers: 20,
                                avgPrice: { min: 400, max: 600 }
                            },
                            {
                                category: 'ups-110v-dc',
                                name: 'UPS 110V DC',
                                dataSheet: 'GZP Final Book/6 Electrical Equipment/02 Supply Documentation/08 UPS 110V DC',
                                inspectionFrequency: 'ماهانه',
                                suppliers: 18,
                                avgPrice: { min: 350, max: 500 }
                            }
                        ]
                    }
                }
            },
            'instrumentation': {
                name: 'ابزار دقیق',
                icon: 'fas fa-tachometer-alt',
                subcategories: {
                    'transmitters': {
                        name: 'Transmitters',
                        icon: 'fas fa-wifi',
                        equipment: [
                            {
                                category: 'pressure-transmitter',
                                name: 'Pressure Transmitter',
                                dataSheet: 'GZP Final Book/7 Instrumentation/02 Supply Documetation',
                                inspectionFrequency: 'ماهانه',
                                suppliers: 35,
                                avgPrice: { min: 45, max: 65 }
                            },
                            {
                                category: 'temperature-transmitter',
                                name: 'Temperature Transmitter',
                                dataSheet: 'GZP Final Book/7 Instrumentation/02 Supply Documetation',
                                inspectionFrequency: 'ماهانه',
                                suppliers: 32,
                                avgPrice: { min: 35, max: 50 }
                            },
                            {
                                category: 'level-transmitter',
                                name: 'Level Transmitter',
                                dataSheet: 'GZP Final Book/7 Instrumentation/02 Supply Documetation',
                                inspectionFrequency: 'ماهانه',
                                suppliers: 28,
                                avgPrice: { min: 55, max: 75 }
                            }
                        ]
                    },
                    'flowmeters': {
                        name: 'Flowmeters',
                        icon: 'fas fa-water',
                        equipment: [
                            {
                                category: 'electromagnetic-flowmeter',
                                name: 'Electromagnetic Flowmeter',
                                dataSheet: 'GZP Final Book/7 Instrumentation/02 Supply Documetation',
                                inspectionFrequency: 'ماهانه',
                                suppliers: 28,
                                avgPrice: { min: 85, max: 120 }
                            }
                        ]
                    }
                }
            }
        };

        // ادغام تجهیزات از equipmentDatabase با marketplaceProducts
        function syncEquipmentToMarketplace() {
            equipmentDatabase.forEach(equipment => {
                // چک کردن وجود در marketplace
                const exists = marketplaceProducts.some(p => p.id === equipment.id);
                if (!exists) {
                    const marketplaceItem = convertEquipmentToMarketplace(equipment);
                    if (marketplaceItem) {
                        marketplaceProducts.push(marketplaceItem);
                    }
                }
            });
        }

        // بارگذاری محصولات marketplace
        // تابع جدید برای بارگذاری محصولات با زبانه‌های قیمت‌گذاری
        function loadMarketplaceProductsNew() {
            syncEquipmentToMarketplace();
            
            const container = document.getElementById('marketplace-products-container');
            if (!container) return;
            
            container.innerHTML = marketplaceProducts.map(product => `
                <div class="bg-white rounded-lg shadow-md border border-gray-200 overflow-hidden product-card" 
                     data-category="${product.category}" 
                     data-brand="${product.brand.toLowerCase()}"
                     data-price="${product.price.min}">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-3 p-3">
                        <!-- تصویر و اطلاعات کلی (کوچک شده) -->
                        <div class="lg:col-span-1">
                            <div class="relative h-32 bg-gradient-to-br from-gray-50 to-gray-100 rounded border border-gray-200 flex items-center justify-center mb-2">
                                <i class="${product.image} text-3xl text-gray-700 opacity-80"></i>
                                ${product.suppliers > 15 ? '<span class="absolute top-1 left-1 bg-green-500 text-white px-1.5 py-0.5 rounded text-xs font-bold">پرفروش</span>' : ''}
                                ${product.rating >= 4.8 ? '<span class="absolute top-1 right-1 bg-yellow-500 text-white px-1.5 py-0.5 rounded text-xs font-bold">⭐</span>' : ''}
                            </div>
                            <div class="text-center">
                                <h3 class="text-sm font-bold text-gray-900 mb-1">${product.name}</h3>
                                <p class="text-xs text-gray-600 mb-1">${product.brand} - ${product.model}</p>
                                <div class="flex items-center justify-center gap-0.5 mb-1">
                                    ${Array.from({length: 5}, (_, i) => 
                                        `<i class="fas fa-star ${i < Math.floor(product.rating) ? 'text-yellow-400' : 'text-gray-300'}" style="font-size: 10px;"></i>`
                                    ).join('')}
                                    <span class="text-xs text-gray-600 mr-1">${product.rating}</span>
                                </div>
                                <span class="inline-block px-2 py-0.5 bg-blue-100 text-blue-700 rounded text-xs font-medium">${product.suppliers} تأمین‌کننده</span>
                            </div>
                        </div>
                        
                        <!-- زبانه‌های قیمت‌گذاری - سبک Siemens (کوچک شده) -->
                        <div class="lg:col-span-2">
                            <div class="border-b border-gray-200 mb-2">
                                <div class="flex gap-1 flex-wrap">
                                    <button onclick="showPriceTab('${product.id}', 'pricing')" 
                                            class="price-tab-btn active px-2 py-1 text-xs bg-blue-600 text-white rounded-t font-medium transition">
                                        <i class="fas fa-dollar-sign ml-1" style="font-size: 10px;"></i>
                                        قیمت
                                    </button>
                                    <button onclick="showPriceTab('${product.id}', 'specs')" 
                                            class="price-tab-btn px-2 py-1 text-xs bg-gray-100 text-gray-700 rounded-t font-medium hover:bg-gray-200 transition">
                                        <i class="fas fa-cog ml-1" style="font-size: 10px;"></i>
                                        مشخصات
                                    </button>
                                    <button onclick="showPriceTab('${product.id}', 'datasheet')" 
                                            class="price-tab-btn px-2 py-1 text-xs bg-gray-100 text-gray-700 rounded-t font-medium hover:bg-gray-200 transition">
                                        <i class="fas fa-file-pdf ml-1" style="font-size: 10px;"></i>
                                        دیتا شیت
                                    </button>
                                    <button onclick="showPriceTab('${product.id}', 'suppliers')" 
                                            class="price-tab-btn px-2 py-1 text-xs bg-gray-100 text-gray-700 rounded-t font-medium hover:bg-gray-200 transition">
                                        <i class="fas fa-users ml-1" style="font-size: 10px;"></i>
                                        تأمین‌کنندگان
                                    </button>
                                    <button onclick="showPriceTab('${product.id}', 'reverse')" 
                                            class="price-tab-btn px-2 py-1 text-xs bg-gray-100 text-gray-700 rounded-t font-medium hover:bg-gray-200 transition">
                                        <i class="fas fa-project-diagram ml-1" style="font-size: 10px;"></i>
                                        نقشه
                                    </button>
                                </div>
                            </div>
                            
                            <!-- محتوای زبانه قیمت‌گذاری (کوچک شده) -->
                            <div id="price-tab-${product.id}-pricing" class="price-tab-content">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-2 mb-2">
                                    <div class="bg-blue-50 rounded p-2">
                                        <div class="text-xs text-gray-600 mb-0.5">قیمت پایه</div>
                                        <div class="text-base font-bold text-blue-600">${product.price.min} - ${product.price.max}</div>
                                        <div class="text-xs text-gray-500">${product.unit}</div>
                                    </div>
                                    <div class="bg-green-50 rounded p-2">
                                        <div class="text-xs text-gray-600 mb-0.5">زمان تحویل</div>
                                        <div class="text-sm font-bold text-green-600">${product.delivery}</div>
                                        <div class="text-xs text-gray-500">گارانتی: ${product.warranty}</div>
                                    </div>
                                </div>
                                <div class="bg-gray-50 rounded p-2 mb-2">
                                    <h4 class="font-semibold text-xs text-gray-900 mb-1">مشخصات کلیدی</h4>
                                    <div class="grid grid-cols-2 gap-1 text-xs">
                                        ${Object.entries(product.specifications || {}).slice(0, 4).map(([key, value]) => `
                                            <div class="flex justify-between">
                                                <span class="text-gray-600">${key}:</span>
                                                <span class="text-gray-900 font-medium">${value}</span>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                                <button onclick="showSuppliers('${product.name}', '${product.category}')" 
                                        class="w-full py-1.5 text-xs bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white rounded font-medium transition">
                                    <i class="fas fa-shopping-cart ml-1"></i>
                                    مشاهده قیمت‌ها
                                </button>
                            </div>
                            
                            <!-- محتوای زبانه مشخصات فنی (کوچک شده) -->
                            <div id="price-tab-${product.id}-specs" class="price-tab-content hidden">
                                <div class="space-y-2">
                                    <div>
                                        <h4 class="font-semibold text-xs text-gray-900 mb-1">مشخصات کامل</h4>
                                        <div class="bg-gray-50 rounded p-2">
                                            <div class="grid grid-cols-2 gap-1 text-xs">
                                                ${Object.entries(product.specifications || {}).map(([key, value]) => `
                                                    <div class="flex justify-between border-b border-gray-200 pb-1">
                                                        <span class="text-gray-600">${key}:</span>
                                                        <span class="text-gray-900 font-medium">${value}</span>
                                                    </div>
                                                `).join('')}
                                            </div>
                                        </div>
                                    </div>
                                    <div>
                                        <h4 class="font-semibold text-xs text-gray-900 mb-1">توضیحات</h4>
                                        <p class="text-xs text-gray-700">${product.description}</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- محتوای زبانه دیتا شیت (کوچک شده) -->
                            <div id="price-tab-${product.id}-datasheet" class="price-tab-content hidden">
                                <div class="bg-gray-50 rounded p-2">
                                    <h4 class="font-semibold text-xs text-gray-900 mb-2">دیتا شیت Final Book</h4>
                                    <div class="flex items-center gap-2 mb-2">
                                        <i class="fas fa-folder text-blue-600 text-sm"></i>
                                        <span class="text-xs text-gray-700">${product.dataSheet}</span>
                                    </div>
                                    <button class="px-2 py-1 text-xs bg-blue-600 hover:bg-blue-700 text-white rounded transition">
                                        <i class="fas fa-download ml-1"></i>
                                        دانلود
                                    </button>
                                </div>
                            </div>
                            
                            <!-- محتوای زبانه تأمین‌کنندگان (کوچک شده) -->
                            <div id="price-tab-${product.id}-suppliers" class="price-tab-content hidden">
                                <div class="space-y-2">
                                    <h4 class="font-semibold text-xs text-gray-900 mb-2">${product.suppliers} تأمین‌کننده فعال</h4>
                                    <div class="bg-gray-50 rounded p-2">
                                        <p class="text-xs text-gray-700 mb-2">برای مشاهده لیست کامل:</p>
                                        <button onclick="showSuppliers('${product.name}', '${product.category}')" 
                                                class="w-full py-1.5 text-xs bg-green-600 hover:bg-green-700 text-white rounded transition">
                                            <i class="fas fa-list ml-1"></i>
                                            مشاهده لیست
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- محتوای زبانه نقشه مهندسی معکوس (کوچک شده) -->
                            <div id="price-tab-${product.id}-reverse" class="price-tab-content hidden">
                                <div class="bg-gray-50 rounded p-2">
                                    <h4 class="font-semibold text-xs text-gray-900 mb-2">نقشه مهندسی معکوس</h4>
                                    <div class="space-y-1.5">
                                        <div class="flex items-center gap-2 justify-between">
                                            <div class="flex items-center gap-1.5">
                                                <i class="fas fa-drafting-compass text-blue-600 text-xs"></i>
                                                <span class="text-xs text-gray-700">نقشه سه‌بعدی CAD</span>
                                            </div>
                                            <button class="px-2 py-0.5 text-xs bg-blue-600 hover:bg-blue-700 text-white rounded transition">
                                                <i class="fas fa-download ml-1"></i>
                                                دانلود
                                            </button>
                                        </div>
                                        <div class="flex items-center gap-2 justify-between">
                                            <div class="flex items-center gap-1.5">
                                                <i class="fas fa-cube text-blue-600 text-xs"></i>
                                                <span class="text-xs text-gray-700">فایل STEP/IGES</span>
                                            </div>
                                            <button class="px-2 py-0.5 text-xs bg-blue-600 hover:bg-blue-700 text-white rounded transition">
                                                <i class="fas fa-download ml-1"></i>
                                                دانلود
                                            </button>
                                        </div>
                                        <div class="flex items-center gap-2 justify-between">
                                            <div class="flex items-center gap-1.5">
                                                <i class="fas fa-ruler-combined text-blue-600 text-xs"></i>
                                                <span class="text-xs text-gray-700">نقشه ابعادی PDF</span>
                                            </div>
                                            <button class="px-2 py-0.5 text-xs bg-blue-600 hover:bg-blue-700 text-white rounded transition">
                                                <i class="fas fa-download ml-1"></i>
                                                دانلود
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        // تابع نمایش زبانه‌های قیمت‌گذاری
        function showPriceTab(productId, tabName) {
            const tabs = ['pricing', 'specs', 'datasheet', 'suppliers', 'reverse'];
            tabs.forEach(tab => {
                const content = document.getElementById(`price-tab-${productId}-${tab}`);
                const btn = event.target.closest('.price-tab-btn');
                if (content) {
                    content.classList.toggle('hidden', tab !== tabName);
                }
            });
            
            // تغییر استایل دکمه‌ها
            const allBtns = document.querySelectorAll(`[onclick*="showPriceTab('${productId}'"]`);
            allBtns.forEach(btn => {
                btn.classList.remove('active', 'bg-blue-600', 'text-white');
                btn.classList.add('bg-gray-100', 'text-gray-700');
            });
            event.target.closest('.price-tab-btn').classList.add('active', 'bg-blue-600', 'text-white');
            event.target.closest('.price-tab-btn').classList.remove('bg-gray-100', 'text-gray-700');
        }
        
        // تابع‌های جدید برای جستجو و فیلتر
        function searchMarketplaceMain(query) {
            if (event && event.key === 'Enter') {
                performMarketplaceSearch();
            }
        }
        
        function performMarketplaceSearch() {
            const query = document.getElementById('marketplace-search-main').value.toLowerCase();
            const cards = document.querySelectorAll('.product-card');
            cards.forEach(card => {
                const text = card.textContent.toLowerCase();
                card.style.display = text.includes(query) || query === '' ? 'block' : 'none';
            });
        }
        
        function filterMarketplace() {
            const category = document.getElementById('marketplace-category').value;
            const brand = document.getElementById('marketplace-brand').value;
            const priceRange = document.getElementById('marketplace-price-range').value;
            
            const cards = document.querySelectorAll('.product-card');
            cards.forEach(card => {
                let show = true;
                
                if (category !== 'all' && card.dataset.category !== category) show = false;
                if (brand !== 'all' && !card.dataset.brand.includes(brand)) show = false;
                
                if (priceRange !== 'all') {
                    const price = parseInt(card.dataset.price);
                    if (priceRange === '0-100' && price >= 100) show = false;
                    else if (priceRange === '100-500' && (price < 100 || price >= 500)) show = false;
                    else if (priceRange === '500-2000' && (price < 500 || price >= 2000)) show = false;
                    else if (priceRange === '2000+' && price < 2000) show = false;
                }
                
                card.style.display = show ? 'block' : 'none';
            });
        }
        
        function sortMarketplace() {
            const sortBy = document.getElementById('marketplace-sort').value;
            const container = document.getElementById('marketplace-products-container');
            const cards = Array.from(container.children);
            
            cards.sort((a, b) => {
                const priceA = parseInt(a.dataset.price);
                const priceB = parseInt(b.dataset.price);
                
                if (sortBy === 'price-asc') return priceA - priceB;
                if (sortBy === 'price-desc') return priceB - priceA;
                return 0;
            });
            
            cards.forEach(card => container.appendChild(card));
        }
        
        // تابع قدیمی برای سازگاری
        function loadMarketplaceProducts() {
            // ادغام تجهیزات از equipmentDatabase
            syncEquipmentToMarketplace();
            
            // استفاده از تابع جدید
            loadMarketplaceProductsNew();
            
            const grid = document.getElementById('marketplace-products-grid');
            if (!grid) return;
            
            grid.innerHTML = marketplaceProducts.map(product => `
                <div class="glory-glass-card overflow-hidden product-card" 
                     data-category="${product.category}" 
                     data-brand="${product.brand.toLowerCase()}"
                     data-price="${product.price.min}">
                    <!-- تصویر محصول -->
                    <div class="relative h-48 bg-gradient-to-br from-blue-50 to-cyan-50 flex items-center justify-center">
                        <i class="${product.image} text-6xl text-blue-600 opacity-60"></i>
                        ${product.suppliers > 15 ? '<span class="absolute top-2 left-2 bg-green-500 text-white px-2 py-1 rounded-full text-xs font-bold">پرفروش</span>' : ''}
                        ${product.rating >= 4.8 ? '<span class="absolute top-2 right-2 bg-yellow-500 text-white px-2 py-1 rounded-full text-xs font-bold">⭐ برتر</span>' : ''}
                    </div>
                    
                    <!-- اطلاعات محصول -->
                    <div class="p-4">
                        <div class="flex items-start justify-between mb-2">
                            <div class="flex-1">
                                <h4 class="font-bold text-lg text-gray-900 mb-1 line-clamp-2">${product.name}</h4>
                                <p class="text-sm text-gray-600 mb-2">${product.brand} - ${product.model}</p>
                            </div>
                        </div>
                        
                        <!-- امتیاز و تعداد تأمین‌کننده -->
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center gap-1">
                                ${Array.from({length: 5}, (_, i) => 
                                    `<i class="fas fa-star ${i < Math.floor(product.rating) ? 'rating-stars' : 'text-gray-300'}" style="font-size: 12px;"></i>`
                                ).join('')}
                                <span class="text-xs text-gray-600 mr-1">${product.rating}</span>
                            </div>
                            <span class="supplier-badge">${product.suppliers} تأمین‌کننده</span>
                        </div>
                        
                        <!-- مشخصات کلیدی -->
                        <div class="mb-3 space-y-1">
                            ${Object.entries(product.specifications || {}).slice(0, 2).map(([key, value]) => `
                                <div class="flex justify-between text-xs">
                                    <span class="text-gray-500">${key}:</span>
                                    <span class="text-gray-900 font-medium">${value}</span>
                                </div>
                            `).join('')}
                        </div>
                        
                        <!-- قیمت -->
                        <div class="mb-3 pt-3 border-t border-gray-200">
                            <div class="price-badge inline-block">
                                ${product.price.min} - ${product.price.max} ${product.unit}
                            </div>
                        </div>
                        
                        <!-- دکمه‌های عملیاتی -->
                        <div class="flex gap-2">
                            <button onclick="showProductDetails('${product.id}')" 
                                    class="flex-1 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition text-sm">
                                <i class="fas fa-info-circle ml-1"></i>
                                جزئیات
                            </button>
                            <button onclick="showSuppliers('${product.name}', '${product.category}')" 
                                    class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition">
                                <i class="fas fa-shopping-cart"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
            
            // به‌روزرسانی تعداد کل محصولات
            document.getElementById('total-products').textContent = marketplaceProducts.length + '+';
        }

        // جستجوی محصولات
        function searchMarketplace(query) {
            const cards = document.querySelectorAll('.product-card');
            cards.forEach(card => {
                const text = card.textContent.toLowerCase();
                if (text.includes(query.toLowerCase()) || query === '') {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // فیلتر بر اساس دسته‌بندی
        function filterMarketplaceByCategory(category) {
            const cards = document.querySelectorAll('.product-card');
            cards.forEach(card => {
                if (category === 'all' || card.dataset.category === category) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // فیلتر بر اساس قیمت
        function filterMarketplaceByPrice(priceRange) {
            const cards = document.querySelectorAll('.product-card');
            cards.forEach(card => {
                const price = parseInt(card.dataset.price);
                let show = false;
                
                if (priceRange === 'all') show = true;
                else if (priceRange === '0-100') show = price < 100;
                else if (priceRange === '100-500') show = price >= 100 && price < 500;
                else if (priceRange === '500-1000') show = price >= 500 && price < 1000;
                else if (priceRange === '1000+') show = price >= 1000;
                
                card.style.display = show ? 'block' : 'none';
            });
        }

        // فیلتر بر اساس برند
        function filterByBrand(brand) {
            const chips = document.querySelectorAll('.filter-chip');
            chips.forEach(chip => chip.classList.remove('active', 'bg-blue-100', 'text-blue-700'));
            event.target.classList.add('active', 'bg-blue-100', 'text-blue-700');
            
            const cards = document.querySelectorAll('.product-card');
            cards.forEach(card => {
                if (brand === 'all' || card.dataset.brand.includes(brand)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // مرتب‌سازی محصولات
        function sortMarketplaceProducts(sortBy) {
            const grid = document.getElementById('marketplace-products-grid');
            const cards = Array.from(grid.children);
            
            cards.sort((a, b) => {
                if (sortBy === 'price-low') {
                    return parseInt(a.dataset.price) - parseInt(b.dataset.price);
                } else if (sortBy === 'price-high') {
                    return parseInt(b.dataset.price) - parseInt(a.dataset.price);
                }
                return 0;
            });
            
            cards.forEach(card => grid.appendChild(card));
        }

        // نمایش جزئیات محصول
        function showProductDetails(productId) {
            const product = marketplaceProducts.find(p => p.id === productId);
            if (!product) return;
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.7);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                padding: 20px;
            `;
            
            modal.innerHTML = `
                <div style="
                    background: #ffffff;
                    border-radius: 16px;
                    padding: 2rem;
                    max-width: 900px;
                    width: 100%;
                    max-height: 90vh;
                    overflow-y: auto;
                    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                ">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; border-bottom: 2px solid #e5e7eb; padding-bottom: 1rem;">
                        <h2 style="color: #1a1a1a; margin: 0; font-size: 1.75rem; font-weight: 600;">${product.name}</h2>
                        <button onclick="this.closest('div[style*=\"position: fixed\"]').remove()" style="
                            background: none;
                            border: none;
                            color: #6b7280;
                            font-size: 24px;
                            cursor: pointer;
                            padding: 0;
                            width: 32px;
                            height: 32px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            border-radius: 50%;
                            transition: all 0.2s;
                        " onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='none'">×</button>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                        <div style="background: #f9fafb; padding: 1rem; border-radius: 8px; border: 1px solid #e5e7eb;">
                            <div style="font-size: 0.75rem; color: #6b7280; margin-bottom: 0.5rem;">برند</div>
                            <div style="font-size: 1.25rem; font-weight: 600; color: #1a1a1a;">${product.brand}</div>
                        </div>
                        <div style="background: #f9fafb; padding: 1rem; border-radius: 8px; border: 1px solid #e5e7eb;">
                            <div style="font-size: 0.75rem; color: #6b7280; margin-bottom: 0.5rem;">مدل</div>
                            <div style="font-size: 1.25rem; font-weight: 600; color: #1a1a1a;">${product.model}</div>
                        </div>
                        <div style="background: #f9fafb; padding: 1rem; border-radius: 8px; border: 1px solid #e5e7eb;">
                            <div style="font-size: 0.75rem; color: #6b7280; margin-bottom: 0.5rem;">قیمت</div>
                            <div style="font-size: 1.25rem; font-weight: 600; color: #2563eb;">${product.price.min} - ${product.price.max} ${product.unit}</div>
                        </div>
                        <div style="background: #f9fafb; padding: 1rem; border-radius: 8px; border: 1px solid #e5e7eb;">
                            <div style="font-size: 0.75rem; color: #6b7280; margin-bottom: 0.5rem;">زمان تحویل</div>
                            <div style="font-size: 1.25rem; font-weight: 600; color: #1a1a1a;">${product.delivery}</div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <h3 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 1rem; color: #1a1a1a;">توضیحات</h3>
                        <p style="color: #6b7280; line-height: 1.6;">${product.description}</p>
                    </div>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <h3 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 1rem; color: #1a1a1a;">مشخصات فنی</h3>
                        <div style="background: #f9fafb; padding: 1rem; border-radius: 8px; border: 1px solid #e5e7eb;">
                            ${Object.entries(product.specifications).map(([key, value]) => `
                                <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #e5e7eb;">
                                    <span style="color: #6b7280;">${key}:</span>
                                    <span style="font-weight: 600; color: #1a1a1a;">${value}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 0.5rem; margin-top: 1.5rem;">
                        <button onclick="showSuppliers('${product.name}', '${product.category}'); this.closest('div[style*=\"position: fixed\"]').remove();" style="
                            flex: 1;
                            padding: 0.75rem;
                            background: #2563eb;
                            color: white;
                            border: none;
                            border-radius: 8px;
                            font-weight: 600;
                            cursor: pointer;
                            transition: all 0.2s;
                        " onmouseover="this.style.background='#1d4ed8'" onmouseout="this.style.background='#2563eb'">
                            مشاهده تأمین‌کنندگان
                        </button>
                        <button onclick="this.closest('div[style*=\"position: fixed\"]').remove()" style="
                            padding: 0.75rem 1.5rem;
                            background: #f3f4f6;
                            color: #1a1a1a;
                            border: none;
                            border-radius: 8px;
                            font-weight: 600;
                            cursor: pointer;
                            transition: all 0.2s;
                        " onmouseover="this.style.background='#e5e7eb'" onmouseout="this.style.background='#f3f4f6'">
                            بستن
                        </button>
                    </div>
                </div>
            `;
            
            modal.onclick = function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            };
            
            document.body.appendChild(modal);
        }

        // محاسبه تعداد کل تأمین‌کنندگان
        function calculateTotalSuppliers() {
            const suppliers = new Set();
            marketplaceProducts.forEach(product => {
                for (let i = 0; i < product.suppliers; i++) {
                    suppliers.add(`${product.id}-${i}`);
                }
            });
            return suppliers.size || 150;
        }

        // محاسبه میانگین امتیاز
        function calculateAverageRating() {
            if (marketplaceProducts.length === 0) return 4.5;
            const sum = marketplaceProducts.reduce((acc, product) => acc + (product.rating || 4.5), 0);
            return sum / marketplaceProducts.length;
        }

        // محاسبه تعداد سفارشات فعال
        function calculateTotalOrders() {
            return Math.floor(Math.random() * 50) + 25;
        }

        // جستجوی هوشمند بازار
        function performAIMarketplaceSearch() {
            const query = document.getElementById('marketplace-search')?.value;
            if (!query || !query.trim()) {
                loadMarketplaceProducts();
                return;
            }
            
            const results = performIntelligentMarketplaceSearch(query);
            displayMarketplaceSearchResults(results, query);
        }

        function performIntelligentMarketplaceSearch(query) {
            const lowerQuery = query.toLowerCase();
            return marketplaceProducts.filter(product => {
                const name = product.name.toLowerCase();
                const brand = product.brand.toLowerCase();
                const description = product.description?.toLowerCase() || '';
                
                return name.includes(lowerQuery) || 
                       brand.includes(lowerQuery) || 
                       description.includes(lowerQuery) ||
                       (lowerQuery.includes('فن') && name.includes('fan')) ||
                       (lowerQuery.includes('پمپ') && name.includes('pump')) ||
                       (lowerQuery.includes('موتور') && name.includes('motor'));
            });
        }

        function displayMarketplaceSearchResults(results, query) {
            const grid = document.getElementById('marketplace-products-grid');
            if (!grid) return;
            
            if (results.length === 0) {
                grid.innerHTML = `
                    <div class="col-span-full bg-yellow-50 border border-yellow-200 rounded-lg p-8 text-center">
                        <i class="fas fa-search text-4xl text-yellow-600 mb-4"></i>
                        <h3 class="text-xl font-bold text-gray-900 mb-2">نتیجه‌ای یافت نشد</h3>
                        <p class="text-gray-600">برای "${query}" نتیجه‌ای پیدا نشد. لطفاً کلمه کلیدی دیگری امتحان کنید.</p>
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = results.map(product => `
                <div class="glory-glass-card overflow-hidden product-card" 
                     data-category="${product.category}" 
                     data-brand="${product.brand.toLowerCase()}"
                     data-price="${product.price.min}">
                    <div class="relative h-48 bg-gradient-to-br from-blue-50 to-cyan-50 flex items-center justify-center">
                        <i class="${product.image} text-6xl text-blue-600 opacity-60"></i>
                        ${product.suppliers > 15 ? '<span class="absolute top-2 left-2 bg-green-500 text-white px-2 py-1 rounded-full text-xs font-bold">پرفروش</span>' : ''}
                        ${product.rating >= 4.8 ? '<span class="absolute top-2 right-2 bg-yellow-500 text-white px-2 py-1 rounded-full text-xs font-bold">⭐ برتر</span>' : ''}
                    </div>
                    <div class="p-4">
                        <div class="flex items-start justify-between mb-2">
                            <div class="flex-1">
                                <h4 class="font-bold text-lg text-gray-900 mb-1 line-clamp-2">${product.name}</h4>
                                <p class="text-sm text-gray-600 mb-2">${product.brand} - ${product.model}</p>
                            </div>
                        </div>
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center gap-1">
                                ${Array.from({length: 5}, (_, i) => 
                                    `<i class="fas fa-star ${i < Math.floor(product.rating) ? 'rating-stars' : 'text-gray-300'}" style="font-size: 12px;"></i>`
                                ).join('')}
                                <span class="text-xs text-gray-600 mr-1">${product.rating}</span>
                            </div>
                            <span class="supplier-badge">${product.suppliers} تأمین‌کننده</span>
                        </div>
                        <div class="mb-3 space-y-1">
                            ${Object.entries(product.specifications || {}).slice(0, 2).map(([key, value]) => `
                                <div class="flex justify-between text-xs">
                                    <span class="text-gray-500">${key}:</span>
                                    <span class="text-gray-900 font-medium">${value}</span>
                                </div>
                            `).join('')}
                        </div>
                        <div class="mb-3 pt-3 border-t border-gray-200">
                            <div class="price-badge inline-block">
                                ${product.price.min} - ${product.price.max} ${product.unit}
                            </div>
                        </div>
                        <button onclick="showProductDetails('${product.id}')" 
                                class="w-full py-2.5 bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-700 hover:to-blue-700 text-white rounded-lg font-semibold transition shadow-md">
                            <i class="fas fa-eye ml-1"></i>
                            مشاهده جزئیات و قیمت‌ها
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // بارگذاری اولیه marketplace
        document.addEventListener('DOMContentLoaded', function() {
            // ادغام تجهیزات از equipmentDatabase با marketplace
            syncEquipmentToMarketplace();
            
            setTimeout(() => {
                if (document.getElementById('marketplace-content') && 
                    !document.getElementById('marketplace-content').classList.contains('collapsed')) {
                    loadMarketplaceProducts();
                }
            }, 500);
        });

        // تابع toggle برای تجهیزات مناقصات
        function toggleTenderEquipment(tenderId) {
            const equipmentDiv = document.getElementById(tenderId + '-equipment');
            const button = event.target.closest('button');
            const icon = button.querySelector('i');
            
            if (equipmentDiv) {
                if (equipmentDiv.classList.contains('hidden')) {
                    equipmentDiv.classList.remove('hidden');
                    if (icon) icon.classList.remove('fa-chevron-down');
                    if (icon) icon.classList.add('fa-chevron-up');
                } else {
                    equipmentDiv.classList.add('hidden');
                    if (icon) icon.classList.remove('fa-chevron-up');
                    if (icon) icon.classList.add('fa-chevron-down');
                }
            }
        }

        // فیلتر تجهیزات تعمیرات
        function filterMaintenanceEquipment(category) {
            const buttons = document.querySelectorAll('.equipment-category-btn[data-category]');
            buttons.forEach(btn => {
                btn.classList.remove('active', 'bg-gradient-to-r', 'from-cyan-600', 'to-blue-600', 'text-white', 'shadow-md');
                btn.classList.add('bg-white', 'text-gray-700', 'border-gray-200');
            });
            
            const activeBtn = document.querySelector(`.equipment-category-btn[data-category="${category}"]`);
            if (activeBtn) {
                activeBtn.classList.remove('bg-white', 'text-gray-700', 'border-gray-200');
                activeBtn.classList.add('active', 'bg-gradient-to-r', 'from-cyan-600', 'to-blue-600', 'text-white', 'shadow-md');
            }
            
            loadMaintenanceEquipment(category);
        }

        // بارگذاری تجهیزات تعمیرات
        function loadMaintenanceEquipment(category = 'all') {
            const grid = document.getElementById('maintenance-equipment-grid');
            if (!grid) return;
            
            let filteredEquipment = equipmentDatabase.filter(eq => 
                eq.status === 'نیاز به بازرسی' || eq.status === 'نیاز به تعمیرات'
            );
            
            if (category !== 'all') {
                filteredEquipment = filteredEquipment.filter(eq => eq.category === category);
            }
            
            grid.innerHTML = filteredEquipment.map(eq => `
                <div class="glory-glass-card" onclick="showEquipmentDetails('${eq.id}')">
                    <div class="flex items-start justify-between mb-3">
                        <div class="flex-1">
                            <h4 class="font-bold text-lg text-gray-900 mb-1">${eq.name}</h4>
                            <p class="text-sm text-gray-600">${eq.section}</p>
                        </div>
                        <span class="px-2 py-1 rounded text-xs font-medium ${
                            eq.status === 'نیاز به تعمیرات' ? 'bg-red-100 text-red-700' : 
                            'bg-yellow-100 text-yellow-700'
                        }">${eq.status}</span>
                    </div>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span class="text-gray-600">کد تجهیز:</span>
                            <span class="font-semibold">${eq.id}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">اولویت:</span>
                            <span class="font-semibold text-red-600">${eq.status === 'نیاز به تعمیرات' ? 'بالا' : 'متوسط'}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">بازرسی بعدی:</span>
                            <span class="font-semibold text-red-600">${eq.nextMaintenance}</span>
                        </div>
                    </div>
                    <button onclick="event.stopPropagation(); checkWarehouseAndShowMarketplace('${eq.id}')" 
                            class="mt-3 w-full py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-white text-sm font-medium transition">
                        <i class="fas fa-warehouse ml-1"></i>
                        بررسی موجودی و بازار
                    </button>
                </div>
            `).join('');
        }

        // چک کردن موجودی انبار و نمایش در بازار
        function checkWarehouseAndShowMarketplace(equipmentId) {
            const equipment = equipmentDatabase.find(eq => eq.id === equipmentId);
            if (!equipment) return;
            
            // شبیه‌سازی چک کردن موجودی انبار
            const warehouseItems = [
                { name: 'Loss in Weight Feeder', inStock: false },
                { name: 'Mixer Drum Type', inStock: false },
                { name: 'Indurating Machine', inStock: false },
                { name: 'Updraft Drying Fan', inStock: true },
                { name: 'ESP Windbox Exhaust Gas', inStock: false }
            ];
            
            const inWarehouse = warehouseItems.some(item => 
                equipment.name.toLowerCase().includes(item.name.toLowerCase()) && item.inStock
            );
            
            if (!inWarehouse) {
                // نمایش در بازار تجهیزات
                const marketplaceItem = convertEquipmentToMarketplace(equipment);
                if (marketplaceItem) {
                    // اضافه کردن به marketplaceProducts اگر وجود نداشته باشد
                    const existingIndex = marketplaceProducts.findIndex(p => p.id === equipmentId);
                    if (existingIndex === -1) {
                        marketplaceProducts.push(marketplaceItem);
                    }
                    
                    // نمایش مودال بازار
                    showMarketplaceForEquipment(marketplaceItem, equipment);
                }
            } else {
                alert('این تجهیز در انبار موجود است.');
            }
        }

        // تبدیل تجهیز از equipmentDatabase به فرمت marketplace
        function convertEquipmentToMarketplace(equipment) {
            // پیدا کردن تعداد تأمین‌کنندگان بر اساس دسته‌بندی
            const supplierCounts = {
                'dosing': 18,
                'pelletizing': 15,
                'indurating': 12,
                'fans': 20,
                'dedusting': 16,
                'water': 14,
                'screening': 17,
                'safety': 10
            };
            
            const suppliers = supplierCounts[equipment.category] || 15;
            
            // پیدا کردن قیمت تقریبی بر اساس نوع تجهیز
            const priceRanges = {
                'Loss in Weight Feeder': { min: 350, max: 480 },
                'Mixer Drum Type': { min: 280, max: 380 },
                'Pelletizing Disc': { min: 850, max: 1200 },
                'Indurating Machine': { min: 25000, max: 35000 },
                'Updraft Drying Fan': { min: 1800, max: 2400 },
                'Hood Exhaust Gas Fan': { min: 1500, max: 2000 },
                'ESP Windbox Exhaust Gas': { min: 5000, max: 7500 },
                'Thickener': { min: 1200, max: 1800 },
                'Membrane Filter Press': { min: 2800, max: 3800 },
                'Product Screen': { min: 450, max: 650 }
            };
            
            let price = { min: 200, max: 350 };
            for (const [key, value] of Object.entries(priceRanges)) {
                if (equipment.name.includes(key)) {
                    price = value;
                    break;
                }
            }
            
            // تبدیل specifications به فرمت مناسب
            const specifications = {};
            if (equipment.specifications) {
                Object.entries(equipment.specifications).forEach(([key, value]) => {
                    specifications[key] = value;
                });
            }
            
            return {
                id: equipment.id,
                name: equipment.name,
                brand: equipment.manufacturer,
                model: equipment.model,
                category: mapCategory(equipment.category),
                price: price,
                unit: 'میلیون تومان',
                suppliers: suppliers,
                rating: 4.5 + Math.random() * 0.4, // بین 4.5 تا 4.9
                image: getCategoryIcon(equipment.category),
                description: equipment.section,
                specifications: specifications,
                dataSheet: equipment.dataSheet,
                delivery: '۸-۱۲ هفته',
                warranty: '۲۴ ماه',
                fromEquipmentDatabase: true // علامت برای شناسایی
            };
        }

        // تبدیل دسته‌بندی equipmentDatabase به marketplace
        function mapCategory(category) {
            const categoryMap = {
                'dosing': 'mechanical',
                'pelletizing': 'mechanical',
                'indurating': 'mechanical',
                'fans': 'mechanical',
                'dedusting': 'mechanical',
                'water': 'mechanical',
                'screening': 'mechanical',
                'electrical': 'electrical',
                'instrumentation': 'instrumentation',
                'automation': 'automation'
            };
            return categoryMap[category] || 'mechanical';
        }

        // دریافت آیکون بر اساس دسته‌بندی
        function getCategoryIcon(category) {
            const iconMap = {
                'dosing': 'fas fa-flask',
                'pelletizing': 'fas fa-circle-notch',
                'indurating': 'fas fa-fire',
                'fans': 'fas fa-wind',
                'dedusting': 'fas fa-filter',
                'water': 'fas fa-water',
                'screening': 'fas fa-th',
                'electrical': 'fas fa-bolt',
                'instrumentation': 'fas fa-tachometer-alt',
                'automation': 'fas fa-microchip'
            };
            return iconMap[category] || 'fas fa-cog';
        }

        // نمایش مودال بازار برای تجهیزات
        function showMarketplaceForEquipment(marketplaceItem, equipment) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.7);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 9999;
                padding: 2rem;
            `;
            
            modal.innerHTML = `
                <div style="
                    background: white;
                    border-radius: 16px;
                    padding: 2rem;
                    max-width: 800px;
                    width: 100%;
                    max-height: 90vh;
                    overflow-y: auto;
                    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                ">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h2 style="font-size: 1.5rem; font-weight: 700; color: #1a1a1a;">
                            <i class="fas fa-shopping-cart ml-2 text-blue-600"></i>
                            تجهیز در انبار موجود نیست - بررسی بازار
                        </h2>
                        <button onclick="this.closest('div[style*=\"position: fixed\"]').remove()" 
                                style="background: #f3f4f6; border: none; border-radius: 50%; width: 36px; height: 36px; cursor: pointer; font-size: 1.2rem;">
                            ×
                        </button>
                    </div>
                    
                    <div style="background: #fef3c7; border: 1px solid #fbbf24; border-radius: 8px; padding: 1rem; margin-bottom: 1.5rem;">
                        <div style="display: flex; align-items: center; gap: 0.5rem; color: #92400e;">
                            <i class="fas fa-exclamation-triangle"></i>
                            <strong>توجه:</strong> این تجهیز در انبار موجود نیست. در بازار ${marketplaceItem.suppliers} تأمین‌کننده فعال دارد.
                        </div>
                    </div>
                    
                    <div style="background: #f9fafb; border-radius: 12px; padding: 1.5rem; margin-bottom: 1.5rem;">
                        <h3 style="font-size: 1.2rem; font-weight: 600; margin-bottom: 1rem; color: #1a1a1a;">${marketplaceItem.name}</h3>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                            <div>
                                <div style="font-size: 0.875rem; color: #6b7280; margin-bottom: 0.25rem;">برند</div>
                                <div style="font-weight: 600; color: #1a1a1a;">${marketplaceItem.brand}</div>
                            </div>
                            <div>
                                <div style="font-size: 0.875rem; color: #6b7280; margin-bottom: 0.25rem;">مدل</div>
                                <div style="font-weight: 600; color: #1a1a1a;">${marketplaceItem.model}</div>
                            </div>
                            <div>
                                <div style="font-size: 0.875rem; color: #6b7280; margin-bottom: 0.25rem;">تعداد تأمین‌کنندگان</div>
                                <div style="font-weight: 600; color: #2563eb;">${marketplaceItem.suppliers} تأمین‌کننده</div>
                            </div>
                            <div>
                                <div style="font-size: 0.875rem; color: #6b7280; margin-bottom: 0.25rem;">قیمت</div>
                                <div style="font-weight: 600; color: #dc2626; font-size: 1.1rem;">
                                    ${marketplaceItem.price.min} - ${marketplaceItem.price.max} ${marketplaceItem.unit}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 0.75rem;">
                        <button onclick="showProductDetails('${marketplaceItem.id}'); this.closest('div[style*=\"position: fixed\"]').remove();" 
                                style="flex: 1; padding: 0.75rem; background: #2563eb; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                            <i class="fas fa-eye ml-1"></i>
                            مشاهده در بازار
                        </button>
                        <button onclick="this.closest('div[style*=\"position: fixed\"]').remove()" 
                                style="padding: 0.75rem 1.5rem; background: #f3f4f6; color: #1a1a1a; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                            بستن
                        </button>
                    </div>
                </div>
            `;
            
            modal.onclick = function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            };
            
            document.body.appendChild(modal);
        }

        // نمایش ساختار سلسله‌مراتبی تجهیزات
        function loadEquipmentHierarchy() {
            const container = document.getElementById('equipment-hierarchy');
            if (!container) return;
            
            let html = '';
            Object.entries(equipmentHierarchy).forEach(([mainCategory, mainData]) => {
                html += `
                    <div class="bg-white rounded-xl border border-gray-200 overflow-hidden shadow-sm mb-4">
                        <div class="bg-gradient-to-r from-gray-50 to-gray-100 p-4 border-b border-gray-200 cursor-pointer hover:bg-gray-200 transition"
                             onclick="toggleHierarchyCategory('${mainCategory}')">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <i class="${mainData.icon} text-2xl text-gray-700"></i>
                                    <h5 class="text-lg font-bold text-gray-900">${mainData.name}</h5>
                                </div>
                                <i class="fas fa-chevron-down text-gray-600 transition" id="icon-${mainCategory}"></i>
                            </div>
                        </div>
                        <div class="hidden" id="content-${mainCategory}">
                            <div class="p-4 space-y-4">
                `;
                
                Object.entries(mainData.subcategories).forEach(([subCategory, subData]) => {
                    html += `
                        <div class="bg-gray-50 rounded-lg border border-gray-200 overflow-hidden">
                            <div class="bg-gray-100 p-3 border-b border-gray-200 cursor-pointer hover:bg-gray-200 transition"
                                 onclick="toggleHierarchySubcategory('${mainCategory}-${subCategory}')">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-2">
                                        <i class="${subData.icon} text-lg text-gray-700"></i>
                                        <h6 class="font-semibold text-gray-900">${subData.name}</h6>
                                    </div>
                                    <i class="fas fa-chevron-down text-sm text-gray-600 transition" id="icon-${mainCategory}-${subCategory}"></i>
                                </div>
                            </div>
                            <div class="hidden p-3 space-y-2" id="content-${mainCategory}-${subCategory}">
                    `;
                    
                    subData.equipment.forEach((equip) => {
                        html += `
                            <div class="bg-white rounded-lg p-3 border border-gray-200 hover:border-cyan-500 hover:shadow-md transition cursor-pointer"
                                 onclick="showEquipmentWithInspection('${equip.category}', '${equip.name}', '${equip.dataSheet}', '${equip.inspectionFrequency}', ${equip.suppliers}, ${JSON.stringify(equip.avgPrice)})">
                                <div class="flex items-center justify-between">
                                    <div class="flex-1">
                                        <div class="font-semibold text-gray-900 mb-1">${equip.name}</div>
                                        <div class="flex items-center gap-4 text-xs text-gray-600">
                                            <span><i class="fas fa-calendar-check ml-1 text-green-600"></i> بازرسی: ${equip.inspectionFrequency}</span>
                                            <span><i class="fas fa-store ml-1 text-blue-600"></i> ${equip.suppliers} تأمین‌کننده</span>
                                            <span><i class="fas fa-money-bill-wave ml-1 text-purple-600"></i> ${equip.avgPrice.min}-${equip.avgPrice.max} میلیون</span>
                                        </div>
                                    </div>
                                    <button class="ml-3 px-3 py-1.5 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg text-sm font-medium transition">
                                        <i class="fas fa-eye ml-1"></i>
                                        مشاهده
                                    </button>
                                </div>
                            </div>
                        `;
                    });
                    
                    html += `
                            </div>
                        </div>
                    `;
                });
                
                html += `
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // Toggle برای دسته‌بندی اصلی
        function toggleHierarchyCategory(category) {
            const content = document.getElementById('content-' + category);
            const icon = document.getElementById('icon-' + category);
            if (content && icon) {
                if (content.classList.contains('hidden')) {
                    content.classList.remove('hidden');
                    icon.style.transform = 'rotate(180deg)';
                } else {
                    content.classList.add('hidden');
                    icon.style.transform = 'rotate(0deg)';
                }
            }
        }

        // Toggle برای زیردسته‌بندی
        function toggleHierarchySubcategory(subCategory) {
            const content = document.getElementById('content-' + subCategory);
            const icon = document.getElementById('icon-' + subCategory);
            if (content && icon) {
                if (content.classList.contains('hidden')) {
                    content.classList.remove('hidden');
                    icon.style.transform = 'rotate(180deg)';
                } else {
                    content.classList.add('hidden');
                    icon.style.transform = 'rotate(0deg)';
                }
            }
        }

        // نمایش تجهیز با جزئیات بازرسی
        function showEquipmentWithInspection(category, name, dataSheet, inspectionFrequency, suppliers, avgPrice) {
            const modal = document.createElement('div');
            modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 9999; display: flex; align-items: center; justify-content: center; padding: 2rem;';
            
            modal.innerHTML = `
                <div style="background: white; border-radius: 16px; padding: 2rem; max-width: 800px; width: 100%; max-height: 90vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h2 style="font-size: 1.5rem; font-weight: 700; color: #1a1a1a;">${name}</h2>
                        <button onclick="this.closest('div[style*=\"position: fixed\"]').remove()" style="background: #f3f4f6; border: none; border-radius: 50%; width: 36px; height: 36px; cursor: pointer; font-size: 1.2rem;">×</button>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-bottom: 1.5rem;">
                        <div style="background: #fef3c7; border: 1px solid #fbbf24; border-radius: 8px; padding: 1rem;">
                            <div style="font-size: 0.875rem; color: #92400e; margin-bottom: 0.5rem;">فرکانس بازرسی</div>
                            <div style="font-size: 1.5rem; font-weight: 700; color: #92400e;"><i class="fas fa-calendar-check ml-1"></i>${inspectionFrequency}</div>
                        </div>
                        <div style="background: #dbeafe; border: 1px solid #3b82f6; border-radius: 8px; padding: 1rem;">
                            <div style="font-size: 0.875rem; color: #1e40af; margin-bottom: 0.5rem;">تعداد تأمین‌کنندگان</div>
                            <div style="font-size: 1.5rem; font-weight: 700; color: #1e40af;"><i class="fas fa-store ml-1"></i>${suppliers}</div>
                        </div>
                        <div style="background: #ede9fe; border: 1px solid #8b5cf6; border-radius: 8px; padding: 1rem;">
                            <div style="font-size: 0.875rem; color: #5b21b6; margin-bottom: 0.5rem;">قیمت تقریبی</div>
                            <div style="font-size: 1.5rem; font-weight: 700; color: #5b21b6;">${avgPrice.min} - ${avgPrice.max} میلیون تومان</div>
                        </div>
                        <div style="background: #dcfce7; border: 1px solid #22c55e; border-radius: 8px; padding: 1rem;">
                            <div style="font-size: 0.875rem; color: #166534; margin-bottom: 0.5rem;">دیتا شیت</div>
                            <div style="font-size: 0.875rem; font-weight: 600; color: #166534; word-break: break-all;">${dataSheet}</div>
                        </div>
                    </div>
                    <div style="display: flex; gap: 0.75rem;">
                        <button onclick="checkWarehouseAndShowMarketplace('${category}'); this.closest('div[style*=\"position: fixed\"]').remove();" 
                                style="flex: 1; padding: 0.75rem; background: #2563eb; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                            <i class="fas fa-shopping-cart ml-1"></i>مشاهده در بازار
                        </button>
                        <button onclick="this.closest('div[style*=\"position: fixed\"]').remove()" 
                                style="padding: 0.75rem 1.5rem; background: #f3f4f6; color: #1a1a1a; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                            بستن
                        </button>
                    </div>
                </div>
            `;
            
            modal.onclick = function(e) {
                if (e.target === modal) modal.remove();
            };
            document.body.appendChild(modal);
        }

        // جستجوی هوشمند با AI
        function handleAISearch(event) {
            if (event.key === 'Enter') performAISearch();
        }

        function performAISearch() {
            const query = document.getElementById('ai-equipment-search')?.value;
            if (!query || !query.trim()) return;
            
            const resultsDiv = document.getElementById('ai-search-results');
            if (!resultsDiv) return;
            
            resultsDiv.classList.remove('hidden');
            resultsDiv.innerHTML = '<div class="text-center py-4"><i class="fas fa-spinner fa-spin text-2xl text-cyan-600"></i><p class="mt-2 text-gray-600">در حال جستجو با هوش مصنوعی...</p></div>';
            
            setTimeout(() => {
                const results = performIntelligentSearch(query);
                displayAISearchResults(results, query);
            }, 1000);
        }

        function performIntelligentSearch(query) {
            const lowerQuery = query.toLowerCase();
            const results = [];
            
            Object.entries(equipmentHierarchy).forEach(([mainCategory, mainData]) => {
                Object.entries(mainData.subcategories).forEach(([subCategory, subData]) => {
                    subData.equipment.forEach(equip => {
                        const equipName = equip.name.toLowerCase();
                        const inspectionFreq = equip.inspectionFrequency.toLowerCase();
                        
                        if (equipName.includes(lowerQuery) || 
                            lowerQuery.includes(equipName.split(' ')[0]) ||
                            (lowerQuery.includes('بازرسی') && inspectionFreq.includes(lowerQuery.split(' ')[1] || '')) ||
                            (lowerQuery.includes('فن') && equipName.includes('fan')) ||
                            (lowerQuery.includes('پمپ') && equipName.includes('pump'))) {
                            results.push({
                                ...equip,
                                mainCategory: mainData.name,
                                subCategory: subData.name,
                                matchScore: calculateMatchScore(equip, lowerQuery)
                            });
                        }
                    });
                });
            });
            
            results.sort((a, b) => b.matchScore - a.matchScore);
            return results.slice(0, 10);
        }

        function calculateMatchScore(equip, query) {
            let score = 0;
            const equipName = equip.name.toLowerCase();
            if (equipName === query) score += 100;
            else if (equipName.includes(query)) score += 50;
            else if (query.includes(equipName.split(' ')[0])) score += 30;
            if (equip.inspectionFrequency.toLowerCase().includes(query)) score += 20;
            return score;
        }

        function displayAISearchResults(results, query) {
            const resultsDiv = document.getElementById('ai-search-results');
            if (!resultsDiv) return;
            
            if (results.length === 0) {
                resultsDiv.innerHTML = `<div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4"><div class="flex items-center gap-2 text-yellow-800"><i class="fas fa-info-circle"></i><span>نتیجه‌ای یافت نشد.</span></div></div>`;
                return;
            }
            
            let html = `<div class="bg-white rounded-lg border border-gray-200 p-4"><div class="flex items-center gap-2 mb-4"><i class="fas fa-check-circle text-green-600"></i><span class="font-semibold text-gray-900">${results.length} نتیجه پیدا شد برای "${query}"</span></div><div class="space-y-2">`;
            
            results.forEach(equip => {
                html += `<div class="bg-gray-50 rounded-lg p-3 border border-gray-200 hover:border-cyan-500 hover:shadow-md transition cursor-pointer" onclick="showEquipmentWithInspection('${equip.category}', '${equip.name}', '${equip.dataSheet}', '${equip.inspectionFrequency}', ${equip.suppliers}, ${JSON.stringify(equip.avgPrice)})"><div class="flex items-center justify-between"><div class="flex-1"><div class="font-semibold text-gray-900 mb-1">${equip.name}</div><div class="text-xs text-gray-600"><span class="ml-3">${equip.mainCategory}</span><span class="mx-2">•</span><span>${equip.subCategory}</span></div></div><div class="flex items-center gap-4 text-xs text-gray-600 mr-4"><span><i class="fas fa-calendar-check ml-1 text-green-600"></i> ${equip.inspectionFrequency}</span><span><i class="fas fa-store ml-1 text-blue-600"></i> ${equip.suppliers} تأمین‌کننده</span></div></div></div>`;
            });
            
            html += `</div></div>`;
            resultsDiv.innerHTML = html;
        }

        // داده‌های کارخانه‌ها (زنجیره فولاد - 6 کارخانه - مرتب شده)
        const factoriesData = {
            'factory-1': {
                id: 'factory-1',
                name: 'گندله‌سازی',
                icon: 'fas fa-fire',
                color: 'cyan',
                capacity: '۵ میلیون تن/سال',
                production: '۵',
                lines: ['خط تولید ۱', 'خط تولید ۲'],
                description: 'کارخانه تولید گندله آهن با کوره ایندوریت'
            },
            'factory-2': {
                id: 'factory-2',
                name: 'کنسانتره',
                icon: 'fas fa-filter',
                color: 'blue',
                capacity: '۳.۵ میلیون تن/سال',
                production: '۳.۵',
                lines: ['مدار خردایش', 'فلوتاسیون'],
                description: 'کارخانه تولید کنسانتره آهن'
            },
            'factory-3': {
                id: 'factory-3',
                name: 'فولادسازی',
                icon: 'fas fa-industry',
                color: 'yellow',
                capacity: '۲.۸ میلیون تن/سال',
                production: '۲.۸',
                lines: ['کوره قوس الکتریکی', 'پاتیل تصفیه'],
                description: 'کارخانه تولید فولاد با کوره قوس الکتریکی'
            },
            'factory-4': {
                id: 'factory-4',
                name: 'خردایش',
                icon: 'fas fa-hammer',
                color: 'orange',
                capacity: '۴.۵ میلیون تن/سال',
                production: '۴.۵',
                lines: ['خط خردایش ۱', 'خط خردایش ۲'],
                description: 'کارخانه خردایش سنگ آهن با ظرفیت بالا'
            },
            'factory-5': {
                id: 'factory-5',
                name: 'نورد',
                icon: 'fas fa-compress-arrows-alt',
                color: 'purple',
                capacity: '۲.۵ میلیون تن/سال',
                production: '۲.۵',
                lines: ['خط نورد گرم', 'خط نورد سرد'],
                description: 'کارخانه نورد فولاد گرم و سرد'
            },
            'factory-6': {
                id: 'factory-6',
                name: 'احیاء مستقیم',
                icon: 'fas fa-atom',
                color: 'pink',
                capacity: '۱.۸ میلیون تن/سال',
                production: '۱.۸',
                lines: ['کوره احیاء'],
                description: 'کارخانه احیاء مستقیم آهن'
            }
        };
        
        // متغیر برای مدیریت مراحل
        let currentFactoryStep = 0;
        const factorySteps = ['site-plan', 'equipment', 'analysis', 'maintenance', 'inspection', 'technical-office', 'production', 'repair-request'];
        
        // متغیر برای مدیریت اسلایدر سایت پلن
        let currentFactorySitePlanSlide = 0;
        const factorySitePlanImages = [
            'images/site-plan.JPG',
            'images/site-plan-2.JPG',
            'images/site-plan-3.JPG',
            'images/site-plan-4.JPG',
            'images/site-plan-5.JPG',
            'images/site-plan-6.JPG'
        ];
        
        // بارگذاری سایت پلن خطی کارخانه‌ها
        function loadFactoryTimeline() {
            const timeline = document.getElementById('factory-timeline');
            if (!timeline) return;
            
            timeline.innerHTML = Object.values(factoriesData).map((factory, index) => {
                const colors = {
                    cyan: { bg: 'from-cyan-500 to-cyan-600', text: 'text-cyan-600', border: 'border-cyan-500' },
                    blue: { bg: 'from-blue-500 to-blue-600', text: 'text-blue-600', border: 'border-blue-500' },
                    yellow: { bg: 'from-yellow-500 to-yellow-600', text: 'text-yellow-600', border: 'border-yellow-500' },
                    purple: { bg: 'from-purple-500 to-purple-600', text: 'text-purple-600', border: 'border-purple-500' },
                    pink: { bg: 'from-pink-500 to-pink-600', text: 'text-pink-600', border: 'border-pink-500' },
                    gray: { bg: 'from-gray-600 to-gray-700', text: 'text-gray-700', border: 'border-gray-600' }
                };
                const color = colors[factory.color];
                
                return `
                    <div class="flex flex-col items-center cursor-pointer group" onclick="selectFactory('${factory.id}', '${factory.name}')" style="flex: 1;">
                        <div class="relative z-10 w-20 h-20 bg-gradient-to-br ${color.bg} rounded-full flex items-center justify-center shadow-lg transform transition-all duration-300 group-hover:scale-110 group-hover:shadow-xl border-4 border-white">
                            <i class="${factory.icon} text-white text-2xl"></i>
                        </div>
                        <div class="mt-3 text-center">
                            <h4 class="font-bold text-sm ${color.text} group-hover:underline">${factory.name}</h4>
                            <p class="text-xs text-gray-600 mt-1">${factory.capacity}</p>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // متغیر برای ذخیره کارخانه انتخاب شده
        let selectedFactoryId = null;
        
        // انتخاب کارخانه و نمایش اطلاعات (شروع از مرحله اول)
        function selectFactory(factoryId, factoryName) {
            const factory = factoriesData[factoryId];
            if (!factory) return;
            
            selectedFactoryId = factoryId;
            currentFactoryStep = 0; // شروع از مرحله اول
            
            const infoDiv = document.getElementById('selected-factory-info');
            const headerNameDiv = document.getElementById('selected-factory-header-name');
            const headerCapacityDiv = document.getElementById('selected-factory-header-capacity');
            const headerIconDiv = document.getElementById('selected-factory-header-icon');
            
            if (!infoDiv || !headerNameDiv || !headerCapacityDiv || !headerIconDiv) return;
            
            // به‌روزرسانی هدر
            headerNameDiv.textContent = factoryName;
            headerCapacityDiv.textContent = `ظرفیت: ${factory.capacity}`;
            headerIconDiv.className = `${factory.icon} text-white text-xl`;
            
            infoDiv.style.display = 'block';
            
            // بارگذاری مرحله اول (سایت پلن)
            goToFactoryStep(0);
            
            // اسکرول به بخش اطلاعات
            infoDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        
        // رفتن به مرحله خاص
        function goToFactoryStep(stepIndex) {
            if (!selectedFactoryId) return;
            
            const factory = factoriesData[selectedFactoryId];
            if (!factory) return;
            
            currentFactoryStep = stepIndex;
            const step = factorySteps[stepIndex];
            const contentDiv = document.getElementById('selected-factory-content');
            
            if (!contentDiv) return;
            
            // به‌روزرسانی نوار پیشرفت
            updateFactoryProgressBar();
            
            // بارگذاری محتوای مرحله
            if (step === 'site-plan') {
                loadFactorySitePlan(factory);
            } else if (step === 'equipment') {
                loadFactoryEquipmentStep(factory);
            } else if (step === 'analysis') {
                loadFactoryAnalysisStep(factory);
            } else if (step === 'maintenance') {
                loadFactoryMaintenanceStep(factory);
            } else if (step === 'inspection') {
                loadFactoryInspectionStep(factory);
            } else if (step === 'technical-office') {
                loadFactoryTechnicalOfficeStep(factory);
            } else if (step === 'production') {
                loadFactoryProductionStep(factory);
            } else if (step === 'repair-request') {
                loadFactoryRepairRequestStep(factory);
            }
        }
        
        // به‌روزرسانی نوار پیشرفت
        function updateFactoryProgressBar() {
            // نوار پیشرفت به صورت خودکار با render شدن HTML به‌روز می‌شود
            const infoDiv = document.getElementById('selected-factory-info');
            if (infoDiv) {
                const progressBar = infoDiv.querySelector('.flex.items-center.justify-between');
                if (progressBar) {
                    // Re-render progress bar
                    const factory = factoriesData[selectedFactoryId];
                    if (factory) {
                        // Progress bar در HTML به صورت داینامیک render می‌شود
                    }
                }
            }
        }
        
        // بارگذاری سایت پلن
        function loadFactorySitePlan(factory) {
            const contentDiv = document.getElementById('selected-factory-content');
            if (!contentDiv) return;
            
            // برای گندله‌سازی: نمایش تمام عکس‌ها به صورت اسلایدی
            const isPelletizing = factory.name === 'گندله‌سازی';
            
            // نکات کلیدی کارخانه
            const keyPoints = {
                'گندله‌سازی': [
                    'ظرفیت تولید: ۵ میلیون تن/سال',
                    'کوره ایندوریت با دمای ۱,۲۵۰°C',
                    'سیستم کنترل پیشرفته',
                    'راندمان: ۹۶.۷%'
                ],
                'کنسانتره': [
                    'ظرفیت تولید: ۳.۵ میلیون تن/سال',
                    'سیستم فلوتاسیون پیشرفته',
                    'مدار خردایش بهینه',
                    'راندمان: ۹۴.۲%'
                ],
                'خردایش': [
                    'ظرفیت تولید: ۴.۵ میلیون تن/سال',
                    'سرعت خردایش: ۲۲۰ تن/ساعت',
                    'اندازه خروجی: ۰-۲۵ mm',
                    'راندمان: ۹۳.۵%'
                ],
                'فولادسازی': [
                    'ظرفیت تولید: ۲.۸ میلیون تن/سال',
                    'کوره قوس الکتریکی',
                    'دمای کوره: ۱,۶۵۰°C',
                    'راندمان: ۸۷.۵%'
                ],
                'نورد': [
                    'ظرفیت تولید: ۲.۵ میلیون تن/سال',
                    'خط نورد گرم و سرد',
                    'سرعت نورد: ۱۲ m/s',
                    'راندمان: ۹۲.۸%'
                ],
                'احیاء مستقیم': [
                    'ظرفیت تولید: ۱.۸ میلیون تن/سال',
                    'کوره احیاء',
                    'دمای کوره: ۸۵۰°C',
                    'راندمان: ۹۱.۵%'
                ]
            };
            
            // تعیین تصویر سایت پلن بر اساس کارخانه
            let sitePlanImage = 'images/site-plan.JPG';
            if (factory.name === 'گندله‌سازی') {
                sitePlanImage = 'images/site-plan-2.JPG';
            } else if (factory.name === 'کنسانتره') {
                sitePlanImage = 'images/site-plan-3.JPG';
            } else if (factory.name === 'فولادسازی') {
                sitePlanImage = 'images/site-plan-4.JPG';
            } else if (factory.name === 'نورد') {
                sitePlanImage = 'images/site-plan-5.JPG';
            } else if (factory.name === 'احیاء مستقیم') {
                sitePlanImage = 'images/site-plan-6.JPG';
            }
            
            contentDiv.innerHTML = `
                <div class="text-center mb-4">
                    <h2 class="text-xl font-bold text-gray-900 mb-1">سایت پلن ${factory.name}</h2>
                    <p class="text-sm text-gray-600">نقشه و موقعیت تجهیزات کارخانه</p>
                </div>
                
                <!-- نکات کلیدی (پستر کارخانه) - در کنار لوگو -->
                <div class="bg-white border border-gray-200 rounded-lg p-4 mb-4">
                    <div class="flex items-start gap-4">
                        <div class="w-16 h-16 bg-gradient-to-br from-cyan-500 to-blue-500 rounded-lg flex items-center justify-center flex-shrink-0">
                            <i class="${factory.icon} text-white text-2xl"></i>
                        </div>
                        <div class="flex-1">
                            <h3 class="text-lg font-bold text-gray-900 mb-3">${factory.name}</h3>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                ${(keyPoints[factory.name] || []).map(point => `
                                    <div class="flex items-center gap-2">
                                        <i class="fas fa-check-circle text-green-600 text-sm"></i>
                                        <span class="text-xs font-medium text-gray-900">${point}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>
                
                ${isPelletizing ? `
                    <!-- اسلایدر سایت پلن برای گندله‌سازی -->
                    <div class="bg-white rounded-lg border border-gray-200 mb-4 overflow-hidden">
                        <div class="relative">
                            <div class="site-plan-slider-wrapper" style="position: relative; overflow: hidden;">
                                <div class="site-plan-slider" id="factory-site-plan-slider" style="display: flex; transition: transform 0.5s ease;">
                                    ${factorySitePlanImages.map((img, index) => `
                                        <div class="site-plan-slide ${index === 0 ? 'active' : ''}" style="min-width: 100%; flex-shrink: 0;">
                                            <div class="relative" style="height: 400px;">
                                                <img src="${img}" alt="سایت پلن ${index + 1}" 
                                                     class="w-full h-full object-contain cursor-pointer hover:opacity-90 transition"
                                                     onclick="window.open('${img}', '_blank')">
                                                <div class="absolute top-2 left-2 bg-white/90 backdrop-blur-sm rounded-lg px-2 py-1 border border-gray-200">
                                                    <span class="text-xs font-medium text-gray-900">سایت پلن ${index + 1}</span>
                                                </div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <!-- دکمه‌های کنترل -->
                            <div class="flex items-center justify-between p-3 bg-gray-50 border-t border-gray-200">
                                <button onclick="previousFactorySitePlanSlide()" 
                                        class="px-4 py-2 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg text-sm font-medium transition">
                                    <i class="fas fa-chevron-right ml-1"></i>
                                    قبلی
                                </button>
                                <div class="flex gap-2" id="site-plan-indicators">
                                    ${factorySitePlanImages.map((_, index) => `
                                        <button onclick="goToFactorySitePlanSlide(${index})" 
                                                class="w-2 h-2 rounded-full transition ${index === 0 ? 'bg-cyan-600' : 'bg-gray-300'}"
                                                id="factory-indicator-${index}"></button>
                                    `).join('')}
                                </div>
                                <button onclick="nextFactorySitePlanSlide()" 
                                        class="px-4 py-2 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg text-sm font-medium transition">
                                    بعدی
                                    <i class="fas fa-chevron-left ml-1"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                ` : `
                    <!-- سایت پلن برای سایر کارخانه‌ها -->
                    <div class="bg-white rounded-lg border border-gray-200 mb-4 overflow-hidden">
                        <div class="relative" style="height: 400px;">
                            <img src="${sitePlanImage}" alt="سایت پلن ${factory.name}" 
                                 class="w-full h-full object-contain cursor-pointer hover:opacity-90 transition"
                                 onclick="window.open('${sitePlanImage}', '_blank')">
                            <div class="absolute top-2 left-2 bg-white/90 backdrop-blur-sm rounded-lg px-2 py-1 border border-gray-200">
                                <span class="text-xs font-medium text-gray-900">برای مشاهده در اندازه بزرگ کلیک کنید</span>
                            </div>
                        </div>
                    </div>
                `}
                
                <div class="flex justify-end gap-3">
                    <button onclick="goToFactoryStep(${currentFactoryStep + 1})" 
                            class="px-6 py-3 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg font-medium transition flex items-center gap-2">
                        مرحله بعد
                        <i class="fas fa-arrow-left"></i>
                    </button>
                </div>
            `;
            
            // اگر گندله‌سازی است، اسلایدر را راه‌اندازی کن
            if (isPelletizing) {
                currentFactorySitePlanSlide = 0;
            }
        }
        
        // توابع کنترل اسلایدر سایت پلن کارخانه
        function nextFactorySitePlanSlide() {
            if (currentFactorySitePlanSlide < factorySitePlanImages.length - 1) {
                currentFactorySitePlanSlide++;
                updateFactorySitePlanSlider();
            }
        }
        
        function previousFactorySitePlanSlide() {
            if (currentFactorySitePlanSlide > 0) {
                currentFactorySitePlanSlide--;
                updateFactorySitePlanSlider();
            }
        }
        
        function goToFactorySitePlanSlide(index) {
            currentFactorySitePlanSlide = index;
            updateFactorySitePlanSlider();
        }
        
        function updateFactorySitePlanSlider() {
            const slider = document.getElementById('factory-site-plan-slider');
            if (!slider) return;
            
            slider.style.transform = `translateX(-${currentFactorySitePlanSlide * 100}%)`;
            
            // به‌روزرسانی اندیکاتورها
            factorySitePlanImages.forEach((_, index) => {
                const indicator = document.getElementById(`factory-indicator-${index}`);
                if (indicator) {
                    if (index === currentFactorySitePlanSlide) {
                        indicator.classList.remove('bg-gray-300');
                        indicator.classList.add('bg-cyan-600');
                    } else {
                        indicator.classList.remove('bg-cyan-600');
                        indicator.classList.add('bg-gray-300');
                    }
                }
            });
        }
        
        // بارگذاری بانک تجهیزات
        function loadFactoryEquipmentStep(factory) {
            const contentDiv = document.getElementById('selected-factory-content');
            if (!contentDiv) return;
            
            const filteredEquipment = equipmentDatabase.filter(eq => 
                eq.section.includes(factory.name) || factory.lines.some(line => eq.location.includes(line))
            );
            
            contentDiv.innerHTML = `
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-900 mb-2">بانک اطلاعاتی تجهیزات ${factory.name}</h2>
                    <p class="text-gray-600">لیست کامل تجهیزات و مشخصات فنی</p>
                </div>
                <div class="mb-4">
                    <input type="text" placeholder="جستجوی تجهیزات..." 
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500"
                           onkeyup="searchFactoryEquipment(this.value)">
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6 max-h-96 overflow-y-auto">
                    ${filteredEquipment.length > 0 ? filteredEquipment.map(eq => `
                        <div class="bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition cursor-pointer" onclick="showEquipmentDetails('${eq.id}')">
                            <div class="flex items-center justify-between mb-2">
                                <h5 class="font-semibold text-gray-900">${eq.name}</h5>
                                <span class="px-2 py-1 rounded text-xs font-medium ${
                                    eq.status === 'فعال' ? 'bg-green-100 text-green-700' : 
                                    eq.status === 'نیاز به بازرسی' ? 'bg-yellow-100 text-yellow-700' : 
                                    'bg-red-100 text-red-700'
                                }">${eq.status}</span>
                            </div>
                            <p class="text-xs text-gray-600 mb-2">${eq.section} - ${eq.location}</p>
                            <div class="flex items-center justify-between text-xs text-gray-500">
                                <span>کد: ${eq.id}</span>
                                <span>${eq.manufacturer}</span>
                            </div>
                        </div>
                    `).join('') : '<p class="col-span-3 text-center text-gray-500 py-8">تجهیزاتی یافت نشد</p>'}
                </div>
                <div class="flex justify-between gap-3">
                    <button onclick="goToFactoryStep(${currentFactoryStep - 1})" 
                            class="px-6 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg font-medium transition flex items-center gap-2">
                        <i class="fas fa-arrow-right"></i>
                        مرحله قبل
                    </button>
                    <button onclick="goToFactoryStep(${currentFactoryStep + 1})" 
                            class="px-6 py-3 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg font-medium transition flex items-center gap-2">
                        مرحله بعد
                        <i class="fas fa-arrow-left"></i>
                    </button>
                </div>
            `;
        }
        
        // بارگذاری تحلیل خرابی
        function loadFactoryAnalysisStep(factory) {
            const contentDiv = document.getElementById('selected-factory-content');
            if (!contentDiv) return;
            
            const factoryPredictions = failurePredictions.filter(pred => 
                pred.section.includes(factory.name) || factory.lines.some(line => pred.equipmentName.includes(line))
            );
            
            contentDiv.innerHTML = `
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-900 mb-2">تحلیل خرابی ${factory.name}</h2>
                    <p class="text-gray-600">پیش‌بینی و تحلیل خرابی تجهیزات</p>
                </div>
                ${factoryPredictions.length > 0 ? `
                    <div class="space-y-4 mb-6">
                        ${factoryPredictions.map(pred => {
                            const riskText = pred.riskLevel === 'high' ? 'ریسک بالا' : pred.riskLevel === 'medium' ? 'ریسک متوسط' : 'ریسک پایین';
                            return `
                                <div class="bg-white border-l-4 ${pred.riskLevel === 'high' ? 'border-red-500' : pred.riskLevel === 'medium' ? 'border-orange-500' : 'border-green-500'} rounded-lg p-4 border border-gray-200">
                                    <div class="flex items-center justify-between mb-2">
                                        <h5 class="font-semibold text-gray-900">${pred.equipmentName}</h5>
                                        <span class="px-3 py-1 rounded text-sm font-medium ${
                                            pred.riskLevel === 'high' ? 'bg-red-100 text-red-700' : 
                                            pred.riskLevel === 'medium' ? 'bg-orange-100 text-orange-700' : 
                                            'bg-green-100 text-green-700'
                                        }">${riskText}</span>
                                    </div>
                                    <p class="text-sm text-gray-600 mb-2">${pred.failureType}</p>
                                    <div class="grid grid-cols-3 gap-4 text-sm">
                                        <div>
                                            <span class="text-gray-500">احتمال:</span>
                                            <span class="font-semibold text-red-600 mr-2">${pred.probability}%</span>
                                        </div>
                                        <div>
                                            <span class="text-gray-500">روزهای باقیمانده:</span>
                                            <span class="font-semibold text-orange-600 mr-2">${pred.daysRemaining}</span>
                                        </div>
                                        <div>
                                            <span class="text-gray-500">تاریخ پیش‌بینی:</span>
                                            <span class="font-semibold text-gray-700 mr-2">${pred.predictedFailureDate}</span>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                ` : '<p class="text-center text-gray-500 py-8 mb-6">هیچ پیش‌بینی خرابی برای این کارخانه وجود ندارد</p>'}
                <div class="flex justify-between gap-3">
                    <button onclick="goToFactoryStep(${currentFactoryStep - 1})" 
                            class="px-6 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg font-medium transition flex items-center gap-2">
                        <i class="fas fa-arrow-right"></i>
                        مرحله قبل
                    </button>
                    <button onclick="goToFactoryStep(${currentFactoryStep + 1})" 
                            class="px-6 py-3 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg font-medium transition flex items-center gap-2">
                        مرحله بعد
                        <i class="fas fa-arrow-left"></i>
                    </button>
                </div>
            `;
        }
        
        // بارگذاری تعمیرات
        function loadFactoryMaintenanceStep(factory) {
            const contentDiv = document.getElementById('selected-factory-content');
            if (!contentDiv) return;
            
            contentDiv.innerHTML = `
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-900 mb-2">تعمیرات و نگهداری ${factory.name}</h2>
                    <p class="text-gray-600">برنامه‌ریزی و مدیریت تعمیرات</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div class="bg-gradient-to-br from-red-50 to-orange-50 rounded-xl p-6 border border-red-200">
                        <h4 class="font-bold text-lg text-gray-900 mb-4">ثبت درخواست تعمیرات</h4>
                        <button onclick="showRepairRequestModal('${factory.id}', '${factory.name}')" 
                                class="w-full py-3 bg-gradient-to-r from-red-600 to-orange-600 hover:from-red-700 hover:to-orange-700 text-white rounded-lg font-semibold transition shadow-lg flex items-center justify-center gap-2">
                            <i class="fas fa-tools"></i>
                            ثبت درخواست جدید
                        </button>
                    </div>
                    <div class="bg-gradient-to-br from-blue-50 to-cyan-50 rounded-xl p-6 border border-blue-200">
                        <h4 class="font-bold text-lg text-gray-900 mb-4">نیازمندی‌های نت/نگهداری</h4>
                        <div class="space-y-3">
                            <div class="bg-white rounded-lg p-3 border border-gray-200">
                                <p class="text-sm font-medium text-gray-900">برنامه‌ریزی تعمیرات دوره‌ای</p>
                                <p class="text-xs text-gray-600 mt-1">بررسی و برنامه‌ریزی تعمیرات پیشگیرانه</p>
                            </div>
                            <div class="bg-white rounded-lg p-3 border border-gray-200">
                                <p class="text-sm font-medium text-gray-900">بازرسی تجهیزات</p>
                                <p class="text-xs text-gray-600 mt-1">بازرسی دوره‌ای و کنترل کیفیت</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="flex justify-between gap-3">
                    <button onclick="goToFactoryStep(${currentFactoryStep - 1})" 
                            class="px-6 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg font-medium transition flex items-center gap-2">
                        <i class="fas fa-arrow-right"></i>
                        مرحله قبل
                    </button>
                    <button onclick="goToFactoryStep(${currentFactoryStep + 1})" 
                            class="px-6 py-3 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg font-medium transition flex items-center gap-2">
                        مرحله بعد
                        <i class="fas fa-arrow-left"></i>
                    </button>
                </div>
            `;
        }
        
        // بارگذاری بازرسی
        function loadFactoryInspectionStep(factory) {
            const contentDiv = document.getElementById('selected-factory-content');
            if (!contentDiv) return;
            
            contentDiv.innerHTML = `
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-900 mb-2">بازرسی و کنترل کیفیت ${factory.name}</h2>
                    <p class="text-gray-600">برنامه‌ریزی و گزارش بازرسی‌ها</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div class="bg-white rounded-xl p-6 border border-gray-200">
                        <h4 class="font-bold text-lg text-gray-900 mb-4">بازرسی‌های برنامه‌ریزی شده</h4>
                        <div class="space-y-3">
                            <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                                <div class="flex items-center justify-between mb-2">
                                    <h5 class="font-semibold text-gray-900">بازرسی دوره‌ای</h5>
                                    <span class="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs">فعال</span>
                                </div>
                                <p class="text-sm text-gray-600">بازرسی هفتگی تجهیزات اصلی</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl p-6 border border-gray-200">
                        <h4 class="font-bold text-lg text-gray-900 mb-4">گزارش بازرسی</h4>
                        <button class="w-full py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold transition">
                            <i class="fas fa-file-alt ml-2"></i>
                            ایجاد گزارش بازرسی جدید
                        </button>
                    </div>
                </div>
                <div class="flex justify-between gap-3">
                    <button onclick="goToFactoryStep(${currentFactoryStep - 1})" 
                            class="px-6 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg font-medium transition flex items-center gap-2">
                        <i class="fas fa-arrow-right"></i>
                        مرحله قبل
                    </button>
                    <button onclick="goToFactoryStep(${currentFactoryStep + 1})" 
                            class="px-6 py-3 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg font-medium transition flex items-center gap-2">
                        مرحله بعد
                        <i class="fas fa-arrow-left"></i>
                    </button>
                </div>
            `;
        }
        
        // بارگذاری دفتر فنی
        function loadFactoryTechnicalOfficeStep(factory) {
            const contentDiv = document.getElementById('selected-factory-content');
            if (!contentDiv) return;
            
            contentDiv.innerHTML = `
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-900 mb-2">دفتر فنی و مستندات ${factory.name}</h2>
                    <p class="text-gray-600">مستندات فنی، پروژه‌ها و گزارش‌ها</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div class="bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl p-6 border border-purple-200">
                        <h4 class="font-bold text-lg text-gray-900 mb-3">مستندات فنی</h4>
                        <div class="space-y-2">
                            <div class="bg-white rounded-lg p-3 border border-gray-200 cursor-pointer hover:border-purple-500 transition">
                                <i class="fas fa-file-pdf text-red-600 ml-2"></i>
                                <span class="text-sm text-gray-900">دیتا شیت تجهیزات</span>
                            </div>
                            <div class="bg-white rounded-lg p-3 border border-gray-200 cursor-pointer hover:border-purple-500 transition">
                                <i class="fas fa-file-alt text-blue-600 ml-2"></i>
                                <span class="text-sm text-gray-900">نقشه‌های فنی</span>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gradient-to-br from-blue-50 to-cyan-50 rounded-xl p-6 border border-blue-200">
                        <h4 class="font-bold text-lg text-gray-900 mb-3">پروژه‌های فنی</h4>
                        <div class="space-y-2">
                            <div class="bg-white rounded-lg p-3 border border-gray-200">
                                <p class="text-sm font-medium text-gray-900">بهینه‌سازی فرآیند</p>
                                <p class="text-xs text-gray-600 mt-1">در حال اجرا</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-6 border border-green-200">
                        <h4 class="font-bold text-lg text-gray-900 mb-3">گزارش‌های فنی</h4>
                        <button class="w-full py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition mb-2">
                            <i class="fas fa-file-alt ml-2"></i>
                            گزارش عملکرد
                        </button>
                    </div>
                </div>
                <div class="flex justify-between gap-3">
                    <button onclick="goToFactoryStep(${currentFactoryStep - 1})" 
                            class="px-6 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg font-medium transition flex items-center gap-2">
                        <i class="fas fa-arrow-right"></i>
                        مرحله قبل
                    </button>
                    <button onclick="goToFactoryStep(${currentFactoryStep + 1})" 
                            class="px-6 py-3 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg font-medium transition flex items-center gap-2">
                        مرحله بعد
                        <i class="fas fa-arrow-left"></i>
                    </button>
                </div>
            `;
        }
        
        // بارگذاری تولید
        function loadFactoryProductionStep(factory) {
            const contentDiv = document.getElementById('selected-factory-content');
            if (!contentDiv) return;
            
            contentDiv.innerHTML = `
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-900 mb-2">تولید و بهره‌وری ${factory.name}</h2>
                    <p class="text-gray-600">آمار تولید و راندمان</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                    <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-6 border border-green-200">
                        <div class="text-sm text-gray-600 mb-1">تولید روزانه</div>
                        <div class="text-3xl font-bold text-green-600 mb-1">${factory.production}</div>
                        <div class="text-xs text-gray-500">میلیون تن/سال</div>
                    </div>
                    <div class="bg-gradient-to-br from-blue-50 to-cyan-50 rounded-xl p-6 border border-blue-200">
                        <div class="text-sm text-gray-600 mb-1">راندمان</div>
                        <div class="text-3xl font-bold text-blue-600 mb-1">۹۶%</div>
                        <div class="text-xs text-gray-500">بهینه</div>
                    </div>
                    <div class="bg-gradient-to-br from-orange-50 to-amber-50 rounded-xl p-6 border border-orange-200">
                        <div class="text-sm text-gray-600 mb-1">کیفیت</div>
                        <div class="text-3xl font-bold text-orange-600 mb-1">۹۸%</div>
                        <div class="text-xs text-gray-500">عالی</div>
                    </div>
                    <div class="bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl p-6 border border-purple-200">
                        <div class="text-sm text-gray-600 mb-1">مصرف انرژی</div>
                        <div class="text-3xl font-bold text-purple-600 mb-1">۲.۴</div>
                        <div class="text-xs text-gray-500">MW</div>
                    </div>
                </div>
                <div class="flex justify-between gap-3">
                    <button onclick="goToFactoryStep(${currentFactoryStep - 1})" 
                            class="px-6 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg font-medium transition flex items-center gap-2">
                        <i class="fas fa-arrow-right"></i>
                        مرحله قبل
                    </button>
                    <button onclick="goToFactoryStep(${currentFactoryStep + 1})" 
                            class="px-6 py-3 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg font-medium transition flex items-center gap-2">
                        مرحله بعد
                        <i class="fas fa-arrow-left"></i>
                    </button>
                </div>
            `;
        }
        
        // بارگذاری ثبت درخواست تعمیرات
        function loadFactoryRepairRequestStep(factory) {
            const contentDiv = document.getElementById('selected-factory-content');
            if (!contentDiv) return;
            
            contentDiv.innerHTML = `
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-900 mb-2">ثبت درخواست تعمیرات ${factory.name}</h2>
                    <p class="text-gray-600">ثبت و مدیریت درخواست‌های تعمیرات</p>
                </div>
                <div class="max-w-2xl mx-auto">
                    <div class="bg-gradient-to-br from-red-50 to-orange-50 rounded-xl p-8 border border-red-200 mb-6">
                        <div class="text-center mb-6">
                            <div class="w-20 h-20 bg-gradient-to-br from-red-600 to-orange-600 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-tools text-white text-3xl"></i>
                            </div>
                            <h3 class="text-xl font-bold text-gray-900 mb-2">ثبت درخواست تعمیرات جدید</h3>
                            <p class="text-gray-600">برای ثبت درخواست تعمیرات، روی دکمه زیر کلیک کنید</p>
                        </div>
                        <button onclick="showRepairRequestModal('${factory.id}', '${factory.name}')" 
                                class="w-full py-4 bg-gradient-to-r from-red-600 to-orange-600 hover:from-red-700 hover:to-orange-700 text-white rounded-lg font-bold text-lg transition shadow-lg flex items-center justify-center gap-3">
                            <i class="fas fa-tools"></i>
                            ثبت درخواست تعمیرات
                        </button>
                    </div>
                </div>
                <div class="flex justify-center gap-3">
                    <button onclick="goToFactoryStep(${currentFactoryStep - 1})" 
                            class="px-6 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg font-medium transition flex items-center gap-2">
                        <i class="fas fa-arrow-right"></i>
                        مرحله قبل
                    </button>
                </div>
            `;
        }
        
        // نمایش تب‌های اصلی کارخانه
        function showFactoryMainTab(tabName) {
            if (!selectedFactoryId) return;
            
            const factory = factoriesData[selectedFactoryId];
            if (!factory) return;
            
            // به‌روزرسانی دکمه‌های تب
            document.querySelectorAll('.factory-main-tab-btn').forEach(btn => {
                btn.classList.remove('active', 'border-b-2', 'border-cyan-600', 'text-gray-700');
                btn.classList.add('text-gray-500');
            });
            if (event && event.target) {
                event.target.classList.add('active', 'border-b-2', 'border-cyan-600', 'text-gray-700');
                event.target.classList.remove('text-gray-500');
            }
            
            const contentDiv = document.getElementById('selected-factory-content');
            if (!contentDiv) return;
            
            if (tabName === 'equipment') {
                // بانک اطلاعاتی تجهیزات
                const filteredEquipment = equipmentDatabase.filter(eq => 
                    eq.section.includes(factory.name) || factory.lines.some(line => eq.location.includes(line))
                );
                
                contentDiv.innerHTML = `
                    <div>
                        <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
                            <i class="fas fa-database text-cyan-600"></i>
                            بانک اطلاعاتی تجهیزات ${factory.name}
                        </h3>
                        <div class="mb-4">
                            <input type="text" id="factory-equipment-search" placeholder="جستجوی تجهیزات..." 
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500"
                                   onkeyup="searchFactoryEquipment(this.value)">
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 max-h-96 overflow-y-auto">
                            ${filteredEquipment.length > 0 ? filteredEquipment.map(eq => `
                                <div class="bg-gray-50 rounded-lg p-4 border border-gray-200 hover:border-cyan-500 transition cursor-pointer" onclick="showEquipmentDetails('${eq.id}')">
                                    <div class="flex items-center justify-between mb-2">
                                        <h5 class="font-semibold text-gray-900">${eq.name}</h5>
                                        <span class="px-2 py-1 rounded text-xs font-medium ${
                                            eq.status === 'فعال' ? 'bg-green-100 text-green-700' : 
                                            eq.status === 'نیاز به بازرسی' ? 'bg-yellow-100 text-yellow-700' : 
                                            'bg-red-100 text-red-700'
                                        }">${eq.status}</span>
                                    </div>
                                    <p class="text-xs text-gray-600 mb-2">${eq.section} - ${eq.location}</p>
                                    <div class="flex items-center justify-between text-xs text-gray-500">
                                        <span>کد: ${eq.id}</span>
                                        <span>${eq.manufacturer}</span>
                                    </div>
                                </div>
                            `).join('') : '<p class="col-span-3 text-center text-gray-500 py-8">تجهیزاتی یافت نشد</p>'}
                        </div>
                    </div>
                `;
            } else if (tabName === 'analysis') {
                // تحلیل خرابی
                const factoryPredictions = failurePredictions.filter(pred => 
                    pred.section.includes(factory.name) || factory.lines.some(line => pred.equipmentName.includes(line))
                );
                
                contentDiv.innerHTML = `
                    <div>
                        <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
                            <i class="fas fa-exclamation-triangle text-red-600"></i>
                            تحلیل خرابی ${factory.name}
                        </h3>
                        ${factoryPredictions.length > 0 ? `
                            <div class="space-y-4">
                                ${factoryPredictions.map(pred => {
                                    const riskText = pred.riskLevel === 'high' ? 'ریسک بالا' : pred.riskLevel === 'medium' ? 'ریسک متوسط' : 'ریسک پایین';
                                    return `
                                        <div class="bg-gray-50 rounded-lg p-4 border-l-4 ${pred.riskLevel === 'high' ? 'border-red-500' : pred.riskLevel === 'medium' ? 'border-orange-500' : 'border-green-500'}">
                                            <div class="flex items-center justify-between mb-2">
                                                <h5 class="font-semibold text-gray-900">${pred.equipmentName}</h5>
                                                <span class="px-3 py-1 rounded text-sm font-medium ${
                                                    pred.riskLevel === 'high' ? 'bg-red-100 text-red-700' : 
                                                    pred.riskLevel === 'medium' ? 'bg-orange-100 text-orange-700' : 
                                                    'bg-green-100 text-green-700'
                                                }">${riskText}</span>
                                            </div>
                                            <p class="text-sm text-gray-600 mb-2">${pred.failureType}</p>
                                            <div class="grid grid-cols-3 gap-4 text-sm">
                                                <div>
                                                    <span class="text-gray-500">احتمال:</span>
                                                    <span class="font-semibold text-red-600 mr-2">${pred.probability}%</span>
                                                </div>
                                                <div>
                                                    <span class="text-gray-500">روزهای باقیمانده:</span>
                                                    <span class="font-semibold text-orange-600 mr-2">${pred.daysRemaining}</span>
                                                </div>
                                                <div>
                                                    <span class="text-gray-500">تاریخ پیش‌بینی:</span>
                                                    <span class="font-semibold text-gray-700 mr-2">${pred.predictedFailureDate}</span>
                                                </div>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        ` : '<p class="text-center text-gray-500 py-8">هیچ پیش‌بینی خرابی برای این کارخانه وجود ندارد</p>'}
                    </div>
                `;
            } else if (tabName === 'maintenance') {
                // تعمیرات و نگهداری
                contentDiv.innerHTML = `
                    <div>
                        <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
                            <i class="fas fa-tools text-orange-600"></i>
                            تعمیرات و نگهداری ${factory.name}
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-gradient-to-br from-red-50 to-orange-50 rounded-xl p-6 border border-red-200">
                                <h4 class="font-bold text-lg text-gray-900 mb-4">ثبت درخواست تعمیرات</h4>
                                <button onclick="showRepairRequestModal('${factory.id}', '${factory.name}')" 
                                        class="w-full py-3 bg-gradient-to-r from-red-600 to-orange-600 hover:from-red-700 hover:to-orange-700 text-white rounded-lg font-semibold transition shadow-lg flex items-center justify-center gap-2">
                                    <i class="fas fa-tools"></i>
                                    ثبت درخواست جدید
                                </button>
                            </div>
                            <div class="bg-gradient-to-br from-blue-50 to-cyan-50 rounded-xl p-6 border border-blue-200">
                                <h4 class="font-bold text-lg text-gray-900 mb-4">نیازمندی‌های نت/نگهداری</h4>
                                <div class="space-y-3">
                                    <div class="bg-white rounded-lg p-3 border border-gray-200">
                                        <p class="text-sm font-medium text-gray-900">برنامه‌ریزی تعمیرات دوره‌ای</p>
                                        <p class="text-xs text-gray-600 mt-1">بررسی و برنامه‌ریزی تعمیرات پیشگیرانه</p>
                                    </div>
                                    <div class="bg-white rounded-lg p-3 border border-gray-200">
                                        <p class="text-sm font-medium text-gray-900">بازرسی تجهیزات</p>
                                        <p class="text-xs text-gray-600 mt-1">بازرسی دوره‌ای و کنترل کیفیت</p>
                                    </div>
                                    <div class="bg-white rounded-lg p-3 border border-gray-200">
                                        <p class="text-sm font-medium text-gray-900">کالیبراسیون سنسورها</p>
                                        <p class="text-xs text-gray-600 mt-1">کالیبراسیون و تنظیم سنسورها</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (tabName === 'inspection') {
                // بازرسی
                contentDiv.innerHTML = `
                    <div>
                        <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
                            <i class="fas fa-search text-blue-600"></i>
                            بازرسی ${factory.name}
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-white rounded-xl p-6 border border-gray-200">
                                <h4 class="font-bold text-lg text-gray-900 mb-4">بازرسی‌های برنامه‌ریزی شده</h4>
                                <div class="space-y-3">
                                    <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                                        <div class="flex items-center justify-between mb-2">
                                            <h5 class="font-semibold text-gray-900">بازرسی دوره‌ای</h5>
                                            <span class="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs">فعال</span>
                                        </div>
                                        <p class="text-sm text-gray-600">بازرسی هفتگی تجهیزات اصلی</p>
                                    </div>
                                    <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                                        <div class="flex items-center justify-between mb-2">
                                            <h5 class="font-semibold text-gray-900">بازرسی ایمنی</h5>
                                            <span class="px-2 py-1 bg-green-100 text-green-700 rounded text-xs">تکمیل شده</span>
                                        </div>
                                        <p class="text-sm text-gray-600">بازرسی ایمنی ماهانه</p>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-white rounded-xl p-6 border border-gray-200">
                                <h4 class="font-bold text-lg text-gray-900 mb-4">گزارش بازرسی</h4>
                                <button class="w-full py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold transition">
                                    <i class="fas fa-file-alt ml-2"></i>
                                    ایجاد گزارش بازرسی جدید
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            } else if (tabName === 'technical-office') {
                // دفتر فنی
                contentDiv.innerHTML = `
                    <div>
                        <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
                            <i class="fas fa-clipboard-list text-purple-600"></i>
                            دفتر فنی ${factory.name}
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <div class="bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl p-6 border border-purple-200">
                                <h4 class="font-bold text-lg text-gray-900 mb-3">مستندات فنی</h4>
                                <div class="space-y-2">
                                    <div class="bg-white rounded-lg p-3 border border-gray-200 cursor-pointer hover:border-purple-500 transition">
                                        <i class="fas fa-file-pdf text-red-600 ml-2"></i>
                                        <span class="text-sm text-gray-900">دیتا شیت تجهیزات</span>
                                    </div>
                                    <div class="bg-white rounded-lg p-3 border border-gray-200 cursor-pointer hover:border-purple-500 transition">
                                        <i class="fas fa-file-alt text-blue-600 ml-2"></i>
                                        <span class="text-sm text-gray-900">نقشه‌های فنی</span>
                                    </div>
                                    <div class="bg-white rounded-lg p-3 border border-gray-200 cursor-pointer hover:border-purple-500 transition">
                                        <i class="fas fa-book text-green-600 ml-2"></i>
                                        <span class="text-sm text-gray-900">دستورالعمل‌ها</span>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-gradient-to-br from-blue-50 to-cyan-50 rounded-xl p-6 border border-blue-200">
                                <h4 class="font-bold text-lg text-gray-900 mb-3">پروژه‌های فنی</h4>
                                <div class="space-y-2">
                                    <div class="bg-white rounded-lg p-3 border border-gray-200">
                                        <p class="text-sm font-medium text-gray-900">بهینه‌سازی فرآیند</p>
                                        <p class="text-xs text-gray-600 mt-1">در حال اجرا</p>
                                    </div>
                                    <div class="bg-white rounded-lg p-3 border border-gray-200">
                                        <p class="text-sm font-medium text-gray-900">ارتقای سیستم</p>
                                        <p class="text-xs text-gray-600 mt-1">برنامه‌ریزی شده</p>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-6 border border-green-200">
                                <h4 class="font-bold text-lg text-gray-900 mb-3">گزارش‌های فنی</h4>
                                <button class="w-full py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition mb-2">
                                    <i class="fas fa-file-alt ml-2"></i>
                                    گزارش عملکرد
                                </button>
                                <button class="w-full py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition">
                                    <i class="fas fa-chart-bar ml-2"></i>
                                    گزارش آماری
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            } else if (tabName === 'ai-insights') {
                // بینش‌های هوش مصنوعی
                const factoryPredictions = failurePredictions.filter(pred => 
                    pred.section.includes(factory.name) || factory.lines.some(line => pred.equipmentName.includes(line))
                );
                
                contentDiv.innerHTML = `
                    <div>
                        <div class="bg-gradient-to-r from-purple-50 via-pink-50 to-red-50 rounded-xl p-6 mb-6 border border-purple-200">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="w-12 h-12 bg-gradient-to-br from-purple-600 to-pink-600 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-robot text-white text-xl"></i>
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold text-gray-900">تحلیل هوشمند با هوش مصنوعی</h3>
                                    <p class="text-sm text-gray-600">تحلیل پیشرفته داده‌ها با استفاده از هوش مصنوعی</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                            <!-- تحلیل بهره‌وری -->
                            <div class="bg-white rounded-xl p-6 border border-gray-200 shadow-sm">
                                <h4 class="font-bold text-lg text-gray-900 mb-4 flex items-center gap-2">
                                    <i class="fas fa-chart-line text-green-600"></i>
                                    تحلیل بهره‌وری با AI
                                </h4>
                                <div class="space-y-4">
                                    <div class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg p-4 border border-green-200">
                                        <div class="flex items-center justify-between mb-2">
                                            <span class="text-sm font-medium text-gray-700">راندمان کلی کارخانه</span>
                                            <span class="px-3 py-1 bg-green-100 text-green-700 rounded text-sm font-bold">۹۶.۷%</span>
                                        </div>
                                        <div class="text-xs text-gray-600 mt-2">
                                            <i class="fas fa-robot text-purple-600 ml-1"></i>
                                            AI پیشنهاد می‌کند: بهینه‌سازی مصرف انرژی می‌تواند راندمان را ۲.۳% افزایش دهد
                                        </div>
                                    </div>
                                    <div class="bg-gradient-to-r from-blue-50 to-cyan-50 rounded-lg p-4 border border-blue-200">
                                        <div class="flex items-center justify-between mb-2">
                                            <span class="text-sm font-medium text-gray-700">مصرف انرژی</span>
                                            <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded text-sm font-bold">۲.۴ MW</span>
                                        </div>
                                        <div class="text-xs text-gray-600 mt-2">
                                            <i class="fas fa-robot text-purple-600 ml-1"></i>
                                            AI پیشنهاد می‌کند: کاهش ۵% در مصرف انرژی با بهینه‌سازی زمان‌بندی
                                        </div>
                                    </div>
                                    <div class="bg-gradient-to-r from-orange-50 to-amber-50 rounded-lg p-4 border border-orange-200">
                                        <div class="flex items-center justify-between mb-2">
                                            <span class="text-sm font-medium text-gray-700">کیفیت محصول</span>
                                            <span class="px-3 py-1 bg-orange-100 text-orange-700 rounded text-sm font-bold">۹۸.۲%</span>
                                        </div>
                                        <div class="text-xs text-gray-600 mt-2">
                                            <i class="fas fa-robot text-purple-600 ml-1"></i>
                                            AI پیشنهاد می‌کند: بهبود پارامترهای فرآیند می‌تواند کیفیت را به ۹۹% برساند
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- پیش‌بینی خرابی با AI -->
                            <div class="bg-white rounded-xl p-6 border border-gray-200 shadow-sm">
                                <h4 class="font-bold text-lg text-gray-900 mb-4 flex items-center gap-2">
                                    <i class="fas fa-exclamation-triangle text-red-600"></i>
                                    پیش‌بینی خرابی با AI
                                </h4>
                                ${factoryPredictions.length > 0 ? `
                                    <div class="space-y-3 max-h-96 overflow-y-auto">
                                        ${factoryPredictions.slice(0, 5).map(pred => {
                                            const riskText = pred.riskLevel === 'high' ? 'ریسک بالا' : pred.riskLevel === 'medium' ? 'ریسک متوسط' : 'ریسک پایین';
                                            return `
                                                <div class="bg-gray-50 rounded-lg p-3 border-l-4 ${pred.riskLevel === 'high' ? 'border-red-500' : pred.riskLevel === 'medium' ? 'border-orange-500' : 'border-green-500'}">
                                                    <div class="flex items-center justify-between mb-1">
                                                        <h5 class="font-semibold text-sm text-gray-900">${pred.equipmentName}</h5>
                                                        <span class="px-2 py-1 rounded text-xs font-medium ${
                                                            pred.riskLevel === 'high' ? 'bg-red-100 text-red-700' : 
                                                            pred.riskLevel === 'medium' ? 'bg-orange-100 text-orange-700' : 
                                                            'bg-green-100 text-green-700'
                                                        }">${riskText}</span>
                                                    </div>
                                                    <p class="text-xs text-gray-600 mb-1">${pred.failureType}</p>
                                                    <div class="flex items-center justify-between text-xs">
                                                        <span class="text-gray-500">احتمال: <span class="font-bold text-red-600">${pred.probability}%</span></span>
                                                        <span class="text-gray-500">${pred.daysRemaining} روز باقیمانده</span>
                                                    </div>
                                                </div>
                                            `;
                                        }).join('')}
                                    </div>
                                ` : '<p class="text-center text-gray-500 py-4">هیچ پیش‌بینی خرابی وجود ندارد</p>'}
                            </div>
                        </div>
                        
                        <!-- توصیه‌های هوش مصنوعی -->
                        <div class="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl p-6 border border-indigo-200">
                            <h4 class="font-bold text-lg text-gray-900 mb-4 flex items-center gap-2">
                                <i class="fas fa-lightbulb text-yellow-600"></i>
                                توصیه‌های هوش مصنوعی برای ${factory.name}
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="bg-white rounded-lg p-4 border border-gray-200">
                                    <div class="flex items-start gap-3">
                                        <div class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                            <i class="fas fa-cog text-purple-600"></i>
                                        </div>
                                        <div>
                                            <h5 class="font-semibold text-gray-900 mb-1">بهینه‌سازی فرآیند</h5>
                                            <p class="text-xs text-gray-600">AI پیشنهاد می‌کند: تنظیم پارامترهای عملیاتی می‌تواند راندمان را ۳.۵% افزایش دهد</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="bg-white rounded-lg p-4 border border-gray-200">
                                    <div class="flex items-start gap-3">
                                        <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                            <i class="fas fa-bolt text-blue-600"></i>
                                        </div>
                                        <div>
                                            <h5 class="font-semibold text-gray-900 mb-1">کاهش مصرف انرژی</h5>
                                            <p class="text-xs text-gray-600">AI پیشنهاد می‌کند: برنامه‌ریزی تولید در ساعات کم‌بار می‌تواند هزینه انرژی را ۱۵% کاهش دهد</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="bg-white rounded-lg p-4 border border-gray-200">
                                    <div class="flex items-start gap-3">
                                        <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                            <i class="fas fa-shield-alt text-green-600"></i>
                                        </div>
                                        <div>
                                            <h5 class="font-semibold text-gray-900 mb-1">پیشگیری از خرابی</h5>
                                            <p class="text-xs text-gray-600">AI پیشنهاد می‌کند: تعمیرات پیشگیرانه برای ۳ تجهیز با ریسک بالا در ۱۰ روز آینده</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="bg-white rounded-lg p-4 border border-gray-200">
                                    <div class="flex items-start gap-3">
                                        <div class="w-8 h-8 bg-orange-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                            <i class="fas fa-chart-bar text-orange-600"></i>
                                        </div>
                                        <div>
                                            <h5 class="font-semibold text-gray-900 mb-1">بهبود کیفیت</h5>
                                            <p class="text-xs text-gray-600">AI پیشنهاد می‌کند: کالیبراسیون سنسورها و تنظیم پارامترهای کنترل کیفیت</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (tabName === 'production') {
                // تولید و بهره‌وری
                contentDiv.innerHTML = `
                    <div>
                        <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
                            <i class="fas fa-industry text-green-600"></i>
                            تولید و بهره‌وری ${factory.name}
                        </h3>
                        
                        <!-- آمار کلی -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                            <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-6 border border-green-200 shadow-sm">
                                <div class="flex items-center justify-between mb-2">
                                    <div class="text-sm text-gray-600">تولید روزانه</div>
                                    <i class="fas fa-chart-line text-green-600"></i>
                                </div>
                                <div class="text-3xl font-bold text-green-600 mb-1">${factory.capacity.split(' ')[0]}</div>
                                <div class="text-xs text-gray-500">میلیون تن/سال</div>
                                <div class="mt-2 text-xs text-green-600">
                                    <i class="fas fa-arrow-up ml-1"></i>
                                    +۲.۳% نسبت به ماه قبل
                                </div>
                            </div>
                            <div class="bg-gradient-to-br from-blue-50 to-cyan-50 rounded-xl p-6 border border-blue-200 shadow-sm">
                                <div class="flex items-center justify-between mb-2">
                                    <div class="text-sm text-gray-600">راندمان</div>
                                    <i class="fas fa-percentage text-blue-600"></i>
                                </div>
                                <div class="text-3xl font-bold text-blue-600 mb-1">۹۶%</div>
                                <div class="text-xs text-gray-500">بهینه</div>
                                <div class="mt-2 text-xs text-blue-600">
                                    <i class="fas fa-arrow-up ml-1"></i>
                                    +۱.۲% بهبود
                                </div>
                            </div>
                            <div class="bg-gradient-to-br from-orange-50 to-amber-50 rounded-xl p-6 border border-orange-200 shadow-sm">
                                <div class="flex items-center justify-between mb-2">
                                    <div class="text-sm text-gray-600">کیفیت محصول</div>
                                    <i class="fas fa-star text-orange-600"></i>
                                </div>
                                <div class="text-3xl font-bold text-orange-600 mb-1">۹۸%</div>
                                <div class="text-xs text-gray-500">عالی</div>
                                <div class="mt-2 text-xs text-orange-600">
                                    <i class="fas fa-check-circle ml-1"></i>
                                    بالاتر از استاندارد
                                </div>
                            </div>
                            <div class="bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl p-6 border border-purple-200 shadow-sm">
                                <div class="flex items-center justify-between mb-2">
                                    <div class="text-sm text-gray-600">مصرف انرژی</div>
                                    <i class="fas fa-bolt text-purple-600"></i>
                                </div>
                                <div class="text-3xl font-bold text-purple-600 mb-1">۲.۴</div>
                                <div class="text-xs text-gray-500">MW</div>
                                <div class="mt-2 text-xs text-green-600">
                                    <i class="fas fa-arrow-down ml-1"></i>
                                    -۳.۵% کاهش
                                </div>
                            </div>
                        </div>
                        
                        <!-- خطوط تولید -->
                        <div class="bg-white rounded-xl p-6 border border-gray-200 shadow-sm mb-6">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="font-bold text-lg text-gray-900">خطوط تولید</h4>
                                <button class="px-4 py-2 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg text-sm font-medium transition">
                                    <i class="fas fa-sync-alt ml-2"></i>
                                    به‌روزرسانی
                                </button>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                ${factory.lines.map((line, index) => `
                                    <div class="bg-gradient-to-r from-gray-50 to-gray-100 rounded-lg p-4 border border-gray-200 hover:shadow-md transition">
                                        <div class="flex items-center justify-between mb-3">
                                            <h5 class="font-semibold text-gray-900">${line}</h5>
                                            <span class="px-2 py-1 bg-green-100 text-green-700 rounded text-xs font-medium">فعال</span>
                                        </div>
                                        <div class="grid grid-cols-2 gap-3 text-sm">
                                            <div>
                                                <span class="text-gray-600">تولید:</span>
                                                <span class="font-semibold text-gray-900 mr-2">${(parseFloat(factory.capacity.split(' ')[0]) / factory.lines.length).toFixed(2)}M تن/سال</span>
                                            </div>
                                            <div>
                                                <span class="text-gray-600">راندمان:</span>
                                                <span class="font-semibold text-green-600 mr-2">۹۶%</span>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <!-- نمودار بهره‌وری -->
                        <div class="bg-white rounded-xl p-6 border border-gray-200 shadow-sm">
                            <h4 class="font-bold text-lg text-gray-900 mb-4">روند بهره‌وری (۳ ماه اخیر)</h4>
                            <div class="h-64 bg-gradient-to-br from-gray-50 to-gray-100 rounded-lg flex items-center justify-center border border-gray-200">
                                <div class="text-center">
                                    <i class="fas fa-chart-area text-4xl text-gray-400 mb-2"></i>
                                    <p class="text-gray-500">نمودار بهره‌وری در حال بارگذاری...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (tabName === 'reports') {
                // گزارش‌ها و تحلیل‌ها
                contentDiv.innerHTML = `
                    <div>
                        <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
                            <i class="fas fa-file-alt text-indigo-600"></i>
                            گزارش‌ها و تحلیل‌های ${factory.name}
                        </h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <!-- گزارش عملکرد -->
                            <div class="bg-gradient-to-br from-blue-50 to-cyan-50 rounded-xl p-6 border border-blue-200 shadow-sm">
                                <div class="flex items-center gap-3 mb-4">
                                    <div class="w-12 h-12 bg-blue-600 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-chart-bar text-white"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-lg text-gray-900">گزارش عملکرد</h4>
                                        <p class="text-xs text-gray-600">گزارش ماهانه عملکرد</p>
                                    </div>
                                </div>
                                <div class="space-y-2 mb-4">
                                    <div class="flex items-center justify-between text-sm">
                                        <span class="text-gray-600">گزارش دی ۱۴۰۳</span>
                                        <span class="px-2 py-1 bg-green-100 text-green-700 rounded text-xs">آماده</span>
                                    </div>
                                    <div class="flex items-center justify-between text-sm">
                                        <span class="text-gray-600">گزارش آذر ۱۴۰۳</span>
                                        <span class="px-2 py-1 bg-green-100 text-green-700 rounded text-xs">آماده</span>
                                    </div>
                                </div>
                                <button class="w-full py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition">
                                    <i class="fas fa-download ml-2"></i>
                                    دانلود گزارش
                                </button>
                            </div>
                            
                            <!-- گزارش تحلیل خرابی -->
                            <div class="bg-gradient-to-br from-red-50 to-orange-50 rounded-xl p-6 border border-red-200 shadow-sm">
                                <div class="flex items-center gap-3 mb-4">
                                    <div class="w-12 h-12 bg-red-600 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-exclamation-triangle text-white"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-lg text-gray-900">گزارش تحلیل خرابی</h4>
                                        <p class="text-xs text-gray-600">تحلیل خرابی‌های شناسایی شده</p>
                                    </div>
                                </div>
                                <div class="space-y-2 mb-4">
                                    <div class="flex items-center justify-between text-sm">
                                        <span class="text-gray-600">گزارش هفتگی</span>
                                        <span class="px-2 py-1 bg-yellow-100 text-yellow-700 rounded text-xs">در انتظار</span>
                                    </div>
                                    <div class="flex items-center justify-between text-sm">
                                        <span class="text-gray-600">گزارش ماهانه</span>
                                        <span class="px-2 py-1 bg-green-100 text-green-700 rounded text-xs">آماده</span>
                                    </div>
                                </div>
                                <button class="w-full py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition">
                                    <i class="fas fa-file-pdf ml-2"></i>
                                    مشاهده گزارش
                                </button>
                            </div>
                            
                            <!-- گزارش بهره‌وری -->
                            <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-6 border border-green-200 shadow-sm">
                                <div class="flex items-center gap-3 mb-4">
                                    <div class="w-12 h-12 bg-green-600 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-chart-line text-white"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-lg text-gray-900">گزارش بهره‌وری</h4>
                                        <p class="text-xs text-gray-600">تحلیل بهره‌وری و راندمان</p>
                                    </div>
                                </div>
                                <div class="space-y-2 mb-4">
                                    <div class="flex items-center justify-between text-sm">
                                        <span class="text-gray-600">گزارش فصلی</span>
                                        <span class="px-2 py-1 bg-green-100 text-green-700 rounded text-xs">آماده</span>
                                    </div>
                                    <div class="flex items-center justify-between text-sm">
                                        <span class="text-gray-600">گزارش سالانه</span>
                                        <span class="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs">در حال تهیه</span>
                                    </div>
                                </div>
                                <button class="w-full py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition">
                                    <i class="fas fa-chart-pie ml-2"></i>
                                    مشاهده تحلیل
                                </button>
                            </div>
                            
                            <!-- گزارش تعمیرات -->
                            <div class="bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl p-6 border border-purple-200 shadow-sm">
                                <div class="flex items-center gap-3 mb-4">
                                    <div class="w-12 h-12 bg-purple-600 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-tools text-white"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-lg text-gray-900">گزارش تعمیرات</h4>
                                        <p class="text-xs text-gray-600">گزارش تعمیرات و نگهداری</p>
                                    </div>
                                </div>
                                <div class="space-y-2 mb-4">
                                    <div class="flex items-center justify-between text-sm">
                                        <span class="text-gray-600">گزارش هفتگی</span>
                                        <span class="px-2 py-1 bg-green-100 text-green-700 rounded text-xs">آماده</span>
                                    </div>
                                </div>
                                <button class="w-full py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-medium transition">
                                    <i class="fas fa-wrench ml-2"></i>
                                    مشاهده گزارش
                                </button>
                            </div>
                            
                            <!-- گزارش مالی -->
                            <div class="bg-gradient-to-br from-yellow-50 to-amber-50 rounded-xl p-6 border border-yellow-200 shadow-sm">
                                <div class="flex items-center gap-3 mb-4">
                                    <div class="w-12 h-12 bg-yellow-600 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-dollar-sign text-white"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-lg text-gray-900">گزارش مالی</h4>
                                        <p class="text-xs text-gray-600">هزینه‌ها و درآمدها</p>
                                    </div>
                                </div>
                                <div class="space-y-2 mb-4">
                                    <div class="flex items-center justify-between text-sm">
                                        <span class="text-gray-600">گزارش ماهانه</span>
                                        <span class="px-2 py-1 bg-green-100 text-green-700 rounded text-xs">آماده</span>
                                    </div>
                                </div>
                                <button class="w-full py-2 bg-yellow-600 hover:bg-yellow-700 text-white rounded-lg font-medium transition">
                                    <i class="fas fa-file-invoice-dollar ml-2"></i>
                                    مشاهده گزارش
                                </button>
                            </div>
                            
                            <!-- گزارش AI -->
                            <div class="bg-gradient-to-br from-indigo-50 to-purple-50 rounded-xl p-6 border border-indigo-200 shadow-sm">
                                <div class="flex items-center gap-3 mb-4">
                                    <div class="w-12 h-12 bg-indigo-600 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-robot text-white"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-lg text-gray-900">گزارش تحلیل AI</h4>
                                        <p class="text-xs text-gray-600">تحلیل هوشمند با هوش مصنوعی</p>
                                    </div>
                                </div>
                                <div class="space-y-2 mb-4">
                                    <div class="flex items-center justify-between text-sm">
                                        <span class="text-gray-600">تحلیل جامع AI</span>
                                        <span class="px-2 py-1 bg-purple-100 text-purple-700 rounded text-xs">در حال پردازش</span>
                                    </div>
                                </div>
                                <button class="w-full py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-medium transition">
                                    <i class="fas fa-brain ml-2"></i>
                                    مشاهده تحلیل AI
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }
        }
        
        // جستجوی تجهیزات کارخانه
        function searchFactoryEquipment(query) {
            if (!selectedFactoryId) return;
            const factory = factoriesData[selectedFactoryId];
            if (!factory) return;
            
            const filteredEquipment = equipmentDatabase.filter(eq => {
                const matchesFactory = eq.section.includes(factory.name) || factory.lines.some(line => eq.location.includes(line));
                const matchesQuery = !query || eq.name.toLowerCase().includes(query.toLowerCase()) || eq.id.toLowerCase().includes(query.toLowerCase());
                return matchesFactory && matchesQuery;
            });
            
            const contentDiv = document.getElementById('selected-factory-content');
            if (!contentDiv) return;
            
            const equipmentGrid = contentDiv.querySelector('.grid');
            if (equipmentGrid) {
                equipmentGrid.innerHTML = filteredEquipment.length > 0 ? filteredEquipment.map(eq => `
                    <div class="bg-gray-50 rounded-lg p-4 border border-gray-200 hover:border-cyan-500 transition cursor-pointer" onclick="showEquipmentDetails('${eq.id}')">
                        <div class="flex items-center justify-between mb-2">
                            <h5 class="font-semibold text-gray-900">${eq.name}</h5>
                            <span class="px-2 py-1 rounded text-xs font-medium ${
                                eq.status === 'فعال' ? 'bg-green-100 text-green-700' : 
                                eq.status === 'نیاز به بازرسی' ? 'bg-yellow-100 text-yellow-700' : 
                                'bg-red-100 text-red-700'
                            }">${eq.status}</span>
                        </div>
                        <p class="text-xs text-gray-600 mb-2">${eq.section} - ${eq.location}</p>
                        <div class="flex items-center justify-between text-xs text-gray-500">
                            <span>کد: ${eq.id}</span>
                            <span>${eq.manufacturer}</span>
                        </div>
                    </div>
                `).join('') : '<p class="col-span-3 text-center text-gray-500 py-8">تجهیزاتی یافت نشد</p>';
            }
        }
        
        // بارگذاری تحلیل خرابی کارخانه
        function loadFactoryFailureAnalysis(factoryId) {
            const factory = factoriesData[factoryId];
            if (!factory) return;
            
            const analysisDiv = document.getElementById(`factory-${factoryId}-failure-analysis`);
            if (!analysisDiv) return;
            
            // فیلتر پیش‌بینی‌های خرابی مربوط به این کارخانه
            const factoryPredictions = failurePredictions.filter(pred => 
                pred.section.includes(factory.name) || factory.lines.some(line => pred.equipmentName.includes(line))
            );
            
            if (factoryPredictions.length === 0) {
                analysisDiv.innerHTML = '<p class="text-center text-gray-500 py-4">هیچ پیش‌بینی خرابی برای این کارخانه وجود ندارد</p>';
                return;
            }
            
            analysisDiv.innerHTML = factoryPredictions.slice(0, 5).map(pred => {
                const riskClass = pred.riskLevel === 'high' ? 'high-risk' : pred.riskLevel === 'medium' ? 'medium-risk' : 'low-risk';
                const riskText = pred.riskLevel === 'high' ? 'ریسک بالا' : pred.riskLevel === 'medium' ? 'ریسک متوسط' : 'ریسک پایین';
                
                return `
                    <div class="bg-gray-50 rounded-lg p-4 border-l-4 ${pred.riskLevel === 'high' ? 'border-red-500' : pred.riskLevel === 'medium' ? 'border-orange-500' : 'border-green-500'} mb-3">
                        <div class="flex items-center justify-between mb-2">
                            <h5 class="font-semibold text-gray-900">${pred.equipmentName}</h5>
                            <span class="px-2 py-1 rounded text-xs font-medium ${
                                pred.riskLevel === 'high' ? 'bg-red-100 text-red-700' : 
                                pred.riskLevel === 'medium' ? 'bg-orange-100 text-orange-700' : 
                                'bg-green-100 text-green-700'
                            }">${riskText}</span>
                        </div>
                        <p class="text-sm text-gray-600 mb-2">${pred.failureType}</p>
                        <div class="flex items-center justify-between text-xs text-gray-500">
                            <span>احتمال: ${pred.probability}%</span>
                            <span>${pred.daysRemaining} روز باقیمانده</span>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // بستن جزئیات کارخانه
        function closeFactoryDetails() {
            const infoDiv = document.getElementById('selected-factory-info');
            if (infoDiv) {
                infoDiv.style.display = 'none';
            }
        }

        // بارگذاری اولیه
        document.addEventListener('DOMContentLoaded', function() {
            // بارگذاری ساختار سلسله‌مراتبی
            loadEquipmentHierarchy();
            
            // بارگذاری سایت پلن خطی کارخانه‌ها
            loadFactoryTimeline();
            
            // بارگذاری بانک اطلاعاتی به صورت پیش‌فرض
            setTimeout(() => {
                if (document.getElementById('equipment-database-tab') && 
                    !document.getElementById('equipment-database-tab').classList.contains('hidden')) {
                    loadEquipmentDatabase();
                }
                // بارگذاری پیش‌بینی‌های خرابی - همیشه بارگذاری کن
                if (document.getElementById('prediction-grid')) {
                    loadFailurePredictions();
                }
            }, 500);
        });
    </script>
</body>

</html>